<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Commit TUI Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header Navigation */
        .header-nav {
            background: #2d2d30;
            border-bottom: 2px solid #007acc;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-tabs {
            display: flex;
            gap: 4px;
        }

        .nav-tab {
            padding: 6px 16px;
            background: #3e3e42;
            border: 1px solid #555;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px 4px 0 0;
        }

        .nav-tab:hover {
            background: #4a4a4f;
        }

        .nav-tab.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: #969696;
        }

        .sync-status .refresh-icon {
            animation: spin 1s linear infinite;
            display: none;
        }

        .sync-status.refreshing .refresh-icon {
            display: inline;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .repo-info {
            padding: 16px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
        }

        .repo-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
            font-size: 13px;
        }

        .dynamic-list {
            flex: 1;
            padding: 8px;
        }

        .list-title {
            font-size: 12px;
            color: #969696;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .list-item {
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 4px;
            margin: 2px 0;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .list-item:hover {
            background: #2a2d2e;
        }

        .list-item.selected {
            background: #094771;
        }

        .list-item .icon {
            width: 16px;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
            overflow: hidden;
        }

        .view-container {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: none;
        }

        .view-container.active {
            display: block;
        }

        /* Git Log View */
        .git-log {
            font-family: monospace;
        }

        .commit-item {
            padding: 8px;
            border: 1px solid #3e3e42;
            margin: 4px 0;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .commit-item:hover {
            background: #2a2d2e;
        }

        .commit-item.selected {
            background: #094771;
            border-color: #007acc;
        }

        .commit-hash {
            color: #f1c232;
            font-family: monospace;
        }

        .commit-date {
            color: #969696;
            font-size: 12px;
        }

        .commit-message {
            flex: 1;
        }

        .commit-status {
            font-size: 16px;
        }

        .stash-icon {
            font-size: 14px;
            margin-right: 4px;
        }

        .remote-icon, .search-icon {
            font-size: 14px;
            margin-right: 4px;
        }

        /* File Status List */
        .file-status-list {
            background: #1e1e1e;
            border-radius: 4px;
            padding: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .file-item:hover {
            background: #252526;
        }

        .file-item.selected {
            background: #094771;
        }

        .file-item.staged {
            border-left: 3px solid #4ec9b0;
        }

        .file-item.unstaged {
            border-left: 3px solid #f14c4c;
        }

        .file-item.untracked {
            border-left: 3px solid #969696;
        }

        .file-status-icon {
            width: 20px;
            text-align: center;
            margin-right: 8px;
            font-weight: bold;
        }

        .file-path {
            flex: 1;
            color: #cccccc;
            margin-right: 8px;
        }

        .file-status {
            color: #969696;
            font-size: 12px;
            margin-right: 8px;
            min-width: 60px;
        }

        .file-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .file-item:hover .file-actions {
            opacity: 1;
        }

        .btn-small {
            padding: 2px 6px;
            font-size: 11px;
            border: 1px solid #3e3e42;
            background: #2d2d30;
            color: #cccccc;
            border-radius: 3px;
            cursor: pointer;
        }

        .btn-small:hover {
            background: #3e3e42;
        }

        .btn-small.btn-danger {
            border-color: #f14c4c;
            color: #f14c4c;
        }

        /* Enhanced Status View Styles */
        .file-item.selected {
            background: #094771;
            border-color: #007acc;
        }

        .file-stats {
            font-family: monospace;
            margin-left: auto;
            margin-right: 8px;
        }

        .status-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .status-card {
            padding: 8px;
            background: #2d2d30;
            border-radius: 4px;
            border-left: 3px solid;
        }

        .status-card.modified {
            border-left-color: #f14c4c;
        }

        .status-card.untracked {
            border-left-color: #ffcc02;
        }

        .status-card.staged {
            border-left-color: #4ec9b0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .section-title {
            margin: 0;
            display: flex;
            align-items: center;
        }

        .section-count {
            color: #569cd6;
            font-size: 11px;
            margin-left: 8px;
        }

        .empty-state {
            padding: 12px;
            background: #2d2d30;
            border-radius: 4px;
            text-align: center;
            color: #969696;
            font-style: italic;
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #2d2d30;
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .keyboard-shortcuts {
            padding: 12px;
            background: #1e1e1e;
            border-radius: 4px;
            border-left: 3px solid #569cd6;
        }

        .shortcut-list {
            font-size: 12px;
            color: #969696;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .btn-small.btn-danger:hover {
            background: #f14c4c;
            color: #ffffff;
        }

        /* Commit Files List */
        .commit-files {
            background: #1e1e1e;
            border-radius: 4px;
            padding: 8px;
            max-height: 150px;
            overflow-y: auto;
        }

        .commit-file-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 3px;
            margin-bottom: 2px;
        }

        .commit-file-item:hover {
            background: #252526;
        }

        /* Enhanced Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            display: none;
            overflow: hidden;
            backdrop-filter: blur(2px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            animation: modalFadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                backdrop-filter: blur(0px);
            }
            to {
                opacity: 1;
                backdrop-filter: blur(2px);
            }
        }

        /* Enhanced Modal Content Sizing with Responsive Design */
        .modal-content {
            background: #2d2d30;
            border: 2px solid #007acc;
            border-radius: 12px;
            max-width: min(95vw, 1200px);
            max-height: min(95vh, 800px);
            width: auto;
            min-width: min(300px, 90vw);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Mobile responsiveness for modals */
        @media (max-width: 768px) {
            .modal-content {
                max-width: 95vw;
                max-height: 90vh;
                margin: 10px;
            }
        }

        .modal.active .modal-content {
            transform: scale(1);
            animation: modalContentEnter 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalContentEnter {
            from {
                transform: scale(0.95) translateY(-10px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(62, 62, 66, 0.8);
            flex-shrink: 0;
            background: linear-gradient(135deg, #323233 0%, #2d2d30 100%);
            position: relative;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 122, 204, 0.5), transparent);
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #007acc;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            background: none;
            border: none;
            color: #969696;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .modal-close:hover {
            background: rgba(241, 76, 76, 0.1);
            color: #f14c4c;
            transform: scale(1.1);
        }

        .modal-body {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 24px;
            background: #2d2d30;
        }

        .modal-footer {
            padding: 16px 24px;
            background: linear-gradient(135deg, #252526 0%, #2d2d30 100%);
            border-top: 1px solid rgba(62, 62, 66, 0.8);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            flex-shrink: 0;
        }

        /* Enhanced Custom Alert/Confirm Styles with Responsive Design */
        #customAlertModal .modal-content,
        #customConfirmModal .modal-content,
        #customPromptModal .modal-content {
            max-width: min(540px, 90vw);
            min-width: min(400px, 80vw);
            width: auto;
        }

        /* Mobile adjustments for custom modals */
        @media (max-width: 480px) {
            #customAlertModal .modal-content,
            #customConfirmModal .modal-content,
            #customPromptModal .modal-content {
                min-width: 90vw;
                margin: 20px;
            }
        }

        #alertMessage,
        #confirmMessage,
        #promptMessage {
            padding: 20px 0;
            line-height: 1.6;
            color: #e6edf3;
            font-size: 14px;
            text-align: left;
        }

        /* Custom Prompt Input Styling */
        #customPromptModal .form-input {
            margin-top: 16px;
            padding: 12px 16px;
            font-size: 14px;
            border-radius: 8px;
            border: 2px solid #3e3e42;
            background: #1e1e1e;
            color: #e6edf3;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #customPromptModal .form-input:focus {
            border-color: #007acc;
            box-shadow:
                0 0 0 3px rgba(0, 122, 204, 0.1),
                inset 0 1px 2px rgba(0, 0, 0, 0.1);
            outline: none;
        }

        #customPromptModal .form-input::placeholder {
            color: #7d8590;
            font-style: italic;
        }

        /* Enhanced Buttons for Modals */
        .btn {
            padding: 10px 20px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0 2px;
            position: relative;
            overflow: hidden;
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: #1177bb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 204, 0.3);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 122, 204, 0.2);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:disabled::before {
            display: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0e639c 0%, #1177bb 100%);
            box-shadow: 0 2px 8px rgba(14, 99, 156, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1177bb 0%, #139ce0 100%);
            box-shadow: 0 4px 16px rgba(14, 99, 156, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3e3e42 0%, #4a4a4f 100%);
            color: #e6edf3;
            box-shadow: 0 2px 8px rgba(62, 62, 66, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #4a4a4f 0%, #565656 100%);
            box-shadow: 0 4px 16px rgba(62, 62, 66, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f14c4c 0%, #d73a49 100%);
            box-shadow: 0 2px 8px rgba(241, 76, 76, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #f36666 0%, #e25461 100%);
            box-shadow: 0 4px 16px rgba(241, 76, 76, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #34ce57 100%);
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #218838 0%, #28a745 100%);
            box-shadow: 0 4px 16px rgba(40, 167, 69, 0.4);
        }

        .close-btn {
            background: none;
            border: none;
            color: #ccc;
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: #fff;
            background: #f44336;
            border-radius: 4px;
        }

        /* Status Bar */
        .status-bar {
            background: #007acc;
            color: white;
            padding: 4px 16px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-left {
            display: flex;
            gap: 16px;
        }

        .status-right {
            display: flex;
            gap: 16px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            color: #cccccc;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 6px 8px;
            background: #3e3e42;
            border: 1px solid #555;
            color: #cccccc;
            border-radius: 4px;
            font-family: inherit;
            font-size: 13px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: #007acc;
        }

        /* AI Commit Specific */
        .ai-suggestions {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
        }

        .ai-suggestion-item {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-suggestion-item:hover {
            border-color: #007acc;
            background: #2a2d2e;
        }

        .ai-suggestion-item.selected {
            border-color: #007acc;
            background: #094771;
        }

        .ai-suggestion-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4ec9b0;
        }

        .ai-suggestion-body {
            font-size: 12px;
            color: #969696;
            white-space: pre-wrap;
        }

        .progress-bar {
            height: 4px;
            background: #3e3e42;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: #007acc;
            transition: width 0.3s;
        }

        /* Diff Viewer */
        /* Enhanced Diff Viewer */
        .diff-viewer {
            font-family: 'Fira Code', 'JetBrains Mono', 'Monaco', monospace;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .diff-header {
            background: #323233;
            padding: 12px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .diff-modes {
            display: flex;
            gap: 8px;
        }

        .diff-mode-btn {
            padding: 6px 12px;
            background: #3e3e42;
            border: 1px solid #555;
            color: #d4d4d4;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s;
        }

        .diff-mode-btn.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }

        .diff-mode-btn:hover:not(.active) {
            background: #4a4a4f;
        }

        .diff-stats {
            font-size: 12px;
            color: #969696;
            display: flex;
            gap: 16px;
        }

        .diff-content {
            flex: 1;
            overflow: auto;
            padding: 0;
            position: relative;
        }

        .diff-line {
            padding: 4px 12px;
            white-space: pre;
            font-family: inherit;
            font-size: 13px;
            line-height: 1.5;
            border-left: 3px solid transparent;
            transition: background-color 0.1s;
            display: flex;
            align-items: flex-start;
        }

        .diff-line:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .diff-line.added {
            background: rgba(46, 160, 67, 0.15);
            border-left-color: #2ea043;
            color: #aff5b4;
        }

        .diff-line.removed {
            background: rgba(248, 81, 73, 0.15);
            border-left-color: #f85149;
            color: #ffdcd7;
        }

        .diff-line.context {
            color: #e6edf3;
        }

        .diff-line.hunk {
            background: rgba(1, 132, 188, 0.15);
            border-left-color: #0184bc;
            color: #79c0ff;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .diff-line-number {
            display: inline-block;
            width: 60px;
            color: #7d8590;
            text-align: right;
            margin-right: 16px;
            user-select: none;
            flex-shrink: 0;
        }

        .diff-line-content {
            flex: 1;
            white-space: pre;
        }

        /* Syntax Highlighting for Code */
        .diff-line .token.keyword { color: #ff7b72; }
        .diff-line .token.string { color: #a5d6ff; }
        .diff-line .token.comment { color: #8b949e; font-style: italic; }
        .diff-line .token.function { color: #d2a8ff; }
        .diff-line .token.number { color: #79c0ff; }
        .diff-line .token.operator { color: #ff7b72; }
        .diff-line .token.punctuation { color: #e6edf3; }

        /* Enhanced File Management System */
        .file-status-list {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            max-height: 500px;
            overflow: hidden;
            margin: 8px 0;
            display: flex;
            flex-direction: column;
        }

        .file-list-header {
            background: #323233;
            padding: 8px 12px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: #969696;
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .file-list-title {
            font-weight: 600;
            color: #e6edf3;
        }

        .file-list-count {
            background: #21262d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .file-list-content {
            flex: 1;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid #2d2d30;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .file-item:hover {
            background: #2a2d2e;
            border-left: 3px solid #007acc;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item.selected {
            background: rgba(0, 122, 204, 0.1);
            border-left: 3px solid #007acc;
        }

        .file-status {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            border-radius: 4px;
            font-size: 12px;
        }

        .file-status.modified { background: rgba(255, 165, 0, 0.2); color: #ffab00; }
        .file-status.added { background: rgba(46, 160, 67, 0.2); color: #2ea043; }
        .file-status.deleted { background: rgba(248, 81, 73, 0.2); color: #f85149; }
        .file-status.renamed { background: rgba(121, 192, 255, 0.2); color: #79c0ff; }
        .file-status.untracked { background: rgba(158, 106, 255, 0.2); color: #a855f7; }

        .file-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .file-name {
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
            font-size: 13px;
            color: #e6edf3;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-path {
            font-size: 11px;
            color: #7d8590;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-stats {
            font-size: 11px;
            color: #7d8590;
            margin-left: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-actions {
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.2s;
            margin-left: 12px;
        }

        .file-item:hover .file-actions {
            opacity: 1;
        }

        .file-action-btn {
            padding: 4px 8px;
            background: #3e3e42;
            border: 1px solid #555;
            color: #d4d4d4;
            cursor: pointer;
            border-radius: 4px;
            font-size: 11px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .file-action-btn:hover {
            background: #4a4a4f;
            transform: translateY(-1px);
        }

        .file-action-btn.stage {
            background: #238636;
            border-color: #2ea043;
            color: white;
        }

        .file-action-btn.unstage {
            background: #da3633;
            border-color: #f85149;
            color: white;
        }

        .file-action-btn.diff {
            background: #1f6feb;
            border-color: #388bfd;
            color: white;
        }

        /* Advanced Search and Filter System */
        .search-container {
            background: #323233;
            border-bottom: 1px solid #3e3e42;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-input-group {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 8px 40px 8px 12px;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            color: #e6edf3;
            font-size: 13px;
            outline: none;
            transition: all 0.2s;
        }

        .search-input:focus {
            border-color: #007acc;
            box-shadow: 0 0 0 1px rgba(0, 122, 204, 0.3);
        }

        .search-input::placeholder {
            color: #7d8590;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            color: #7d8590;
            font-size: 14px;
            pointer-events: none;
        }

        .search-clear {
            position: absolute;
            right: 12px;
            background: none;
            border: none;
            color: #7d8590;
            cursor: pointer;
            font-size: 16px;
            padding: 2px;
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .search-input:not(:placeholder-shown) + .search-clear {
            opacity: 1;
        }

        .search-clear:hover {
            color: #f85149;
            background: rgba(248, 81, 73, 0.1);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 12px;
            color: #7d8590;
            font-weight: 500;
        }

        .filter-dropdown {
            padding: 6px 8px;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            color: #e6edf3;
            font-size: 12px;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }

        .filter-dropdown:focus {
            border-color: #007acc;
        }

        .filter-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: rgba(0, 122, 204, 0.2);
            border: 1px solid #007acc;
            border-radius: 12px;
            font-size: 11px;
            color: #79c0ff;
        }

        .filter-tag-remove {
            background: none;
            border: none;
            color: #79c0ff;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            display: flex;
            align-items: center;
        }

        .filter-tag-remove:hover {
            color: #f85149;
        }

        .search-stats {
            font-size: 11px;
            color: #7d8590;
            background: #21262d;
            padding: 4px 8px;
            border-radius: 12px;
            white-space: nowrap;
        }

        .quick-filters {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }

        .quick-filter {
            padding: 4px 8px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 4px;
            font-size: 11px;
            color: #d4d4d4;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .quick-filter.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }

        .quick-filter:hover:not(.active) {
            background: #4a4a4f;
        }

        /* Advanced Search Mode Buttons */
        .search-mode-buttons {
            display: flex;
            gap: 4px;
            margin-left: 8px;
            align-items: center;
        }

        .search-mode-btn {
            width: 28px;
            height: 28px;
            padding: 0;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
        }

        .search-mode-btn:hover {
            background: #4a4a4f;
            border-color: #007acc;
            transform: translateY(-1px);
        }

        .search-mode-btn.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 122, 204, 0.3);
        }

        .search-mode-btn:active {
            transform: translateY(0);
        }

        /* Search Results Highlighting */
        .search-highlight {
            background: rgba(255, 255, 0, 0.3);
            padding: 1px 2px;
            border-radius: 2px;
            font-weight: bold;
        }

        /* Saved Search Dropdown */
        .saved-search-dropdown {
            position: relative;
            margin-left: 8px;
        }

        .saved-search-btn {
            padding: 6px 12px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .saved-search-btn:hover {
            background: #4a4a4f;
            border-color: #007acc;
        }

        .saved-search-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .saved-search-menu.show {
            display: block;
        }

        .saved-search-item {
            padding: 8px 12px;
            border-bottom: 1px solid #3e3e42;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 12px;
        }

        .saved-search-item:hover {
            background: #3e3e42;
        }

        .saved-search-item:last-child {
            border-bottom: none;
        }

        .saved-search-name {
            font-weight: bold;
            color: #e6edf3;
            margin-bottom: 2px;
        }

        .saved-search-query {
            color: #7d8590;
            font-size: 11px;
        }

        /* Search Statistics Enhancement */
        .search-stats {
            font-size: 11px;
            color: #7d8590;
            background: #21262d;
            padding: 4px 8px;
            border-radius: 12px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-stats .stats-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .search-stats .stats-time {
            color: #569cd6;
            font-weight: bold;
        }

        /* Code Search Results */
        .code-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 999;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .code-search-results.show {
            display: block;
        }

        .code-search-item {
            padding: 8px 12px;
            border-bottom: 1px solid #3e3e42;
            cursor: pointer;
            transition: background 0.2s;
        }

        .code-search-item:hover {
            background: #3e3e42;
        }

        .code-search-file {
            font-size: 12px;
            color: #79c0ff;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .code-search-line {
            font-size: 11px;
            color: #7d8590;
            margin-bottom: 2px;
        }

        .code-search-content {
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
            font-size: 11px;
            color: #e6edf3;
            background: #1e1e1e;
            padding: 4px 8px;
            border-radius: 3px;
            overflow-x: auto;
        }

        /* Advanced Filter Panel */
        .advanced-filter-panel {
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .filter-section {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #3e3e42;
        }

        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .filter-label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #e6edf3;
        }

        .date-range-inputs, .size-range-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .date-range-inputs input, .size-range-inputs input {
            flex: 1;
            max-width: 150px;
        }

        .author-filter {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .author-tags, .custom-filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            background: #3e3e42;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 12px;
        }

        .checkbox-group label:hover {
            background: #4a4a4f;
        }

        .checkbox-group label input[type="checkbox"] {
            margin: 0;
        }

        .custom-filter {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .custom-filter input {
            flex: 1;
            min-width: 150px;
        }

        .filter-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            padding-top: 16px;
            border-top: 1px solid #3e3e42;
        }

        /* Advanced Filter Toggle Button */
        .advanced-filter-toggle {
            margin-left: 8px;
        }

        .advanced-filter-btn {
            padding: 6px 12px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .advanced-filter-btn:hover {
            background: #4a4a4f;
            border-color: #007acc;
        }

        .advanced-filter-btn.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }

        /* Syntax Highlighter Controls */
        .syntax-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-left: auto;
        }

        .syntax-control-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .syntax-label {
            font-size: 12px;
            color: #969696;
            white-space: nowrap;
        }

        .syntax-btn {
            padding: 4px 8px;
            background: #28a745;
            border: 1px solid #28a745;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .syntax-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .syntax-btn.disabled {
            background: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .syntax-select {
            padding: 4px 6px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            font-size: 11px;
            cursor: pointer;
            outline: none;
        }

        .syntax-select:focus {
            border-color: #007acc;
        }

        /* Enhanced Syntax Highlighting Tokens */
        .diff-line .token.keyword {
            color: #569cd6;
            font-weight: bold;
        }

        .diff-line .token.string {
            color: #ce9178;
        }

        .diff-line .token.comment {
            color: #6a9955;
            font-style: italic;
        }

        .diff-line .token.function {
            color: #dcdcaa;
            font-weight: 600;
        }

        .diff-line .token.number {
            color: #b5cea8;
        }

        .diff-line .token.operator {
            color: #d4d4d4;
        }

        .diff-line .token.punctuation {
            color: #d4d4d4;
        }

        .diff-line .token.macro {
            color: #c586c0;
            font-weight: bold;
        }

        .diff-line .token.tag {
            color: #569cd6;
        }

        .diff-line .token.attribute {
            color: #92c5f8;
        }

        .diff-line .token.selector {
            color: #d7ba7d;
        }

        .diff-line .token.property {
            color: #9cdcfe;
        }

        .diff-line .token.value {
            color: #ce9178;
        }

        .diff-line .token.header {
            color: #569cd6;
            font-weight: bold;
            font-size: 1.1em;
        }

        .diff-line .token.bold {
            font-weight: bold;
        }

        .diff-line .token.italic {
            font-style: italic;
        }

        .diff-line .token.code {
            background: rgba(110, 118, 129, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
        }

        .diff-line .token.link {
            color: #569cd6;
            text-decoration: underline;
        }

        /* Inline Editor Styles */
        .context-menu {
            position: fixed;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 6px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            min-width: 150px;
            overflow: hidden;
        }

        .context-menu-item {
            padding: 8px 12px;
            color: #d4d4d4;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .context-menu-item:hover {
            background: #007acc;
            color: white;
        }

        .context-menu-separator {
            height: 1px;
            background: #555;
            margin: 4px 0;
        }

        .diff-modified {
            background: rgba(40, 160, 40, 0.1);
            border-left: 3px solid #28a028;
            position: relative;
        }

        .diff-modified::after {
            content: '✏️';
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #28a028;
        }

        .inline-editor {
            background: #1e1e1e !important;
            border: 2px solid #007acc !important;
            color: #d4d4d4 !important;
            font-family: 'Fira Code', 'Consolas', monospace !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 122, 204, 0.3);
        }

        .inline-editor:focus {
            border-color: #28a028 !important;
            box-shadow: 0 0 0 2px rgba(40, 160, 40, 0.2);
        }

        .edit-hint {
            animation: slideInFromRight 0.3s ease-out;
        }

        .edit-hint .edit-shortcuts {
            margin-left: 8px;
            opacity: 0.8;
        }

        .edit-hint kbd {
            background: rgba(0, 122, 204, 0.2);
            border: 1px solid #007acc;
            border-radius: 2px;
            padding: 2px 4px;
            font-size: 10px;
            font-family: monospace;
        }

        .change-preview {
            animation: fadeInScale 0.3s ease-out;
        }

        .change-stats {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .stat-added {
            color: #28a745;
            font-weight: 600;
        }

        .stat-removed {
            color: #dc3545;
            font-weight: 600;
        }

        .stat-chars {
            color: #17a2b8;
            font-size: 10px;
        }

        .line-comment {
            animation: slideInFromLeft 0.3s ease-out;
        }

        .toast {
            animation: slideInFromTop 0.3s ease-out;
        }

        /* Inline Editor Animations */
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        /* Diff Analyzer Styles */
        .diff-stats-panel {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .stats-header {
            background: #007acc;
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            font-size: 14px;
        }

        .stats-content {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .stats-section {
            margin-bottom: 20px;
        }

        .stats-section h4 {
            margin: 0 0 12px 0;
            color: #d4d4d4;
            font-size: 13px;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 11px;
        }

        .stat-label {
            color: #969696;
        }

        .stat-value {
            font-weight: 600;
            color: #d4d4d4;
        }

        .stat-value.added {
            color: #28a745;
        }

        .stat-value.removed {
            color: #dc3545;
        }

        .stat-value.context {
            color: #6c757d;
        }

        .stat-value.movement {
            color: #17a2b8;
        }

        .stat-value.net {
            color: #ffc107;
        }

        .movement-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 11px;
        }

        .movement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .movement-title {
            font-weight: 600;
            color: #d4d4d4;
        }

        .movement-similarity {
            background: #007acc;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }

        .movement-content {
            color: #969696;
            font-family: 'Fira Code', monospace;
            font-size: 10px;
            line-height: 1.3;
        }

        .no-movements, .no-files {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
            font-size: 12px;
        }

        .complexity-bar {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .complexity-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .complexity-info {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #d4d4d4;
        }

        .file-stat-item {
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .file-name {
            font-weight: 600;
            color: #d4d4d4;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .file-changes {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 10px;
        }

        .file-added {
            color: #28a745;
            font-weight: 600;
        }

        .file-removed {
            color: #dc3545;
            font-weight: 600;
        }

        .file-bar {
            height: 4px;
            background: #333;
            border-radius: 2px;
            overflow: hidden;
            display: flex;
        }

        .file-bar-added {
            background: #28a745;
            transition: width 0.3s ease;
        }

        .file-bar-removed {
            background: #dc3545;
            transition: width 0.3s ease;
        }

        /* Code Movement Visual Indicators */
        .diff-line[data-movement] {
            position: relative;
        }

        .diff-line[data-movement]::before {
            content: '🔄';
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            opacity: 0.7;
        }

        /* Git Workflow Styles */
        .workflow-modal {
            width: 90%;
            max-width: 1000px;
            height: 80%;
        }

        .workflow-body {
            padding: 0;
        }

        .workflow-tabs {
            display: flex;
            border-bottom: 1px solid #555;
            background: #2d2d30;
        }

        .workflow-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: #d4d4d4;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .workflow-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .workflow-tab.active {
            color: #007acc;
            border-bottom-color: #007acc;
            background: rgba(0, 122, 204, 0.1);
        }

        .workflow-content {
            padding: 20px;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        .workflow-tab-content {
            display: none;
        }

        .workflow-tab-content.active {
            display: block;
        }

        .rebase-section, .merge-section, .gitflow-section, .conflict-section {
            max-width: 100%;
        }

        .rebase-controls, .merge-controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .commit-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid #555;
        }

        .commit-action {
            margin-right: 16px;
            min-width: 80px;
        }

        .commit-info {
            flex: 1;
        }

        .commit-message {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .commit-meta {
            font-size: 11px;
            color: #969696;
        }

        .commit-controls {
            display: flex;
            gap: 4px;
        }

        .btn-icon {
            background: none;
            border: 1px solid #555;
            color: #d4d4d4;
            width: 24px;
            height: 24px;
            cursor: pointer;
            border-radius: 3px;
        }

        .btn-icon:hover {
            background: #007acc;
            border-color: #007acc;
        }

        .status-message {
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
        }

        .status-message.info {
            background: rgba(0, 122, 204, 0.1);
            border: 1px solid #007acc;
            color: #007acc;
        }

        .status-message.success {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
            color: #28a745;
        }

        .status-message.warning {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            color: #ffc107;
        }

        .status-message.error {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid #dc3545;
            color: #dc3545;
        }

        /* Git Flow Specific Styles */
        .gitflow-section {
            padding: 15px;
        }

        .gitflow-init-section,
        .gitflow-features,
        .gitflow-releases,
        .gitflow-hotfixes,
        .gitflow-history {
            margin-bottom: 25px;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
        }

        .gitflow-init-section h4,
        .gitflow-features h4,
        .gitflow-releases h4,
        .gitflow-hotfixes h4,
        .gitflow-history h4 {
            margin: 0 0 15px 0;
            color: #d4d4d4;
            font-size: 16px;
            border-bottom: 1px solid #555;
            padding-bottom: 8px;
        }

        .gitflow-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .feature-controls,
        .release-controls,
        .hotfix-controls {
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-group .form-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 12px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            font-size: 13px;
        }

        .input-group .form-input::placeholder {
            color: #888;
        }

        .branch-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }

        .branch-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #555;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .branch-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .branch-name {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #9cdcfe;
            font-size: 13px;
        }

        .branch-actions {
            display: flex;
            gap: 6px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 3px;
        }

        .btn-primary {
            background: #007acc;
            border: 1px solid #007acc;
            color: white;
        }

        .btn-primary:hover {
            background: #005a9e;
            border-color: #005a9e;
        }

        .btn-success {
            background: #28a745;
            border: 1px solid #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            border-color: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            border: 1px solid #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            border-color: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            border: 1px solid #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            border-color: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            border: 1px solid #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            border-color: #138496;
        }

        .btn-secondary {
            background: #6c757d;
            border: 1px solid #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            border-color: #5a6268;
        }

        .status-area {
            margin-top: 15px;
            min-height: 40px;
        }

        .gitflow-status {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border: 1px solid #555;
        }

        .status-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .status-item:last-child {
            margin-bottom: 0;
        }

        .status-icon {
            margin-right: 8px;
            width: 20px;
        }

        .status-item.success {
            color: #28a745;
        }

        .status-item.warning {
            color: #ffc107;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid #444;
            border-radius: 4px;
            font-size: 12px;
        }

        .history-time {
            color: #888;
            font-family: 'Monaco', 'Menlo', monospace;
            min-width: 130px;
        }

        .history-action {
            color: #d4d4d4;
            flex: 1;
            margin-left: 10px;
        }

        /* Merge Operation Specific Styles */
        .merge-section {
            padding: 15px;
        }

        .merge-strategy-section,
        .branch-selection-section,
        .merge-preview-section,
        .conflict-detection-section,
        .merge-history-section {
            margin-bottom: 25px;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
        }

        .merge-strategy-section h4,
        .branch-selection-section h4,
        .merge-preview-section h4,
        .conflict-detection-section h4,
        .merge-history-section h4 {
            margin: 0 0 15px 0;
            color: #d4d4d4;
            font-size: 16px;
            border-bottom: 1px solid #555;
            padding-bottom: 8px;
        }

        .strategy-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .strategy-option {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .strategy-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .strategy-option input[type="radio"] {
            margin-right: 10px;
        }

        .strategy-option label {
            color: #d4d4d4;
            cursor: pointer;
            font-size: 13px;
        }

        .merge-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* Responsive design for merge controls */
        @media (max-width: 768px) {
            .merge-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .merge-arrow {
                order: 1;
                align-self: center;
                padding: 8px;
                transform: rotate(90deg);
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .merge-controls {
                gap: 10px;
            }
        }

        .branch-selector {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }

        .branch-selector label {
            color: #d4d4d4;
            font-size: 13px;
            font-weight: 500;
        }

        .form-select {
            padding: 8px 12px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            font-size: 13px;
            min-width: 160px;
        }

        .merge-arrow {
            align-self: end;
            padding-bottom: 8px;
            font-size: 18px;
            color: #007acc;
            font-weight: bold;
        }

        .merge-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        /* Responsive design for merge actions */
        @media (max-width: 768px) {
            .merge-actions {
                flex-direction: column;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .merge-actions {
                gap: 6px;
            }

            .merge-actions .btn {
                width: 100%;
                text-align: center;
            }
        }

        /* Responsive button styling for merge operations */
        @media (max-width: 768px) {
            .merge-section .btn {
                min-width: 120px;
                padding: 10px 16px;
                font-size: 14px;
                margin: 2px 0;
            }
        }

        @media (max-width: 480px) {
            .merge-section .btn {
                min-width: auto;
                width: 100%;
                padding: 12px 16px;
                font-size: 14px;
                margin: 2px 0;
            }
        }

        .merge-preview-content {
            min-height: 100px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid #444;
            border-radius: 6px;
            padding: 15px;
        }

        .no-preview {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 30px;
        }

        .merge-preview-info h5 {
            color: #d4d4d4;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .summary-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            color: #d4d4d4;
            font-size: 13px;
        }

        .commit-list,
        .file-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .commit-item,
        .file-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            margin-bottom: 4px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
            font-size: 12px;
        }

        .commit-hash {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #9cdcfe;
            min-width: 60px;
            margin-right: 10px;
        }

        .commit-message {
            flex: 1;
            color: #d4d4d4;
            margin-right: 10px;
        }

        .commit-author {
            color: #888;
            min-width: 60px;
        }

        .file-status {
            width: 20px;
            text-align: center;
            font-weight: bold;
            margin-right: 8px;
        }

        .file-item.added .file-status {
            color: #28a745;
        }

        .file-item.modified .file-status {
            color: #ffc107;
        }

        .file-item.deleted .file-status {
            color: #dc3545;
        }

        .file-path {
            flex: 1;
            font-family: 'Monaco', 'Menlo', monospace;
            color: #d4d4d4;
            margin-right: 10px;
        }

        .file-changes {
            color: #888;
            font-size: 11px;
            min-width: 60px;
        }

        .conflict-status {
            min-height: 60px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid #444;
            border-radius: 6px;
            padding: 15px;
        }

        .status-pending {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }

        .conflict-detected {
            border-left: 4px solid #ffc107;
            padding-left: 12px;
        }

        .conflict-warning {
            display: flex;
            align-items: center;
            color: #ffc107;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .warning-icon {
            margin-right: 8px;
        }

        .conflict-files {
            margin: 10px 0;
        }

        .conflict-file {
            display: flex;
            align-items: center;
            padding: 6px 0;
            color: #d4d4d4;
            font-size: 13px;
        }

        .file-icon {
            margin-right: 8px;
        }

        .conflict-type {
            margin-left: auto;
            color: #ffc107;
            font-size: 11px;
        }

        .conflict-advice {
            color: #888;
            font-style: italic;
            font-size: 12px;
            margin-top: 10px;
        }

        .no-conflicts {
            border-left: 4px solid #28a745;
            padding-left: 12px;
        }

        .success-status {
            display: flex;
            align-items: center;
            color: #28a745;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .success-icon {
            margin-right: 8px;
        }

        .status-details {
            color: #d4d4d4;
            font-size: 12px;
            line-height: 1.4;
        }

        .merge-history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .merge-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid #444;
            border-radius: 6px;
            font-size: 12px;
        }

        .merge-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
        }

        .merge-time {
            color: #888;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .merge-desc {
            color: #d4d4d4;
            font-weight: 500;
        }

        .merge-strategy {
            color: #9cdcfe;
            font-size: 11px;
        }

        .merge-status {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            min-width: 70px;
            text-align: center;
        }

        .merge-status.success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }

        .merge-status.conflict {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid #ffc107;
        }

        /* Team Collaboration Styles */
        .collaboration-modal {
            width: 95%;
            max-width: 1200px;
            height: 85%;
        }

        .collaboration-body {
            padding: 0;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .notification-badge {
            background: #dc3545;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            min-width: 16px;
            text-align: center;
        }

        .collaboration-tabs {
            display: flex;
            border-bottom: 1px solid #555;
            background: #2d2d30;
        }

        .collaboration-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: #d4d4d4;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .collaboration-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .collaboration-tab.active {
            color: #007acc;
            border-bottom-color: #007acc;
            background: rgba(0, 122, 204, 0.1);
        }

        .collaboration-content {
            padding: 20px;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        .collaboration-tab-content {
            display: none;
        }

        .collaboration-tab-content.active {
            display: block;
        }

        .pr-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .pr-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .pr-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 6px;
            text-align: center;
            border-left: 3px solid #007acc;
        }

        .stat-number {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #007acc;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #969696;
        }

        .pr-item {
            display: flex;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid #555;
        }

        .pr-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-1px);
        }

        .pr-item.open {
            border-left-color: #28a745;
        }

        .pr-item.review {
            border-left-color: #ffc107;
        }

        .pr-item.approved {
            border-left-color: #007acc;
        }

        .pr-main {
            flex: 1;
        }

        .pr-title {
            margin-bottom: 8px;
        }

        .pr-id {
            color: #007acc;
            font-weight: 600;
            margin-right: 8px;
        }

        .pr-title-text {
            font-weight: 600;
        }

        .pr-meta {
            font-size: 12px;
            color: #969696;
            margin-bottom: 8px;
        }

        .pr-meta span {
            margin-right: 16px;
        }

        .pr-stats-mini {
            font-size: 11px;
            color: #d4d4d4;
        }

        .pr-stats-mini span {
            margin-right: 12px;
        }

        .pr-checks.passed {
            color: #28a745;
        }

        .pr-checks.failed {
            color: #dc3545;
        }

        .pr-checks.pending {
            color: #ffc107;
        }

        .pr-sidebar {
            min-width: 200px;
            padding-left: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .pr-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
        }

        .pr-status.open {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .pr-status.review {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .pr-status.approved {
            background: rgba(0, 122, 204, 0.2);
            color: #007acc;
        }

        .pr-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .pr-label {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .pr-label.feature {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .pr-label.bug {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .pr-label.documentation {
            background: rgba(0, 122, 204, 0.2);
            color: #007acc;
        }

        .pr-label.high-priority {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .pr-label.urgent {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .pr-reviewers {
            font-size: 11px;
            color: #969696;
        }

        /* Review Styles */
        .review-filters {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 12px;
            color: #969696;
            white-space: nowrap;
        }

        .review-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .review-stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .stat-icon {
            font-size: 16px;
        }

        .review-item {
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .review-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .review-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .review-pr-id {
            color: #007acc;
            font-weight: 600;
        }

        .review-priority {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .review-priority.high {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .review-priority.urgent {
            background: rgba(220, 53, 69, 0.3);
            color: #dc3545;
        }

        .review-priority.medium {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .review-details {
            margin-bottom: 12px;
        }

        .review-participants {
            font-size: 12px;
            color: #969696;
            margin-bottom: 8px;
        }

        .review-participants span {
            margin-right: 16px;
        }

        .review-metrics {
            font-size: 11px;
            color: #d4d4d4;
        }

        .review-metrics span {
            margin-right: 12px;
        }

        .review-complexity.complexity-low {
            color: #28a745;
        }

        .review-complexity.complexity-medium {
            color: #ffc107;
        }

        .review-complexity.complexity-high {
            color: #dc3545;
        }

        .review-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .review-time {
            font-size: 11px;
            color: #969696;
        }

        /* Team Stats Styles */
        .stats-period {
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .overview-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .overview-card {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }

        .card-icon {
            font-size: 24px;
            margin-right: 16px;
        }

        .card-title {
            font-size: 12px;
            color: #969696;
            margin-bottom: 4px;
        }

        .card-value {
            font-size: 18px;
            font-weight: 700;
            color: #d4d4d4;
        }

        .stats-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-section h4 {
            margin-bottom: 16px;
            color: #d4d4d4;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
        }

        .contribution-bars {
            space-y: 12px;
        }

        .contribution-bar {
            margin-bottom: 12px;
        }

        .contributor-name {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .bar-container {
            display: flex;
            gap: 2px;
            height: 8px;
        }

        .bar {
            height: 100%;
            border-radius: 4px;
        }

        .bar.commits {
            background: #28a745;
        }

        .bar.prs {
            background: #007acc;
        }

        .bar.reviews {
            background: #ffc107;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            font-size: 11px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 4px;
        }

        .legend-color.commits {
            background: #28a745;
        }

        .legend-color.prs {
            background: #007acc;
        }

        .legend-color.reviews {
            background: #ffc107;
        }

        .efficiency-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .metric-item {
            text-align: center;
        }

        .metric-label {
            font-size: 11px;
            color: #969696;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 600;
            color: #d4d4d4;
            margin-bottom: 4px;
        }

        .metric-trend {
            font-size: 10px;
            font-weight: 600;
        }

        .metric-trend.up {
            color: #28a745;
        }

        .metric-trend.down {
            color: #dc3545;
        }

        .leaderboard-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank-badge {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            font-size: 12px;
        }

        .rank-1 .rank-badge {
            background: #ffd700;
            color: #000;
        }

        .rank-2 .rank-badge {
            background: #c0c0c0;
            color: #000;
        }

        .rank-3 .rank-badge {
            background: #cd7f32;
            color: #fff;
        }

        .rank-4 .rank-badge,
        .rank-5 .rank-badge {
            background: #555;
            color: #d4d4d4;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .member-stats {
            font-size: 11px;
            color: #969696;
        }

        .score-badge {
            background: #007acc;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 12px;
        }

        /* Notification Styles */
        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .notification-controls {
            display: flex;
            gap: 8px;
        }

        .notification-filters {
            margin-bottom: 20px;
        }

        .filter-tabs {
            display: flex;
            gap: 4px;
            border-bottom: 1px solid #555;
        }

        .filter-tab {
            padding: 8px 12px;
            background: none;
            border: none;
            color: #969696;
            cursor: pointer;
            font-size: 12px;
            border-bottom: 2px solid transparent;
        }

        .filter-tab:hover {
            color: #d4d4d4;
        }

        .filter-tab.active {
            color: #007acc;
            border-bottom-color: #007acc;
        }

        .notification-item {
            display: flex;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .notification-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .notification-item.unread {
            border-left: 3px solid #007acc;
            background: rgba(0, 122, 204, 0.1);
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
        }

        .notification-icon.pr_assigned {
            background: rgba(0, 122, 204, 0.2);
        }

        .notification-icon.mention {
            background: rgba(255, 193, 7, 0.2);
        }

        .notification-icon.pr_approved {
            background: rgba(40, 167, 69, 0.2);
        }

        .notification-icon.build_failed {
            background: rgba(220, 53, 69, 0.2);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-description {
            font-size: 12px;
            color: #969696;
            margin-bottom: 6px;
        }

        .notification-meta {
            font-size: 11px;
            color: #969696;
        }

        .notification-time {
            margin-right: 12px;
        }

        .notification-priority.priority-high {
            color: #dc3545;
            font-weight: 600;
        }

        .notification-priority.priority-medium {
            color: #ffc107;
        }

        .notification-priority.priority-low {
            color: #28a745;
        }

        .notification-actions {
            display: flex;
            align-items: center;
        }

        /* Workflow and Collaboration Styles */
        .workflow-tabs, .collaboration-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 1px solid #3e3e42;
            padding-bottom: 10px;
        }

        .workflow-tab-btn, .collaboration-tab-btn {
            padding: 8px 16px;
            border: 1px solid #555;
            background: #3e3e42;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .workflow-tab-btn.active, .collaboration-tab-btn.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }

        /* Enhanced Flex Layout with Better Content Handling */
        .workflow-content, .collaboration-content {
            min-height: 300px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        /* Fix flex item overflow issues */
        .file-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Prevent flex item from overflowing */
            overflow: hidden;
        }

        .file-name {
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
            font-size: 13px;
            color: #e6edf3;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; /* Prevent text wrapping in tight spaces */
        }

        /* Better flex behavior for containers */
        .pr-main {
            flex: 1;
            min-width: 0; /* Allow shrinking below content size */
            overflow: hidden;
        }

        .contributor-name {
            flex: 1;
            color: #d4d4d4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Improved notification content handling */
        .notification-content {
            flex: 1;
            margin-left: 15px;
            min-width: 0;
            overflow: hidden;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #d4d4d4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .notification-message {
            color: #969696;
            font-size: 14px;
            margin-bottom: 8px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .workflow-tab-content, .collaboration-tab-content {
            display: none;
        }

        .workflow-tab-content.active, .collaboration-tab-content.active {
            display: block;
        }

        /* Enhanced UI Aesthetics and Container Improvements */

        /* Better visual hierarchy for workflow sections */
        .rebase-interface, .merge-interface, .gitflow-interface, .conflicts-interface {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #3e3e42;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Improved section headers */
        .rebase-header, .collaboration-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #3e3e42;
        }

        /* Better commit list styling */
        .commit-list {
            margin: 20px 0;
            background: #1e1e1e;
            border-radius: 6px;
            border: 1px solid #3e3e42;
            overflow: hidden;
        }

        .commit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: transparent;
            border: none;
            border-bottom: 1px solid #2d2d30;
            transition: background-color 0.2s;
        }

        .commit-item:last-child {
            border-bottom: none;
        }

        .commit-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Enhanced form elements */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: 600;
            color: #d4d4d4;
            font-size: 13px;
        }

        .form-select {
            background: #3e3e42;
            border: 1px solid #555;
            color: #d4d4d4;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-select:focus {
            outline: none;
            border-color: #007acc;
            box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);
        }

        /* Better GitFlow section styling */
        .gitflow-section {
            background: #1e1e1e;
            padding: 18px;
            border-radius: 6px;
            border: 1px solid #3e3e42;
            transition: border-color 0.2s;
        }

        .gitflow-section:hover {
            border-color: #555;
        }

        .gitflow-section h5 {
            margin-bottom: 15px;
            color: #4ec9b0;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Add icons to GitFlow sections */
        .gitflow-section h5::before {
            font-size: 16px;
        }

        .gitflow-section:nth-child(1) h5::before {
            content: "🌱"; /* Feature */
        }

        .gitflow-section:nth-child(2) h5::before {
            content: "🚀"; /* Release */
        }

        .gitflow-section:nth-child(3) h5::before {
            content: "🚨"; /* Hotfix */
        }

        /* Improved action button layouts */
        .gitflow-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .gitflow-actions .btn {
            justify-content: flex-start;
            text-align: left;
            padding: 10px 14px;
            font-size: 13px;
        }

        /* Enhanced Conflict Resolution Interface Styles */
        .conflict-resolution-modal {
            background: #1e1e1e;
            border: 2px solid #dc3545;
            border-radius: 8px;
            max-width: min(95vw, 1600px);
            max-height: min(95vh, 900px);
            width: 90vw;
            height: 80vh;
        }

        .conflict-modal-header {
            background: #dc3545;
            color: white;
            padding: 12px 20px;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conflict-file-tabs {
            display: flex;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            overflow-x: auto;
        }

        .conflict-file-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: #d4d4d4;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .conflict-file-tab.active {
            background: #1e1e1e;
            border-bottom-color: #dc3545;
            color: white;
        }

        .conflict-file-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }

        .conflict-three-way {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            height: calc(100% - 120px);
            gap: 1px;
            background: #3e3e42;
        }

        .conflict-pane {
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
        }

        .conflict-pane-header {
            background: #2d2d30;
            padding: 8px 12px;
            border-bottom: 1px solid #3e3e42;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .conflict-pane-header.current {
            color: #4ec9b0;
        }

        .conflict-pane-header.incoming {
            color: #569cd6;
        }

        .conflict-pane-header.result {
            color: #ffc107;
        }

        .conflict-content {
            flex: 1;
            overflow: auto;
            padding: 0;
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .conflict-line {
            display: flex;
            align-items: center;
            padding: 2px 0;
            border-left: 3px solid transparent;
            position: relative;
        }

        .conflict-line:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .conflict-line.conflict-start {
            border-left-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .conflict-line.conflict-middle {
            border-left-color: #6c757d;
            background: rgba(108, 117, 125, 0.1);
        }

        .conflict-line.conflict-end {
            border-left-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .conflict-line.current {
            background: rgba(78, 201, 176, 0.1);
            border-left-color: #4ec9b0;
        }

        .conflict-line.incoming {
            background: rgba(86, 156, 214, 0.1);
            border-left-color: #569cd6;
        }

        .line-number {
            width: 40px;
            padding: 0 8px;
            text-align: right;
            color: #6c757d;
            font-size: 11px;
            user-select: none;
            flex-shrink: 0;
        }

        .line-content {
            flex: 1;
            padding: 0 12px;
            white-space: pre;
            overflow-x: auto;
        }

        .line-actions {
            padding: 0 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .conflict-line:hover .line-actions {
            opacity: 1;
        }

        .line-action-btn {
            padding: 2px 6px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 3px;
            color: #d4d4d4;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .line-action-btn:hover {
            background: #007acc;
            border-color: #007acc;
        }

        .conflict-controls {
            background: #2d2d30;
            padding: 12px 20px;
            border-top: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conflict-progress {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #d4d4d4;
            font-size: 13px;
        }

        .conflict-progress-bar {
            width: 120px;
            height: 6px;
            background: #3e3e42;
            border-radius: 3px;
            overflow: hidden;
        }

        .conflict-progress-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s;
        }

        .conflict-actions {
            display: flex;
            gap: 10px;
        }

        /* Conflict markers styling */
        .conflict-marker {
            color: #dc3545;
            font-weight: bold;
            background: rgba(220, 53, 69, 0.2);
        }

        .conflict-marker.start::before {
            content: "<<<<<<< ";
        }

        .conflict-marker.middle::before {
            content: "======= ";
        }

        .conflict-marker.end::before {
            content: ">>>>>>> ";
        }

        /* Mobile responsiveness for conflict resolution */
        @media (max-width: 768px) {
            .conflict-three-way {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 1fr 1fr;
            }

            .conflict-resolution-modal {
                width: 95vw;
                height: 90vh;
            }

            .conflict-file-tabs {
                padding: 0 8px;
            }

            .conflict-file-tab {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
        .conflict-files {
            margin-bottom: 20px;
            background: #1e1e1e;
            border-radius: 6px;
            border: 1px solid #3e3e42;
            overflow: hidden;
        }

        .conflict-file {
            background: transparent;
            border: none;
            border-bottom: 1px solid #2d2d30;
            margin-bottom: 0;
        }

        .conflict-file:last-child {
            border-bottom: none;
        }

        .file-header {
            display: flex;
            align-items: center;
            padding: 12px;
            gap: 12px;
            transition: background-color 0.2s;
        }

        .conflict-file:hover .file-header {
            background: rgba(255, 255, 255, 0.03);
        }

        /* =======================================
           🔥 Meld-Inspired Diff Visualization
           ======================================= */

        /* Line-by-line diff container */
        .meld-diff-container {
            display: grid;
            grid-template-columns: 50px 1fr 100px 1fr 50px 1fr;
            gap: 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.4;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            overflow: hidden;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Line numbers column */
        .line-numbers {
            background: #2d2d30;
            color: #858585;
            padding: 4px 8px;
            text-align: right;
            border-right: 1px solid #3e3e42;
            user-select: none;
            min-width: 50px;
        }

        /* Diff content columns */
        .diff-content {
            padding: 4px 8px;
            border-right: 1px solid #3e3e42;
            white-space: pre;
            word-wrap: break-word;
            position: relative;
        }

        .diff-content:last-child {
            border-right: none;
        }

        /* Meld-style diff line types */
        .diff-line-added {
            background: rgba(40, 167, 69, 0.25) !important;
            border-left: 3px solid #28a745;
        }

        .diff-line-deleted {
            background: rgba(220, 53, 69, 0.25) !important;
            border-left: 3px solid #dc3545;
        }

        .diff-line-modified {
            background: rgba(255, 193, 7, 0.25) !important;
            border-left: 3px solid #ffc107;
        }

        .diff-line-unchanged {
            background: transparent;
            border-left: 3px solid transparent;
        }

        .diff-line-empty {
            background: #2d2d30;
            color: #555;
            border-left: 3px solid #555;
        }

        /* Merge action buttons between conflict resolution panes */
        .conflict-merge-actions {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #252526;
            border-right: 1px solid #3e3e42;
            padding: 4px;
            gap: 2px;
            min-width: 100px;
        }

        .merge-action-btn {
            background: #0e639c;
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s;
            width: 80px;
        }

        .merge-action-btn:hover {
            background: #1177bb;
            transform: scale(1.05);
        }

        .merge-action-btn.left-to-result {
            background: #28a745;
        }

        .merge-action-btn.left-to-result:hover {
            background: #34ce57;
        }

        .merge-action-btn.right-to-result {
            background: #dc3545;
        }

        .merge-action-btn.right-to-result:hover {
            background: #e4606d;
        }

        /* Diff navigation controls */
        .diff-navigation {
            background: #252526;
            border-bottom: 1px solid #3e3e42;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            justify-content: space-between;
        }

        .diff-nav-buttons {
            display: flex;
            gap: 8px;
        }

        .diff-nav-btn {
            background: #0e639c;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background 0.2s;
        }

        .diff-nav-btn:hover {
            background: #1177bb;
        }

        .diff-nav-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Diff statistics */
        .diff-stats {
            display: flex;
            gap: 16px;
            color: #d4d4d4;
            font-size: 12px;
        }

        .diff-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .diff-stat-added {
            color: #28a745;
        }

        .diff-stat-deleted {
            color: #dc3545;
        }

        .diff-stat-modified {
            color: #ffc107;
        }

        /* Synchronized scrolling indicator */
        .sync-scroll-indicator {
            position: absolute;
            top: 0;
            right: 0;
            background: #0e639c;
            color: white;
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 0 0 0 3px;
        }

        /* Line highlight on hover */
        .diff-line:hover {
            background: rgba(255, 255, 255, 0.05) !important;
            cursor: pointer;
        }

        /* Current conflict block highlighting */
        .conflict-block {
            outline: 2px solid #ffc107;
            outline-offset: -2px;
        }

        .conflict-block-header {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            font-weight: bold;
            text-align: center;
            padding: 4px;
            border-bottom: 1px solid #ffc107;
        }

        /* Enhanced line selection */
        .line-selected {
            background: rgba(14, 99, 156, 0.3) !important;
            outline: 1px solid #0e639c;
        }

        /* Merge conflict markers with better visibility */
        .conflict-marker-line {
            background: rgba(220, 53, 69, 0.4) !important;
            color: #ff6b7a;
            font-weight: bold;
            text-align: center;
            border: 1px dashed #dc3545;
        }

        /* Responsive adjustments for Meld interface */
        @media (max-width: 1024px) {
            .meld-diff-container {
                grid-template-columns: 40px 1fr 80px 1fr 40px 1fr;
            }

            .conflict-merge-actions {
                min-width: 80px;
            }

            .merge-action-btn {
                width: 60px;
                padding: 3px 6px;
                font-size: 9px;
            }
        }

        @media (max-width: 768px) {
            .meld-diff-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                max-height: 400px;
            }

            .conflict-merge-actions {
                flex-direction: row;
                min-width: auto;
                padding: 8px;
            }

            .diff-navigation {
                flex-direction: column;
                gap: 8px;
            }

            .diff-nav-buttons {
                justify-content: center;
            }
        }

        /* Better spacing for different components */
        @media (min-width: 1200px) {
            .workflow-content,
            .collaboration-content {
                padding: 24px;
            }

            .rebase-interface,
            .merge-interface,
            .gitflow-interface,
            .conflicts-interface {
                padding: 24px;
            }
        }

        .rebase-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .commit-list {
            margin: 20px 0;
        }

        .commit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .commit-action {
            width: 100px;
            background: #3e3e42;
            border: 1px solid #555;
            color: #d4d4d4;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .commit-hash {
            font-family: monospace;
            color: #569cd6;
        }

        .commit-message {
            flex: 1;
            color: #d4d4d4;
        }

        .rebase-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Enhanced Grid Layouts with Better Responsiveness */
        .merge-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .gitflow-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
            gap: 20px;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Mobile optimizations for grid layouts */
        @media (max-width: 768px) {
            .merge-config {
                grid-template-columns: 1fr;
            }

            .gitflow-sections {
                grid-template-columns: 1fr;
            }

            .stats-summary {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #d4d4d4;
        }

        .form-select {
            background: #3e3e42;
            border: 1px solid #555;
            color: #d4d4d4;
            padding: 8px;
            border-radius: 4px;
        }

        .gitflow-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .gitflow-section {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #3e3e42;
        }

        .gitflow-section h5 {
            margin-bottom: 15px;
            color: #4ec9b0;
        }

        .gitflow-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .conflict-files {
            margin-bottom: 20px;
        }

        .conflict-file {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .file-header {
            display: flex;
            align-items: center;
            padding: 10px;
            gap: 10px;
        }

        .file-icon {
            font-size: 16px;
        }

        .file-path {
            flex: 1;
            font-family: monospace;
            color: #569cd6;
        }

        .conflict-actions {
            display: flex;
            gap: 10px;
        }

        .pr-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .pr-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .pr-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .pr-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pr-item:hover {
            background: #2d2d2d;
            border-color: #555;
        }

        .pr-item.open {
            border-left: 3px solid #28a745;
        }

        .pr-item.closed {
            border-left: 3px solid #dc3545;
        }

        .pr-main {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .pr-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pr-id {
            color: #569cd6;
            font-weight: 600;
        }

        .pr-title-text {
            color: #d4d4d4;
        }

        .pr-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 12px;
            color: #969696;
        }

        .pr-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
            font-size: 12px;
        }

        .pr-checks {
            color: #28a745;
        }

        .pr-reviews {
            color: #ffc107;
        }

        .review-interface {
            background: #252526;
            padding: 20px;
            border-radius: 6px;
        }

        .review-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .review-item {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            padding: 15px;
        }

        .review-item.pending {
            border-left: 3px solid #ffc107;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-title {
            font-weight: 600;
            color: #d4d4d4;
        }

        .review-priority.high {
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .review-details {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #969696;
        }

        .review-actions {
            display: flex;
            gap: 8px;
        }

        .stats-interface {
            background: #252526;
            padding: 20px;
            border-radius: 6px;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #3e3e42;
        }

        .stat-card h5 {
            margin-bottom: 10px;
            color: #969696;
        }

        .stat-number {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #4ec9b0;
            margin-bottom: 5px;
        }

        .stat-period {
            font-size: 12px;
            color: #969696;
        }

        .contributor-leaderboard {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #3e3e42;
        }

        .contributor-leaderboard h5 {
            margin-bottom: 15px;
            color: #4ec9b0;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #3e3e42;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .contributor-rank {
            font-weight: 700;
            color: #569cd6;
            width: 30px;
        }

        .contributor-name {
            flex: 1;
            color: #d4d4d4;
        }

        .contributor-commits {
            color: #969696;
            font-size: 12px;
        }

        .notifications-interface {
            background: #252526;
            padding: 20px;
            border-radius: 6px;
        }

        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification-item {
            display: flex;
            padding: 15px;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .notification-item:hover {
            background: #2d2d2d;
        }

        .notification-item.priority-high {
            border-left: 3px solid #dc3545;
        }

        .notification-item.priority-medium {
            border-left: 3px solid #ffc107;
        }

        .notification-item.priority-low {
            border-left: 3px solid #28a745;
        }

        .notification-item.unread {
            background: rgba(0, 122, 204, 0.1);
        }

        .notification-content {
            flex: 1;
            margin-left: 15px;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #d4d4d4;
        }

        .notification-message {
            color: #969696;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .notification-time {
            font-size: 12px;
            color: #707070;
        }

        /* Comprehensive Responsive Design Improvements */

        /* Main layout responsiveness */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 200px;
                overflow-y: auto;
                border-right: none;
                border-bottom: 1px solid #3e3e42;
            }

            .content-area {
                min-height: calc(100vh - 300px);
            }

            /* Navigation tabs on mobile */
            .nav-tabs {
                flex-wrap: wrap;
                gap: 4px;
            }

            .nav-tab {
                font-size: 12px;
                padding: 6px 10px;
                min-width: auto;
                flex: 1;
                text-align: center;
            }
        }

        /* Tablet responsiveness */
        @media (max-width: 1024px) and (min-width: 769px) {
            .sidebar {
                width: 200px;
            }

            .nav-tab {
                font-size: 13px;
                padding: 8px 12px;
            }
        }

        /* Form responsiveness */
        @media (max-width: 480px) {
            .form-input,
            .form-textarea,
            .form-select {
                font-size: 16px; /* Prevent zoom on iOS */
            }

            .quick-actions {
                flex-direction: column;
                gap: 8px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 14px;
                width: 100%;
                justify-content: center;
            }

            /* Stack action buttons vertically on small screens */
            .pr-controls,
            .rebase-actions,
            .conflict-actions {
                flex-direction: column;
                gap: 8px;
            }

            .pr-controls .btn,
            .rebase-actions .btn,
            .conflict-actions .btn {
                width: 100%;
            }
        }

        /* Better handling of long content */
        .commit-message {
            flex: 1;
            color: #d4d4d4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        .file-path {
            flex: 1;
            font-family: monospace;
            color: #569cd6;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        /* Improved spacing for different screen sizes */
        @media (max-width: 768px) {
            .view-container {
                padding: 12px;
            }

            .modal-body {
                padding: 16px;
            }

            .workflow-tabs,
            .collaboration-tabs {
                flex-wrap: wrap;
                gap: 4px;
            }

            .workflow-tab-btn,
            .collaboration-tab-btn {
                flex: 1;
                min-width: 120px;
                text-align: center;
                font-size: 12px;
                padding: 6px 8px;
            }
        }
        .virtual-list {
            position: relative;
            overflow: auto;
            height: 100%;
        }

        .virtual-list-content {
            position: relative;
        }

        .virtual-list-item {
            position: absolute;
            left: 0;
            right: 0;
            will-change: transform;
        }

        /* Accessibility Enhancements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .focus-indicator {
            outline: 2px solid #007acc;
            outline-offset: 2px;
        }

        .keyboard-nav-hint {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #e6edf3;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            z-index: 1001;
            display: none;
        }

        .keyboard-nav-hint.visible {
            display: block;
        }

        /* Quick Actions */
        .quick-actions {
            padding: 8px;
            background: #252526;
            border-top: 1px solid #3e3e42;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 4px 8px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-action:hover {
            background: #4a4a4f;
            border-color: #007acc;
        }

        .kbd {
            display: inline-block;
            padding: 2px 6px;
            background: #3e3e42;
            border: 1px solid #555;
            border-radius: 3px;
            font-size: 11px;
            font-family: monospace;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Navigation -->
        <div class="header-nav">
            <div class="nav-tabs">
                <div class="nav-tab active" data-view="branches">Branches</div>
                <div class="nav-tab" data-view="tags">Tags</div>
                <div class="nav-tab" data-view="stash">Stash</div>
                <div class="nav-tab" data-view="status">Status</div>
                <div class="nav-tab" data-view="remotes">Remotes</div>
                <div class="nav-tab" data-view="workflow">Git 工作流</div>
            </div>
            <div class="sync-status" id="syncStatus">
                <span class="refresh-icon">🔄</span>
                <span class="status-text">Ready</span>
                <span>| Auto-refresh: ON</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="repo-info">
                    <div class="repo-info-item">
                        <span>📋</span>
                        <span>ai-commit</span>
                    </div>
                    <div class="repo-info-item">
                        <span>🔀</span>
                        <span>main</span>
                    </div>
                    <div class="repo-info-item">
                        <span>📊</span>
                        <span>1024 commits</span>
                    </div>
                    <div class="repo-info-item">
                        <span>🌿</span>
                        <span>45 branches</span>
                    </div>
                    <div class="repo-info-item">
                        <span>🏷️</span>
                        <span>12 tags</span>
                    </div>
                    <div class="repo-info-item">
                        <span>💾</span>
                        <span>2 stashes</span>
                    </div>
                </div>
                <div class="dynamic-list" id="dynamicList">
                    <!-- Dynamic content based on selected view -->
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Branches View -->
                <div class="view-container active" id="branchesView">
                    <h3>Branch Management</h3>
                    <div style="background: #252526; padding: 16px; border-radius: 4px; margin: 16px 0;">
                        <div style="margin-bottom: 12px;">
                            <div style="font-weight: bold; color: #4ec9b0;">Selected: <span id="selectedBranch">★ main</span></div>
                            <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                                <div>📊 Branch Details:</div>
                                <div>• Upstream: origin/main</div>
                                <div>• Ahead: 2 commits | Behind: 0 commits</div>
                                <div>• Last commit: fix(ui): 修复侧边栏布局问题</div>
                                <div>• Author: costa | Date: 2024-09-11</div>
                            </div>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="btn" onclick="checkoutBranch()">Checkout</button>
                        <button class="btn" onclick="createBranch()">Create New</button>
                        <button class="btn" onclick="deleteBranch()">Delete</button>
                        <button class="btn">Merge</button>
                        <button class="btn">Push</button>
                        <button class="btn">Pull</button>
                        <button class="btn btn-secondary" onclick="refreshView()">🔄 Refresh</button>
                    </div>

                    <!-- Git Log for Branches -->
                    <div style="margin-top: 16px;">
                        <h4 style="margin-bottom: 8px; color: #cccccc;">Git Log</h4>
                        <div id="branchesFocusHint" style="font-size: 12px; color: #969696; margin-bottom: 8px; text-align: center;">
                            <span class="kbd">Tab</span> Switch Focus | <span class="kbd">↑↓</span> Navigate | <span class="kbd">Enter</span> Show Diff
                        </div>
                        <div class="git-log" id="branchesGitLog">
                            <div class="commit-item selected" data-hash="18c4a3a" onclick="selectBranchCommit('18c4a3a')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">18c4a3a</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editBranchCommit('18c4a3a')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetBranchCommit('18c4a3a')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickBranchCommit('18c4a3a')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                            <div class="commit-item" data-hash="8502563" onclick="selectBranchCommit('8502563')">
                                <span class="commit-status">🔧</span>
                                <span class="commit-hash">8502563</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">fix(src): 修复TUI界面焦点管理和视图切换问题</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editBranchCommit('8502563')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetBranchCommit('8502563')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickBranchCommit('8502563')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                            <div class="commit-item" data-hash="5f49518" onclick="selectBranchCommit('5f49518')">
                                <span class="commit-status">✨</span>
                                <span class="commit-hash">5f49518</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">feat(diff_viewer): 添加 Diff 修改块列表和解析函数</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editBranchCommit('5f49518')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetBranchCommit('5f49518')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickBranchCommit('5f49518')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 16px; padding: 12px; background: #1e1e1e; border-radius: 4px;">
                        <div style="font-size: 12px; color: #969696;">
                            <span class="kbd">Enter</span> Checkout |
                            <span class="kbd">c</span> Create |
                            <span class="kbd">d</span> Delete |
                            <span class="kbd">m</span> Merge
                        </div>
                    </div>
                </div>

                <!-- Tags View -->
                <div class="view-container" id="tagsView">
                    <h3>Tag Management</h3>
                    <div style="background: #252526; padding: 16px; border-radius: 4px; margin: 16px 0;">
                        <div style="margin-bottom: 12px;">
                            <div style="font-weight: bold; color: #4ec9b0;">Selected: <span id="selectedTag">v2.1.0</span></div>
                            <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                                <div>🏷️ Tag Details:</div>
                                <div>• Date: 2024-09-11 15:45:32</div>
                                <div>• Commit: 18c4a3a</div>
                                <div>• Message: Latest release</div>
                                <div>• Tagger: costa &lt;costa@helltalk.com&gt;</div>
                            </div>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="btn" onclick="checkoutTag()">Checkout Tag</button>
                        <button class="btn" onclick="createTag()">Create Tag</button>
                        <button class="btn" onclick="deleteTag()">Delete</button>
                        <button class="btn">Push Tag</button>
                        <button class="btn">Compare</button>
                        <button class="btn btn-secondary" onclick="refreshView()">🔄 Refresh</button>
                    </div>

                    <!-- Git Log for Tags -->
                    <div style="margin-top: 16px;">
                        <h4 style="margin-bottom: 8px; color: #cccccc;">Git Log</h4>
                        <div class="git-log" id="tagsGitLog">
                            <div class="commit-item selected" data-hash="18c4a3a" onclick="selectTagCommit('18c4a3a')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">18c4a3a</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">fix(ui): 修复侧边栏布局问题</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editTagCommit('18c4a3a')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetTagCommit('18c4a3a')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickTagCommit('18c4a3a')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                            <div class="commit-item" data-hash="8502563" onclick="selectTagCommit('8502563')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">8502563</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">fix(src): 修复TUI界面焦点管理</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editTagCommit('8502563')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetTagCommit('8502563')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickTagCommit('8502563')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                            <div class="commit-item" data-hash="5f49518" onclick="selectTagCommit('5f49518')">
                                <span class="commit-status">🔒</span>
                                <span class="commit-hash">5f49518</span>
                                <span class="commit-date">[09-10 15:30]</span>
                                <span class="commit-message">feat(diff_viewer): 添加 Diff 修改块</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editTagCommit('5f49518')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetTagCommit('5f49518')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickTagCommit('5f49518')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                            <div class="commit-item" data-hash="9bd566f" onclick="selectTagCommit('9bd566f')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">9bd566f</span>
                                <span class="commit-date">[09-10 14:20]</span>
                                <span class="commit-message">fix(tui_enhanced): 修复左侧面板显示</span>
                                <div class="commit-actions">
                                    <button class="btn btn-secondary" onclick="editTagCommit('9bd566f')" title="Edit">✏️</button>
                                    <button class="btn btn-secondary" onclick="resetTagCommit('9bd566f')" title="Reset">🔄</button>
                                    <button class="btn btn-secondary" onclick="cherryPickTagCommit('9bd566f')" title="Cherry Pick">🍒</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 16px; padding: 12px; background: #1e1e1e; border-radius: 4px;">
                        <div style="font-size: 12px; color: #969696;">
                            <span class="kbd">Enter</span> Diff |
                            <span class="kbd">c</span> Create Tag |
                            <span class="kbd">d</span> Delete |
                            <span class="kbd">r</span> Reword |
                            <span class="kbd">↑↓</span> Navigate
                        </div>
                    </div>
                </div>

                <!-- Stash/Git Log View -->
                <div class="view-container" id="stashView">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3>Stash Management</h3>
                        <div>
                            <button class="btn btn-secondary" onclick="createStash()">Create Stash</button>
                            <button class="btn btn-secondary" onclick="toggleStashMode()">Switch to Git Log</button>
                            <button class="btn btn-secondary" onclick="refreshView()">🔄 Refresh</button>
                        </div>
                    </div>

                    <!-- Git Log Display (hidden in stash mode) -->
                    <div class="git-log" id="gitLog" style="display: none;">
                        <div class="commit-item selected" data-hash="18c4a3a" onclick="selectMainCommit('18c4a3a')">
                            <span class="commit-status">📝</span>
                            <span class="commit-hash">18c4a3a</span>
                            <span class="commit-date">[09-11 01:44]</span>
                            <span class="commit-message">fix(ui): 修复侧边栏布局问题</span>
                        </div>
                        <div class="commit-item" data-hash="8502563" onclick="selectMainCommit('8502563')">
                            <span class="commit-status">📝</span>
                            <span class="commit-hash">8502563</span>
                            <span class="commit-date">[09-11 01:44]</span>
                            <span class="commit-message">fix(src): 修复TUI界面焦点管理</span>
                        </div>
                        <div class="commit-item" data-hash="5f49518" onclick="selectMainCommit('5f49518')">
                            <span class="commit-status">🔒</span>
                            <span class="commit-hash">5f49518</span>
                            <span class="commit-date">[09-11 01:44]</span>
                            <span class="commit-message">feat(diff_viewer): 添加 Diff 修改块</span>
                        </div>
                    </div>

                    <!-- Stash Files Display (shown in stash mode) -->
                    <div class="stash-files" id="stashFiles" style="display: block;">
                        <div style="margin-bottom: 16px;">
                            <h4 style="margin-bottom: 8px; color: #cccccc;">Stash Files</h4>
                            <div style="font-size: 12px; color: #969696; margin-bottom: 8px; text-align: center;">
                                <span class="kbd">↑↓</span> Navigate | <span class="kbd">Enter</span> Show File Diff | <span class="kbd">Space</span> Select
                            </div>
                        </div>

                        <!-- File Status List for Stash -->
                        <div class="file-status-list" id="stashFilesList">
                            <div class="file-item unstaged selected" onclick="selectStashFile(this)" data-file="src/core/auth/login.rs">
                                <span class="file-status-icon" style="color: #f14c4c;">M</span>
                                <span class="file-path">src/core/auth/login.rs</span>
                                <span class="file-stats" style="color: #569cd6; font-size: 11px;">+23 -8</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="showStashFileDiff(event, 'src/core/auth/login.rs')">Diff</button>
                                    <button class="btn-small" onclick="restoreStashFile(event, 'src/core/auth/login.rs')">Restore</button>
                                </span>
                            </div>
                            <div class="file-item unstaged" onclick="selectStashFile(this)" data-file="src/models/user.rs">
                                <span class="file-status-icon" style="color: #f14c4c;">M</span>
                                <span class="file-path">src/models/user.rs</span>
                                <span class="file-stats" style="color: #569cd6; font-size: 11px;">+15 -3</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="showStashFileDiff(event, 'src/models/user.rs')">Diff</button>
                                    <button class="btn-small" onclick="restoreStashFile(event, 'src/models/user.rs')">Restore</button>
                                </span>
                            </div>
                            <div class="file-item untracked" onclick="selectStashFile(this)" data-file="tests/auth_tests.rs">
                                <span class="file-status-icon" style="color: #ffcc02;">A</span>
                                <span class="file-path">tests/auth_tests.rs</span>
                                <span class="file-stats" style="color: #4ec9b0; font-size: 11px;">+67 -0</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="showStashFileDiff(event, 'tests/auth_tests.rs')">Diff</button>
                                    <button class="btn-small" onclick="restoreStashFile(event, 'tests/auth_tests.rs')">Restore</button>
                                </span>
                            </div>
                        </div>

                        <!-- Stash Actions -->
                        <div style="margin-top: 16px; padding: 12px; background: #1e1e1e; border-radius: 4px;">
                            <div style="font-size: 12px; color: #969696;">
                                <span class="kbd">Enter</span> Show File Diff |
                                <span class="kbd">Space</span> Select File |
                                <span class="kbd">a</span> Apply Stash |
                                <span class="kbd">p</span> Pop Stash |
                                <span class="kbd">d</span> Drop Stash |
                                <span class="kbd">↑↓</span> Navigate
                            </div>
                        </div>
                    </div>

                    <!-- Selected Commit Details -->
                    <div id="selectedCommitDetails" style="margin: 16px 0; padding: 16px; background: #252526; border-radius: 4px; border: 1px solid #3e3e42; display: none;">
                        <div style="color: #4ec9b0; font-weight: bold; margin-bottom: 8px;">
                            Selected Commit: <span id="selectedCommitHash">5f49518</span>
                        </div>
                        <div style="font-size: 12px; color: #969696; line-height: 1.4;">
                            <div><strong>Hash:</strong> <span id="detailCommitHash">5f49518</span></div>
                            <div><strong>Date:</strong> <span id="detailCommitDate">[09-11 01:44]</span></div>
                            <div><strong>Message:</strong> <span id="detailCommitMessage">feat(diff_viewer): 添加 Diff 修改块列表和解析函数</span></div>
                            <div><strong>Author:</strong> <span id="detailCommitAuthor">costa</span></div>
                            <div><strong>Changed:</strong> <span id="detailCommitStats">4 files changed, 15 insertions(+), 2 deletions(-)</span></div>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="showDiff()">Show Diff</button>
                            <button class="btn btn-secondary" onclick="editCommitMessage()">Edit Message</button>
                            <button class="btn btn-secondary" onclick="resetToThis()">Reset to This</button>
                            <button class="btn btn-secondary" onclick="cherryPickThis()">Cherry Pick</button>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <span class="quick-action" onclick="rewordCommit()"><kbd>r</kbd> Reword</span>
                        <span class="quick-action" onclick="editCommit()"><kbd>e</kbd> Edit</span>
                        <span class="quick-action" onclick="squashCommit()"><kbd>s</kbd> Squash</span>
                        <span class="quick-action" onclick="showDiff()"><kbd>Enter</kbd> Show Diff</span>
                        <span class="quick-action" onclick="showInteractiveRebase()"><kbd>Ctrl+E</kbd> Interactive Rebase</span>
                    </div>
                </div>

                <!-- Status View -->
                <div class="view-container" id="statusView">
                    <!-- Advanced Search and Filter Container -->
                    <div class="search-container">
                        <div class="search-input-group">
                            <input type="text" class="search-input" placeholder="Search files by name, path, or status..." id="fileSearchInput">
                            <span class="search-icon">🔍</span>
                            <button class="search-clear" onclick="clearFileSearch()">&times;</button>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Status:</label>
                            <select class="filter-dropdown" id="statusFilter">
                                <option value="all">All Files</option>
                                <option value="modified">Modified</option>
                                <option value="added">Added</option>
                                <option value="deleted">Deleted</option>
                                <option value="untracked">Untracked</option>
                                <option value="staged">Staged</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Type:</label>
                            <select class="filter-dropdown" id="fileTypeFilter">
                                <option value="all">All Types</option>
                                <option value="rs">Rust (.rs)</option>
                                <option value="js">JavaScript (.js)</option>
                                <option value="html">HTML (.html)</option>
                                <option value="css">CSS (.css)</option>
                                <option value="md">Markdown (.md)</option>
                                <option value="toml">Config (.toml)</option>
                            </select>
                        </div>
                        <div class="quick-filters">
                            <div class="quick-filter active" onclick="quickFilter('all')" data-filter="all">
                                📄 All
                            </div>
                            <div class="quick-filter" onclick="quickFilter('modified')" data-filter="modified">
                                📝 Modified
                            </div>
                            <div class="quick-filter" onclick="quickFilter('untracked')" data-filter="untracked">
                                ❓ Untracked
                            </div>
                            <div class="quick-filter" onclick="quickFilter('staged')" data-filter="staged">
                                ✅ Staged
                            </div>
                        </div>
                        <div class="search-stats" id="searchStats">
                            📊 Showing 12 of 12 files
                        </div>
                    </div>

                    <!-- Repository Summary -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 12px; background: #252526; border-radius: 4px;">
                        <div>
                            <h3 style="margin: 0; color: #4ec9b0;">📊 Git Status</h3>
                            <div style="font-size: 12px; color: #969696; margin-top: 4px;">
                                On branch <strong style="color: #569cd6;">main</strong> • Your branch is up to date with '<strong>origin/main</strong>'
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 11px; color: #969696;">
                                <div>📝 <span id="modifiedCount">8</span> modified</div>
                                <div>❓ <span id="untrackedCount">4</span> untracked</div>
                                <div>✅ <span id="stagedCount">0</span> staged</div>
                            </div>
                        </div>
                    </div>

                    <!-- Working Directory Stats -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div style="padding: 8px; background: #2d2d30; border-radius: 4px; border-left: 3px solid #f14c4c;">
                            <div style="font-size: 11px; color: #969696;">MODIFIED</div>
                            <div style="font-weight: bold; color: #f14c4c;">8 files</div>
                        </div>
                        <div style="padding: 8px; background: #2d2d30; border-radius: 4px; border-left: 3px solid #ffcc02;">
                            <div style="font-size: 11px; color: #969696;">UNTRACKED</div>
                            <div style="font-weight: bold; color: #ffcc02;">4 files</div>
                        </div>
                        <div style="padding: 8px; background: #2d2d30; border-radius: 4px; border-left: 3px solid #4ec9b0;">
                            <div style="font-size: 11px; color: #969696;">STAGED</div>
                            <div style="font-weight: bold; color: #4ec9b0;">0 files</div>
                        </div>
                    </div>

                    <!-- Staged Changes Section -->
                    <div id="stagedSection" style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h4 style="margin: 0; color: #4ec9b0; display: flex; align-items: center;">
                                <span style="margin-right: 8px;">📋</span>
                                Changes to be committed <span style="color: #569cd6; font-size: 11px; margin-left: 8px;">(0)</span>
                            </h4>
                            <button class="btn-small" onclick="unstageAllFiles()" style="opacity: 0.7;">Reset All</button>
                        </div>
                        <div class="file-status-list" id="stagedFiles">
                            <div style="padding: 12px; background: #2d2d30; border-radius: 4px; text-align: center; color: #969696; font-style: italic;">
                                No changes staged for commit
                            </div>
                        </div>
                    </div>

                    <!-- Modified Files Section -->
                    <div style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h4 style="margin: 0; color: #f14c4c; display: flex; align-items: center;">
                                <span style="margin-right: 8px;">🔄</span>
                                Changes not staged for commit <span style="color: #569cd6; font-size: 11px; margin-left: 8px;">(8)</span>
                            </h4>
                            <button class="btn-small" onclick="stageAllFiles()">Stage All</button>
                        </div>
                        <div class="file-status-list" id="unstagedFiles">
                            <div class="file-list-header">
                                <div class="file-list-title">📝 Modified Files</div>
                                <div class="file-list-count">8</div>
                            </div>
                            <div class="file-list-content">
                                <!-- Enhanced File Items with New Structure -->
                                <div class="file-item" onclick="selectFile(this)" data-file="docs/tui/new-layout-design.md" data-status="modified" data-type="md">
                                    <div class="file-status modified">M</div>
                                    <div class="file-details">
                                        <div class="file-name">new-layout-design.md</div>
                                        <div class="file-path">docs/tui/new-layout-design.md</div>
                                    </div>
                                    <div class="file-stats">
                                        <span style="color: #2ea043;">+425</span>
                                        <span style="color: #f85149;">-0</span>
                                    </div>
                                    <div class="file-actions">
                                        <button class="file-action-btn stage" onclick="stageFile(event, 'docs/tui/new-layout-design.md')">
                                            ✅ Stage
                                        </button>
                                        <button class="file-action-btn diff" onclick="showFileDiff(event, 'docs/tui/new-layout-design.md')">
                                            🔍 Diff
                                        </button>
                                        <button class="file-action-btn unstage" onclick="discardFile(event, 'docs/tui/new-layout-design.md')">
                                            ↩️ Restore
                                        </button>
                                    </div>
                                </div>
                                <div class="file-item" onclick="selectFile(this)" data-file="docs/tui/tui-demo.html" data-status="modified" data-type="html">
                                    <div class="file-status modified">M</div>
                                    <div class="file-details">
                                        <div class="file-name">tui-demo.html</div>
                                        <div class="file-path">docs/tui/tui-demo.html</div>
                                    </div>
                                    <div class="file-stats">
                                        <span style="color: #2ea043;">+426</span>
                                        <span style="color: #f85149;">-179</span>
                                    </div>
                                    <div class="file-actions">
                                        <button class="file-action-btn stage" onclick="stageFile(event, 'docs/tui/tui-demo.html')">
                                            ✅ Stage
                                        </button>
                                        <button class="file-action-btn diff" onclick="showFileDiff(event, 'docs/tui/tui-demo.html')">
                                            🔍 Diff
                                        </button>
                                        <button class="file-action-btn unstage" onclick="discardFile(event, 'docs/tui/tui-demo.html')">
                                            ↩️ Restore
                                        </button>
                                    </div>
                                </div>
                                <div class="file-item" onclick="selectFile(this)" data-file="src/diff_viewer.rs" data-status="modified" data-type="rs">
                                    <div class="file-status modified">M</div>
                                    <div class="file-details">
                                        <div class="file-name">diff_viewer.rs</div>
                                        <div class="file-path">src/diff_viewer.rs</div>
                                    </div>
                                    <div class="file-stats">
                                        <span style="color: #2ea043;">+77</span>
                                        <span style="color: #f85149;">-0</span>
                                    </div>
                                    <div class="file-actions">
                                        <button class="file-action-btn stage" onclick="stageFile(event, 'src/diff_viewer.rs')">
                                            ✅ Stage
                                        </button>
                                        <button class="file-action-btn diff" onclick="showFileDiff(event, 'src/diff_viewer.rs')">
                                            🔍 Diff
                                        </button>
                                        <button class="file-action-btn unstage" onclick="discardFile(event, 'src/diff_viewer.rs')">
                                            ↩️ Restore
                                        </button>
                                    </div>
                                </div>
                                <div class="file-item" onclick="selectFile(this)" data-file="src/tui_unified/app.rs" data-status="modified" data-type="rs">
                                    <div class="file-status modified">M</div>
                                    <div class="file-details">
                                        <div class="file-name">app.rs</div>
                                        <div class="file-path">src/tui_unified/app.rs</div>
                                    </div>
                                    <div class="file-stats">
                                        <span style="color: #2ea043;">+131</span>
                                        <span style="color: #f85149;">-0</span>
                                    </div>
                                    <div class="file-actions">
                                        <button class="file-action-btn stage" onclick="stageFile(event, 'src/tui_unified/app.rs')">
                                            ✅ Stage
                                        </button>
                                        <button class="file-action-btn diff" onclick="showFileDiff(event, 'src/tui_unified/app.rs')">
                                            🔍 Diff
                                        </button>
                                        <button class="file-action-btn unstage" onclick="discardFile(event, 'src/tui_unified/app.rs')">
                                            ↩️ Restore
                                        </button>
                                    </div>
                                </div>
                                <div class="file-item" onclick="selectFile(this)" data-file="src/tui_unified/components/panels/sidebar.rs" data-status="modified" data-type="rs">
                                    <div class="file-status modified">M</div>
                                    <div class="file-details">
                                        <div class="file-name">sidebar.rs</div>
                                        <div class="file-path">src/tui_unified/components/panels/sidebar.rs</div>
                                    </div>
                                    <div class="file-stats">
                                        <span style="color: #2ea043;">+110</span>
                                        <span style="color: #f85149;">-0</span>
                                    </div>
                                    <div class="file-actions">
                                        <button class="file-action-btn stage" onclick="stageFile(event, 'src/tui_unified/components/panels/sidebar.rs')">
                                            ✅ Stage
                                        </button>
                                        <button class="file-action-btn diff" onclick="showFileDiff(event, 'src/tui_unified/components/panels/sidebar.rs')">
                                            🔍 Diff
                                        </button>
                                        <button class="file-action-btn unstage" onclick="discardFile(event, 'src/tui_unified/components/panels/sidebar.rs')">
                                            ↩️ Restore
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Untracked Files Section -->
                    <div style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h4 style="margin: 0; color: #ffcc02; display: flex; align-items: center;">
                                <span style="margin-right: 8px;">❓</span>
                                Untracked files <span style="color: #569cd6; font-size: 11px; margin-left: 8px;">(4)</span>
                            </h4>
                            <button class="btn-small" onclick="addAllUntracked()">Add All</button>
                        </div>
                        <div class="file-status-list" id="untrackedFiles">
                            <div class="file-item untracked" onclick="selectFile(this)" data-file="final_branch_gitlog_fix.md">
                                <span class="file-status-icon" style="color: #ffcc02;">?</span>
                                <span class="file-path">final_branch_gitlog_fix.md</span>
                                <span class="file-stats" style="color: #969696; font-size: 11px;">new file</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="stageFile(event, 'final_branch_gitlog_fix.md')">Add</button>
                                    <button class="btn-small btn-danger" onclick="deleteFile(event, 'final_branch_gitlog_fix.md')">Delete</button>
                                </span>
                            </div>
                            <div class="file-item untracked" onclick="selectFile(this)" data-file="test_branch_gitlog_fix.md">
                                <span class="file-status-icon" style="color: #ffcc02;">?</span>
                                <span class="file-path">test_branch_gitlog_fix.md</span>
                                <span class="file-stats" style="color: #969696; font-size: 11px;">new file</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="stageFile(event, 'test_branch_gitlog_fix.md')">Add</button>
                                    <button class="btn-small btn-danger" onclick="deleteFile(event, 'test_branch_gitlog_fix.md')">Delete</button>
                                </span>
                            </div>
                            <div class="file-item untracked" onclick="selectFile(this)" data-file="test_diff_fix">
                                <span class="file-status-icon" style="color: #ffcc02;">?</span>
                                <span class="file-path">test_diff_fix</span>
                                <span class="file-stats" style="color: #969696; font-size: 11px;">new file</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="stageFile(event, 'test_diff_fix')">Add</button>
                                    <button class="btn-small btn-danger" onclick="deleteFile(event, 'test_diff_fix')">Delete</button>
                                </span>
                            </div>
                            <div class="file-item untracked" onclick="selectFile(this)" data-file="test_diff_fix.rs">
                                <span class="file-status-icon" style="color: #ffcc02;">?</span>
                                <span class="file-path">test_diff_fix.rs</span>
                                <span class="file-stats" style="color: #969696; font-size: 11px;">new file</span>
                                <span class="file-actions">
                                    <button class="btn-small" onclick="stageFile(event, 'test_diff_fix.rs')">Add</button>
                                    <button class="btn-small btn-danger" onclick="deleteFile(event, 'test_diff_fix.rs')">Delete</button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Bar -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #2d2d30; border-radius: 4px; margin-bottom: 16px;">
                        <div style="display: flex; gap: 8px;">
                            <button class="btn" onclick="commitChanges()" style="background: #4ec9b0;">📝 Commit</button>
                            <button class="btn" onclick="showAICommit()" style="background: #569cd6;">🤖 AI Commit</button>
                            <button class="btn btn-secondary" onclick="stageAllFiles()">📋 Stage All</button>
                            <button class="btn btn-secondary" onclick="unstageAllFiles()">🔄 Reset</button>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-danger" onclick="discardAllFiles()">🗑️ Discard All</button>
                            <button class="btn btn-secondary" onclick="refreshView()">🔄 Refresh</button>
                        </div>
                    </div>

                    <!-- Keyboard Shortcuts -->
                    <div style="padding: 12px; background: #1e1e1e; border-radius: 4px; border-left: 3px solid #569cd6;">
                        <div style="font-size: 12px; color: #969696; display: flex; flex-wrap: gap: 16px;">
                            <span><span class="kbd">Space</span> Stage/Unstage</span>
                            <span><span class="kbd">Enter</span> Select</span>
                            <span><span class="kbd">d</span> Diff</span>
                            <span><span class="kbd">c</span> Commit</span>
                            <span><span class="kbd">a</span> Stage All</span>
                            <span><span class="kbd">r</span> Restore</span>
                            <span><span class="kbd">↑↓</span> Navigate</span>
                        </div>
                    </div>
                </div>

                <!-- Remotes View -->
                <div class="view-container" id="remotesView">
                    <h3>Remote Management</h3>
                    <div class="quick-actions">
                        <button class="btn">Fetch</button>
                        <button class="btn">Pull</button>
                        <button class="btn">Push</button>
                        <button class="btn">Sync</button>
                        <button class="btn btn-secondary" onclick="refreshView()">🔄 Refresh</button>
                    </div>

                    <!-- Git Log for Remotes -->
                    <div style="margin-top: 16px;">
                        <h4 style="margin-bottom: 8px; color: #cccccc;">Git Log</h4>
                        <div class="git-log" id="remotesGitLog">
                            <div class="commit-item selected" data-hash="18c4a3a" onclick="selectRemoteCommit('18c4a3a')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">18c4a3a</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">fix(ui): 修复侧边栏布局问题</span>
                            </div>
                            <div class="commit-item" data-hash="8502563" onclick="selectRemoteCommit('8502563')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">8502563</span>
                                <span class="commit-date">[09-11 01:44]</span>
                                <span class="commit-message">fix(src): 修复TUI界面焦点管理</span>
                            </div>
                            <div class="commit-item" data-hash="5f49518" onclick="selectRemoteCommit('5f49518')">
                                <span class="commit-status">🔒</span>
                                <span class="commit-hash">5f49518</span>
                                <span class="commit-date">[09-10 15:30]</span>
                                <span class="commit-message">feat(diff_viewer): 添加 Diff 修改块</span>
                            </div>
                            <div class="commit-item" data-hash="9bd566f" onclick="selectRemoteCommit('9bd566f')">
                                <span class="commit-status">📝</span>
                                <span class="commit-hash">9bd566f</span>
                                <span class="commit-date">[09-10 14:20]</span>
                                <span class="commit-message">fix(tui_enhanced): 修复左侧面板显示</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 16px; padding: 12px; background: #1e1e1e; border-radius: 4px;">
                        <div style="font-size: 12px; color: #969696;">
                            <span class="kbd">Enter</span> Diff |
                            <span class="kbd">f</span> Fetch |
                            <span class="kbd">p</span> Pull |
                            <span class="kbd">r</span> Reword |
                            <span class="kbd">↑↓</span> Navigate
                        </div>
                    </div>
                </div>

                <!-- History View -->
                <div class="view-container" id="historyView">
                    <h3>Query History</h3>
                    <div class="quick-actions">
                        <button class="btn" onclick="testModalSystem()">🧪 测试弹窗系统</button>
                        <button class="btn">Search</button>
                        <button class="btn">Filter</button>
                        <button class="btn btn-secondary" onclick="refreshView()">🔄 Refresh</button>
                    </div>
                </div>

                <!-- Git Workflow View -->
                <div class="view-container" id="workflowView">
                    <h3>🔄 Git 工作流管理</h3>
                    <div class="workflow-tabs">
                        <button class="btn workflow-tab-btn active" data-tab="rebase" onclick="showWorkflowTab('rebase')">
                            🔄 交互式变基
                        </button>
                        <button class="btn workflow-tab-btn" data-tab="merge" onclick="showWorkflowTab('merge')">
                            🔀 合并操作
                        </button>
                        <button class="btn workflow-tab-btn" data-tab="gitflow" onclick="showWorkflowTab('gitflow')">
                            🌊 Git Flow
                        </button>
                        <button class="btn workflow-tab-btn" data-tab="conflicts" onclick="showWorkflowTab('conflicts')">
                            ⚡ 冲突解决
                        </button>
                    </div>

                    <div class="workflow-content">
                        <!-- Interactive Rebase Tab -->
                        <div class="workflow-tab-content active" id="rebaseTab">
                            <div class="rebase-interface">
                                <div class="rebase-header">
                                    <h4>🔄 交互式变基</h4>
                                    <div class="rebase-controls">
                                        <label>基准提交:</label>
                                        <select id="rebaseBase" class="form-select">
                                            <option value="HEAD~2">HEAD~2 (最近2个提交)</option>
                                            <option value="HEAD~3">HEAD~3 (最近3个提交)</option>
                                            <option value="HEAD~5">HEAD~5 (最近5个提交)</option>
                                        </select>
                                        <button class="btn btn-primary" onclick="startInteractiveRebase()">🔄 开始变基</button>
                                    </div>
                                </div>

                                <div class="commit-list" id="rebaseCommitList">
                                    <div class="commit-item">
                                        <select class="commit-action">
                                            <option value="pick">pick</option>
                                            <option value="reword">reword</option>
                                            <option value="edit">edit</option>
                                            <option value="squash">squash</option>
                                            <option value="drop">drop</option>
                                        </select>
                                        <span class="commit-hash">18c4a3a</span>
                                        <span class="commit-message">fix(ui): 修复侧边栏布局问题</span>
                                    </div>
                                    <div class="commit-item">
                                        <select class="commit-action">
                                            <option value="pick" selected>pick</option>
                                            <option value="reword">reword</option>
                                            <option value="edit">edit</option>
                                            <option value="squash">squash</option>
                                            <option value="drop">drop</option>
                                        </select>
                                        <span class="commit-hash">8502563</span>
                                        <span class="commit-message">fix(src): 修复TUI界面焦点管理问题</span>
                                    </div>
                                </div>

                                <div class="rebase-actions">
                                    <button class="btn btn-success" onclick="executeRebase()">✅ 执行变基</button>
                                    <button class="btn btn-warning" onclick="previewRebase()">👁️ 预览变更</button>
                                    <button class="btn btn-secondary" onclick="resetRebase()">🔄 重置</button>
                                </div>
                            </div>
                        </div>

                        <!-- Merge Operations Tab -->
                        <div class="workflow-tab-content" id="mergeTab">
                            <div class="merge-interface">
                                <h4>🔀 合并操作</h4>
                                <div class="merge-config">
                                    <div class="form-group">
                                        <label>源分支:</label>
                                        <select class="form-select">
                                            <option>feature/auth</option>
                                            <option>develop</option>
                                            <option>hotfix/v1.2</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>目标分支:</label>
                                        <select class="form-select">
                                            <option>main</option>
                                            <option>develop</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>合并策略:</label>
                                        <select class="form-select">
                                            <option>--no-ff (创建合并提交)</option>
                                            <option>--ff-only (快进合并)</option>
                                            <option>--squash (压缩合并)</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="executeMerge()">🔀 执行合并</button>
                            </div>
                        </div>

                        <!-- Git Flow Tab -->
                        <div class="workflow-tab-content" id="gitflowTab">
                            <div class="gitflow-interface">
                                <h4>🌊 Git Flow 工作流</h4>
                                <div class="gitflow-sections">
                                    <div class="gitflow-section">
                                        <h5>Feature 分支</h5>
                                        <div class="gitflow-actions">
                                            <button class="btn btn-primary" onclick="startFeature()">🌱 开始 Feature</button>
                                            <button class="btn btn-success" onclick="finishFeature()">✅ 完成 Feature</button>
                                            <button class="btn btn-info" onclick="listFeatures()">📋 列表 Feature</button>
                                        </div>
                                    </div>
                                    <div class="gitflow-section">
                                        <h5>Release 分支</h5>
                                        <div class="gitflow-actions">
                                            <button class="btn btn-primary" onclick="startRelease()">🚀 开始 Release</button>
                                            <button class="btn btn-success" onclick="finishRelease()">✅ 完成 Release</button>
                                        </div>
                                    </div>
                                    <div class="gitflow-section">
                                        <h5>Hotfix 分支</h5>
                                        <div class="gitflow-actions">
                                            <button class="btn btn-warning" onclick="startHotfix()">🚨 开始 Hotfix</button>
                                            <button class="btn btn-success" onclick="finishHotfix()">✅ 完成 Hotfix</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conflict Resolution Tab -->
                        <div class="workflow-tab-content" id="conflictsTab">
                            <div class="conflicts-interface">
                                <h4>⚡ 冲突解决</h4>
                                <div class="conflict-files">
                                    <div class="conflict-file">
                                        <div class="file-header">
                                            <span class="file-icon">⚠️</span>
                                            <span class="file-path">src/main.rs</span>
                                            <button class="btn btn-sm" onclick="resolveConflict('src/main.rs')">解决冲突</button>
                                        </div>
                                    </div>
                                    <div class="conflict-file">
                                        <div class="file-header">
                                            <span class="file-icon">⚠️</span>
                                            <span class="file-path">docs/README.md</span>
                                            <button class="btn btn-sm" onclick="resolveConflict('docs/README.md')">解决冲突</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="conflict-actions">
                                    <button class="btn btn-success" onclick="continueOperation()">✅ 继续操作</button>
                                    <button class="btn btn-danger" onclick="abortOperation()">❌ 中止操作</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Collaboration View -->
                <div class="view-container" id="collaborationView">
                    <h3>👥 团队协作中心</h3>
                    <div class="collaboration-header">
                        <div class="notification-badge">3</div>
                        <button class="btn btn-secondary" onclick="refreshCollaborationData()">🔄 刷新</button>
                    </div>

                    <div class="collaboration-tabs">
                        <button class="btn collaboration-tab-btn active" data-tab="pullrequests" onclick="showCollaborationTab('pullrequests')">
                            📋 Pull Requests
                        </button>
                        <button class="btn collaboration-tab-btn" data-tab="reviews" onclick="showCollaborationTab('reviews')">
                            👁️ 代码审查
                        </button>
                        <button class="btn collaboration-tab-btn" data-tab="stats" onclick="showCollaborationTab('stats')">
                            📊 团队统计
                        </button>
                        <button class="btn collaboration-tab-btn" data-tab="notifications" onclick="showCollaborationTab('notifications')">
                            🔔 通知中心
                        </button>
                    </div>

                    <div class="collaboration-content">
                        <!-- Pull Requests Tab -->
                        <div class="collaboration-tab-content active" id="pullrequestsTab">
                            <div class="pr-header">
                                <h4>📋 Pull Requests</h4>
                                <div class="pr-controls">
                                    <button class="btn btn-primary" onclick="createPullRequest()">➕ 创建 PR</button>
                                    <select class="form-select" onchange="filterPRs(this.value)">
                                        <option value="all">全部</option>
                                        <option value="open">进行中</option>
                                        <option value="closed">已关闭</option>
                                        <option value="merged">已合并</option>
                                    </select>
                                </div>
                            </div>

                            <div class="pr-list">
                                <div class="pr-item open">
                                    <div class="pr-main">
                                        <div class="pr-title">
                                            <span class="pr-id">#123</span>
                                            <span class="pr-title-text">feat(auth): 实现OAuth 2.0认证功能</span>
                                        </div>
                                        <div class="pr-meta">
                                            <span class="pr-author">by Alice Chen</span>
                                            <span class="pr-time">2小时前</span>
                                            <span class="pr-branch">feature/oauth → main</span>
                                        </div>
                                    </div>
                                    <div class="pr-status">
                                        <span class="pr-checks">✅ 4/5 检查通过</span>
                                        <span class="pr-reviews">👁️ 需要审查</span>
                                    </div>
                                </div>

                                <div class="pr-item closed">
                                    <div class="pr-main">
                                        <div class="pr-title">
                                            <span class="pr-id">#122</span>
                                            <span class="pr-title-text">fix(ui): 修复响应式布局问题</span>
                                        </div>
                                        <div class="pr-meta">
                                            <span class="pr-author">by Bob Wilson</span>
                                            <span class="pr-time">1天前</span>
                                            <span class="pr-branch">hotfix/responsive → main</span>
                                        </div>
                                    </div>
                                    <div class="pr-status">
                                        <span class="pr-checks">✅ 已合并</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Code Reviews Tab -->
                        <div class="collaboration-tab-content" id="reviewsTab">
                            <div class="review-interface">
                                <h4>👁️ 代码审查</h4>
                                <div class="review-list">
                                    <div class="review-item pending">
                                        <div class="review-header">
                                            <span class="review-title">PR #123: OAuth 2.0 认证功能</span>
                                            <span class="review-priority high">高优先级</span>
                                        </div>
                                        <div class="review-details">
                                            <span class="review-author">请求者: Alice Chen</span>
                                            <span class="review-complexity">复杂度: 中等</span>
                                            <span class="review-files">文件: 8个</span>
                                        </div>
                                        <div class="review-actions">
                                            <button class="btn btn-success" onclick="approveReview(123)">✅ 批准</button>
                                            <button class="btn btn-warning" onclick="requestChanges(123)">🔄 需要修改</button>
                                            <button class="btn btn-info" onclick="addComment(123)">💬 评论</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Team Statistics Tab -->
                        <div class="collaboration-tab-content" id="statsTab">
                            <div class="stats-interface">
                                <h4>📊 团队统计</h4>
                                <div class="stats-summary">
                                    <div class="stat-card">
                                        <h5>提交数量</h5>
                                        <span class="stat-number">156</span>
                                        <span class="stat-period">本月</span>
                                    </div>
                                    <div class="stat-card">
                                        <h5>PR数量</h5>
                                        <span class="stat-number">23</span>
                                        <span class="stat-period">本月</span>
                                    </div>
                                    <div class="stat-card">
                                        <h5>代码审查</h5>
                                        <span class="stat-number">45</span>
                                        <span class="stat-period">本月</span>
                                    </div>
                                </div>

                                <div class="contributor-leaderboard">
                                    <h5>贡献者排行榜</h5>
                                    <div class="leaderboard-item">
                                        <span class="contributor-rank">#1</span>
                                        <span class="contributor-name">Alice Chen</span>
                                        <span class="contributor-commits">42 commits</span>
                                    </div>
                                    <div class="leaderboard-item">
                                        <span class="contributor-rank">#2</span>
                                        <span class="contributor-name">Bob Wilson</span>
                                        <span class="contributor-commits">38 commits</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Tab -->
                        <div class="collaboration-tab-content" id="notificationsTab">
                            <div class="notifications-interface">
                                <h4>🔔 通知中心</h4>
                                <div class="notification-controls">
                                    <button class="btn btn-secondary" onclick="markAllRead()">✅ 全部已读</button>
                                    <button class="btn btn-secondary" onclick="configureNotifications()">⚙️ 设置</button>
                                </div>

                                <div class="notification-list">
                                    <div class="notification-item unread priority-high">
                                        <div class="notification-icon">🚨</div>
                                        <div class="notification-content">
                                            <div class="notification-title">紧急: 生产环境部署失败</div>
                                            <div class="notification-message">主分支的最新提交导致构建失败，需要立即修复</div>
                                            <div class="notification-time">5分钟前</div>
                                        </div>
                                    </div>

                                    <div class="notification-item unread priority-medium">
                                        <div class="notification-icon">👁️</div>
                                        <div class="notification-content">
                                            <div class="notification-title">代码审查请求</div>
                                            <div class="notification-message">Alice Chen 请求您审查 PR #123</div>
                                            <div class="notification-time">1小时前</div>
                                        </div>
                                    </div>

                                    <div class="notification-item read priority-low">
                                        <div class="notification-icon">✅</div>
                                        <div class="notification-content">
                                            <div class="notification-title">PR 已合并</div>
                                            <div class="notification-message">您的 PR #122 已成功合并到主分支</div>
                                            <div class="notification-time">3小时前</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <span>[NORMAL]</span>
                <span>Focus: Content</span>
                <span>View: <span id="currentView">Branches</span></span>
            </div>
            <div class="status-right">
                <span><kbd>F5</kbd> Refresh</span>
                <span><kbd>Ctrl+P</kbd> Pull</span>
                <span><kbd>Ctrl+A</kbd> AI Commit</span>
                <span><kbd>Tab</kbd> Focus</span>
                <span><kbd>q</kbd> Quit</span>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Enhanced Diff Viewer Modal -->
    <div class="modal" id="diffModal">
        <div class="modal-content" style="width: 95%; max-width: 1400px; height: 90vh;">
            <div class="modal-header">
                <div class="modal-title">
                    📄 Diff Viewer - <span id="diffCommitHash">18c4a3a</span>
                </div>
                <button class="modal-close" onclick="closeDiffModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="diff-viewer">
                    <!-- Diff Header with Controls and Stats -->
                    <div class="diff-header">
                        <div class="diff-modes">
                            <button class="diff-mode-btn active" onclick="switchDiffMode('unified')" data-mode="unified">
                                📋 Unified
                            </button>
                            <button class="diff-mode-btn" onclick="switchDiffMode('side-by-side')" data-mode="side-by-side">
                                ⬌ Side-by-Side
                            </button>
                            <button class="diff-mode-btn" onclick="switchDiffMode('split')" data-mode="split">
                                📋 Split View
                            </button>
                        </div>
                        <div class="diff-stats">
                            <span>📁 <span id="diffFileCount">3</span> files</span>
                            <span style="color: #2ea043;">+<span id="diffAdded">45</span></span>
                            <span style="color: #f85149;">-<span id="diffRemoved">12</span></span>
                            <span>🔍 <span id="diffCurrentFile">1 of 3</span></span>
                        </div>
                    </div>

                    <!-- File Navigation Bar -->
                    <div style="background: #2d2d30; padding: 8px 12px; border-bottom: 1px solid #3e3e42; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-family: 'Fira Code', monospace; font-size: 13px; color: #79c0ff;" id="currentDiffFile">
                                src/core/ai/agents/commit_agent.rs
                            </span>
                            <div style="font-size: 11px; color: #7d8590;">
                                <span style="color: #2ea043;">+25</span>
                                <span style="color: #f85149;">-8</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 6px;">
                            <button class="btn btn-secondary" onclick="navigateDiffFile(-1)" style="padding: 4px 8px; font-size: 11px;">
                                ← Prev
                            </button>
                            <button class="btn btn-secondary" onclick="showFileList()" style="padding: 4px 8px; font-size: 11px;">
                                📁 Files
                            </button>
                            <button class="btn btn-secondary" onclick="navigateDiffFile(1)" style="padding: 4px 8px; font-size: 11px;">
                                Next →
                            </button>
                        </div>
                    </div>

                    <!-- Diff Content -->
                    <div class="diff-content" id="diffContent">
                        <!-- Enhanced Unified View with Line Numbers -->
                        <div id="unifiedView" class="diff-content">
                            <div class="diff-line hunk" data-line-number="hunk-1">
                                <span class="diff-line-number">@@ -194,18 +194,53 @@</span>
                                <span class="diff-line-content">impl CommitAgent {</span>
                            </div>
                            <div class="diff-line context" data-line-number="194">
                                <span class="diff-line-number">194</span>
                                <span class="diff-line-content">    /// 清理提交消息</span>
                            </div>
                            <div class="diff-line context" data-line-number="195">
                                <span class="diff-line-number">195</span>
                                <span class="diff-line-content">    fn clean_commit_message(&self, message: &str) -> String {</span>
                            </div>
                            <div class="diff-line removed" data-line-number="196">
                                <span class="diff-line-number">196</span>
                                <span class="diff-line-content">        // 只取第一行，去除多余空白和引号</span>
                            </div>
                            <div class="diff-line removed" data-line-number="197">
                                <span class="diff-line-number">197</span>
                                <span class="diff-line-content">        let cleaned = message.lines()</span>
                            </div>
                            <div class="diff-line removed" data-line-number="198">
                                <span class="diff-line-number">198</span>
                                <span class="diff-line-content">            .next()</span>
                            </div>
                            <div class="diff-line added" data-line-number="196-new">
                                <span class="diff-line-number">196</span>
                                <span class="diff-line-content">        // 寻找符合 <span class="token keyword">Conventional</span> <span class="token keyword">Commits</span> 格式的行</span>
                            </div>
                            <div class="diff-line added" data-line-number="197-new">
                                <span class="diff-line-number">197</span>
                                <span class="diff-line-content">        <span class="token keyword">for</span> line <span class="token keyword">in</span> message.<span class="token function">lines</span>() {</span>
                            </div>
                            <div class="diff-line added" data-line-number="198-new">
                                <span class="diff-line-number">198</span>
                                <span class="diff-line-content">            <span class="token keyword">let</span> trimmed_line = line.<span class="token function">trim</span>();</span>
                            </div>
                            <div class="diff-line added" data-line-number="199-new">
                                <span class="diff-line-number">199</span>
                                <span class="diff-line-content"></span>
                            </div>
                            <div class="diff-line added" data-line-number="200-new">
                                <span class="diff-line-number">200</span>
                                <span class="diff-line-content">            // 跳过空行和明显的解释性文本</span>
                            </div>
                            <div class="diff-line added" data-line-number="201-new">
                                <span class="diff-line-number">201</span>
                                <span class="diff-line-content">            <span class="token keyword">if</span> trimmed_line.<span class="token function">is_empty</span>() ||</span>
                            </div>
                            <div class="diff-line added" data-line-number="202-new">
                                <span class="diff-line-number">202</span>
                                <span class="diff-line-content">                trimmed_line.<span class="token function">starts_with</span>(<span class="token string">"Here"</span>) ||</span>
                            </div>
                            <div class="diff-line added" data-line-number="203-new">
                                <span class="diff-line-number">203</span>
                                <span class="diff-line-content">                trimmed_line.<span class="token function">starts_with</span>(<span class="token string">"Based"</span>) ||</span>
                            </div>
                            <div class="diff-line added" data-line-number="204-new">
                                <span class="diff-line-number">204</span>
                                <span class="diff-line-content">                trimmed_line.<span class="token function">starts_with</span>(<span class="token string">"The"</span>) ||</span>
                            </div>
                            <div class="diff-line added" data-line-number="205-new">
                                <span class="diff-line-number">205</span>
                                <span class="diff-line-content">                trimmed_line.<span class="token function">starts_with</span>(<span class="token string">"This"</span>) ||</span>
                            </div>
                            <div class="diff-line added" data-line-number="206-new">
                                <span class="diff-line-number">206</span>
                                <span class="diff-line-content">                trimmed_line.<span class="token function">starts_with</span>(<span class="token string">"Analysis"</span>)</span>
                            </div>
                            <div class="diff-line added" data-line-number="207-new">
                                <span class="diff-line-number">207</span>
                                <span class="diff-line-content">            {</span>
                            </div>
                            <div class="diff-line added" data-line-number="208-new">
                                <span class="diff-line-number">208</span>
                                <span class="diff-line-content">                <span class="token keyword">continue</span>;</span>
                            </div>
                            <div class="diff-line added" data-line-number="209-new">
                                <span class="diff-line-number">209</span>
                                <span class="diff-line-content">            }</span>
                            </div>
                            <div class="diff-line context" data-line-number="210">
                                <span class="diff-line-number">210</span>
                                <span class="diff-line-content">        }</span>
                            </div>
                        </div>

                        <!-- Side-by-Side View (hidden by default) -->
                        <div id="sideBySideView" style="display: none;">
                            <div style="display: flex; gap: 1px; height: 100%;">
                                <div style="flex: 1; background: #1a1a1a; overflow: auto;">
                                    <div style="background: #2d2d30; padding: 8px 12px; border-bottom: 1px solid #3e3e42; font-size: 12px; color: #f85149; font-weight: 600;">
                                        📄 Original
                                    </div>
                                    <div class="diff-line context" data-line-number="194">
                                        <span class="diff-line-number">194</span>
                                        <span class="diff-line-content">    /// 清理提交消息</span>
                                    </div>
                                    <div class="diff-line removed" data-line-number="196">
                                        <span class="diff-line-number">196</span>
                                        <span class="diff-line-content">        // 只取第一行，去除多余空白和引号</span>
                                    </div>
                                    <div class="diff-line removed" data-line-number="197">
                                        <span class="diff-line-number">197</span>
                                        <span class="diff-line-content">        let cleaned = message.lines()</span>
                                    </div>
                                    <div class="diff-line removed" data-line-number="198">
                                        <span class="diff-line-number">198</span>
                                        <span class="diff-line-content">            .next()</span>
                                    </div>
                                </div>
                                <div style="flex: 1; background: #1a1a1a; overflow: auto;">
                                    <div style="background: #2d2d30; padding: 8px 12px; border-bottom: 1px solid #3e3e42; font-size: 12px; color: #2ea043; font-weight: 600;">
                                        📄 Modified
                                    </div>
                                    <div class="diff-line context" data-line-number="194">
                                        <span class="diff-line-number">194</span>
                                        <span class="diff-line-content">    /// 清理提交消息</span>
                                    </div>
                                    <div class="diff-line added" data-line-number="196-new">
                                        <span class="diff-line-number">196</span>
                                        <span class="diff-line-content">        // 寻找符合 Conventional Commits 格式的行</span>
                                    </div>
                                    <div class="diff-line added" data-line-number="197-new">
                                        <span class="diff-line-number">197</span>
                                        <span class="diff-line-content">        for line in message.lines() {</span>
                                    </div>
                                    <div class="diff-line added" data-line-number="198-new">
                                        <span class="diff-line-number">198</span>
                                        <span class="diff-line-content">            let trimmed_line = line.trim();</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reword Modal -->
    <div class="modal" id="rewordModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>✏️ Edit Commit Message</span>
                <button class="close-btn" onclick="closeRewordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Commit: <span id="rewordCommitHash"></span></label>
                </div>
                <div class="form-group">
                    <label class="form-label">Original Message</label>
                    <input type="text" class="form-input" id="originalMessage" readonly value="fix(ui): 修复侧边栏布局问题">
                </div>
                <div class="form-group">
                    <label class="form-label">New Message</label>
                    <input type="text" class="form-input" id="newMessage" placeholder="Enter new commit message">
                </div>
                <div class="form-group">
                    <label class="form-label">Body (optional)</label>
                    <textarea class="form-textarea" id="commitBody" placeholder="Additional details..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveReword()">Save</button>
                <button class="btn btn-info" onclick="aiEnhance()">AI Enhance</button>
                <button class="btn btn-secondary" onclick="closeRewordModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- AI Commit Modal -->
    <div class="modal" id="aiCommitModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>🤖 AI Commit Assistant</span>
                <button class="close-btn" onclick="closeAIModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">AI Provider</label>
                    <select class="form-select" id="aiProvider">
                        <option value="ollama">Ollama (Local)</option>
                        <option value="deepseek">Deepseek</option>
                        <option value="siliconflow">SiliconFlow</option>
                        <option value="kimi">Kimi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Model</label>
                    <select class="form-select" id="aiModel">
                        <option value="mistral">Mistral</option>
                        <option value="llama2">Llama 2</option>
                        <option value="codellama">Code Llama</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Changes Summary</label>
                    <div style="background: #1e1e1e; padding: 8px; border-radius: 4px;">
                        <div>Files: 3 changed, +45 -12 lines</div>
                        <div>• src/tui/layout/manager.rs [Modified]</div>
                        <div>• src/components/sidebar.rs [Modified]</div>
                        <div>• docs/design.md [Added]</div>
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="generateAICommit()">Generate Suggestions</button>
                </div>
                <div id="aiProgress" style="display: none;">
                    <label class="form-label">Analyzing changes...</label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
                <div id="aiSuggestions" style="display: none;">
                    <label class="form-label">AI Suggestions</label>
                    <div class="ai-suggestions">
                        <div class="ai-suggestion-item" onclick="selectSuggestion(this, 1)">
                            <div class="ai-suggestion-title">1. fix(ui): 重构侧边栏布局，解决信息层次混乱问题 ⭐</div>
                            <div class="ai-suggestion-body">• 分离仓库状态和菜单导航
• 优化焦点管理逻辑
• 改善用户交互体验</div>
                        </div>
                        <div class="ai-suggestion-item" onclick="selectSuggestion(this, 2)">
                            <div class="ai-suggestion-title">2. fix(tui): 修复侧边栏组件布局和焦点管理问题</div>
                            <div class="ai-suggestion-body">解决了侧边栏中Repository信息、分支列表和菜单导航
混合显示导致的信息层次不清和交互复杂的问题</div>
                        </div>
                        <div class="ai-suggestion-item" onclick="selectSuggestion(this, 3)">
                            <div class="ai-suggestion-title">3. refactor(layout): 优化TUI布局管理系统</div>
                            <div class="ai-suggestion-body">重构布局管理器以支持更灵活的组件排列和响应式设计</div>
                        </div>
                    </div>
                    <div id="editAICommit" style="display: none; margin-top: 16px;">
                        <label class="form-label">Edit Selected Message</label>
                        <textarea class="form-input" id="aiCommitMessage" rows="3" placeholder="Edit the commit message..."></textarea>
                        <div style="margin-top: 8px; font-size: 12px; color: #969696;">
                            <span class="kbd">Ctrl+Enter</span> Apply | <span class="kbd">Esc</span> Cancel Edit
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div id="aiCommitActions" style="display: none;">
                    <button class="btn btn-primary" onclick="useAICommit()">Use Selected</button>
                    <button class="btn btn-info" onclick="editAIMessage()">Edit Message</button>
                    <button class="btn btn-warning" onclick="regenerateAI()">Regenerate</button>
                </div>
                <div id="aiEditActions" style="display: none;">
                    <button class="btn btn-primary" onclick="applyEditedMessage()">Apply Changes</button>
                    <button class="btn btn-secondary" onclick="cancelEdit()">Cancel Edit</button>
                </div>
                <button class="btn btn-secondary" onclick="closeAIModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Interactive Rebase Modal -->
    <div class="modal" id="rebaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>🔄 Interactive Rebase Editor</span>
                <button class="close-btn" onclick="closeRebaseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Editing 5 commits from 18c4a3a to HEAD</label>
                </div>
                <div style="background: #1e1e1e; padding: 12px; border-radius: 4px;">
                    <div class="commit-item">
                        <select class="form-select" style="width: 100px; margin-right: 8px;">
                            <option value="pick">pick</option>
                            <option value="reword">reword</option>
                            <option value="edit">edit</option>
                            <option value="squash">squash</option>
                            <option value="fixup">fixup</option>
                            <option value="drop">drop</option>
                        </select>
                        <span>18c4a3a fix(ui): 修复侧边栏布局问题</span>
                    </div>
                    <div class="commit-item">
                        <select class="form-select" style="width: 100px; margin-right: 8px;">
                            <option value="pick">pick</option>
                            <option value="reword" selected>reword</option>
                            <option value="edit">edit</option>
                            <option value="squash">squash</option>
                            <option value="fixup">fixup</option>
                            <option value="drop">drop</option>
                        </select>
                        <span>8502563 fix(src): 修复TUI界面焦点管理 ✏️</span>
                    </div>
                    <div class="commit-item">
                        <select class="form-select" style="width: 100px; margin-right: 8px;">
                            <option value="pick">pick</option>
                            <option value="reword">reword</option>
                            <option value="edit">edit</option>
                            <option value="squash" selected>squash</option>
                            <option value="fixup">fixup</option>
                            <option value="drop">drop</option>
                        </select>
                        <span>5f49518 feat: 添加 Diff 修改块</span>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">Commands:</label>
                    <div style="font-size: 12px; color: #969696;">
                        <div><kbd>p</kbd> pick - 使用提交</div>
                        <div><kbd>r</kbd> reword - 使用提交，但修改提交信息</div>
                        <div><kbd>e</kbd> edit - 使用提交，但停下来修改</div>
                        <div><kbd>s</kbd> squash - 使用提交，但融合到上一个提交</div>
                        <div><kbd>f</kbd> fixup - 类似于 squash，但丢弃提交信息</div>
                        <div><kbd>d</kbd> drop - 删除提交</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="startRebase()">Start Rebase</button>
                <button class="btn btn-secondary" onclick="closeRebaseModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Commit Modal -->
    <div class="modal" id="commitModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>📝 Commit Changes</span>
                <button class="close-btn" onclick="closeCommitModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Commit Message</label>
                    <textarea class="form-input" id="commitMessage" rows="4" placeholder="Enter commit message...&#10;&#10;Use conventional commit format:&#10;feat(scope): description&#10;fix(scope): description&#10;docs(scope): description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Files to commit</label>
                    <div class="commit-files" id="commitFilesList">
                        <div class="commit-file-item">
                            <span class="file-status-icon">✓</span>
                            <span class="file-path">src/tui/layout/manager.rs</span>
                            <span class="file-status">Modified</span>
                        </div>
                        <div class="commit-file-item">
                            <span class="file-status-icon">✓</span>
                            <span class="file-path">src/components/sidebar.rs</span>
                            <span class="file-status">Modified</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="pushAfterCommit" style="margin-right: 8px;">
                        Push to remote after commit
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="executeCommit()">Commit</button>
                <button class="btn btn-info" onclick="showAICommit(); closeCommitModal();">AI Assist</button>
                <button class="btn btn-secondary" onclick="closeCommitModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div class="modal" id="customAlertModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <span id="alertTitle">💬 提示</span>
                <button class="close-btn" onclick="closeCustomAlert()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="alertMessage" style="padding: 20px 0; line-height: 1.6; color: #e0e0e0;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeCustomAlert()">确定</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div class="modal" id="customConfirmModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <span id="confirmTitle">❓ 确认操作</span>
                <button class="close-btn" onclick="closeCustomConfirm()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="confirmMessage" style="padding: 20px 0; line-height: 1.6; color: #e0e0e0;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="confirmYesBtn">确认</button>
                <button class="btn btn-secondary" onclick="closeCustomConfirm()">取消</button>
            </div>
        </div>
    </div>

    <!-- Custom Prompt Input Modal -->
    <div class="modal" id="customPromptModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <span id="promptTitle">📝 输入</span>
                <button class="close-btn" onclick="closeCustomPrompt()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="promptMessage" style="padding: 10px 0 20px 0; line-height: 1.6; color: #e0e0e0;"></div>
                <div class="form-group">
                    <input type="text"
                           id="promptInput"
                           class="form-input"
                           placeholder="请输入..."
                           style="width: 100%; margin-bottom: 0;"
                           autocomplete="off">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="promptOkBtn">确定</button>
                <button class="btn btn-secondary" onclick="closeCustomPrompt()">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 统一状态管理系统
        const AppState = {
            currentView: 'branches',
            selectedCommit: '18c4a3a',
            selectedAISuggestion: null,
            customConfirmCallback: null,
            selectedFileIndex: 0,
            isStashMode: true,
            selectedStashIndex: 0,
            selectedBranchIndex: 0,
            branchesFocusOnGitLog: false,
            stashFocusOnGitLog: false,

            // 状态更新方法
            updateView(newView) {
                if (this.currentView !== newView) {
                    const oldView = this.currentView;
                    this.currentView = newView;
                    this.onViewChange(oldView, newView);
                }
            },

            // 视图切换回调
            onViewChange(oldView, newView) {
                // 更新状态栏
                const viewElement = document.getElementById('currentView');
                if (viewElement) {
                    viewElement.textContent = newView.charAt(0).toUpperCase() + newView.slice(1);
                }

                // 更新动态列表
                if (newView === 'branches' || newView === 'git-log') {
                    updateDynamicListSafeV2(newView);
                } else {
                    updateDynamicList(newView);
                }

                // 清理旧状态
                this.cleanupViewState(oldView);

                // 初始化新视图状态
                this.initializeViewState(newView);

                // 同步全局变量
                this.syncToGlobals();
            },

            // 同步AppState到全局变量
            syncToGlobals() {
                currentView = this.currentView;
                selectedCommit = this.selectedCommit;
                selectedAISuggestion = this.selectedAISuggestion;
                customConfirmCallback = this.customConfirmCallback;
                selectedFileIndex = this.selectedFileIndex;
                isStashMode = this.isStashMode;
                selectedStashIndex = this.selectedStashIndex;
                selectedBranchIndex = this.selectedBranchIndex;
                branchesFocusOnGitLog = this.branchesFocusOnGitLog;
                stashFocusOnGitLog = this.stashFocusOnGitLog;
            },

            // 从全局变量同步到AppState
            syncFromGlobals() {
                this.currentView = currentView;
                this.selectedCommit = selectedCommit;
                this.selectedAISuggestion = selectedAISuggestion;
                this.customConfirmCallback = customConfirmCallback;
                this.selectedFileIndex = selectedFileIndex;
                this.isStashMode = isStashMode;
                this.selectedStashIndex = selectedStashIndex;
                this.selectedBranchIndex = selectedBranchIndex;
                this.branchesFocusOnGitLog = branchesFocusOnGitLog;
                this.stashFocusOnGitLog = stashFocusOnGitLog;
            },

            cleanupViewState(view) {
                // 清理特定视图的状态
                switch(view) {
                    case 'branches':
                        this.branchesFocusOnGitLog = false;
                        break;
                    case 'stash':
                        this.stashFocusOnGitLog = false;
                        break;
                }
            },

            initializeViewState(view) {
                // 初始化特定视图的状态
                switch(view) {
                    case 'branches':
                        this.branchesFocusOnGitLog = false;
                        break;
                    case 'stash':
                        this.stashFocusOnGitLog = false;
                        this.isStashMode = true;
                        break;
                    case 'remotes':
                        selectRemote(0, 'origin');
                        break;
                    case 'history':
                        selectHistory(0, 'fix.*ui');
                        break;
                }
            }
        };

        // 统一数据管理系统
        const AppData = {
            branches: ['main', 'feature/auth', 'develop', 'hotfix/v1.2'],
            commits: {
                recent: ['18c4a3a', '8502563', '5f49518'],
                byBranch: {
                    0: [ // main
                        { hash: '18c4a3a', status: '🐛', date: '[09-11 01:44]', message: 'fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单', author: 'alice' },
                        { hash: '8502563', status: '🐛', date: '[09-10 23:15]', message: 'fix(src): 修复TUI界面焦点管理和视图切换问题', author: 'alice' },
                        { hash: '4872364', status: '🎨', date: '[09-10 22:30]', message: 'fix(tui): 优化 TUI 布局导航组件', author: 'alice' },
                        { hash: 'f9a2d92', status: '🧪', date: '[09-10 21:45]', message: 'test(dev): 添加AI Commit功能测试指南文档', author: 'alice' }
                    ],
                    1: [ // feature/auth
                        { hash: '5f49518', status: '✨', date: '[09-11 16:20]', message: 'feat(auth): 实现用户认证模块', author: 'alice' },
                        { hash: '3c5b770', status: '🎨', date: '[09-11 14:10]', message: 'feat(ui): 实现交互式功能和优化 UI 体验', author: 'alice' },
                        { hash: '2a1b3c4', status: '🔐', date: '[09-11 12:55]', message: 'security(auth): 添加JWT令牌验证', author: 'alice' },
                        { hash: '9d8e7f6', status: '📝', date: '[09-11 10:30]', message: 'docs(auth): 更新认证模块文档', author: 'alice' }
                    ],
                    2: [ // develop
                        { hash: '6e5f7g8', status: '🔀', date: '[09-09 15:30]', message: 'merge: 合并多个功能分支到开发分支', author: 'bob' },
                        { hash: '7f6g8h9', status: '🚀', date: '[09-09 13:20]', message: 'perf(core): 优化核心模块性能', author: 'bob' },
                        { hash: '8g7h9i0', status: '🐛', date: '[09-09 11:15]', message: 'fix(api): 修复API接口响应问题', author: 'bob' },
                        { hash: '9h8i0j1', status: '📦', date: '[09-08 16:45]', message: 'build(deps): 更新项目依赖包', author: 'bob' }
                    ],
                    3: [ // hotfix/v1.2
                        { hash: '0i9j1k2', status: '🚨', date: '[09-08 14:20]', message: 'hotfix: 修复关键安全漏洞', author: 'charlie' },
                        { hash: '1j0k2l3', status: '🔒', date: '[09-08 13:15]', message: 'security: 加强输入验证防止注入攻击', author: 'charlie' },
                        { hash: '2k1l3m4', status: '🧹', date: '[09-08 12:30]', message: 'clean: 清理无用代码和注释', author: 'charlie' },
                        { hash: '3l2m4n5', status: '📋', date: '[09-08 11:45]', message: 'log: 添加详细的安全审计日志', author: 'charlie' }
                    ]
                }
            },
            stashes: [
                { index: 0, name: 'stash@{0}', branch: 'main', message: 'WIP on main: 18c4a3a fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单' },
                { index: 1, name: 'stash@{1}', branch: 'feature/auth', message: 'WIP on feature/auth: 5f49518 feat(auth): 实现用户认证模块' },
                { index: 2, name: 'stash@{2}', branch: 'develop', message: 'WIP on develop: 6e5f7g8 merge: 合并多个功能分支到开发分支' }
            ],
            tags: [
                { name: 'v1.0.0', hash: '18c4a3a', date: '2024-09-11', message: 'Release version 1.0.0' },
                { name: 'v0.9.0', hash: '8502563', date: '2024-09-10', message: 'Pre-release version 0.9.0' },
                { name: 'v0.8.5', hash: '4872364', date: '2024-09-09', message: 'Hotfix version 0.8.5' }
            ],
            remotes: [
                { name: 'origin', url: 'https://github.com/user/ai-commit.git', type: 'fetch/push' },
                { name: 'upstream', url: 'https://github.com/original/ai-commit.git', type: 'fetch' }
            ],

            // 数据获取方法
            getBranches() { return this.branches; },
            getBranchCommits(branchIndex) { return this.commits.byBranch[branchIndex] || this.commits.byBranch[0]; },
            getRecentCommits() { return this.commits.recent; },
            getStashes() { return this.stashes; },
            getTags() { return this.tags; },
            getRemotes() { return this.remotes; }
        };

        // 事件管理系统 - 防止内存泄漏
        const EventManager = {
            listeners: new Map(),

            addEventListener(element, eventType, handler, options = {}) {
                if (!element) return null;

                const elementKey = element.id || element.tagName + '_' + Date.now();
                if (!this.listeners.has(elementKey)) {
                    this.listeners.set(elementKey, []);
                }

                const listenerInfo = { element, eventType, handler, options };
                this.listeners.get(elementKey).push(listenerInfo);

                element.addEventListener(eventType, handler, options);
                return listenerInfo;
            },

            removeEventListener(element, eventType, handler) {
                if (!element) return;

                element.removeEventListener(eventType, handler);

                // 从记录中删除
                for (const [key, listeners] of this.listeners.entries()) {
                    const index = listeners.findIndex(l =>
                        l.element === element && l.eventType === eventType && l.handler === handler
                    );
                    if (index !== -1) {
                        listeners.splice(index, 1);
                        if (listeners.length === 0) {
                            this.listeners.delete(key);
                        }
                        break;
                    }
                }
            },

            removeAllListeners(element) {
                if (!element) return;

                for (const [key, listeners] of this.listeners.entries()) {
                    const elementListeners = listeners.filter(l => l.element === element);
                    elementListeners.forEach(l => {
                        element.removeEventListener(l.eventType, l.handler);
                    });

                    // 移除这个元素的所有监听器
                    const remainingListeners = listeners.filter(l => l.element !== element);
                    if (remainingListeners.length === 0) {
                        this.listeners.delete(key);
                    } else {
                        this.listeners.set(key, remainingListeners);
                    }
                }
            },

            cleanup() {
                // 清理所有事件监听器
                for (const [key, listeners] of this.listeners.entries()) {
                    listeners.forEach(l => {
                        if (l.element) {
                            l.element.removeEventListener(l.eventType, l.handler);
                        }
                    });
                }
                this.listeners.clear();
            },

            // 清理特定容器内的所有事件监听器
            cleanupContainer(container) {
                if (!container) return;

                for (const [key, listeners] of this.listeners.entries()) {
                    const containerListeners = listeners.filter(l =>
                        container.contains(l.element) || l.element === container
                    );
                    containerListeners.forEach(l => {
                        this.removeEventListener(l.element, l.eventType, l.handler);
                    });
                }
            }
        };

        // 页面卸载时清理资源
        window.addEventListener('beforeunload', () => {
            EventManager.cleanup();
        });

        // 保持向后兼容性的全局变量
        let currentView = AppState.currentView;
        let selectedCommit = AppState.selectedCommit;
        let selectedAISuggestion = AppState.selectedAISuggestion;
        let customConfirmCallback = AppState.customConfirmCallback;
        let selectedFileIndex = AppState.selectedFileIndex;
        let isStashMode = AppState.isStashMode;
        let selectedStashIndex = AppState.selectedStashIndex;
        let selectedBranchIndex = AppState.selectedBranchIndex;
        let branchesFocusOnGitLog = AppState.branchesFocusOnGitLog;
        let stashFocusOnGitLog = AppState.stashFocusOnGitLog;

        // DOM 安全操作辅助函数
        const DOMUtils = {
            getElementById(id) {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Element with id '${id}' not found`);
                    return null;
                }
                return element;
            },

            querySelector(selector) {
                try {
                    const element = document.querySelector(selector);
                    if (!element) {
                        console.warn(`Element with selector '${selector}' not found`);
                        return null;
                    }
                    return element;
                } catch (error) {
                    console.error(`Invalid selector '${selector}':`, error);
                    return null;
                }
            },

            querySelectorAll(selector) {
                try {
                    return document.querySelectorAll(selector);
                } catch (error) {
                    console.error(`Invalid selector '${selector}':`, error);
                    return [];
                }
            },

            safeSetTextContent(element, text) {
                if (element && typeof element.textContent !== 'undefined') {
                    element.textContent = text;
                    return true;
                }
                return false;
            },

            safeSetInnerHTML(element, html) {
                if (element && typeof element.innerHTML !== 'undefined') {
                    element.innerHTML = html;
                    return true;
                }
                return false;
            },

            safeAddClass(element, className) {
                if (element && element.classList) {
                    element.classList.add(className);
                    return true;
                }
                return false;
            },

            safeRemoveClass(element, className) {
                if (element && element.classList) {
                    element.classList.remove(className);
                    return true;
                }
                return false;
            },

            safeToggleClass(element, className, condition) {
                if (element && element.classList) {
                    if (typeof condition !== 'undefined') {
                        element.classList.toggle(className, condition);
                    } else {
                        element.classList.toggle(className);
                    }
                    return true;
                }
                return false;
            }
        };

        // HTML sanitization helper function
        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Safe HTML template function
        function safeHtml(strings, ...values) {
            return strings.reduce((result, string, i) => {
                const value = values[i] ? escapeHtml(values[i]) : '';
                return result + string + value;
            });
        }

        // ========================================
        // 📊 Advanced Search and Filter Module
        // ========================================
        const SearchManager = {
            currentSearchTerm: '',
            activeFilters: new Set(),
            searchCache: new Map(),
            savedSearches: new Map(),
            searchHistory: [],
            regexMode: false,
            fuzzyMode: false,
            searchStats: { totalFiles: 0, matchedFiles: 0, searchTime: 0 },

            /**
             * 初始化搜索系统
             */
            init() {
                const searchInput = DOMUtils.getElementById('fileSearchInput');
                const statusFilter = DOMUtils.getElementById('statusFilter');
                const typeFilter = DOMUtils.getElementById('fileTypeFilter');

                if (searchInput) {
                    // 防抖搜索
                    let searchTimeout;
                    EventManager.addEventListener(searchInput, 'input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.performSearch(e.target.value);
                        }, 300);
                    });

                    // 支持快捷键
                    EventManager.addEventListener(searchInput, 'keydown', (e) => {
                        if (e.key === 'Enter' && e.ctrlKey) {
                            this.toggleRegexMode();
                        } else if (e.key === 'Enter' && e.altKey) {
                            this.toggleFuzzyMode();
                        } else if (e.key === 'F3') {
                            e.preventDefault();
                            this.findNext();
                        }
                    });
                }

                if (statusFilter) {
                    EventManager.addEventListener(statusFilter, 'change', (e) => {
                        this.applyFilter('status', e.target.value);
                    });
                }

                if (typeFilter) {
                    EventManager.addEventListener(typeFilter, 'change', (e) => {
                        this.applyFilter('type', e.target.value);
                    });
                }

                // 初始化保存的搜索
                this.loadSavedSearches();
                this.setupAdvancedSearchUI();
            },

            /**
             * 设置高级搜索UI
             */
            setupAdvancedSearchUI() {
                this.createSearchModeButtons();
                this.createSavedSearchDropdown();
                this.updateSearchStats();
            },

            /**
             * 创建搜索模式按钮
             */
            createSearchModeButtons() {
                const searchContainer = document.querySelector('.search-container');
                if (!searchContainer) return;

                const modeButtons = document.createElement('div');
                modeButtons.className = 'search-mode-buttons';
                modeButtons.innerHTML = `
                    <button class="search-mode-btn" id="regexModeBtn" title="正则表达式模式 (Ctrl+Enter)">.*</button>
                    <button class="search-mode-btn" id="fuzzyModeBtn" title="模糊搜索模式 (Alt+Enter)">~</button>
                    <button class="search-mode-btn" id="caseSensitiveBtn" title="区分大小写">Aa</button>
                    <button class="search-mode-btn" id="wholeWordBtn" title="全词匹配">"</button>
                `;

                const searchInputGroup = searchContainer.querySelector('.search-input-group');
                searchInputGroup.appendChild(modeButtons);

                // 绑定事件
                this.bindSearchModeEvents();
            },

            /**
             * 绑定搜索模式事件
             */
            bindSearchModeEvents() {
                const regexBtn = document.getElementById('regexModeBtn');
                const fuzzyBtn = document.getElementById('fuzzyModeBtn');
                const caseBtn = document.getElementById('caseSensitiveBtn');
                const wordBtn = document.getElementById('wholeWordBtn');

                if (regexBtn) {
                    EventManager.addEventListener(regexBtn, 'click', () => this.toggleRegexMode());
                }
                if (fuzzyBtn) {
                    EventManager.addEventListener(fuzzyBtn, 'click', () => this.toggleFuzzyMode());
                }
                if (caseBtn) {
                    EventManager.addEventListener(caseBtn, 'click', () => this.toggleCaseSensitive());
                }
                if (wordBtn) {
                    EventManager.addEventListener(wordBtn, 'click', () => this.toggleWholeWord());
                }
            },

            /**
             * 切换正则表达式模式
             */
            toggleRegexMode() {
                this.regexMode = !this.regexMode;
                const btn = document.getElementById('regexModeBtn');
                if (btn) {
                    btn.classList.toggle('active', this.regexMode);
                }
                this.performSearch(this.currentSearchTerm);
            },

            /**
             * 切换模糊搜索模式
             */
            toggleFuzzyMode() {
                this.fuzzyMode = !this.fuzzyMode;
                const btn = document.getElementById('fuzzyModeBtn');
                if (btn) {
                    btn.classList.toggle('active', this.fuzzyMode);
                }
                this.performSearch(this.currentSearchTerm);
            },

            /**
             * 切换大小写敏感
             */
            toggleCaseSensitive() {
                this.caseSensitive = !this.caseSensitive;
                const btn = document.getElementById('caseSensitiveBtn');
                if (btn) {
                    btn.classList.toggle('active', this.caseSensitive);
                }
                this.performSearch(this.currentSearchTerm);
            },

            /**
             * 切换全词匹配
             */
            toggleWholeWord() {
                this.wholeWord = !this.wholeWord;
                const btn = document.getElementById('wholeWordBtn');
                if (btn) {
                    btn.classList.toggle('active', this.wholeWord);
                }
                this.performSearch(this.currentSearchTerm);
            },

            /**
             * 模糊搜索算法
             */
            fuzzyMatch(text, pattern) {
                if (!pattern) return true;

                const textChars = text.toLowerCase().split('');
                const patternChars = pattern.toLowerCase().split('');

                let textIndex = 0;
                let patternIndex = 0;
                let score = 0;

                while (textIndex < textChars.length && patternIndex < patternChars.length) {
                    if (textChars[textIndex] === patternChars[patternIndex]) {
                        score++;
                        patternIndex++;
                    }
                    textIndex++;
                }

                return patternIndex === patternChars.length;
            },

            /**
             * 正则表达式搜索
             */
            regexMatch(text, pattern) {
                try {
                    const flags = this.caseSensitive ? 'g' : 'gi';
                    const regex = new RegExp(pattern, flags);
                    return regex.test(text);
                } catch (e) {
                    console.warn('Invalid regex pattern:', pattern);
                    return text.toLowerCase().includes(pattern.toLowerCase());
                }
            },

            /**
             * 全文代码搜索
             */
            searchInCode(searchTerm) {
                // 模拟代码内容搜索
                const mockCodeFiles = {
                    'src/main.rs': 'fn main() {\n    println!("Hello, world!");\n}',
                    'src/lib.rs': 'pub mod utils;\npub mod config;',
                    'Cargo.toml': '[package]\nname = "ai-commit"\nversion = "1.0.0"'
                };

                const results = [];
                Object.entries(mockCodeFiles).forEach(([file, content]) => {
                    const lines = content.split('\n');
                    lines.forEach((line, index) => {
                        if (this.matchText(line, searchTerm)) {
                            results.push({
                                file,
                                line: index + 1,
                                content: line.trim(),
                                match: searchTerm
                            });
                        }
                    });
                });

                return results;
            },

            /**
             * 文本匹配
             */
            matchText(text, pattern) {
                if (!pattern) return true;

                if (this.regexMode) {
                    return this.regexMatch(text, pattern);
                } else if (this.fuzzyMode) {
                    return this.fuzzyMatch(text, pattern);
                } else {
                    const searchText = this.caseSensitive ? text : text.toLowerCase();
                    const searchPattern = this.caseSensitive ? pattern : pattern.toLowerCase();

                    if (this.wholeWord) {
                        const regex = new RegExp(`\\b${escapeRegex(searchPattern)}\\b`, this.caseSensitive ? 'g' : 'gi');
                        return regex.test(searchText);
                    }

                    return searchText.includes(searchPattern);
                }
            },

            /**
             * 保存搜索
             */
            saveSearch(name, query, filters) {
                this.savedSearches.set(name, {
                    query,
                    filters: new Map(filters),
                    timestamp: Date.now(),
                    regexMode: this.regexMode,
                    fuzzyMode: this.fuzzyMode,
                    caseSensitive: this.caseSensitive,
                    wholeWord: this.wholeWord
                });

                // 保存到本地存储
                try {
                    localStorage.setItem('aicommit-saved-searches', JSON.stringify(Array.from(this.savedSearches.entries())));
                } catch (e) {
                    console.warn('无法保存搜索到本地存储:', e);
                }

                this.updateSavedSearchDropdown();
                this.showNotification(`搜索 "${name}" 已保存`, 'success');
            },

            /**
             * 加载保存的搜索
             */
            loadSavedSearches() {
                try {
                    const saved = localStorage.getItem('aicommit-saved-searches');
                    if (saved) {
                        const entries = JSON.parse(saved);
                        this.savedSearches = new Map(entries);
                    }
                } catch (e) {
                    console.warn('无法加载保存的搜索:', e);
                }
            },

            /**
             * 应用保存的搜索
             */
            applySavedSearch(name) {
                const search = this.savedSearches.get(name);
                if (!search) return;

                // 应用搜索设置
                this.regexMode = search.regexMode || false;
                this.fuzzyMode = search.fuzzyMode || false;
                this.caseSensitive = search.caseSensitive || false;
                this.wholeWord = search.wholeWord || false;

                // 更新UI状态
                this.updateSearchModeUI();

                // 应用过滤器
                this.activeFilters = new Map(search.filters);

                // 执行搜索
                this.performSearch(search.query);

                // 更新搜索输入框
                const searchInput = document.getElementById('fileSearchInput');
                if (searchInput) {
                    searchInput.value = search.query;
                }
            },

            /**
             * 更新搜索模式UI
             */
            updateSearchModeUI() {
                const regexBtn = document.getElementById('regexModeBtn');
                const fuzzyBtn = document.getElementById('fuzzyModeBtn');
                const caseBtn = document.getElementById('caseSensitiveBtn');
                const wordBtn = document.getElementById('wholeWordBtn');

                if (regexBtn) regexBtn.classList.toggle('active', this.regexMode);
                if (fuzzyBtn) fuzzyBtn.classList.toggle('active', this.fuzzyMode);
                if (caseBtn) caseBtn.classList.toggle('active', this.caseSensitive);
                if (wordBtn) wordBtn.classList.toggle('active', this.wholeWord);
            },

            /**
             * 执行搜索
             */
            performSearch(searchTerm) {
                const startTime = performance.now();

                this.currentSearchTerm = searchTerm;

                // 添加到搜索历史
                if (searchTerm && !this.searchHistory.includes(searchTerm)) {
                    this.searchHistory.unshift(searchTerm);
                    if (this.searchHistory.length > 20) {
                        this.searchHistory.pop();
                    }
                }

                // 检查缓存
                const cacheKey = this.getCacheKey(searchTerm);
                if (this.searchCache.has(cacheKey)) {
                    const cached = this.searchCache.get(cacheKey);
                    this.applySearchResults(cached.results);
                    this.updateSearchStats();
                    return;
                }

                // 执行搜索
                const results = this.executeSearch(searchTerm);

                // 缓存结果
                this.searchCache.set(cacheKey, {
                    results,
                    timestamp: Date.now()
                });

                // 应用结果
                this.applySearchResults(results);

                // 更新统计
                const endTime = performance.now();
                this.searchStats.searchTime = endTime - startTime;
                this.updateSearchStats();
            },

            /**
             * 获取缓存键
             */
            getCacheKey(searchTerm) {
                return `${searchTerm}_${this.regexMode}_${this.fuzzyMode}_${this.caseSensitive}_${this.wholeWord}_${Array.from(this.activeFilters.entries()).join(',')}`;
            },

            /**
             * 执行具体搜索
             */
            executeSearch(searchTerm) {
                const fileContainers = document.querySelectorAll('.file-list-content');
                const results = [];

                fileContainers.forEach(container => {
                    const allItems = Array.from(container.querySelectorAll('.file-item'));
                    allItems.forEach(item => {
                        if (this.matchFileItem(item, searchTerm)) {
                            results.push(item);
                        }
                    });
                });

                return results;
            },

            /**
             * 匹配文件项
             */
            matchFileItem(item, searchTerm) {
                if (!searchTerm) return true;

                const fileName = item.dataset.file || '';
                const fileStatus = item.dataset.status || '';
                const fileType = item.dataset.type || '';

                // 应用搜索模式
                const isMatch = this.matchText(fileName, searchTerm) ||
                              this.matchText(fileStatus, searchTerm) ||
                              this.matchText(fileType, searchTerm);

                if (!isMatch) return false;

                // 应用过滤器
                return this.applyActiveFilters(item);
            },

            /**
             * 应用活动过滤器
             */
            applyActiveFilters(item) {
                // 状态过滤
                if (this.activeFilters.has('status')) {
                    const statusFilter = this.activeFilters.get('status');
                    if (statusFilter !== 'all' && item.dataset.status !== statusFilter) {
                        return false;
                    }
                }

                // 类型过滤
                if (this.activeFilters.has('type')) {
                    const typeFilter = this.activeFilters.get('type');
                    if (typeFilter !== 'all' && item.dataset.type !== typeFilter) {
                        return false;
                    }
                }

                return true;
            },

            /**
             * 应用搜索结果
             */
            applySearchResults(results) {
                const allItems = document.querySelectorAll('.file-item');

                // 隐藏所有项目
                allItems.forEach(item => {
                    item.style.display = 'none';
                    this.removeHighlight(item);
                });

                // 显示匹配的项目并高亮
                results.forEach(item => {
                    item.style.display = 'flex';
                    this.highlightMatches(item);
                });

                this.searchStats.totalFiles = allItems.length;
                this.searchStats.matchedFiles = results.length;
            },

            /**
             * 高亮匹配内容
             */
            highlightMatches(item) {
                if (!this.currentSearchTerm) return;

                const textElements = item.querySelectorAll('.file-name, .file-path');
                textElements.forEach(element => {
                    const originalText = element.textContent;
                    const highlightedText = this.highlightText(originalText, this.currentSearchTerm);
                    if (highlightedText !== originalText) {
                        element.innerHTML = highlightedText;
                    }
                });
            },

            /**
             * 移除高亮
             */
            removeHighlight(item) {
                const highlightedElements = item.querySelectorAll('.search-highlight');
                highlightedElements.forEach(element => {
                    const parent = element.parentNode;
                    parent.replaceChild(document.createTextNode(element.textContent), element);
                    parent.normalize();
                });
            },

            /**
             * 高亮文本
             */
            highlightText(text, searchTerm) {
                if (!searchTerm || !this.matchText(text, searchTerm)) return text;

                if (this.regexMode) {
                    try {
                        const flags = this.caseSensitive ? 'g' : 'gi';
                        const regex = new RegExp(`(${searchTerm})`, flags);
                        return text.replace(regex, '<span class="search-highlight">$1</span>');
                    } catch (e) {
                        return text;
                    }
                } else {
                    const flags = this.caseSensitive ? 'g' : 'gi';
                    const regex = new RegExp(`(${this.escapeRegex(searchTerm)})`, flags);
                    return text.replace(regex, '<span class="search-highlight">$1</span>');
                }
            },

            /**
             * 转义正则表达式特殊字符
             */
            escapeRegex(str) {
                return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            },

            /**
             * 创建保存的搜索下拉菜单
             */
            createSavedSearchDropdown() {
                const searchContainer = document.querySelector('.search-container');
                if (!searchContainer) return;

                const dropdown = document.createElement('div');
                dropdown.className = 'saved-search-dropdown';
                dropdown.innerHTML = `
                    <button class="saved-search-btn" id="savedSearchBtn">
                        💾 保存的搜索
                        <span>▼</span>
                    </button>
                    <div class="saved-search-menu" id="savedSearchMenu">
                        <div class="saved-search-item" onclick="SearchManager.showSaveSearchDialog()">
                            <div class="saved-search-name">+ 保存当前搜索</div>
                        </div>
                    </div>
                `;

                searchContainer.appendChild(dropdown);

                // 绑定事件
                const btn = dropdown.querySelector('#savedSearchBtn');
                const menu = dropdown.querySelector('#savedSearchMenu');

                EventManager.addEventListener(btn, 'click', (e) => {
                    e.stopPropagation();
                    menu.classList.toggle('show');
                });

                // 点击外部关闭菜单
                EventManager.addEventListener(document, 'click', () => {
                    menu.classList.remove('show');
                });

                this.updateSavedSearchDropdown();
            },

            /**
             * 更新保存的搜索下拉菜单
             */
            updateSavedSearchDropdown() {
                const menu = document.getElementById('savedSearchMenu');
                if (!menu) return;

                // 保留第一个"保存当前搜索"项
                const saveItem = menu.querySelector('.saved-search-item');
                menu.innerHTML = '';
                menu.appendChild(saveItem);

                // 添加保存的搜索项
                this.savedSearches.forEach((search, name) => {
                    const item = document.createElement('div');
                    item.className = 'saved-search-item';
                    item.innerHTML = `
                        <div class="saved-search-name">${name}</div>
                        <div class="saved-search-query">${search.query}</div>
                    `;

                    EventManager.addEventListener(item, 'click', () => {
                        this.applySavedSearch(name);
                        menu.classList.remove('show');
                    });

                    menu.appendChild(item);
                });
            },

            /**
             * 显示保存搜索对话框
             */
            showSaveSearchDialog() {
                if (!this.currentSearchTerm) {
                    this.showNotification('请先输入搜索条件', 'warning');
                    return;
                }

                const name = prompt('请输入搜索名称:');
                if (name && name.trim()) {
                    this.saveSearch(name.trim(), this.currentSearchTerm, this.activeFilters);
                }
            },

            /**
             * 显示通知
             */
            showNotification(message, type = 'info') {
                // 简单的通知实现
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 16px;
                    background: ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#007acc'};
                    color: white;
                    border-radius: 4px;
                    z-index: 10000;
                    font-size: 14px;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            },

            /**
             * 查找下一个
             */
            findNext() {
                // 简单实现：重新执行搜索
                this.performSearch(this.currentSearchTerm);
            },

            /**
             * 应用过滤器
             */
            applyFilter(filterType, filterValue) {
                if (filterValue === 'all') {
                    this.activeFilters.delete(filterType);
                } else {
                    this.activeFilters.set(filterType, filterValue);
                }
                this.updateFileList();
                this.updateSearchStats();
            },

            /**
             * 快速过滤器
             */
            quickFilter(filterType) {
                // 清除其他快速过滤器的激活状态
                document.querySelectorAll('.quick-filter').forEach(btn => {
                    btn.classList.remove('active');
                });

                // 激活当前过滤器
                const activeBtn = document.querySelector(`[data-filter="${filterType}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }

                this.applyFilter('status', filterType);
            },

            /**
             * 过滤文件项
             */
            filterFileItems(fileItems) {
                return fileItems.filter(item => {
                    // 搜索过滤
                    if (this.currentSearchTerm) {
                        const fileName = item.dataset.file.toLowerCase();
                        const fileStatus = item.dataset.status.toLowerCase();
                        if (!fileName.includes(this.currentSearchTerm) &&
                            !fileStatus.includes(this.currentSearchTerm)) {
                            return false;
                        }
                    }

                    // 状态过滤
                    if (this.activeFilters.has('status')) {
                        const statusFilter = this.activeFilters.get('status');
                        if (statusFilter !== 'all' && item.dataset.status !== statusFilter) {
                            return false;
                        }
                    }

                    // 类型过滤
                    if (this.activeFilters.has('type')) {
                        const typeFilter = this.activeFilters.get('type');
                        if (typeFilter !== 'all' && item.dataset.type !== typeFilter) {
                            return false;
                        }
                    }

                    return true;
                });
            },

            /**
             * 更新文件列表显示
             */
            updateFileList() {
                const fileContainers = document.querySelectorAll('.file-list-content');

                fileContainers.forEach(container => {
                    const allItems = Array.from(container.querySelectorAll('.file-item'));
                    const filteredItems = this.filterFileItems(allItems);

                    // 隐藏所有项目
                    allItems.forEach(item => item.style.display = 'none');

                    // 显示过滤后的项目
                    filteredItems.forEach(item => item.style.display = 'flex');
                });
            },

            /**
             * 更新搜索统计
             */
            updateSearchStats() {
                const statsElement = DOMUtils.getElementById('searchStats');
                if (!statsElement) return;

                const allItems = document.querySelectorAll('.file-item');
                const visibleItems = document.querySelectorAll('.file-item[style*="display: flex"], .file-item:not([style*="display: none"])');

                const total = allItems.length;
                const visible = visibleItems.length;

                // 增强统计信息
                const timeInfo = this.searchStats.searchTime ? ` | 🕒 ${this.searchStats.searchTime.toFixed(2)}ms` : '';
                const filterInfo = this.activeFilters.size > 0 ? ` | 🔍 ${this.activeFilters.size} filters` : '';

                statsElement.innerHTML = `
                    <div class="stats-item">📊 Showing ${visible} of ${total} files</div>
                    ${timeInfo ? `<div class="stats-item"><span class="stats-time">${timeInfo}</span></div>` : ''}
                    ${filterInfo ? `<div class="stats-item">${filterInfo}</div>` : ''}
                `;
            },

            // ==========================================
            // 高级过滤器系统
            // ==========================================

            /**
             * 高级过滤器管理
             */
            advancedFilters: {
                dateRange: { start: null, end: null },
                fileSize: { min: 0, max: Infinity },
                author: [],
                commitType: [],
                customFilters: new Map()
            },

            /**
             * 创建高级过滤器面板
             */
            createAdvancedFilterPanel() {
                const searchContainer = document.querySelector('.search-container');
                if (!searchContainer) return;

                const panel = document.createElement('div');
                panel.className = 'advanced-filter-panel';
                panel.style.display = 'none';
                panel.innerHTML = `
                    <div class="filter-section">
                        <label class="filter-label">📅 修改时间范围:</label>
                        <div class="date-range-inputs">
                            <input type="date" id="dateStart" class="form-input" placeholder="开始日期">
                            <span>至</span>
                            <input type="date" id="dateEnd" class="form-input" placeholder="结束日期">
                        </div>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">📏 文件大小 (KB):</label>
                        <div class="size-range-inputs">
                            <input type="number" id="sizeMin" class="form-input" placeholder="最小" min="0">
                            <span>-</span>
                            <input type="number" id="sizeMax" class="form-input" placeholder="最大">
                        </div>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">👤 作者:</label>
                        <div class="author-filter">
                            <input type="text" id="authorFilter" class="form-input" placeholder="输入作者名称...">
                            <div class="author-tags" id="authorTags"></div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">🔖 提交类型:</label>
                        <div class="commit-type-filter">
                            <div class="checkbox-group">
                                <label><input type="checkbox" value="feat"> ✨ feat</label>
                                <label><input type="checkbox" value="fix"> 🐛 fix</label>
                                <label><input type="checkbox" value="docs"> 📚 docs</label>
                                <label><input type="checkbox" value="style"> 💄 style</label>
                                <label><input type="checkbox" value="refactor"> ♻️ refactor</label>
                                <label><input type="checkbox" value="test"> 🧪 test</label>
                                <label><input type="checkbox" value="chore"> 🔧 chore</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">🎯 自定义过滤器:</label>
                        <div class="custom-filter">
                            <input type="text" id="customFilterName" class="form-input" placeholder="过滤器名称">
                            <input type="text" id="customFilterRule" class="form-input" placeholder="过滤规则 (JavaScript表达式)">
                            <button class="btn btn-secondary" onclick="SearchManager.addCustomFilter()">添加</button>
                        </div>
                        <div class="custom-filter-tags" id="customFilterTags"></div>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" onclick="SearchManager.applyAdvancedFilters()">应用过滤器</button>
                        <button class="btn btn-secondary" onclick="SearchManager.clearAdvancedFilters()">清除所有</button>
                        <button class="btn btn-secondary" onclick="SearchManager.saveFilterPreset()">保存预设</button>
                    </div>
                `;

                searchContainer.appendChild(panel);
                this.bindAdvancedFilterEvents();
            },

            /**
             * 绑定高级过滤器事件
             */
            bindAdvancedFilterEvents() {
                // 日期范围过滤
                const dateStart = document.getElementById('dateStart');
                const dateEnd = document.getElementById('dateEnd');

                if (dateStart) {
                    EventManager.addEventListener(dateStart, 'change', (e) => {
                        this.advancedFilters.dateRange.start = e.target.value ? new Date(e.target.value) : null;
                    });
                }

                if (dateEnd) {
                    EventManager.addEventListener(dateEnd, 'change', (e) => {
                        this.advancedFilters.dateRange.end = e.target.value ? new Date(e.target.value) : null;
                    });
                }

                // 文件大小过滤
                const sizeMin = document.getElementById('sizeMin');
                const sizeMax = document.getElementById('sizeMax');

                if (sizeMin) {
                    EventManager.addEventListener(sizeMin, 'change', (e) => {
                        this.advancedFilters.fileSize.min = parseInt(e.target.value) || 0;
                    });
                }

                if (sizeMax) {
                    EventManager.addEventListener(sizeMax, 'change', (e) => {
                        this.advancedFilters.fileSize.max = parseInt(e.target.value) || Infinity;
                    });
                }

                // 作者过滤
                const authorFilter = document.getElementById('authorFilter');
                if (authorFilter) {
                    EventManager.addEventListener(authorFilter, 'keypress', (e) => {
                        if (e.key === 'Enter' && e.target.value.trim()) {
                            this.addAuthorFilter(e.target.value.trim());
                            e.target.value = '';
                        }
                    });
                }

                // 提交类型过滤
                const commitTypeCheckboxes = document.querySelectorAll('.commit-type-filter input[type="checkbox"]');
                commitTypeCheckboxes.forEach(checkbox => {
                    EventManager.addEventListener(checkbox, 'change', (e) => {
                        if (e.target.checked) {
                            if (!this.advancedFilters.commitType.includes(e.target.value)) {
                                this.advancedFilters.commitType.push(e.target.value);
                            }
                        } else {
                            const index = this.advancedFilters.commitType.indexOf(e.target.value);
                            if (index > -1) {
                                this.advancedFilters.commitType.splice(index, 1);
                            }
                        }
                    });
                });
            },

            /**
             * 添加作者过滤器
             */
            addAuthorFilter(author) {
                if (!this.advancedFilters.author.includes(author)) {
                    this.advancedFilters.author.push(author);
                    this.updateAuthorTags();
                }
            },

            /**
             * 更新作者标签显示
             */
            updateAuthorTags() {
                const container = document.getElementById('authorTags');
                if (!container) return;

                container.innerHTML = '';
                this.advancedFilters.author.forEach(author => {
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        ${author}
                        <button class="filter-tag-remove" onclick="SearchManager.removeAuthorFilter('${author}')">×</button>
                    `;
                    container.appendChild(tag);
                });
            },

            /**
             * 移除作者过滤器
             */
            removeAuthorFilter(author) {
                const index = this.advancedFilters.author.indexOf(author);
                if (index > -1) {
                    this.advancedFilters.author.splice(index, 1);
                    this.updateAuthorTags();
                }
            },

            /**
             * 添加自定义过滤器
             */
            addCustomFilter() {
                const nameInput = document.getElementById('customFilterName');
                const ruleInput = document.getElementById('customFilterRule');

                if (!nameInput || !ruleInput) return;

                const name = nameInput.value.trim();
                const rule = ruleInput.value.trim();

                if (!name || !rule) {
                    this.showNotification('请输入过滤器名称和规则', 'warning');
                    return;
                }

                try {
                    // 验证JavaScript表达式
                    new Function('file', 'return ' + rule);

                    this.advancedFilters.customFilters.set(name, rule);
                    this.updateCustomFilterTags();

                    nameInput.value = '';
                    ruleInput.value = '';

                    this.showNotification(`自定义过滤器 "${name}" 已添加`, 'success');
                } catch (e) {
                    this.showNotification('过滤器规则语法错误', 'warning');
                }
            },

            /**
             * 更新自定义过滤器标签
             */
            updateCustomFilterTags() {
                const container = document.getElementById('customFilterTags');
                if (!container) return;

                container.innerHTML = '';
                this.advancedFilters.customFilters.forEach((rule, name) => {
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        ${name}
                        <button class="filter-tag-remove" onclick="SearchManager.removeCustomFilter('${name}')">×</button>
                    `;
                    container.appendChild(tag);
                });
            },

            /**
             * 移除自定义过滤器
             */
            removeCustomFilter(name) {
                this.advancedFilters.customFilters.delete(name);
                this.updateCustomFilterTags();
            },

            /**
             * 应用高级过滤器
             */
            applyAdvancedFilters() {
                // 重新执行搜索，包含高级过滤器
                this.performSearch(this.currentSearchTerm);
                this.showNotification('高级过滤器已应用', 'success');
            },

            /**
             * 清除高级过滤器
             */
            clearAdvancedFilters() {
                this.advancedFilters = {
                    dateRange: { start: null, end: null },
                    fileSize: { min: 0, max: Infinity },
                    author: [],
                    commitType: [],
                    customFilters: new Map()
                };

                // 重置UI
                const dateStart = document.getElementById('dateStart');
                const dateEnd = document.getElementById('dateEnd');
                const sizeMin = document.getElementById('sizeMin');
                const sizeMax = document.getElementById('sizeMax');
                const authorFilter = document.getElementById('authorFilter');

                if (dateStart) dateStart.value = '';
                if (dateEnd) dateEnd.value = '';
                if (sizeMin) sizeMin.value = '';
                if (sizeMax) sizeMax.value = '';
                if (authorFilter) authorFilter.value = '';

                // 清除复选框
                const checkboxes = document.querySelectorAll('.commit-type-filter input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);

                this.updateAuthorTags();
                this.updateCustomFilterTags();
                this.performSearch(this.currentSearchTerm);
                this.showNotification('所有高级过滤器已清除', 'success');
            },

            /**
             * 保存过滤器预设
             */
            saveFilterPreset() {
                const name = prompt('请输入预设名称:');
                if (!name || !name.trim()) return;

                const preset = {
                    dateRange: { ...this.advancedFilters.dateRange },
                    fileSize: { ...this.advancedFilters.fileSize },
                    author: [...this.advancedFilters.author],
                    commitType: [...this.advancedFilters.commitType],
                    customFilters: new Map(this.advancedFilters.customFilters)
                };

                try {
                    const presets = JSON.parse(localStorage.getItem('aicommit-filter-presets') || '{}');
                    presets[name.trim()] = {
                        ...preset,
                        customFilters: Array.from(preset.customFilters.entries())
                    };
                    localStorage.setItem('aicommit-filter-presets', JSON.stringify(presets));
                    this.showNotification(`过滤器预设 "${name}" 已保存`, 'success');
                } catch (e) {
                    this.showNotification('保存失败', 'warning');
                }
            },

            /**
             * 切换高级过滤器面板
             */
            toggleAdvancedFilterPanel() {
                const panel = document.querySelector('.advanced-filter-panel');
                if (panel) {
                    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                }
            },

            /**
             * 清除搜索
             */
            clearSearch() {
                const searchInput = DOMUtils.getElementById('fileSearchInput');
                if (searchInput) {
                    searchInput.value = '';
                    this.performSearch('');
                }
            }
        };

        // ========================================
        // 🎨 Enhanced Syntax Highlighter Module
        // ========================================
        const SyntaxHighlighter = {
            // 语言规则定义
            languageRules: {
                // JavaScript/TypeScript
                javascript: {
                    keywords: /\b(const|let|var|function|class|if|else|for|while|do|switch|case|default|break|continue|return|try|catch|finally|throw|async|await|import|export|from|as)\b/g,
                    strings: /(["'`])(?:\\.|(?!\1)[^\\\r\n])*\1/g,
                    comments: /(\/\/.*$|\/\*[\s\S]*?\*\/)/gm,
                    numbers: /\b\d+(\.\d+)?\b/g,
                    functions: /([a-zA-Z_$][a-zA-Z0-9_$]*)\s*\(/g,
                    operators: /[+\-*\/=<>!&|^%~?:]/g,
                    punctuation: /[{}[\]();,.]/g
                },

                // Rust
                rust: {
                    keywords: /\b(fn|let|mut|const|static|struct|enum|impl|trait|use|mod|pub|crate|super|self|if|else|match|while|for|loop|break|continue|return|unsafe|async|await|move|ref|type|where|as|in)\b/g,
                    strings: /(r#*"(?:[^"\\]|\\.)*"#*|"(?:[^"\\]|\\.)*")/g,
                    comments: /(\/\/.*$|\/\*[\s\S]*?\*\/)/gm,
                    numbers: /\b\d+(\.\d+)?([eE][+-]?\d+)?(f32|f64|i8|i16|i32|i64|i128|isize|u8|u16|u32|u64|u128|usize)?\b/g,
                    functions: /([a-zA-Z_][a-zA-Z0-9_]*)\s*[!]?\(/g,
                    operators: /[+\-*\/=<>!&|^%~?:@]/g,
                    punctuation: /[{}[\]();,.]/g,
                    macros: /([a-zA-Z_][a-zA-Z0-9_]*!)/g
                },

                // Python
                python: {
                    keywords: /\b(def|class|if|elif|else|for|while|try|except|finally|with|as|import|from|lambda|return|yield|break|continue|pass|global|nonlocal|and|or|not|in|is|True|False|None)\b/g,
                    strings: /("""[\s\S]*?"""|'''[\s\S]*?'''|"(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g,
                    comments: /#.*$/gm,
                    numbers: /\b\d+(\.\d+)?([eE][+-]?\d+)?\b/g,
                    functions: /([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g,
                    operators: /[+\-*\/=<>!&|^%~]/g,
                    punctuation: /[{}[\]();,.]/g
                },

                // HTML
                html: {
                    tags: /<\/?([a-zA-Z][a-zA-Z0-9-]*)\b[^>]*>/g,
                    attributes: /([a-zA-Z-]+)=("[^"]*"|'[^']*')/g,
                    comments: /<!--[\s\S]*?-->/g,
                    strings: /(["'])(?:\\.|(?!\1)[^\\\r\n])*\1/g
                },

                // CSS
                css: {
                    selectors: /([.#]?[a-zA-Z][a-zA-Z0-9-_]*|[*])\s*(?=[{,])/g,
                    properties: /([a-zA-Z-]+)\s*:/g,
                    values: /:\s*([^;{]+)/g,
                    comments: /\/\*[\s\S]*?\*\//g,
                    strings: /(["'])(?:\\.|(?!\1)[^\\\r\n])*\1/g
                },

                // JSON
                json: {
                    strings: /"(?:[^"\\]|\\.)*"/g,
                    numbers: /-?\b\d+(\.\d+)?([eE][+-]?\d+)?\b/g,
                    keywords: /\b(true|false|null)\b/g,
                    punctuation: /[{}[\]:,]/g
                },

                // Markdown
                markdown: {
                    headers: /^#{1,6}\s+.*$/gm,
                    bold: /\*\*([^*]+)\*\*/g,
                    italic: /\*([^*]+)\*/g,
                    code: /`([^`]+)`/g,
                    links: /\[([^\]]+)\]\(([^)]+)\)/g,
                    lists: /^\s*[-*+]\s+/gm
                }
            },

            // 颜色主题
            themes: {
                vscode: {
                    keyword: '#569cd6',
                    string: '#ce9178',
                    comment: '#6a9955',
                    number: '#b5cea8',
                    function: '#dcdcaa',
                    operator: '#d4d4d4',
                    punctuation: '#d4d4d4',
                    macro: '#c586c0',
                    tag: '#569cd6',
                    attribute: '#92c5f8',
                    selector: '#d7ba7d',
                    property: '#9cdcfe',
                    value: '#ce9178',
                    header: '#569cd6',
                    bold: '#d4d4d4',
                    italic: '#d4d4d4',
                    code: '#ce9178',
                    link: '#569cd6'
                }
            },

            currentTheme: 'vscode',

            /**
             * 初始化语法高亮器
             */
            init() {
                this.enhanceExistingDiffViewer();
                this.createSyntaxControls();
                console.log('SyntaxHighlighter initialized');
            },

            /**
             * 增强现有的差异查看器
             */
            enhanceExistingDiffViewer() {
                // 为现有的差异内容添加语法高亮
                this.highlightAllDiffContent();

                // 监听动态创建的差异内容
                this.setupDiffContentObserver();
            },

            /**
             * 创建语法高亮控制面板
             */
            createSyntaxControls() {
                const diffViewer = document.querySelector('.diff-viewer');
                if (!diffViewer) return;

                const header = diffViewer.querySelector('.diff-header');
                if (!header) return;

                const controls = document.createElement('div');
                controls.className = 'syntax-controls';
                controls.innerHTML = `
                    <div class="syntax-control-group">
                        <label class="syntax-label">语法高亮:</label>
                        <button class="syntax-btn" id="toggleSyntaxBtn" onclick="SyntaxHighlighter.toggleSyntaxHighlight()">
                            <span id="syntaxStatus">开启</span>
                        </button>
                    </div>
                    <div class="syntax-control-group">
                        <label class="syntax-label">语言:</label>
                        <select class="syntax-select" id="languageSelect" onchange="SyntaxHighlighter.changeLanguage(this.value)">
                            <option value="auto">自动检测</option>
                            <option value="javascript">JavaScript</option>
                            <option value="rust">Rust</option>
                            <option value="python">Python</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="json">JSON</option>
                            <option value="markdown">Markdown</option>
                        </select>
                    </div>
                `;

                header.appendChild(controls);
                this.bindSyntaxControlEvents();
            },

            /**
             * 绑定语法控制事件
             */
            bindSyntaxControlEvents() {
                // 已在HTML中使用onclick绑定
            },

            /**
             * 自动检测语言
             */
            detectLanguage(filename, content) {
                if (!filename) return 'javascript';

                const extension = filename.split('.').pop()?.toLowerCase();
                const firstLine = content.split('\n')[0].trim();

                // 基于文件扩展名检测
                const extensionMap = {
                    'js': 'javascript',
                    'jsx': 'javascript',
                    'ts': 'javascript',
                    'tsx': 'javascript',
                    'rs': 'rust',
                    'py': 'python',
                    'html': 'html',
                    'htm': 'html',
                    'css': 'css',
                    'scss': 'css',
                    'json': 'json',
                    'md': 'markdown',
                    'txt': 'plain'
                };

                if (extension && extensionMap[extension]) {
                    return extensionMap[extension];
                }

                // 基于内容特征检测
                if (firstLine.includes('#!/usr/bin/env python') || firstLine.includes('# -*- coding:')) {
                    return 'python';
                }
                if (firstLine.includes('<!DOCTYPE html') || content.includes('<html')) {
                    return 'html';
                }
                if (content.includes('fn main()') || content.includes('use ')) {
                    return 'rust';
                }

                return 'javascript'; // 默认
            },

            /**
             * 应用语法高亮
             */
            highlight(text, language = 'auto', filename = '') {
                if (language === 'auto') {
                    language = this.detectLanguage(filename, text);
                }

                if (!this.languageRules[language]) {
                    return this.escapeHtml(text);
                }

                return this.applySyntaxRules(text, language);
            },

            /**
             * 应用语法规则
             */
            applySyntaxRules(text, language) {
                const rules = this.languageRules[language];
                const theme = this.themes[this.currentTheme];
                let highlightedText = this.escapeHtml(text);

                // 按优先级应用规则（字符串和注释优先处理，避免关键字冲突）
                const ruleOrder = ['comments', 'strings', 'keywords', 'functions', 'numbers', 'operators', 'punctuation', 'macros', 'tags', 'attributes', 'selectors', 'properties', 'values', 'headers', 'bold', 'italic', 'code', 'links'];

                ruleOrder.forEach(ruleType => {
                    if (rules[ruleType] && theme[ruleType]) {
                        highlightedText = highlightedText.replace(rules[ruleType], (match, ...groups) => {
                            // 处理不同类型的匹配
                            if (ruleType === 'functions') {
                                const funcName = groups[0];
                                return match.replace(funcName, `<span class="token function" style="color: ${theme[ruleType]}">${funcName}</span>`);
                            } else if (ruleType === 'attributes') {
                                const attrName = groups[0];
                                const attrValue = groups[1];
                                return `<span class="token attribute" style="color: ${theme.attribute}">${attrName}</span>=<span class="token string" style="color: ${theme.string}">${attrValue}</span>`;
                            } else {
                                return `<span class="token ${ruleType}" style="color: ${theme[ruleType]}">${match}</span>`;
                            }
                        });
                    }
                });

                return highlightedText;
            },

            /**
             * 高亮所有差异内容
             */
            highlightAllDiffContent() {
                const diffLines = document.querySelectorAll('.diff-line-content');
                diffLines.forEach(line => {
                    this.highlightDiffLine(line);
                });
            },

            /**
             * 高亮单个差异行
             */
            highlightDiffLine(lineElement, filename = '') {
                if (!lineElement || lineElement.dataset.highlighted === 'true') return;

                const originalText = lineElement.textContent || '';
                const language = this.detectLanguage(filename, originalText);
                const highlightedText = this.highlight(originalText, language, filename);

                lineElement.innerHTML = highlightedText;
                lineElement.dataset.highlighted = 'true';
            },

            /**
             * 设置差异内容观察器
             */
            setupDiffContentObserver() {
                const diffContent = document.getElementById('diffContent');
                if (!diffContent) return;

                const observer = new MutationObserver(mutations => {
                    mutations.forEach(mutation => {
                        mutation.addedNodes.forEach(node => {
                            if (node.nodeType === 1) { // Element node
                                const diffLines = node.querySelectorAll('.diff-line-content');
                                diffLines.forEach(line => this.highlightDiffLine(line));
                            }
                        });
                    });
                });

                observer.observe(diffContent, {
                    childList: true,
                    subtree: true
                });

                this.diffObserver = observer;
            },

            /**
             * 切换语法高亮开关
             */
            toggleSyntaxHighlight() {
                this.enabled = !this.enabled;
                const statusSpan = document.getElementById('syntaxStatus');
                const toggleBtn = document.getElementById('toggleSyntaxBtn');

                if (statusSpan) {
                    statusSpan.textContent = this.enabled ? '开启' : '关闭';
                }

                if (toggleBtn) {
                    toggleBtn.classList.toggle('disabled', !this.enabled);
                }

                // 重新处理所有差异内容
                if (this.enabled) {
                    this.highlightAllDiffContent();
                } else {
                    this.removeAllHighlights();
                }
            },

            /**
             * 改变语言
             */
            changeLanguage(language) {
                this.currentLanguage = language;
                this.highlightAllDiffContent();
            },

            /**
             * 移除所有高亮
             */
            removeAllHighlights() {
                const diffLines = document.querySelectorAll('.diff-line-content');
                diffLines.forEach(line => {
                    const originalText = line.textContent;
                    line.innerHTML = this.escapeHtml(originalText);
                    line.dataset.highlighted = 'false';
                });
            },

            /**
             * HTML转义
             */
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            /**
             * 获取文件扩展名对应的语言
             */
            getLanguageFromExtension(filename) {
                if (!filename) return 'javascript';

                const ext = filename.split('.').pop()?.toLowerCase();
                const map = {
                    'js': 'javascript', 'jsx': 'javascript', 'ts': 'javascript', 'tsx': 'javascript',
                    'rs': 'rust',
                    'py': 'python', 'pyw': 'python',
                    'html': 'html', 'htm': 'html',
                    'css': 'css', 'scss': 'css', 'sass': 'css',
                    'json': 'json',
                    'md': 'markdown', 'markdown': 'markdown'
                };

                return map[ext] || 'javascript';
            },

            // 初始状态
            enabled: true,
            currentLanguage: 'auto'
        };

        // ========================================
        // ✏️ Inline Editor Module
        // ========================================
        const InlineEditor = {
            currentEditLine: null,
            editHistory: [],
            editMode: false,
            originalContent: '',
            editElement: null,

            // 初始化行内编辑功能
            init() {
                this.setupEventListeners();
                this.setupKeyboardShortcuts();
                this.setupContextMenu();
                console.log('📝 InlineEditor initialized');
            },

            // 设置事件监听器
            setupEventListeners() {
                // 双击编辑
                document.addEventListener('dblclick', (e) => {
                    const diffLine = e.target.closest('.diff-line');
                    if (diffLine && !diffLine.classList.contains('diff-file-header')) {
                        this.startEdit(diffLine);
                    }
                });

                // 编辑器失焦保存
                document.addEventListener('blur', (e) => {
                    if (e.target.classList.contains('inline-editor')) {
                        this.saveEdit();
                    }
                }, true);
            },

            // 设置键盘快捷键
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+E: 进入编辑模式
                    if (e.ctrlKey && e.key === 'e' && !this.editMode) {
                        e.preventDefault();
                        const selectedLine = document.querySelector('.diff-line.selected');
                        if (selectedLine) {
                            this.startEdit(selectedLine);
                        }
                    }

                    // 编辑模式中的快捷键
                    if (this.editMode) {
                        // Ctrl+S: 保存
                        if (e.ctrlKey && e.key === 's') {
                            e.preventDefault();
                            this.saveEdit();
                        }
                        // Esc: 取消编辑
                        else if (e.key === 'Escape') {
                            e.preventDefault();
                            this.cancelEdit();
                        }
                        // Ctrl+Z: 撤销
                        else if (e.ctrlKey && e.key === 'z') {
                            e.preventDefault();
                            this.undo();
                        }
                    }
                });
            },

            // 设置右键菜单
            setupContextMenu() {
                document.addEventListener('contextmenu', (e) => {
                    const diffLine = e.target.closest('.diff-line');
                    if (diffLine && !diffLine.classList.contains('diff-file-header')) {
                        e.preventDefault();
                        this.showContextMenu(e, diffLine);
                    }
                });

                // 点击其他地方关闭菜单
                document.addEventListener('click', () => {
                    this.hideContextMenu();
                });
            },

            // 显示右键菜单
            showContextMenu(event, diffLine) {
                this.hideContextMenu(); // 先隐藏现有菜单

                const menu = document.createElement('div');
                menu.className = 'context-menu';
                menu.innerHTML = `
                    <div class="context-menu-item" data-action="edit" data-line="${diffLine.dataset.lineNumber || ''}">
                        ✏️ 编辑此行
                    </div>
                    <div class="context-menu-item" data-action="copy" data-line="${diffLine.dataset.lineNumber || ''}">
                        📋 复制内容
                    </div>
                    <div class="context-menu-item" data-action="comment" data-line="${diffLine.dataset.lineNumber || ''}">
                        💬 添加注释
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" data-action="info" data-line="${diffLine.dataset.lineNumber || ''}">
                        ℹ️ 行信息
                    </div>
                `;

                menu.style.left = event.pageX + 'px';
                menu.style.top = event.pageY + 'px';
                document.body.appendChild(menu);

                // 绑定点击事件
                menu.querySelectorAll('.context-menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const action = item.dataset.action;

                        try {
                            switch(action) {
                                case 'edit':
                                    this.startEdit(diffLine);
                                    break;
                                case 'copy':
                                    this.copyLine(diffLine);
                                    break;
                                case 'comment':
                                    this.addComment(diffLine);
                                    break;
                                case 'info':
                                    this.showLineInfo(diffLine);
                                    break;
                                default:
                                    console.warn('Unknown action:', action);
                            }
                        } catch (error) {
                            console.error('Context menu action failed:', error);
                        }

                        this.hideContextMenu();
                    });
                });

                // 存储当前菜单引用
                this.currentMenu = menu;
            },

            // 隐藏右键菜单
            hideContextMenu() {
                const existingMenu = document.querySelector('.context-menu');
                if (existingMenu) {
                    existingMenu.remove();
                }

                // 清除引用
                if (this.currentMenu) {
                    this.currentMenu = null;
                }
            },

            // 开始编辑
            startEdit(diffLine) {
                if (this.editMode) {
                    this.saveEdit(); // 保存当前编辑
                }

                this.currentEditLine = diffLine;
                this.editMode = true;

                // 获取原始内容
                const codeSpan = diffLine.querySelector('.diff-line-content');
                this.originalContent = codeSpan.textContent;

                // 创建编辑器
                const editor = document.createElement('textarea');
                editor.className = 'inline-editor';
                editor.value = this.originalContent;
                editor.style.cssText = `
                    width: 100%;
                    min-height: 24px;
                    border: 2px solid #007acc;
                    background: #1e1e1e;
                    color: #d4d4d4;
                    font-family: 'Fira Code', 'Consolas', monospace;
                    font-size: 14px;
                    padding: 4px 8px;
                    resize: vertical;
                    outline: none;
                `;

                // 替换内容
                codeSpan.style.display = 'none';
                diffLine.appendChild(editor);
                this.editElement = editor;

                // 自动调整高度
                this.autoResize(editor);
                editor.addEventListener('input', () => this.autoResize(editor));

                // 选中内容并聚焦
                editor.focus();
                editor.select();

                // 显示编辑提示
                this.showEditHint(diffLine);

                console.log(`📝 Started editing line: ${this.originalContent.substring(0, 50)}...`);
            },

            // 自动调整编辑器高度
            autoResize(editor) {
                editor.style.height = 'auto';
                editor.style.height = Math.max(24, editor.scrollHeight) + 'px';
            },

            // 显示编辑提示
            showEditHint(diffLine) {
                const hint = document.createElement('div');
                hint.className = 'edit-hint';
                hint.innerHTML = `
                    <span>✏️ 编辑模式</span>
                    <span class="edit-shortcuts">
                        <kbd>Ctrl+S</kbd> 保存
                        <kbd>Esc</kbd> 取消
                        <kbd>Ctrl+Z</kbd> 撤销
                    </span>
                `;
                hint.style.cssText = `
                    position: absolute;
                    right: 10px;
                    top: 5px;
                    background: rgba(0, 122, 204, 0.1);
                    border: 1px solid #007acc;
                    border-radius: 4px;
                    padding: 4px 8px;
                    font-size: 12px;
                    color: #007acc;
                    z-index: 1000;
                `;
                diffLine.style.position = 'relative';
                diffLine.appendChild(hint);
            },

            // 保存编辑
            saveEdit() {
                if (!this.editMode || !this.editElement) return;

                const newContent = this.editElement.value;
                const codeSpan = this.currentEditLine.querySelector('.diff-line-content');

                // 保存到历史记录
                this.editHistory.push({
                    line: this.currentEditLine.dataset.lineNumber,
                    original: this.originalContent,
                    modified: newContent,
                    timestamp: new Date().toISOString()
                });

                // 更新内容
                codeSpan.textContent = newContent;

                // 重新应用语法高亮
                if (window.SyntaxHighlighter && SyntaxHighlighter.enabled) {
                    const language = SyntaxHighlighter.detectLanguage(newContent);
                    codeSpan.innerHTML = SyntaxHighlighter.highlight(newContent, language);
                }

                // 添加修改标记
                this.currentEditLine.classList.add('diff-modified');
                this.currentEditLine.setAttribute('data-original', this.originalContent);

                this.finishEdit();
                this.showChangePreview(newContent);

                console.log(`💾 Saved edit: ${this.originalContent} → ${newContent}`);
            },

            // 取消编辑
            cancelEdit() {
                if (!this.editMode) return;
                this.finishEdit();
                console.log('❌ Cancelled edit');
            },

            // 完成编辑（清理）
            finishEdit() {
                if (this.editElement) {
                    this.editElement.remove();
                }

                if (this.currentEditLine) {
                    const codeSpan = this.currentEditLine.querySelector('.diff-line-content');
                    if (codeSpan) codeSpan.style.display = '';

                    // 移除编辑提示
                    const hint = this.currentEditLine.querySelector('.edit-hint');
                    if (hint) hint.remove();
                }

                this.editMode = false;
                this.currentEditLine = null;
                this.editElement = null;
                this.originalContent = '';
            },

            // 显示修改预览
            showChangePreview(newContent) {
                const changes = this.calculateChanges(this.originalContent, newContent);
                const preview = document.createElement('div');
                preview.className = 'change-preview';
                preview.innerHTML = `
                    <div class="change-stats">
                        <span class="stat-added">+${changes.added}</span>
                        <span class="stat-removed">-${changes.removed}</span>
                        <span class="stat-chars">${changes.charDiff > 0 ? '+' : ''}${changes.charDiff} 字符</span>
                    </div>
                `;
                preview.style.cssText = `
                    position: absolute;
                    right: 10px;
                    top: 5px;
                    background: rgba(40, 160, 40, 0.1);
                    border: 1px solid #28a028;
                    border-radius: 4px;
                    padding: 4px 8px;
                    font-size: 11px;
                    color: #28a028;
                    z-index: 999;
                `;

                this.currentEditLine.appendChild(preview);
                setTimeout(() => preview.remove(), 3000);
            },

            // 计算变更统计
            calculateChanges(original, modified) {
                const originalLines = original.split('\n');
                const modifiedLines = modified.split('\n');

                return {
                    added: Math.max(0, modifiedLines.length - originalLines.length),
                    removed: Math.max(0, originalLines.length - modifiedLines.length),
                    charDiff: modified.length - original.length
                };
            },

            // 撤销编辑
            undo() {
                if (this.editHistory.length === 0) return;

                const lastEdit = this.editHistory.pop();
                const diffLine = document.querySelector(`[data-line-number="${lastEdit.line}"]`);

                if (diffLine) {
                    const codeSpan = diffLine.querySelector('.diff-line-content');
                    codeSpan.textContent = lastEdit.original;
                    diffLine.classList.remove('diff-modified');
                    diffLine.removeAttribute('data-original');
                }

                console.log(`↶ Undid edit on line ${lastEdit.line}`);
            },

            // 复制行内容
            copyLine(diffLine) {
                try {
                    if (!diffLine) {
                        console.warn('copyLine: Invalid diffLine parameter');
                        return;
                    }

                    let content = '';
                    const contentElement = diffLine.querySelector('.diff-line-content');
                    if (contentElement && contentElement.textContent) {
                        content = contentElement.textContent;
                    } else if (diffLine.textContent) {
                        content = diffLine.textContent.trim();
                    } else {
                        this.showToast('无法获取行内容');
                        return;
                    }

                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(content).then(() => {
                            this.showToast('已复制到剪贴板');
                        }).catch(error => {
                            console.error('Clipboard write failed:', error);
                            this.showToast('复制失败');
                        });
                    } else {
                        // 备用方法
                        const textArea = document.createElement('textarea');
                        textArea.value = content;
                        document.body.appendChild(textArea);
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            this.showToast('已复制到剪贴板');
                        } catch (error) {
                            console.error('Copy command failed:', error);
                            this.showToast('复制失败');
                        }
                        document.body.removeChild(textArea);
                    }
                } catch (error) {
                    console.error('Error in copyLine:', error);
                    this.showToast('复制操作失败');
                }
            },

            // 添加注释
            addComment(diffLine) {
                try {
                    if (!diffLine) {
                        console.warn('addComment: Invalid diffLine parameter');
                        return;
                    }

                    const comment = prompt('添加注释:');
                    if (comment && comment.trim()) {
                        const lineNum = diffLine.dataset.lineNumber || '未知';
                        const commentEl = document.createElement('div');
                        commentEl.className = 'line-comment';
                        commentEl.innerHTML = `💬 ${comment.replace(/</g, '&lt;').replace(/>/g, '&gt;')}`;
                        commentEl.style.cssText = `
                            background: rgba(255, 193, 7, 0.1);
                            border-left: 3px solid #ffc107;
                            padding: 4px 8px;
                            margin: 2px 0;
                            font-size: 12px;
                            color: #ffc107;
                        `;
                        diffLine.appendChild(commentEl);
                        this.showToast('注释已添加');
                    }
                } catch (error) {
                    console.error('Error in addComment:', error);
                    this.showToast('添加注释失败');
                }
            },

            // 显示行信息
            showLineInfo(diffLine) {
                try {
                    // 验证输入参数
                    if (!diffLine || !diffLine.dataset) {
                        console.warn('showLineInfo: Invalid diffLine parameter');
                        return;
                    }

                    const lineNum = diffLine.dataset.lineNumber || '未知';

                    // 安全地获取内容
                    let content = '';
                    const contentElement = diffLine.querySelector('.diff-line-content');
                    if (contentElement && contentElement.textContent) {
                        content = contentElement.textContent;
                    } else if (diffLine.textContent) {
                        content = diffLine.textContent.trim();
                    } else {
                        content = '(空内容)';
                    }

                    // 确定行类型
                    let type = '上下文';
                    if (diffLine.classList.contains('diff-added') || diffLine.classList.contains('diff-line-added')) {
                        type = '新增';
                    } else if (diffLine.classList.contains('diff-removed') || diffLine.classList.contains('diff-line-deleted')) {
                        type = '删除';
                    } else if (diffLine.classList.contains('diff-line-modified')) {
                        type = '修改';
                    }

                    const message = `行 ${lineNum} (${type}): ${content.length} 字符`;
                    this.showToast(message);

                    console.log('Line info:', { lineNum, type, contentLength: content.length });
                } catch (error) {
                    console.error('Error in showLineInfo:', error);
                    this.showToast('无法显示行信息');
                }
            },

            // 显示提示消息
            showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #333;
                    color: white;
                    padding: 8px 16px;
                    border-radius: 4px;
                    z-index: 10000;
                    animation: fadeInOut 2s ease-in-out;
                `;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            },

            // 获取编辑统计
            getEditStats() {
                const stats = {
                    totalEdits: this.editHistory.length,
                    linesModified: new Set(this.editHistory.map(e => e.line)).size,
                    lastEdit: this.editHistory.length > 0 ? this.editHistory[this.editHistory.length - 1] : null
                };
                console.log('📊 Edit Stats:', stats);
                return stats;
            },

            // 导出编辑历史
            exportEditHistory() {
                const data = {
                    edits: this.editHistory,
                    exportTime: new Date().toISOString(),
                    stats: this.getEditStats()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `edit-history-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        };

        // ========================================
        // 📈 Code Movement Detection & Diff Statistics Module
        // ========================================
        const DiffAnalyzer = {
            movementCache: new Map(),
            statisticsCache: new Map(),

            // 初始化分析器
            init() {
                this.setupAnalysisPanel();
                this.setupMovementDetection();
                this.generateDiffStatistics();
                console.log('📈 DiffAnalyzer initialized');
            },

            // 设置分析面板
            setupAnalysisPanel() {
                const diffModal = document.querySelector('#diffModal .modal-content');
                if (!diffModal) return;

                // 在模态框头部添加统计按钮
                const header = diffModal.querySelector('.modal-header');
                const statsButton = document.createElement('button');
                statsButton.className = 'stats-toggle-btn';
                statsButton.innerHTML = '📊 统计';
                statsButton.style.cssText = `
                    margin-left: auto;
                    margin-right: 10px;
                    padding: 4px 8px;
                    background: #007acc;
                    border: 1px solid #007acc;
                    border-radius: 4px;
                    color: white;
                    cursor: pointer;
                    font-size: 11px;
                `;
                statsButton.onclick = () => this.toggleStatsPanel();
                header.insertBefore(statsButton, header.querySelector('.close-btn'));

                // 创建统计面板
                const statsPanel = document.createElement('div');
                statsPanel.id = 'diffStatsPanel';
                statsPanel.className = 'diff-stats-panel';
                statsPanel.style.cssText = `
                    display: none;
                    position: absolute;
                    top: 60px;
                    right: 20px;
                    width: 320px;
                    background: #2d2d30;
                    border: 1px solid #555;
                    border-radius: 6px;
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
                    z-index: 1001;
                    overflow: hidden;
                `;

                statsPanel.innerHTML = `
                    <div class="stats-header">
                        <span>📊 差异统计分析</span>
                        <button onclick="DiffAnalyzer.closeStatsPanel()" style="background: none; border: none; color: #ccc; float: right; cursor: pointer;">&times;</button>
                    </div>
                    <div class="stats-content">
                        <div id="overallStats" class="stats-section">
                            <h4>📋 总体统计</h4>
                            <div class="stats-grid" id="overallStatsGrid"></div>
                        </div>
                        <div id="movementStats" class="stats-section">
                            <h4>🔄 代码移动</h4>
                            <div id="movementList"></div>
                        </div>
                        <div id="complexityStats" class="stats-section">
                            <h4>📈 复杂度分析</h4>
                            <div class="complexity-chart" id="complexityChart"></div>
                        </div>
                        <div id="fileStats" class="stats-section">
                            <h4>📁 文件统计</h4>
                            <div id="fileStatsChart"></div>
                        </div>
                    </div>
                `;

                diffModal.appendChild(statsPanel);
            },

            // 切换统计面板
            toggleStatsPanel() {
                const panel = document.getElementById('diffStatsPanel');
                if (panel.style.display === 'none') {
                    this.updateAllStatistics();
                    panel.style.display = 'block';
                } else {
                    panel.style.display = 'none';
                }
            },

            // 关闭统计面板
            closeStatsPanel() {
                document.getElementById('diffStatsPanel').style.display = 'none';
            },

            // 设置代码移动检测
            setupMovementDetection() {
                // 分析当前diff中的代码移动
                const diffLines = document.querySelectorAll('.diff-line');
                const movements = this.detectCodeMovements(diffLines);
                this.movementCache.set('current', movements);

                // 为移动的代码块添加视觉标记
                this.highlightMovedCode(movements);
            },

            // 检测代码移动
            detectCodeMovements(diffLines) {
                const removedLines = [];
                const addedLines = [];
                const movements = [];

                // 收集删除和添加的行
                diffLines.forEach((line, index) => {
                    const content = line.querySelector('.diff-line-content')?.textContent.trim();
                    if (!content || line.classList.contains('diff-file-header')) return;

                    if (line.classList.contains('diff-removed')) {
                        removedLines.push({ content, index, element: line });
                    } else if (line.classList.contains('diff-added')) {
                        addedLines.push({ content, index, element: line });
                    }
                });

                // 使用相似度算法检测移动
                removedLines.forEach(removed => {
                    const matches = addedLines.filter(added => {
                        const similarity = this.calculateSimilarity(removed.content, added.content);
                        return similarity > 0.8; // 80% 相似度阈值
                    });

                    if (matches.length > 0) {
                        const bestMatch = matches.reduce((best, current) => {
                            const bestSim = this.calculateSimilarity(removed.content, best.content);
                            const currentSim = this.calculateSimilarity(removed.content, current.content);
                            return currentSim > bestSim ? current : best;
                        });

                        movements.push({
                            from: removed,
                            to: bestMatch,
                            similarity: this.calculateSimilarity(removed.content, bestMatch.content),
                            type: 'move'
                        });

                        // 从数组中移除已匹配的项
                        const addedIndex = addedLines.indexOf(bestMatch);
                        if (addedIndex > -1) addedLines.splice(addedIndex, 1);
                    }
                });

                return movements;
            },

            // 计算字符串相似度
            calculateSimilarity(str1, str2) {
                const len1 = str1.length;
                const len2 = str2.length;
                const matrix = Array(len2 + 1).fill().map(() => Array(len1 + 1).fill(0));

                for (let i = 0; i <= len1; i++) matrix[0][i] = i;
                for (let j = 0; j <= len2; j++) matrix[j][0] = j;

                for (let j = 1; j <= len2; j++) {
                    for (let i = 1; i <= len1; i++) {
                        if (str1[i - 1] === str2[j - 1]) {
                            matrix[j][i] = matrix[j - 1][i - 1];
                        } else {
                            matrix[j][i] = Math.min(
                                matrix[j - 1][i] + 1,
                                matrix[j][i - 1] + 1,
                                matrix[j - 1][i - 1] + 1
                            );
                        }
                    }
                }

                const distance = matrix[len2][len1];
                return 1 - distance / Math.max(len1, len2);
            },

            // 高亮移动的代码
            highlightMovedCode(movements) {
                movements.forEach((movement, index) => {
                    const color = this.getMovementColor(index);

                    // 标记删除的行
                    movement.from.element.style.borderLeft = `3px solid ${color}`;
                    movement.from.element.setAttribute('data-movement', `move-${index}`);

                    // 标记添加的行
                    movement.to.element.style.borderLeft = `3px solid ${color}`;
                    movement.to.element.setAttribute('data-movement', `move-${index}`);

                    // 添加工具提示
                    const tooltip = `代码移动 #${index + 1} (相似度: ${Math.round(movement.similarity * 100)}%)`;
                    movement.from.element.title = tooltip;
                    movement.to.element.title = tooltip;
                });
            },

            // 获取移动颜色
            getMovementColor(index) {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f39c12', '#9b59b6', '#e74c3c'];
                return colors[index % colors.length];
            },

            // 生成差异统计
            generateDiffStatistics() {
                const diffLines = document.querySelectorAll('.diff-line');
                const stats = {
                    total: diffLines.length,
                    added: document.querySelectorAll('.diff-line.diff-added').length,
                    removed: document.querySelectorAll('.diff-line.diff-removed').length,
                    context: document.querySelectorAll('.diff-line.diff-context').length,
                    movements: this.movementCache.get('current')?.length || 0,
                    files: this.getFileStatistics(),
                    complexity: this.calculateComplexity()
                };

                this.statisticsCache.set('current', stats);
                return stats;
            },

            // 获取文件统计
            getFileStatistics() {
                const files = new Map();
                const diffLines = document.querySelectorAll('.diff-line');

                let currentFile = 'unknown';
                diffLines.forEach(line => {
                    if (line.classList.contains('diff-file-header')) {
                        const content = line.textContent;
                        const match = content.match(/[@\+\-]{3}\s+([^\s]+)/);
                        if (match) currentFile = match[1];
                    }

                    if (!files.has(currentFile)) {
                        files.set(currentFile, { added: 0, removed: 0, total: 0 });
                    }

                    const fileStats = files.get(currentFile);
                    if (line.classList.contains('diff-added')) fileStats.added++;
                    if (line.classList.contains('diff-removed')) fileStats.removed++;
                    fileStats.total++;
                });

                return Object.fromEntries(files);
            },

            // 计算复杂度
            calculateComplexity() {
                const diffLines = document.querySelectorAll('.diff-line.diff-added, .diff-line.diff-removed');
                let complexity = 0;

                diffLines.forEach(line => {
                    const content = line.querySelector('.diff-line-content')?.textContent || '';

                    // 基于代码特征计算复杂度
                    if (content.includes('if') || content.includes('for') || content.includes('while')) complexity += 2;
                    if (content.includes('function') || content.includes('fn ') || content.includes('def ')) complexity += 3;
                    if (content.includes('class') || content.includes('struct') || content.includes('impl')) complexity += 4;
                    if (content.includes('{') || content.includes('}')) complexity += 1;
                    complexity += (content.match(/[&|]{2}/g) || []).length; // 逻辑操作符
                });

                return Math.min(complexity, 100); // 限制在0-100范围内
            },

            // 更新所有统计信息
            updateAllStatistics() {
                this.setupMovementDetection();
                const stats = this.generateDiffStatistics();

                this.updateOverallStats(stats);
                this.updateMovementStats();
                this.updateComplexityChart(stats.complexity);
                this.updateFileStatsChart(stats.files);
            },

            // 更新总体统计
            updateOverallStats(stats) {
                const grid = document.getElementById('overallStatsGrid');
                grid.innerHTML = `
                    <div class="stat-item">
                        <span class="stat-label">总行数</span>
                        <span class="stat-value">${stats.total}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">新增</span>
                        <span class="stat-value added">+${stats.added}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">删除</span>
                        <span class="stat-value removed">-${stats.removed}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">上下文</span>
                        <span class="stat-value context">${stats.context}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">代码移动</span>
                        <span class="stat-value movement">${stats.movements}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">净变更</span>
                        <span class="stat-value net">${stats.added - stats.removed > 0 ? '+' : ''}${stats.added - stats.removed}</span>
                    </div>
                `;
            },

            // 更新移动统计
            updateMovementStats() {
                const movements = this.movementCache.get('current') || [];
                const list = document.getElementById('movementList');

                if (movements.length === 0) {
                    list.innerHTML = '<div class="no-movements">未检测到代码移动</div>';
                    return;
                }

                list.innerHTML = movements.map((movement, index) => `
                    <div class="movement-item" style="border-left: 3px solid ${this.getMovementColor(index)};">
                        <div class="movement-header">
                            <span class="movement-title">移动 #${index + 1}</span>
                            <span class="movement-similarity">${Math.round(movement.similarity * 100)}%</span>
                        </div>
                        <div class="movement-content">${movement.from.content.substring(0, 60)}...</div>
                    </div>
                `).join('');
            },

            // 更新复杂度图表
            updateComplexityChart(complexity) {
                const chart = document.getElementById('complexityChart');
                const level = complexity < 20 ? '低' : complexity < 50 ? '中' : complexity < 80 ? '高' : '极高';
                const color = complexity < 20 ? '#28a745' : complexity < 50 ? '#ffc107' : complexity < 80 ? '#fd7e14' : '#dc3545';

                chart.innerHTML = `
                    <div class="complexity-bar">
                        <div class="complexity-fill" style="width: ${complexity}%; background: ${color};"></div>
                    </div>
                    <div class="complexity-info">
                        <span>复杂度等级: <strong style="color: ${color};">${level}</strong></span>
                        <span>评分: ${complexity}/100</span>
                    </div>
                `;
            },

            // 更新文件统计图表
            updateFileStatsChart(files) {
                const chart = document.getElementById('fileStatsChart');
                const fileEntries = Object.entries(files);

                if (fileEntries.length === 0) {
                    chart.innerHTML = '<div class="no-files">无文件统计</div>';
                    return;
                }

                chart.innerHTML = fileEntries.map(([filename, stats]) => `
                    <div class="file-stat-item">
                        <div class="file-name">${filename.split('/').pop()}</div>
                        <div class="file-changes">
                            <span class="file-added">+${stats.added}</span>
                            <span class="file-removed">-${stats.removed}</span>
                        </div>
                        <div class="file-bar">
                            <div class="file-bar-added" style="width: ${(stats.added / stats.total) * 100}%;"></div>
                            <div class="file-bar-removed" style="width: ${(stats.removed / stats.total) * 100}%;"></div>
                        </div>
                    </div>
                `).join('');
            },

            // 导出统计数据
            exportStatistics() {
                const stats = this.statisticsCache.get('current');
                const movements = this.movementCache.get('current');

                const exportData = {
                    timestamp: new Date().toISOString(),
                    statistics: stats,
                    movements: movements.map(m => ({
                        similarity: m.similarity,
                        fromContent: m.from.content,
                        toContent: m.to.content
                    })),
                    summary: {
                        totalChanges: stats.added + stats.removed,
                        netChanges: stats.added - stats.removed,
                        changeRatio: stats.removed > 0 ? (stats.added / stats.removed).toFixed(2) : 'N/A',
                        movementPercentage: stats.total > 0 ? ((stats.movements * 2 / stats.total) * 100).toFixed(1) : 0
                    }
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `diff-analysis-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        };

        // ========================================
        // 🔄 Git Workflow Enhancement Module
        // ========================================
        const GitWorkflow = {
            currentOperation: null,
            operationHistory: [],
            conflictResolution: {
                files: [],
                currentFile: null,
                resolutions: new Map()
            },

            // 初始化Git工作流模块
            init() {
                this.setupWorkflowPanel();
                this.setupRebaseInterface();
                this.setupMergeInterface();
                this.setupGitFlowInterface();
                this.setupConflictResolution();
                console.log('🔄 GitWorkflow initialized');
            },

            // 设置工作流面板
            setupWorkflowPanel() {
                // 创建工作流模态框（移除了重复的侧边栏按钮创建）
                const workflowModal = document.createElement('div');
                workflowModal.className = 'modal';
                workflowModal.id = 'gitWorkflowModal';
                workflowModal.innerHTML = `
                    <div class="modal-content workflow-modal">
                        <div class="modal-header">
                            <span>🔄 Git 工作流管理</span>
                            <button class="close-btn" onclick="GitWorkflow.closeWorkflowModal()">&times;</button>
                        </div>
                        <div class="modal-body workflow-body">
                            <div class="workflow-tabs">
                                <button class="workflow-tab active" data-tab="rebase">交互式变基</button>
                                <button class="workflow-tab" data-tab="merge">合并操作</button>
                                <button class="workflow-tab" data-tab="gitflow">Git Flow</button>
                                <button class="workflow-tab" data-tab="conflicts">冲突解决</button>
                            </div>
                            <div class="workflow-content">
                                <div id="rebaseTab" class="workflow-tab-content active"></div>
                                <div id="mergeTab" class="workflow-tab-content"></div>
                                <div id="gitflowTab" class="workflow-tab-content"></div>
                                <div id="conflictsTab" class="workflow-tab-content"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(workflowModal);

                // 绑定选项卡切换
                workflowModal.querySelectorAll('.workflow-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        this.switchWorkflowTab(tabName);
                    });
                });
            },

            // 打开工作流模态框
            openWorkflowModal() {
                document.getElementById('gitWorkflowModal').style.display = 'flex';
                this.loadCurrentBranches();
                this.loadRebaseHistory();
            },

            // 关闭工作流模态框
            closeWorkflowModal() {
                document.getElementById('gitWorkflowModal').style.display = 'none';
            },

            // 切换工作流选项卡
            switchWorkflowTab(tabName) {
                // 更新选项卡状态
                document.querySelectorAll('.workflow-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // 更新内容区域
                document.querySelectorAll('.workflow-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}Tab`).classList.add('active');

                // 加载相应内容
                switch(tabName) {
                    case 'rebase': this.loadRebaseInterface(); break;
                    case 'merge': this.loadMergeInterface(); break;
                    case 'gitflow': this.loadGitFlowInterface(); break;
                    case 'conflicts': this.loadConflictInterface(); break;
                }
            },

            // 设置交互式变基界面
            setupRebaseInterface() {
                // 将在loadRebaseInterface中实现
            },

            // 加载变基界面
            loadRebaseInterface() {
                const container = document.getElementById('rebaseTab');
                container.innerHTML = `
                    <div class="rebase-section">
                        <h3>📝 交互式变基</h3>
                        <div class="rebase-controls">
                            <div class="form-group">
                                <label>目标分支/提交：</label>
                                <select id="rebaseTarget" class="form-select">
                                    <option value="main">main</option>
                                    <option value="develop">develop</option>
                                    <option value="HEAD~3">HEAD~3 (最近3个提交)</option>
                                    <option value="HEAD~5">HEAD~5 (最近5个提交)</option>
                                </select>
                                <button class="btn btn-primary" onclick="GitWorkflow.startInteractiveRebase()">
                                    🔄 开始变基
                                </button>
                            </div>
                        </div>

                        <div id="rebaseCommitList" class="rebase-commit-list">
                            <h4>📋 提交列表</h4>
                            <div class="commit-actions-help">
                                <span><strong>操作说明：</strong></span>
                                <span><code>pick</code> - 使用此提交</span>
                                <span><code>reword</code> - 使用提交但编辑消息</span>
                                <span><code>edit</code> - 使用提交但停止以便修正</span>
                                <span><code>squash</code> - 使用提交但合并到前一个提交</span>
                                <span><code>drop</code> - 删除此提交</span>
                            </div>
                            <div id="commitItems"></div>
                        </div>

                        <div class="rebase-actions">
                            <button class="btn btn-success" onclick="GitWorkflow.executeRebase()">
                                ✅ 执行变基
                            </button>
                            <button class="btn btn-warning" onclick="GitWorkflow.previewRebase()">
                                👁️ 预览变更
                            </button>
                            <button class="btn btn-secondary" onclick="GitWorkflow.resetRebase()">
                                🔄 重置
                            </button>
                        </div>

                        <div id="rebaseStatus" class="rebase-status"></div>
                    </div>
                `;

                this.loadCommitsForRebase();
            },

            // 加载可变基的提交
            loadCommitsForRebase() {
                // 模拟获取提交列表
                const commits = [
                    { hash: 'abc1234', message: 'feat(ui): 添加新的用户界面组件', author: 'Alice', date: '2024-01-15' },
                    { hash: 'def5678', message: 'fix(api): 修复用户认证问题', author: 'Bob', date: '2024-01-14' },
                    { hash: 'ghi9012', message: 'docs: 更新API文档', author: 'Charlie', date: '2024-01-13' },
                    { hash: 'jkl3456', message: 'refactor: 重构数据处理模块', author: 'Alice', date: '2024-01-12' },
                    { hash: 'mno7890', message: 'test: 添加单元测试', author: 'Bob', date: '2024-01-11' }
                ];

                const container = document.getElementById('commitItems');
                container.innerHTML = commits.map((commit, index) => `
                    <div class="commit-item" data-hash="${commit.hash}">
                        <select class="commit-action" onchange="GitWorkflow.updateCommitAction('${commit.hash}', this.value)">
                            <option value="pick">pick</option>
                            <option value="reword">reword</option>
                            <option value="edit">edit</option>
                            <option value="squash">squash</option>
                            <option value="drop">drop</option>
                        </select>
                        <div class="commit-info">
                            <div class="commit-message">${commit.message}</div>
                            <div class="commit-meta">
                                <span class="commit-hash">${commit.hash}</span>
                                <span class="commit-author">by ${commit.author}</span>
                                <span class="commit-date">${commit.date}</span>
                            </div>
                        </div>
                        <div class="commit-controls">
                            <button class="btn-icon" onclick="GitWorkflow.moveCommitUp(${index})" title="上移">↑</button>
                            <button class="btn-icon" onclick="GitWorkflow.moveCommitDown(${index})" title="下移">↓</button>
                        </div>
                    </div>
                `).join('');
            },

            // 其他方法的简化实现（为了保持代码长度合理）
            startInteractiveRebase() {
                const target = document.getElementById('rebaseTarget').value;
                this.showRebaseStatus(`正在准备变基到 ${target}...`, 'info');
            },

            executeRebase() {
                this.showRebaseStatus('正在执行变基...', 'info');
            },

            previewRebase() {
                alert('变基预览功能');
            },

            resetRebase() {
                this.showRebaseStatus('变基操作已重置', 'info');
            },

            loadMergeInterface() {
                const container = document.getElementById('mergeTab');
                container.innerHTML = `
                    <div class="merge-section">
                        <h3>🔀 分支合并操作</h3>

                        <!-- 合并策略选择 -->
                        <div class="merge-strategy-section">
                            <h4>📋 合并策略</h4>
                            <div class="strategy-options">
                                <div class="strategy-option">
                                    <input type="radio" id="mergeDefault" name="mergeStrategy" value="default" checked>
                                    <label for="mergeDefault">
                                        <strong>默认合并</strong> - 自动选择最佳策略
                                    </label>
                                </div>
                                <div class="strategy-option">
                                    <input type="radio" id="mergeNoFF" name="mergeStrategy" value="no-ff">
                                    <label for="mergeNoFF">
                                        <strong>--no-ff</strong> - 保留分支历史，创建合并提交
                                    </label>
                                </div>
                                <div class="strategy-option">
                                    <input type="radio" id="mergeSquash" name="mergeStrategy" value="squash">
                                    <label for="mergeSquash">
                                        <strong>--squash</strong> - 压缩所有提交为单个提交
                                    </label>
                                </div>
                                <div class="strategy-option">
                                    <input type="radio" id="mergeFastForward" name="mergeStrategy" value="ff-only">
                                    <label for="mergeFastForward">
                                        <strong>--ff-only</strong> - 仅允许快进合并
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 分支选择区域 -->
                        <div class="branch-selection-section">
                            <h4>🌿 选择要合并的分支</h4>
                            <div class="merge-controls">
                                <div class="branch-selector">
                                    <label>源分支 (从):</label>
                                    <select id="sourceBranchSelect" class="form-select">
                                        <option value="feature/user-auth">feature/user-auth</option>
                                        <option value="feature/payment">feature/payment</option>
                                        <option value="bugfix/login-issue">bugfix/login-issue</option>
                                        <option value="develop">develop</option>
                                    </select>
                                </div>
                                <div class="merge-arrow">
                                    <span>→</span>
                                </div>
                                <div class="branch-selector">
                                    <label>目标分支 (到):</label>
                                    <select id="targetBranchSelect" class="form-select">
                                        <option value="main">main</option>
                                        <option value="develop" selected>develop</option>
                                        <option value="staging">staging</option>
                                    </select>
                                </div>
                            </div>

                            <div class="merge-actions">
                                <button class="btn btn-primary" onclick="GitWorkflow.previewMerge()">
                                    👁️ 预览合并
                                </button>
                                <button class="btn btn-success" onclick="GitWorkflow.executeMerge()">
                                    🔀 执行合并
                                </button>
                                <button class="btn btn-secondary" onclick="GitWorkflow.checkMergeStatus()">
                                    📊 检查状态
                                </button>
                            </div>
                        </div>

                        <!-- 合并预览区域 -->
                        <div class="merge-preview-section">
                            <h4>🔍 合并预览</h4>
                            <div id="mergePreview" class="merge-preview-content">
                                <div class="no-preview">点击"预览合并"查看详细信息</div>
                            </div>
                        </div>

                        <!-- 冲突检测区域 -->
                        <div class="conflict-detection-section">
                            <h4>⚠️ 冲突检测</h4>
                            <div id="conflictDetection" class="conflict-status">
                                <div class="status-pending">点击"检查状态"进行冲突检测</div>
                            </div>
                        </div>

                        <!-- 合并历史 -->
                        <div class="merge-history-section">
                            <h4>📚 最近合并历史</h4>
                            <div class="merge-history-list">
                                <div class="merge-history-item">
                                    <div class="merge-info">
                                        <span class="merge-time">2025-09-13 14:30</span>
                                        <span class="merge-desc">合并 feature/user-auth → develop</span>
                                        <span class="merge-strategy">策略: --no-ff</span>
                                    </div>
                                    <div class="merge-status success">✅ 成功</div>
                                </div>
                                <div class="merge-history-item">
                                    <div class="merge-info">
                                        <span class="merge-time">2025-09-13 11:15</span>
                                        <span class="merge-desc">合并 bugfix/login-issue → main</span>
                                        <span class="merge-strategy">策略: --squash</span>
                                    </div>
                                    <div class="merge-status success">✅ 成功</div>
                                </div>
                                <div class="merge-history-item">
                                    <div class="merge-info">
                                        <span class="merge-time">2025-09-12 16:45</span>
                                        <span class="merge-desc">合并 feature/api-update → develop</span>
                                        <span class="merge-strategy">策略: 默认</span>
                                    </div>
                                    <div class="merge-status conflict">⚠️ 有冲突</div>
                                </div>
                            </div>
                        </div>

                        <!-- 状态显示区域 -->
                        <div id="mergeStatus" class="status-area"></div>
                    </div>
                `;
            },

            loadGitFlowInterface() {
                const container = document.getElementById('gitflowTab');
                container.innerHTML = `
                    <div class="gitflow-section">
                        <h3>🌊 Git Flow 工作流</h3>

                        <!-- Git Flow 初始化 -->
                        <div class="gitflow-init-section">
                            <h4>📋 初始化设置</h4>
                            <div class="gitflow-controls">
                                <button class="btn btn-primary" onclick="GitWorkflow.initGitFlow()">
                                    🚀 初始化 Git Flow
                                </button>
                                <button class="btn btn-secondary" onclick="GitWorkflow.checkGitFlowStatus()">
                                    ✅ 检查状态
                                </button>
                            </div>
                            <div id="gitflowStatus" class="status-area"></div>
                        </div>

                        <!-- Feature 分支管理 -->
                        <div class="gitflow-features">
                            <h4>🌟 Feature 分支</h4>
                            <div class="feature-controls">
                                <div class="input-group">
                                    <input type="text" id="featureName" placeholder="功能名称 (如: login-system)" class="form-input">
                                    <button class="btn btn-success" onclick="GitWorkflow.startFeature()">
                                        ▶️ 开始 Feature
                                    </button>
                                </div>
                            </div>
                            <div class="active-features">
                                <h5>当前 Feature 分支:</h5>
                                <ul id="featureBranchList" class="branch-list">
                                    <li class="branch-item">
                                        <span class="branch-name">feature/user-authentication</span>
                                        <div class="branch-actions">
                                            <button class="btn btn-sm btn-primary" onclick="GitWorkflow.finishFeature('user-authentication')">
                                                ✅ 完成
                                            </button>
                                            <button class="btn btn-sm btn-warning" onclick="GitWorkflow.publishFeature('user-authentication')">
                                                📤 发布
                                            </button>
                                        </div>
                                    </li>
                                    <li class="branch-item">
                                        <span class="branch-name">feature/payment-integration</span>
                                        <div class="branch-actions">
                                            <button class="btn btn-sm btn-primary" onclick="GitWorkflow.finishFeature('payment-integration')">
                                                ✅ 完成
                                            </button>
                                            <button class="btn btn-sm btn-warning" onclick="GitWorkflow.publishFeature('payment-integration')">
                                                📤 发布
                                            </button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Release 分支管理 -->
                        <div class="gitflow-releases">
                            <h4>🏷️ Release 分支</h4>
                            <div class="release-controls">
                                <div class="input-group">
                                    <input type="text" id="releaseVersion" placeholder="版本号 (如: 1.2.0)" class="form-input">
                                    <button class="btn btn-info" onclick="GitWorkflow.startRelease()">
                                        🎯 开始 Release
                                    </button>
                                </div>
                            </div>
                            <div class="active-releases">
                                <h5>当前 Release 分支:</h5>
                                <ul id="releaseBranchList" class="branch-list">
                                    <li class="branch-item">
                                        <span class="branch-name">release/1.2.0</span>
                                        <div class="branch-actions">
                                            <button class="btn btn-sm btn-success" onclick="GitWorkflow.finishRelease('1.2.0')">
                                                🚀 发布
                                            </button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Hotfix 分支管理 -->
                        <div class="gitflow-hotfixes">
                            <h4>🚨 Hotfix 分支</h4>
                            <div class="hotfix-controls">
                                <div class="input-group">
                                    <input type="text" id="hotfixName" placeholder="热修复名称 (如: critical-bug)" class="form-input">
                                    <button class="btn btn-danger" onclick="GitWorkflow.startHotfix()">
                                        🔥 开始 Hotfix
                                    </button>
                                </div>
                            </div>
                            <div class="active-hotfixes">
                                <h5>当前 Hotfix 分支:</h5>
                                <ul id="hotfixBranchList" class="branch-list">
                                    <!-- 动态加载热修复分支 -->
                                </ul>
                            </div>
                        </div>

                        <!-- Git Flow 操作历史 -->
                        <div class="gitflow-history">
                            <h4>📚 操作历史</h4>
                            <div id="gitflowHistoryList" class="history-list">
                                <div class="history-item">
                                    <span class="history-time">2025-09-13 10:30</span>
                                    <span class="history-action">✅ 完成 feature/user-authentication</span>
                                </div>
                                <div class="history-item">
                                    <span class="history-time">2025-09-13 09:15</span>
                                    <span class="history-action">🎯 开始 release/1.2.0</span>
                                </div>
                                <div class="history-item">
                                    <span class="history-time">2025-09-12 16:45</span>
                                    <span class="history-action">▶️ 开始 feature/payment-integration</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            loadConflictInterface() {
                const container = document.getElementById('conflictsTab');
                container.innerHTML = `
                    <div class="conflicts-interface">
                        <h4>⚡ 冲突解决</h4>
                        <div class="conflict-files">
                            <div class="conflict-file">
                                <div class="file-header">
                                    <span class="file-icon">⚠️</span>
                                    <span class="file-path">src/main.rs</span>
                                    <button class="btn btn-sm" onclick="resolveConflict('src/main.rs')">解决冲突</button>
                                </div>
                            </div>
                            <div class="conflict-file">
                                <div class="file-header">
                                    <span class="file-icon">⚠️</span>
                                    <span class="file-path">docs/README.md</span>
                                    <button class="btn btn-sm" onclick="resolveConflict('docs/README.md')">解决冲突</button>
                                </div>
                            </div>
                        </div>
                        <div class="conflict-actions">
                            <button class="btn btn-success" onclick="continueOperation()">✅ 继续操作</button>
                            <button class="btn btn-danger" onclick="abortOperation()">❌ 中止操作</button>
                        </div>
                    </div>
                `;

                // 重新绑定事件（因为内容是动态生成的）
                setTimeout(() => {
                    console.log('loadConflictInterface: rebinding events...');
                    handleConflictResolutionButtons();
                }, 100);
            },

            // 辅助方法
            showRebaseStatus(message, type) {
                this.showStatus('rebaseStatus', message, type);
            },

            showStatus(elementId, message, type) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.innerHTML = `<div class="status-message ${type}">${message}</div>`;
                }
            },

            // Git Flow 操作方法
            initGitFlow() {
                showCustomAlert('🚀 正在初始化 Git Flow...', '提示', '⏳');
                // 模拟 git flow init 操作
                setTimeout(() => {
                    this.showStatus('gitflowStatus', '✅ Git Flow 初始化成功！已设置 main/develop 分支结构', 'success');
                }, 2000);
            },

            checkGitFlowStatus() {
                const status = {
                    initialized: true,
                    mainBranch: 'main',
                    developBranch: 'develop',
                    featurePrefix: 'feature/',
                    releasePrefix: 'release/',
                    hotfixPrefix: 'hotfix/'
                };

                const statusHtml = `
                    <div class="gitflow-status">
                        <div class="status-item ${status.initialized ? 'success' : 'warning'}">
                            <span class="status-icon">${status.initialized ? '✅' : '⚠️'}</span>
                            <span>Git Flow ${status.initialized ? '已初始化' : '未初始化'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon">🌟</span>
                            <span>主分支: ${status.mainBranch}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon">🔧</span>
                            <span>开发分支: ${status.developBranch}</span>
                        </div>
                    </div>
                `;
                this.showStatus('gitflowStatus', statusHtml, 'info');
            },

            startFeature() {
                const featureName = document.getElementById('featureName')?.value?.trim();
                if (!featureName) {
                    showCustomAlert('❌ 请输入功能名称', '错误', '❌');
                    return;
                }

                showCustomAlert(`🌟 正在创建功能分支: feature/${featureName}...`, '提示', '⏳');

                // 模拟创建功能分支
                setTimeout(() => {
                    this.addFeatureBranch(featureName);
                    document.getElementById('featureName').value = '';
                    showCustomAlert(`✅ 成功创建并切换到 feature/${featureName}`, '成功', '✅');
                }, 1500);
            },

            finishFeature(featureName) {
                showCustomConfirm(
                    `确认完成功能分支 feature/${featureName}？\n这将把更改合并到 develop 分支。`,
                    () => {
                        showCustomAlert(`🔄 正在完成 feature/${featureName}...`, '提示', '⏳');
                        setTimeout(() => {
                            this.removeFeatureBranch(featureName);
                            this.addHistoryItem(`✅ 完成 feature/${featureName}`);
                            showCustomAlert(`✅ feature/${featureName} 已成功合并到 develop`, '完成', '🎉');
                        }, 2000);
                    }
                );
            },

            publishFeature(featureName) {
                showCustomAlert(`📤 正在发布 feature/${featureName} 到远程仓库...`, '提示', '⏳');
                setTimeout(() => {
                    showCustomAlert(`✅ feature/${featureName} 已发布到远程仓库`, '完成', '📤');
                }, 1500);
            },

            startRelease() {
                const releaseVersion = document.getElementById('releaseVersion')?.value?.trim();
                if (!releaseVersion) {
                    showCustomAlert('❌ 请输入版本号', '错误', '❌');
                    return;
                }

                showCustomAlert(`🎯 正在创建发布分支: release/${releaseVersion}...`, '提示', '⏳');

                setTimeout(() => {
                    this.addReleaseBranch(releaseVersion);
                    document.getElementById('releaseVersion').value = '';
                    this.addHistoryItem(`🎯 开始 release/${releaseVersion}`);
                    showCustomAlert(`✅ 成功创建发布分支 release/${releaseVersion}`, '成功', '✅');
                }, 1500);
            },

            finishRelease(version) {
                showCustomConfirm(
                    `确认发布版本 ${version}？\n这将合并到 main 和 develop 分支，并创建标签。`,
                    () => {
                        showCustomAlert(`🚀 正在发布版本 ${version}...`, '提示', '⏳');
                        setTimeout(() => {
                            this.removeReleaseBranch(version);
                            this.addHistoryItem(`🚀 发布版本 ${version}`);
                            showCustomAlert(`🎉 版本 ${version} 发布成功！`, '完成', '🎉');
                        }, 3000);
                    }
                );
            },

            startHotfix() {
                const hotfixName = document.getElementById('hotfixName')?.value?.trim();
                if (!hotfixName) {
                    showCustomAlert('❌ 请输入热修复名称', '错误', '❌');
                    return;
                }

                showCustomAlert(`🔥 正在创建热修复分支: hotfix/${hotfixName}...`, '提示', '⏳');

                setTimeout(() => {
                    this.addHotfixBranch(hotfixName);
                    document.getElementById('hotfixName').value = '';
                    this.addHistoryItem(`🔥 开始 hotfix/${hotfixName}`);
                    showCustomAlert(`✅ 成功创建热修复分支 hotfix/${hotfixName}`, '成功', '✅');
                }, 1500);
            },

            // 辅助方法
            addFeatureBranch(name) {
                const list = document.getElementById('featureBranchList');
                if (list) {
                    const li = document.createElement('li');
                    li.className = 'branch-item';
                    li.innerHTML = `
                        <span class="branch-name">feature/${name}</span>
                        <div class="branch-actions">
                            <button class="btn btn-sm btn-primary" onclick="GitWorkflow.finishFeature('${name}')">
                                ✅ 完成
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="GitWorkflow.publishFeature('${name}')">
                                📤 发布
                            </button>
                        </div>
                    `;
                    list.appendChild(li);
                }
            },

            removeFeatureBranch(name) {
                const list = document.getElementById('featureBranchList');
                if (list) {
                    const items = list.querySelectorAll('.branch-item');
                    items.forEach(item => {
                        if (item.querySelector('.branch-name')?.textContent?.includes(`feature/${name}`)) {
                            item.remove();
                        }
                    });
                }
            },

            addReleaseBranch(version) {
                const list = document.getElementById('releaseBranchList');
                if (list) {
                    const li = document.createElement('li');
                    li.className = 'branch-item';
                    li.innerHTML = `
                        <span class="branch-name">release/${version}</span>
                        <div class="branch-actions">
                            <button class="btn btn-sm btn-success" onclick="GitWorkflow.finishRelease('${version}')">
                                🚀 发布
                            </button>
                        </div>
                    `;
                    list.appendChild(li);
                }
            },

            removeReleaseBranch(version) {
                const list = document.getElementById('releaseBranchList');
                if (list) {
                    const items = list.querySelectorAll('.branch-item');
                    items.forEach(item => {
                        if (item.querySelector('.branch-name')?.textContent?.includes(`release/${version}`)) {
                            item.remove();
                        }
                    });
                }
            },

            addHotfixBranch(name) {
                const list = document.getElementById('hotfixBranchList');
                if (list) {
                    const li = document.createElement('li');
                    li.className = 'branch-item';
                    li.innerHTML = `
                        <span class="branch-name">hotfix/${name}</span>
                        <div class="branch-actions">
                            <button class="btn btn-sm btn-danger" onclick="GitWorkflow.finishHotfix('${name}')">
                                🔥 完成
                            </button>
                        </div>
                    `;
                    list.appendChild(li);
                }
            },

            finishHotfix(hotfixName) {
                showCustomConfirm(
                    `确认完成热修复分支 hotfix/${hotfixName}？\n这将把更改合并到 main 和 develop 分支。`,
                    () => {
                        showCustomAlert(`🔥 正在完成 hotfix/${hotfixName}...`, '提示', '⏳');
                        setTimeout(() => {
                            this.removeHotfixBranch(hotfixName);
                            this.addHistoryItem(`🔥 完成 hotfix/${hotfixName}`);
                            showCustomAlert(`✅ hotfix/${hotfixName} 已成功合并`, '完成', '🎉');
                        }, 2000);
                    }
                );
            },

            removeHotfixBranch(name) {
                const list = document.getElementById('hotfixBranchList');
                if (list) {
                    const items = list.querySelectorAll('.branch-item');
                    items.forEach(item => {
                        if (item.querySelector('.branch-name')?.textContent?.includes(`hotfix/${name}`)) {
                            item.remove();
                        }
                    });
                }
            },

            addHistoryItem(action) {
                const list = document.getElementById('gitflowHistoryList');
                if (list) {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <span class="history-time">${new Date().toLocaleString('zh-CN')}</span>
                        <span class="history-action">${action}</span>
                    `;
                    list.insertBefore(div, list.firstChild);

                    // 保持最多10个历史记录
                    const items = list.querySelectorAll('.history-item');
                    if (items.length > 10) {
                        items[items.length - 1].remove();
                    }
                }
            },

            // 合并操作方法
            previewMerge() {
                const sourceBranch = document.getElementById('sourceBranchSelect')?.value;
                const targetBranch = document.getElementById('targetBranchSelect')?.value;
                const strategy = document.querySelector('input[name="mergeStrategy"]:checked')?.value;

                if (!sourceBranch || !targetBranch) {
                    showCustomAlert('❌ 请选择源分支和目标分支', '错误', '❌');
                    return;
                }

                if (sourceBranch === targetBranch) {
                    showCustomAlert('❌ 源分支和目标分支不能相同', '错误', '❌');
                    return;
                }

                showCustomAlert('🔍 正在分析合并预览...', '提示', '⏳');

                setTimeout(() => {
                    const previewContainer = document.getElementById('mergePreview');
                    const commitCount = Math.floor(Math.random() * 5) + 1;
                    const fileCount = Math.floor(Math.random() * 8) + 1;

                    previewContainer.innerHTML = `
                        <div class="merge-preview-info">
                            <div class="preview-summary">
                                <h5>📊 合并摘要</h5>
                                <div class="summary-stats">
                                    <span class="stat-item">
                                        <strong>${commitCount}</strong> 个提交
                                    </span>
                                    <span class="stat-item">
                                        <strong>${fileCount}</strong> 个文件变更
                                    </span>
                                    <span class="stat-item">
                                        策略: <strong>${this.getStrategyName(strategy)}</strong>
                                    </span>
                                </div>
                            </div>
                            <div class="preview-commits">
                                <h5>📝 将要合并的提交</h5>
                                <div class="commit-list">
                                    <div class="commit-item">
                                        <span class="commit-hash">a1b2c3d</span>
                                        <span class="commit-message">feat: 添加用户认证功能</span>
                                        <span class="commit-author">张三</span>
                                    </div>
                                    <div class="commit-item">
                                        <span class="commit-hash">e4f5g6h</span>
                                        <span class="commit-message">fix: 修复登录表单验证问题</span>
                                        <span class="commit-author">李四</span>
                                    </div>
                                    ${commitCount > 2 ? `
                                    <div class="commit-item">
                                        <span class="commit-hash">i7j8k9l</span>
                                        <span class="commit-message">docs: 更新API文档</span>
                                        <span class="commit-author">王五</span>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="preview-files">
                                <h5>📁 变更文件</h5>
                                <div class="file-list">
                                    <div class="file-item added">
                                        <span class="file-status">+</span>
                                        <span class="file-path">src/auth/login.js</span>
                                        <span class="file-changes">+45 -0</span>
                                    </div>
                                    <div class="file-item modified">
                                        <span class="file-status">M</span>
                                        <span class="file-path">src/components/LoginForm.vue</span>
                                        <span class="file-changes">+12 -8</span>
                                    </div>
                                    <div class="file-item modified">
                                        <span class="file-status">M</span>
                                        <span class="file-path">docs/api.md</span>
                                        <span class="file-changes">+23 -5</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }, 1500);
            },

            checkMergeStatus() {
                showCustomAlert('📊 正在检查合并状态和冲突...', '提示', '⏳');

                setTimeout(() => {
                    const conflictContainer = document.getElementById('conflictDetection');
                    const hasConflicts = Math.random() < 0.3; // 30% 概率有冲突

                    if (hasConflicts) {
                        conflictContainer.innerHTML = `
                            <div class="conflict-detected">
                                <div class="conflict-warning">
                                    <span class="warning-icon">⚠️</span>
                                    <span>检测到潜在冲突</span>
                                </div>
                                <div class="conflict-files">
                                    <div class="conflict-file">
                                        <span class="file-icon">📄</span>
                                        <span class="file-path">src/utils/config.js</span>
                                        <span class="conflict-type">合并冲突</span>
                                    </div>
                                    <div class="conflict-file">
                                        <span class="file-icon">📄</span>
                                        <span class="file-path">package.json</span>
                                        <span class="conflict-type">依赖冲突</span>
                                    </div>
                                </div>
                                <div class="conflict-advice">
                                    建议先解决冲突后再进行合并
                                </div>
                            </div>
                        `;
                    } else {
                        conflictContainer.innerHTML = `
                            <div class="no-conflicts">
                                <div class="success-status">
                                    <span class="success-icon">✅</span>
                                    <span>未检测到冲突，可以安全合并</span>
                                </div>
                                <div class="status-details">
                                    <span>• 分支可以快进合并</span><br>
                                    <span>• 没有重叠的文件修改</span><br>
                                    <span>• 合并操作预计无风险</span>
                                </div>
                            </div>
                        `;
                    }
                }, 2000);
            },

            executeMerge() {
                const sourceBranch = document.getElementById('sourceBranchSelect')?.value;
                const targetBranch = document.getElementById('targetBranchSelect')?.value;
                const strategy = document.querySelector('input[name="mergeStrategy"]:checked')?.value;

                if (!sourceBranch || !targetBranch) {
                    showCustomAlert('❌ 请选择源分支和目标分支', '错误', '❌');
                    return;
                }

                const strategyName = this.getStrategyName(strategy);
                showCustomConfirm(
                    `确认执行合并操作？\n\n` +
                    `源分支: ${sourceBranch}\n` +
                    `目标分支: ${targetBranch}\n` +
                    `策略: ${strategyName}\n\n` +
                    `此操作将修改目标分支的历史记录。`,
                    () => {
                        showCustomAlert(`🔀 正在执行合并: ${sourceBranch} → ${targetBranch}...`, '提示', '⏳');

                        // 模拟合并过程
                        setTimeout(() => {
                            const success = Math.random() < 0.8; // 80% 成功率

                            if (success) {
                                this.addMergeHistory(sourceBranch, targetBranch, strategyName, 'success');
                                showCustomAlert(`✅ 合并成功！${sourceBranch} 已合并到 ${targetBranch}`, '完成', '🎉');
                                this.showStatus('mergeStatus', '✅ 合并操作已成功完成', 'success');
                            } else {
                                this.addMergeHistory(sourceBranch, targetBranch, strategyName, 'conflict');
                                showCustomAlert(`⚠️ 合并时遇到冲突，请手动解决冲突后再试`, '警告', '⚠️');
                                this.showStatus('mergeStatus', '⚠️ 合并过程中遇到冲突，需要手动解决', 'warning');
                            }
                        }, 3000);
                    }
                );
            },

            getStrategyName(strategy) {
                const strategies = {
                    'default': '默认合并',
                    'no-ff': '--no-ff',
                    'squash': '--squash',
                    'ff-only': '--ff-only'
                };
                return strategies[strategy] || '默认合并';
            },

            addMergeHistory(sourceBranch, targetBranch, strategy, status) {
                const historyList = document.querySelector('.merge-history-list');
                if (historyList) {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'merge-history-item';
                    historyItem.innerHTML = `
                        <div class="merge-info">
                            <span class="merge-time">${new Date().toLocaleString('zh-CN')}</span>
                            <span class="merge-desc">合并 ${sourceBranch} → ${targetBranch}</span>
                            <span class="merge-strategy">策略: ${strategy}</span>
                        </div>
                        <div class="merge-status ${status}">
                            ${status === 'success' ? '✅ 成功' : '⚠️ 有冲突'}
                        </div>
                    `;
                    historyList.insertBefore(historyItem, historyList.firstChild);

                    // 保持最多10个历史记录
                    const items = historyList.querySelectorAll('.merge-history-item');
                    if (items.length > 10) {
                        items[items.length - 1].remove();
                    }
                }
            },

            // 其他方法
            updateCommitAction() {},
            moveCommitUp() {},
            moveCommitDown() {},
            loadCurrentBranches() {},
            loadRebaseHistory() {},
            setupMergeInterface() {},
            setupGitFlowInterface() {},
            setupConflictResolution() {}
        };

        // ========================================
        // 👥 Team Collaboration Module
        // ========================================
        const TeamCollaboration = {
            pullRequests: [],
            teamMembers: [],
            reviewData: new Map(),
            notifications: [],

            // 初始化团队协作模块
            init() {
                this.setupCollaborationPanel();
                this.setupPullRequestInterface();
                this.setupCodeReviewInterface();
                this.setupTeamStatsInterface();
                this.setupNotificationSystem();
                this.loadTeamData();
                console.log('👥 TeamCollaboration initialized');
            },

            // 设置协作面板
            setupCollaborationPanel() {
                // 创建协作模态框（移除了重复的侧边栏按钮创建）
                const collaborationModal = document.createElement('div');
                collaborationModal.className = 'modal';
                collaborationModal.id = 'teamCollaborationModal';
                collaborationModal.innerHTML = `
                    <div class="modal-content collaboration-modal">
                        <div class="modal-header">
                            <span>👥 团队协作中心</span>
                            <div class="header-controls">
                                <span class="notification-badge" id="notificationBadge">3</span>
                                <button class="btn btn-sm" onclick="TeamCollaboration.refreshData()">🔄 刷新</button>
                                <button class="close-btn" onclick="TeamCollaboration.closeCollaborationModal()">&times;</button>
                            </div>
                        </div>
                        <div class="modal-body collaboration-body">
                            <div class="collaboration-tabs">
                                <button class="collaboration-tab active" data-tab="pullrequests">Pull Requests</button>
                                <button class="collaboration-tab" data-tab="reviews">代码审查</button>
                                <button class="collaboration-tab" data-tab="teamstats">团队统计</button>
                                <button class="collaboration-tab" data-tab="notifications">通知中心</button>
                            </div>
                            <div class="collaboration-content">
                                <div id="pullrequestsTab" class="collaboration-tab-content active"></div>
                                <div id="reviewsTab" class="collaboration-tab-content"></div>
                                <div id="teamstatsTab" class="collaboration-tab-content"></div>
                                <div id="notificationsTab" class="collaboration-tab-content"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(collaborationModal);

                // 绑定选项卡切换
                collaborationModal.querySelectorAll('.collaboration-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        this.switchCollaborationTab(tabName);
                    });
                });
            },

            // 打开协作模态框
            openCollaborationModal() {
                document.getElementById('teamCollaborationModal').style.display = 'flex';
                this.loadPullRequestsInterface();
            },

            // 关闭协作模态框
            closeCollaborationModal() {
                document.getElementById('teamCollaborationModal').style.display = 'none';
            },

            // 切换协作选项卡
            switchCollaborationTab(tabName) {
                // 更新选项卡状态
                document.querySelectorAll('.collaboration-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // 更新内容区域
                document.querySelectorAll('.collaboration-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}Tab`).classList.add('active');

                // 加载相应内容
                switch(tabName) {
                    case 'pullrequests': this.loadPullRequestsInterface(); break;
                    case 'reviews': this.loadCodeReviewInterface(); break;
                    case 'teamstats': this.loadTeamStatsInterface(); break;
                    case 'notifications': this.loadNotificationsInterface(); break;
                }
            },

            // 设置Pull Request界面
            setupPullRequestInterface() {
                // 将在loadPullRequestsInterface中实现
            },

            // 加载Pull Request界面
            loadPullRequestsInterface() {
                const container = document.getElementById('pullrequestsTab');
                container.innerHTML = `
                    <div class="pr-section">
                        <div class="pr-header">
                            <h3>📋 Pull Requests</h3>
                            <div class="pr-controls">
                                <button class="btn btn-primary" onclick="TeamCollaboration.createPullRequest()">
                                    ➕ 创建 PR
                                </button>
                                <select id="prFilter" class="form-select" onchange="TeamCollaboration.filterPRs(this.value)">
                                    <option value="all">全部</option>
                                    <option value="open">进行中</option>
                                    <option value="closed">已关闭</option>
                                    <option value="merged">已合并</option>
                                    <option value="assigned">分配给我</option>
                                </select>
                            </div>
                        </div>

                        <div class="pr-stats">
                            <div class="stat-card">
                                <span class="stat-number">12</span>
                                <span class="stat-label">进行中</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">8</span>
                                <span class="stat-label">待审查</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">45</span>
                                <span class="stat-label">已合并</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">3</span>
                                <span class="stat-label">有冲突</span>
                            </div>
                        </div>

                        <div id="prList" class="pr-list"></div>
                    </div>
                `;

                this.loadPullRequestList();
            },

            // 加载Pull Request列表
            loadPullRequestList() {
                const pullRequests = [
                    {
                        id: 123,
                        title: 'feat(auth): 实现OAuth 2.0认证功能',
                        author: 'Alice Chen',
                        status: 'open',
                        branch: 'feature/oauth2',
                        target: 'main',
                        reviewers: ['Bob', 'Charlie'],
                        created: '2024-01-15',
                        commits: 8,
                        additions: 156,
                        deletions: 23,
                        checks: { passed: 4, failed: 0, pending: 1 },
                        labels: ['feature', 'high-priority']
                    },
                    {
                        id: 124,
                        title: 'fix(api): 修复用户数据同步问题',
                        author: 'Bob Wang',
                        status: 'review',
                        branch: 'hotfix/user-sync',
                        target: 'main',
                        reviewers: ['Alice', 'David'],
                        created: '2024-01-14',
                        commits: 3,
                        additions: 45,
                        deletions: 12,
                        checks: { passed: 5, failed: 0, pending: 0 },
                        labels: ['bug', 'urgent']
                    },
                    {
                        id: 125,
                        title: 'docs: 更新API文档和使用指南',
                        author: 'Charlie Liu',
                        status: 'approved',
                        branch: 'docs/api-update',
                        target: 'main',
                        reviewers: ['Alice'],
                        created: '2024-01-13',
                        commits: 2,
                        additions: 89,
                        deletions: 5,
                        checks: { passed: 3, failed: 0, pending: 0 },
                        labels: ['documentation']
                    }
                ];

                const container = document.getElementById('prList');
                container.innerHTML = pullRequests.map(pr => `
                    <div class="pr-item ${pr.status}" onclick="TeamCollaboration.openPullRequest(${pr.id})">
                        <div class="pr-main">
                            <div class="pr-title">
                                <span class="pr-id">#${pr.id}</span>
                                <span class="pr-title-text">${pr.title}</span>
                            </div>
                            <div class="pr-meta">
                                <span class="pr-author">👤 ${pr.author}</span>
                                <span class="pr-branch">${pr.branch} → ${pr.target}</span>
                                <span class="pr-date">📅 ${pr.created}</span>
                            </div>
                            <div class="pr-stats-mini">
                                <span class="pr-commits">📝 ${pr.commits} commits</span>
                                <span class="pr-changes">+${pr.additions} -${pr.deletions}</span>
                                <span class="pr-checks ${pr.checks.failed > 0 ? 'failed' : pr.checks.pending > 0 ? 'pending' : 'passed'}">
                                    ✅ ${pr.checks.passed} ❌ ${pr.checks.failed} ⏳ ${pr.checks.pending}
                                </span>
                            </div>
                        </div>
                        <div class="pr-sidebar">
                            <div class="pr-status ${pr.status}">${this.getPRStatusText(pr.status)}</div>
                            <div class="pr-labels">
                                ${pr.labels.map(label => `<span class="pr-label ${label}">${label}</span>`).join('')}
                            </div>
                            <div class="pr-reviewers">
                                👥 ${pr.reviewers.join(', ')}
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            // 获取PR状态文本
            getPRStatusText(status) {
                const statusMap = {
                    'open': '进行中',
                    'review': '审查中',
                    'approved': '已批准',
                    'merged': '已合并',
                    'closed': '已关闭',
                    'conflict': '有冲突'
                };
                return statusMap[status] || status;
            },

            // 设置代码审查界面
            setupCodeReviewInterface() {
                // 将在loadCodeReviewInterface中实现
            },

            // 加载代码审查界面
            loadCodeReviewInterface() {
                const container = document.getElementById('reviewsTab');
                container.innerHTML = `
                    <div class="review-section">
                        <h3>🔍 代码审查</h3>

                        <div class="review-filters">
                            <div class="filter-group">
                                <label>审查状态：</label>
                                <select id="reviewStatusFilter" class="form-select">
                                    <option value="all">全部</option>
                                    <option value="pending">待审查</option>
                                    <option value="in-progress">审查中</option>
                                    <option value="approved">已批准</option>
                                    <option value="rejected">需要修改</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>我的角色：</label>
                                <select id="reviewRoleFilter" class="form-select">
                                    <option value="all">全部</option>
                                    <option value="author">我是作者</option>
                                    <option value="reviewer">我是审查者</option>
                                    <option value="mentioned">我被提及</option>
                                </select>
                            </div>
                        </div>

                        <div class="review-stats">
                            <div class="review-stat-item">
                                <span class="stat-icon">⏳</span>
                                <span class="stat-text">待我审查: 5</span>
                            </div>
                            <div class="review-stat-item">
                                <span class="stat-icon">👁️</span>
                                <span class="stat-text">我的审查: 12</span>
                            </div>
                            <div class="review-stat-item">
                                <span class="stat-icon">✅</span>
                                <span class="stat-text">本周批准: 8</span>
                            </div>
                            <div class="review-stat-item">
                                <span class="stat-icon">💬</span>
                                <span class="stat-text">评论数: 23</span>
                            </div>
                        </div>

                        <div id="reviewList" class="review-list"></div>
                    </div>
                `;

                this.loadReviewList();
            },

            // 加载审查列表
            loadReviewList() {
                const reviews = [
                    {
                        prId: 123,
                        title: 'feat(auth): 实现OAuth 2.0认证功能',
                        author: 'Alice Chen',
                        reviewer: 'Current User',
                        status: 'pending',
                        priority: 'high',
                        filesChanged: 8,
                        linesChanged: 179,
                        comments: 0,
                        lastActivity: '2小时前',
                        complexity: 'medium'
                    },
                    {
                        prId: 124,
                        title: 'fix(api): 修复用户数据同步问题',
                        author: 'Bob Wang',
                        reviewer: 'Current User',
                        status: 'in-progress',
                        priority: 'urgent',
                        filesChanged: 3,
                        linesChanged: 57,
                        comments: 5,
                        lastActivity: '30分钟前',
                        complexity: 'low'
                    },
                    {
                        prId: 126,
                        title: 'refactor: 重构用户认证模块',
                        author: 'Current User',
                        reviewer: 'Alice Chen',
                        status: 'approved',
                        priority: 'medium',
                        filesChanged: 12,
                        linesChanged: 245,
                        comments: 8,
                        lastActivity: '1天前',
                        complexity: 'high'
                    }
                ];

                const container = document.getElementById('reviewList');
                container.innerHTML = reviews.map(review => `
                    <div class="review-item ${review.status}" onclick="TeamCollaboration.openReview(${review.prId})">
                        <div class="review-header">
                            <div class="review-title">
                                <span class="review-pr-id">#${review.prId}</span>
                                <span class="review-title-text">${review.title}</span>
                                <span class="review-priority ${review.priority}">${review.priority}</span>
                            </div>
                            <div class="review-status ${review.status}">
                                ${this.getReviewStatusText(review.status)}
                            </div>
                        </div>
                        <div class="review-details">
                            <div class="review-participants">
                                <span class="review-author">👤 作者: ${review.author}</span>
                                <span class="review-reviewer">👁️ 审查: ${review.reviewer}</span>
                            </div>
                            <div class="review-metrics">
                                <span class="review-files">📁 ${review.filesChanged} 文件</span>
                                <span class="review-lines">📝 ${review.linesChanged} 行变更</span>
                                <span class="review-comments">💬 ${review.comments} 评论</span>
                                <span class="review-complexity complexity-${review.complexity}">
                                    🎯 复杂度: ${review.complexity}
                                </span>
                            </div>
                        </div>
                        <div class="review-actions">
                            <button class="btn btn-sm btn-success" onclick="TeamCollaboration.approveReview(${review.prId}); event.stopPropagation();">
                                ✅ 批准
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="TeamCollaboration.requestChanges(${review.prId}); event.stopPropagation();">
                                🔄 需要修改
                            </button>
                            <button class="btn btn-sm btn-info" onclick="TeamCollaboration.addComment(${review.prId}); event.stopPropagation();">
                                💬 评论
                            </button>
                            <span class="review-time">${review.lastActivity}</span>
                        </div>
                    </div>
                `).join('');
            },

            // 获取审查状态文本
            getReviewStatusText(status) {
                const statusMap = {
                    'pending': '待审查',
                    'in-progress': '审查中',
                    'approved': '已批准',
                    'rejected': '需要修改',
                    'completed': '已完成'
                };
                return statusMap[status] || status;
            },

            // 设置团队统计界面
            setupTeamStatsInterface() {
                // 将在loadTeamStatsInterface中实现
            },

            // 加载团队统计界面
            loadTeamStatsInterface() {
                const container = document.getElementById('teamstatsTab');
                container.innerHTML = `
                    <div class="team-stats-section">
                        <h3>📊 团队统计</h3>

                        <div class="stats-period">
                            <label>统计周期：</label>
                            <select id="statsPeriod" class="form-select" onchange="TeamCollaboration.updateStatsData(this.value)">
                                <option value="week">本周</option>
                                <option value="month">本月</option>
                                <option value="quarter">本季度</option>
                                <option value="year">今年</option>
                            </select>
                        </div>

                        <div class="team-overview">
                            <div class="overview-cards">
                                <div class="overview-card">
                                    <div class="card-icon">👥</div>
                                    <div class="card-content">
                                        <div class="card-title">团队成员</div>
                                        <div class="card-value">8 人</div>
                                    </div>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">🔄</div>
                                    <div class="card-content">
                                        <div class="card-title">活跃 PR</div>
                                        <div class="card-value">12 个</div>
                                    </div>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">✅</div>
                                    <div class="card-content">
                                        <div class="card-title">已合并</div>
                                        <div class="card-value">45 个</div>
                                    </div>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">📝</div>
                                    <div class="card-content">
                                        <div class="card-title">代码提交</div>
                                        <div class="card-value">156 次</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stats-charts">
                            <div class="chart-section">
                                <h4>📈 贡献统计</h4>
                                <div id="contributionChart" class="chart-container"></div>
                            </div>
                            <div class="chart-section">
                                <h4>🎯 审查效率</h4>
                                <div id="reviewEfficiencyChart" class="chart-container"></div>
                            </div>
                        </div>

                        <div class="team-leaderboard">
                            <h4>🏆 团队排行榜</h4>
                            <div id="leaderboard" class="leaderboard-container"></div>
                        </div>
                    </div>
                `;

                this.loadTeamStatsData();
            },

            // 加载团队统计数据
            loadTeamStatsData() {
                // 贡献统计图表
                const contributionChart = document.getElementById('contributionChart');
                contributionChart.innerHTML = `
                    <div class="contribution-bars">
                        <div class="contribution-bar">
                            <span class="contributor-name">Alice Chen</span>
                            <div class="bar-container">
                                <div class="bar commits" style="width: 85%;" title="34 commits"></div>
                                <div class="bar prs" style="width: 75%;" title="12 PRs"></div>
                                <div class="bar reviews" style="width: 90%;" title="18 reviews"></div>
                            </div>
                        </div>
                        <div class="contribution-bar">
                            <span class="contributor-name">Bob Wang</span>
                            <div class="bar-container">
                                <div class="bar commits" style="width: 70%;" title="28 commits"></div>
                                <div class="bar prs" style="width: 60%;" title="9 PRs"></div>
                                <div class="bar reviews" style="width: 65%;" title="13 reviews"></div>
                            </div>
                        </div>
                        <div class="contribution-bar">
                            <span class="contributor-name">Charlie Liu</span>
                            <div class="bar-container">
                                <div class="bar commits" style="width: 60%;" title="24 commits"></div>
                                <div class="bar prs" style="width: 80%;" title="15 PRs"></div>
                                <div class="bar reviews" style="width: 55%;" title="11 reviews"></div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-legend">
                        <span><div class="legend-color commits"></div> Commits</span>
                        <span><div class="legend-color prs"></div> PRs</span>
                        <span><div class="legend-color reviews"></div> Reviews</span>
                    </div>
                `;

                // 审查效率图表
                const reviewChart = document.getElementById('reviewEfficiencyChart');
                reviewChart.innerHTML = `
                    <div class="efficiency-metrics">
                        <div class="metric-item">
                            <div class="metric-label">平均审查时间</div>
                            <div class="metric-value">2.3 小时</div>
                            <div class="metric-trend up">↑ 15%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">首次反馈时间</div>
                            <div class="metric-value">45 分钟</div>
                            <div class="metric-trend down">↓ 8%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">批准率</div>
                            <div class="metric-value">87%</div>
                            <div class="metric-trend up">↑ 3%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">返工率</div>
                            <div class="metric-value">13%</div>
                            <div class="metric-trend down">↓ 5%</div>
                        </div>
                    </div>
                `;

                // 排行榜
                const leaderboard = document.getElementById('leaderboard');
                const leaderboardData = [
                    { rank: 1, name: 'Alice Chen', score: 95, commits: 34, prs: 12, reviews: 18 },
                    { rank: 2, name: 'Charlie Liu', score: 88, commits: 24, prs: 15, reviews: 11 },
                    { rank: 3, name: 'Bob Wang', score: 82, commits: 28, prs: 9, reviews: 13 },
                    { rank: 4, name: 'David Zhang', score: 75, commits: 19, prs: 8, reviews: 15 },
                    { rank: 5, name: 'Eva Li', score: 71, commits: 22, prs: 6, reviews: 9 }
                ];

                leaderboard.innerHTML = leaderboardData.map(member => `
                    <div class="leaderboard-item rank-${member.rank}">
                        <div class="rank-badge">${member.rank}</div>
                        <div class="member-info">
                            <div class="member-name">${member.name}</div>
                            <div class="member-stats">
                                ${member.commits} commits • ${member.prs} PRs • ${member.reviews} reviews
                            </div>
                        </div>
                        <div class="score-badge">${member.score}</div>
                    </div>
                `).join('');
            },

            // 设置通知系统
            setupNotificationSystem() {
                // 将在loadNotificationsInterface中实现
            },

            // 加载通知界面
            loadNotificationsInterface() {
                const container = document.getElementById('notificationsTab');
                container.innerHTML = `
                    <div class="notifications-section">
                        <div class="notifications-header">
                            <h3>🔔 通知中心</h3>
                            <div class="notification-controls">
                                <button class="btn btn-sm" onclick="TeamCollaboration.markAllRead()">
                                    ✅ 全部已读
                                </button>
                                <button class="btn btn-sm" onclick="TeamCollaboration.configureNotifications()">
                                    ⚙️ 设置
                                </button>
                            </div>
                        </div>

                        <div class="notification-filters">
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all">全部 (12)</button>
                                <button class="filter-tab" data-filter="unread">未读 (3)</button>
                                <button class="filter-tab" data-filter="mentions">@提及 (1)</button>
                                <button class="filter-tab" data-filter="reviews">审查 (5)</button>
                                <button class="filter-tab" data-filter="assignments">分配 (2)</button>
                            </div>
                        </div>

                        <div id="notificationList" class="notification-list"></div>
                    </div>
                `;

                this.loadNotificationList();
            },

            // 加载通知列表
            loadNotificationList() {
                const notifications = [
                    {
                        id: 1,
                        type: 'pr_assigned',
                        title: 'PR #123 已分配给您审查',
                        description: 'Alice Chen 请求您审查 "feat(auth): 实现OAuth 2.0认证功能"',
                        time: '5分钟前',
                        read: false,
                        priority: 'high',
                        actionUrl: '/pr/123'
                    },
                    {
                        id: 2,
                        type: 'mention',
                        title: '在 PR #124 中提及了您',
                        description: 'Bob Wang: "@current_user 请查看这个实现方式是否合适"',
                        time: '15分钟前',
                        read: false,
                        priority: 'medium',
                        actionUrl: '/pr/124#comment-45'
                    },
                    {
                        id: 3,
                        type: 'pr_approved',
                        title: 'PR #126 已获得批准',
                        description: 'Alice Chen 批准了您的 PR "refactor: 重构用户认证模块"',
                        time: '1小时前',
                        read: false,
                        priority: 'low',
                        actionUrl: '/pr/126'
                    },
                    {
                        id: 4,
                        type: 'build_failed',
                        title: 'PR #123 构建失败',
                        description: '自动化测试在 Node.js 16 环境中失败',
                        time: '2小时前',
                        read: true,
                        priority: 'high',
                        actionUrl: '/pr/123/checks'
                    },
                    {
                        id: 5,
                        type: 'review_requested',
                        title: '新的审查请求',
                        description: 'Charlie Liu 请求审查 PR #127 "docs: API文档更新"',
                        time: '3小时前',
                        read: true,
                        priority: 'medium',
                        actionUrl: '/pr/127'
                    }
                ];

                const container = document.getElementById('notificationList');
                container.innerHTML = notifications.map(notification => `
                    <div class="notification-item ${notification.read ? 'read' : 'unread'} priority-${notification.priority}"
                         onclick="TeamCollaboration.openNotification(${notification.id})">
                        <div class="notification-icon ${notification.type}">
                            ${this.getNotificationIcon(notification.type)}
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-description">${notification.description}</div>
                            <div class="notification-meta">
                                <span class="notification-time">${notification.time}</span>
                                <span class="notification-priority priority-${notification.priority}">
                                    ${notification.priority}
                                </span>
                            </div>
                        </div>
                        <div class="notification-actions">
                            <button class="btn btn-sm" onclick="TeamCollaboration.markAsRead(${notification.id}); event.stopPropagation();">
                                ${notification.read ? '标为未读' : '标为已读'}
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            // 获取通知图标
            getNotificationIcon(type) {
                const iconMap = {
                    'pr_assigned': '👤',
                    'mention': '@',
                    'pr_approved': '✅',
                    'build_failed': '❌',
                    'review_requested': '👁️',
                    'pr_merged': '🔀',
                    'comment': '💬'
                };
                return iconMap[type] || '📢';
            },

            // 加载团队数据
            loadTeamData() {
                this.teamMembers = [
                    { id: 1, name: 'Alice Chen', role: 'Tech Lead', avatar: '👩‍💻', status: 'active' },
                    { id: 2, name: 'Bob Wang', role: 'Senior Dev', avatar: '👨‍💻', status: 'active' },
                    { id: 3, name: 'Charlie Liu', role: 'Full Stack Dev', avatar: '👨‍💼', status: 'active' },
                    { id: 4, name: 'David Zhang', role: 'Frontend Dev', avatar: '👨‍🎨', status: 'away' },
                    { id: 5, name: 'Eva Li', role: 'Backend Dev', avatar: '👩‍🔬', status: 'active' }
                ];

                this.notifications = [
                    { id: 1, type: 'pr_assigned', read: false, time: new Date(Date.now() - 5 * 60 * 1000) },
                    { id: 2, type: 'mention', read: false, time: new Date(Date.now() - 15 * 60 * 1000) },
                    { id: 3, type: 'pr_approved', read: false, time: new Date(Date.now() - 60 * 60 * 1000) }
                ];

                // 更新通知徽章
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    const unreadCount = this.notifications.filter(n => !n.read).length;
                    badge.textContent = unreadCount;
                    badge.style.display = unreadCount > 0 ? 'block' : 'none';
                }
            },

            // 方法实现
            createPullRequest() {
                alert('创建新的 Pull Request');
            },

            filterPRs(filter) {
                console.log('Filtering PRs by:', filter);
            },

            openPullRequest(prId) {
                alert(`打开 PR #${prId}`);
            },

            openReview(prId) {
                alert(`打开审查 PR #${prId}`);
            },

            approveReview(prId) {
                alert(`批准 PR #${prId}`);
            },

            requestChanges(prId) {
                alert(`请求修改 PR #${prId}`);
            },

            addComment(prId) {
                const comment = prompt('添加评论:');
                if (comment) {
                    alert(`已添加评论到 PR #${prId}: ${comment}`);
                }
            },

            updateStatsData(period) {
                console.log('Updating stats for period:', period);
                this.loadTeamStatsData();
            },

            markAllRead() {
                this.notifications.forEach(n => n.read = true);
                this.loadNotificationList();
                this.updateNotificationBadge();
            },

            configureNotifications() {
                alert('打开通知设置');
            },

            openNotification(notificationId) {
                const notification = this.notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    this.updateNotificationBadge();
                    alert(`打开通知: ${notificationId}`);
                }
            },

            markAsRead(notificationId) {
                const notification = this.notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = !notification.read;
                    this.loadNotificationList();
                    this.updateNotificationBadge();
                }
            },

            updateNotificationBadge() {
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    const unreadCount = this.notifications.filter(n => !n.read).length;
                    badge.textContent = unreadCount;
                    badge.style.display = unreadCount > 0 ? 'block' : 'none';
                }
            },

            refreshData() {
                console.log('Refreshing collaboration data...');
                this.loadTeamData();
                // 根据当前活跃的选项卡重新加载数据
                const activeTab = document.querySelector('.collaboration-tab.active');
                if (activeTab) {
                    this.switchCollaborationTab(activeTab.dataset.tab);
                }
            }
        };

        // ========================================
        // ⚡ Performance Optimization Module
        // ========================================
        const PerformanceManager = {
            virtualScrollConfig: {
                itemHeight: 40,
                containerHeight: 400,
                buffer: 5
            },

            intersectionObserver: null,
            resizeObserver: null,

            /**
             * 初始化性能优化
             */
            init() {
                this.setupVirtualScrolling();
                this.setupLazyLoading();
                this.setupMemoryOptimization();
                this.setupPerformanceMonitoring();
            },

            /**
             * 虚拟滚动实现
             */
            setupVirtualScrolling() {
                const virtualLists = document.querySelectorAll('.virtual-list');

                virtualLists.forEach(list => {
                    this.createVirtualScrollInstance(list);
                });
            },

            /**
             * 创建虚拟滚动实例
             */
            createVirtualScrollInstance(container) {
                const items = Array.from(container.querySelectorAll('.file-item'));
                if (items.length < 20) return; // 小于20项不使用虚拟滚动

                const { itemHeight, buffer } = this.virtualScrollConfig;
                const containerHeight = container.clientHeight || 400;
                const visibleCount = Math.ceil(containerHeight / itemHeight);

                let scrollTop = 0;
                let startIndex = 0;
                let endIndex = Math.min(visibleCount + buffer, items.length);

                const virtualContent = document.createElement('div');
                virtualContent.className = 'virtual-list-content';
                virtualContent.style.height = `${items.length * itemHeight}px`;

                // 初始渲染
                this.renderVisibleItems(virtualContent, items, startIndex, endIndex, itemHeight);

                container.innerHTML = '';
                container.appendChild(virtualContent);

                // 滚动事件处理
                let scrollTimeout;
                EventManager.addEventListener(container, 'scroll', () => {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        scrollTop = container.scrollTop;
                        startIndex = Math.floor(scrollTop / itemHeight);
                        endIndex = Math.min(startIndex + visibleCount + buffer, items.length);

                        this.renderVisibleItems(virtualContent, items, startIndex, endIndex, itemHeight);
                    }, 16); // ~60fps
                });
            },

            /**
             * 渲染可见项目
             */
            renderVisibleItems(container, items, startIndex, endIndex, itemHeight) {
                // 清空容器
                container.innerHTML = '';

                // 添加上方填充
                if (startIndex > 0) {
                    const topSpacer = document.createElement('div');
                    topSpacer.style.height = `${startIndex * itemHeight}px`;
                    container.appendChild(topSpacer);
                }

                // 渲染可见项目
                for (let i = startIndex; i < endIndex; i++) {
                    if (items[i]) {
                        const clonedItem = items[i].cloneNode(true);
                        clonedItem.style.position = 'relative';
                        clonedItem.style.height = `${itemHeight}px`;
                        container.appendChild(clonedItem);
                    }
                }

                // 添加下方填充
                const remainingItems = items.length - endIndex;
                if (remainingItems > 0) {
                    const bottomSpacer = document.createElement('div');
                    bottomSpacer.style.height = `${remainingItems * itemHeight}px`;
                    container.appendChild(bottomSpacer);
                }
            },

            /**
             * 懒加载设置
             */
            setupLazyLoading() {
                if ('IntersectionObserver' in window) {
                    this.intersectionObserver = new IntersectionObserver(
                        (entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting) {
                                    this.loadLazyContent(entry.target);
                                }
                            });
                        },
                        { threshold: 0.1 }
                    );

                    // 观察懒加载元素
                    document.querySelectorAll('[data-lazy]').forEach(el => {
                        this.intersectionObserver.observe(el);
                    });
                }
            },

            /**
             * 加载懒加载内容
             */
            loadLazyContent(element) {
                const lazyType = element.dataset.lazy;

                switch (lazyType) {
                    case 'diff':
                        this.loadLazyDiff(element);
                        break;
                    case 'image':
                        this.loadLazyImage(element);
                        break;
                    default:
                        console.warn('Unknown lazy type:', lazyType);
                }

                this.intersectionObserver.unobserve(element);
            },

            /**
             * 内存优化
             */
            setupMemoryOptimization() {
                // 定期清理缓存
                setInterval(() => {
                    this.cleanupCache();
                }, 60000); // 每分钟清理一次

                // 页面隐藏时暂停动画
                EventManager.addEventListener(document, 'visibilitychange', () => {
                    if (document.hidden) {
                        this.pauseAnimations();
                    } else {
                        this.resumeAnimations();
                    }
                });
            },

            /**
             * 清理缓存
             */
            cleanupCache() {
                // 清理SearchManager缓存
                if (SearchManager.searchCache.size > 100) {
                    const entries = Array.from(SearchManager.searchCache.entries());
                    const toKeep = entries.slice(-50); // 保留最近50个
                    SearchManager.searchCache.clear();
                    toKeep.forEach(([key, value]) => {
                        SearchManager.searchCache.set(key, value);
                    });
                }

                // 强制垃圾回收 (如果可用)
                if (window.gc) {
                    window.gc();
                }
            },

            /**
             * 暂停动画
             */
            pauseAnimations() {
                document.querySelectorAll('.animation-active').forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
            },

            /**
             * 恢复动画
             */
            resumeAnimations() {
                document.querySelectorAll('.animation-active').forEach(el => {
                    el.style.animationPlayState = 'running';
                });
            },

            /**
             * 性能监控
             */
            setupPerformanceMonitoring() {
                if ('PerformanceObserver' in window) {
                    // 监控长任务
                    const longTaskObserver = new PerformanceObserver((list) => {
                        list.getEntries().forEach((entry) => {
                            if (entry.duration > 50) {
                                console.warn(`Long task detected: ${entry.duration}ms`);
                            }
                        });
                    });

                    try {
                        longTaskObserver.observe({ entryTypes: ['longtask'] });
                    } catch (e) {
                        console.warn('Long task monitoring not supported');
                    }
                }

                // 内存使用监控
                if ('memory' in performance) {
                    setInterval(() => {
                        const memory = performance.memory;
                        const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                        const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024);

                        if (usedMB > 100) { // 超过100MB警告
                            console.warn(`High memory usage: ${usedMB}MB / ${totalMB}MB`);
                        }
                    }, 30000); // 每30秒检查一次
                }
            }
        };

        // ========================================
        // ♿ Accessibility Enhancement Module
        // ========================================
        const AccessibilityManager = {
            focusHistory: [],
            ariaLiveRegions: new Map(),
            keyboardNavigation: true,

            /**
             * 初始化可访问性增强
             */
            init() {
                this.setupARIALabels();
                this.setupKeyboardNavigation();
                this.setupScreenReaderSupport();
                this.setupFocusManagement();
                this.setupSkipLinks();
            },

            /**
             * 设置ARIA标签
             */
            setupARIALabels() {
                // 为所有交互元素添加适当的ARIA标签
                const interactiveElements = document.querySelectorAll('button, input, select, [role="button"]');

                interactiveElements.forEach(element => {
                    if (!element.getAttribute('aria-label') && !element.getAttribute('aria-labelledby')) {
                        const label = this.generateARIALabel(element);
                        if (label) {
                            element.setAttribute('aria-label', label);
                        }
                    }
                });

                // 设置地标区域
                this.setupLandmarks();
            },

            /**
             * 生成ARIA标签
             */
            generateARIALabel(element) {
                const text = element.textContent?.trim();
                const title = element.getAttribute('title');
                const placeholder = element.getAttribute('placeholder');

                return text || title || placeholder || null;
            },

            /**
             * 设置地标区域
             */
            setupLandmarks() {
                const sidebar = document.querySelector('.sidebar');
                const main = document.querySelector('.content-area');
                const nav = document.querySelector('.header-nav');

                if (sidebar && !sidebar.getAttribute('role')) {
                    sidebar.setAttribute('role', 'complementary');
                    sidebar.setAttribute('aria-label', 'Repository navigation');
                }

                if (main && !main.getAttribute('role')) {
                    main.setAttribute('role', 'main');
                    main.setAttribute('aria-label', 'Main content');
                }

                if (nav && !nav.getAttribute('role')) {
                    nav.setAttribute('role', 'navigation');
                    nav.setAttribute('aria-label', 'View navigation');
                }
            },

            /**
             * 增强键盘导航
             */
            setupKeyboardNavigation() {
                // 确保所有交互元素都可以通过键盘访问
                document.querySelectorAll('[onclick], .clickable').forEach(element => {
                    if (!element.getAttribute('tabindex')) {
                        element.setAttribute('tabindex', '0');
                    }

                    // 添加键盘事件
                    EventManager.addEventListener(element, 'keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            element.click();
                        }
                    });
                });

                // 显示键盘导航提示
                this.setupKeyboardHints();
            },

            /**
             * 设置键盘提示
             */
            setupKeyboardHints() {
                let hintTimeout;

                EventManager.addEventListener(document, 'keydown', (e) => {
                    // 显示键盘导航提示
                    if (e.key === 'Tab' || e.key === 'F1') {
                        this.showKeyboardHints();

                        clearTimeout(hintTimeout);
                        hintTimeout = setTimeout(() => {
                            this.hideKeyboardHints();
                        }, 5000);
                    }
                });

                // Esc隐藏提示
                EventManager.addEventListener(document, 'keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideKeyboardHints();
                    }
                });
            },

            /**
             * 显示键盘导航提示
             */
            showKeyboardHints() {
                let hint = document.querySelector('.keyboard-nav-hint');

                if (!hint) {
                    hint = document.createElement('div');
                    hint.className = 'keyboard-nav-hint';
                    hint.innerHTML = `
                        <div><strong>Keyboard Navigation:</strong></div>
                        <div>Tab: Navigate elements</div>
                        <div>1-6: Switch views</div>
                        <div>↑↓: Navigate lists</div>
                        <div>Enter: Activate</div>
                        <div>Esc: Close dialogs</div>
                    `;
                    document.body.appendChild(hint);
                }

                hint.classList.add('visible');
            },

            /**
             * 隐藏键盘导航提示
             */
            hideKeyboardHints() {
                const hint = document.querySelector('.keyboard-nav-hint');
                if (hint) {
                    hint.classList.remove('visible');
                }
            },

            /**
             * 设置屏幕阅读器支持
             */
            setupScreenReaderSupport() {
                // 创建实时区域用于状态更新
                this.createLiveRegion('status', 'polite');
                this.createLiveRegion('alerts', 'assertive');

                // 监听状态变化并通知屏幕阅读器
                this.setupStatusAnnouncements();
            },

            /**
             * 创建实时区域
             */
            createLiveRegion(id, politeness) {
                const region = document.createElement('div');
                region.id = `aria-live-${id}`;
                region.className = 'sr-only';
                region.setAttribute('aria-live', politeness);
                region.setAttribute('aria-atomic', 'true');

                document.body.appendChild(region);
                this.ariaLiveRegions.set(id, region);
            },

            /**
             * 设置状态公告
             */
            setupStatusAnnouncements() {
                // 监听视图变化
                const originalUpdateView = AppState.updateView;
                AppState.updateView = (newView) => {
                    originalUpdateView.call(AppState, newView);
                    this.announceViewChange(newView);
                };
            },

            /**
             * 公告视图变化
             */
            announceViewChange(viewName) {
                const statusRegion = this.ariaLiveRegions.get('status');
                if (statusRegion) {
                    statusRegion.textContent = `Switched to ${viewName} view`;
                }
            },

            /**
             * 公告状态消息
             */
            announce(message, type = 'status') {
                const region = this.ariaLiveRegions.get(type);
                if (region) {
                    region.textContent = message;
                }
            },

            /**
             * 设置焦点管理
             */
            setupFocusManagement() {
                // 跟踪焦点历史
                EventManager.addEventListener(document, 'focusin', (e) => {
                    this.focusHistory.push(e.target);
                    if (this.focusHistory.length > 10) {
                        this.focusHistory.shift();
                    }
                });

                // 为模态框设置焦点陷阱
                this.setupModalFocusTraps();
            },

            /**
             * 设置模态框焦点陷阱
             */
            setupModalFocusTraps() {
                const modals = document.querySelectorAll('.modal');

                modals.forEach(modal => {
                    EventManager.addEventListener(modal, 'keydown', (e) => {
                        if (e.key === 'Tab' && modal.classList.contains('active')) {
                            this.trapFocus(e, modal);
                        }
                    });
                });
            },

            /**
             * 焦点陷阱
             */
            trapFocus(e, container) {
                const focusableElements = container.querySelectorAll(
                    'button, input, select, textarea, a[href], [tabindex]:not([tabindex="-1"])'
                );

                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey) {
                    if (document.activeElement === firstElement) {
                        e.preventDefault();
                        lastElement.focus();
                    }
                } else {
                    if (document.activeElement === lastElement) {
                        e.preventDefault();
                        firstElement.focus();
                    }
                }
            },

            /**
             * 设置跳转链接
             */
            setupSkipLinks() {
                const skipLink = document.createElement('a');
                skipLink.href = '#main-content';
                skipLink.className = 'skip-link sr-only';
                skipLink.textContent = 'Skip to main content';
                skipLink.style.position = 'absolute';
                skipLink.style.top = '0';
                skipLink.style.left = '0';
                skipLink.style.zIndex = '9999';

                EventManager.addEventListener(skipLink, 'focus', () => {
                    skipLink.classList.remove('sr-only');
                });

                EventManager.addEventListener(skipLink, 'blur', () => {
                    skipLink.classList.add('sr-only');
                });

                document.body.insertBefore(skipLink, document.body.firstChild);

                // 为主内容添加ID
                const mainContent = document.querySelector('.content-area');
                if (mainContent && !mainContent.id) {
                    mainContent.id = 'main-content';
                }
            }
        };

        // 安全的分支列表渲染函数
        function createBranchListElement(index, branchName, isSelected, isCurrent) {
            const element = document.createElement('div');
            element.className = `list-item ${isSelected ? 'selected' : ''}`;
            EventManager.addEventListener(element, 'click', () => selectBranch(index, branchName));

            const icon = document.createElement('span');
            icon.className = 'icon';
            icon.textContent = isCurrent ? '★' : ' ';

            element.appendChild(icon);
            element.appendChild(document.createTextNode(` ${branchName}`));

            return element;
        }

        // 安全的列表项创建函数
        function createSafeListItem(text, isSelected = false, clickHandler = null, additionalContent = '') {
            const element = document.createElement('div');
            element.className = `list-item ${isSelected ? 'selected' : ''}`;

            if (additionalContent) {
                element.innerHTML = additionalContent + ' ' + escapeHtml(text);
            } else {
                element.textContent = text;
            }

            if (clickHandler) {
                EventManager.addEventListener(element, 'click', clickHandler);
            }

            return element;
        }

        // 安全的动态列表更新函数（优化版）
        function updateDynamicListSafeV2(view) {
            const dynamicList = DOMUtils.getElementById('dynamicList');
            if (!dynamicList) return;

            // 清理旧的事件监听器和内容
            EventManager.cleanupContainer(dynamicList);
            dynamicList.innerHTML = '';

            const branchNames = AppData.getBranches();

            switch(view) {
                case 'stash':
                    if (isStashMode) {
                        // 创建 stash 列表标题
                        const stashTitle = document.createElement('div');
                        stashTitle.className = 'list-title';
                        stashTitle.textContent = 'STASH ENTRIES';
                        dynamicList.appendChild(stashTitle);

                        // 添加 stash 条目
                        AppData.getStashes().forEach((stash, index) => {
                            const stashElement = createSafeListItem(
                                stash.name + ': ' + stash.message,
                                selectedStashIndex === index,
                                () => selectStash(index, stash.name)
                            );
                            dynamicList.appendChild(stashElement);
                        });
                    } else {
                        // Recent Commits mode - 使用安全的DOM操作
                        const commitsTitle = document.createElement('div');
                        commitsTitle.className = 'list-title';
                        commitsTitle.textContent = 'Recent Commits';
                        dynamicList.appendChild(commitsTitle);

                        const recentCommits = AppData.getRecentCommits();
                        recentCommits.forEach((commitHash, index) => {
                            const commitElement = createSafeListItem(
                                `${commitHash} fix(ui)`,
                                selectedCommitIndex === index,
                                () => selectCommitByIndex(index, commitHash),
                                '<span class="commit-status">📝</span>'
                            );
                            dynamicList.appendChild(commitElement);
                        });
                    }
                    break;

                // 其他视图保持使用原来的逻辑，但添加清理
                default:
                    // 继续使用原有逻辑但需要添加事件清理
                    updateDynamicListLegacy(view);
                    return;
            }
        }

        function updateDynamicListLegacy(view) {
            const dynamicList = document.getElementById('dynamicList');
            if (!dynamicList) return;

            // 清理旧的事件监听器
            EventManager.cleanupContainer(dynamicList);

            let content = '';

            switch(view) {
                case 'git-log':
                    const selectedBranchName = branchNames[selectedBranchIndex] || branchNames[0];

                    // 创建标题
                    const title = document.createElement('div');
                    title.className = 'list-title';
                    title.textContent = `Git Log - ${selectedBranchName}`;
                    dynamicList.appendChild(title);

                    // 创建当前分支信息
                    const branchInfo = document.createElement('div');
                    branchInfo.style.cssText = 'margin-bottom: 12px; padding: 8px; background: #2d2d30; border-radius: 4px;';
                    branchInfo.innerHTML = `
                        <div style="color: #4ec9b0; font-weight: bold;">🔍 Viewing Branch:</div>
                        <div style="color: #cccccc; margin-top: 4px;">${escapeHtml(selectedBranchName)}</div>
                    `;
                    dynamicList.appendChild(branchInfo);

                    // 创建分支切换标题
                    const switchTitle = document.createElement('div');
                    switchTitle.className = 'list-title';
                    switchTitle.style.marginTop = '16px';
                    switchTitle.textContent = 'Switch Branch:';
                    dynamicList.appendChild(switchTitle);

                    // 添加分支列表
                    branchNames.forEach((branchName, index) => {
                        const branchElement = createBranchListElement(
                            index,
                            branchName,
                            selectedBranchIndex === index,
                            currentBranchIndex === index
                        );
                        dynamicList.appendChild(branchElement);
                    });
                    break;

                case 'branches':
                    // 创建分支列表标题
                    const branchesTitle = document.createElement('div');
                    branchesTitle.className = 'list-title';
                    branchesTitle.textContent = 'Branches List';
                    dynamicList.appendChild(branchesTitle);

                    // 添加分支列表
                    branchNames.forEach((branchName, index) => {
                        const branchElement = createBranchListElement(
                            index,
                            branchName,
                            selectedBranchIndex === index,
                            currentBranchIndex === index
                        );
                        dynamicList.appendChild(branchElement);
                    });
                    break;

                // 其他视图保持原有逻辑...
                default:
                    // 使用原有的 updateDynamicList 处理其他视图
                    updateDynamicList(view);
                    return;
            }
        }

        // Custom Alert and Confirm Functions
        function showCustomAlert(message, title = '💬 提示', icon = '💬') {
            const alertTitle = DOMUtils.getElementById('alertTitle');
            const alertMessage = DOMUtils.getElementById('alertMessage');
            const alertModal = DOMUtils.getElementById('customAlertModal');

            if (alertTitle && alertMessage && alertModal) {
                DOMUtils.safeSetTextContent(alertTitle, `${icon} ${title}`);
                DOMUtils.safeSetInnerHTML(alertMessage, message.replace(/\n/g, '<br>'));
                DOMUtils.safeAddClass(alertModal, 'active');
            }
        }

        function closeCustomAlert() {
            const alertModal = DOMUtils.getElementById('customAlertModal');
            if (alertModal) {
                DOMUtils.safeRemoveClass(alertModal, 'active');
            }
        }

        function showCustomConfirm(message, onConfirm, title = '确认操作', icon = '❓') {
            const confirmTitle = DOMUtils.getElementById('confirmTitle');
            const confirmMessage = DOMUtils.getElementById('confirmMessage');
            const confirmModal = DOMUtils.getElementById('customConfirmModal');
            const confirmBtn = DOMUtils.getElementById('confirmYesBtn');

            if (confirmTitle && confirmMessage && confirmModal) {
                DOMUtils.safeSetTextContent(confirmTitle, `${icon} ${title}`);
                DOMUtils.safeSetInnerHTML(confirmMessage, message.replace(/\n/g, '<br>'));
                DOMUtils.safeAddClass(confirmModal, 'active');
                customConfirmCallback = onConfirm;

                if (confirmBtn) {
                    confirmBtn.onclick = function() {
                        if (customConfirmCallback) {
                            customConfirmCallback();
                            customConfirmCallback = null;
                        }
                        closeCustomConfirm();
                    };
                }
            }
        }

        function closeCustomConfirm() {
            const confirmModal = DOMUtils.getElementById('customConfirmModal');
            if (confirmModal) {
                DOMUtils.safeRemoveClass(confirmModal, 'active');
            }
            customConfirmCallback = null;
        }

        /**
         * 显示自定义输入弹窗
         * @param {string} message - 弹窗消息内容
         * @param {function} onConfirm - 确认回调函数，接收输入值作为参数
         * @param {string} title - 弹窗标题
         * @param {string} icon - 图标
         * @param {string} defaultValue - 默认输入值
         * @param {string} placeholder - 输入框占位符
         */
        function showCustomPrompt(message, onConfirm, title = '📝 输入', icon = '📝', defaultValue = '', placeholder = '请输入...') {
            const promptTitle = DOMUtils.getElementById('promptTitle');
            const promptMessage = DOMUtils.getElementById('promptMessage');
            const promptModal = DOMUtils.getElementById('customPromptModal');
            const promptInput = DOMUtils.getElementById('promptInput');
            const promptOkBtn = DOMUtils.getElementById('promptOkBtn');

            if (promptTitle && promptMessage && promptModal && promptInput && promptOkBtn) {
                DOMUtils.safeSetTextContent(promptTitle, `${icon} ${title}`);
                DOMUtils.safeSetInnerHTML(promptMessage, message.replace(/\n/g, '<br>'));

                // 设置输入框
                promptInput.value = defaultValue;
                promptInput.placeholder = placeholder;

                DOMUtils.safeAddClass(promptModal, 'active');

                // 自动聚焦到输入框
                setTimeout(() => {
                    promptInput.focus();
                    if (defaultValue) {
                        promptInput.select();
                    }
                }, 100);

                // 设置确认按钮回调
                const handleConfirm = () => {
                    const inputValue = promptInput.value.trim();
                    if (onConfirm) {
                        onConfirm(inputValue);
                    }
                    closeCustomPrompt();
                };

                // 绑定确认按钮事件
                promptOkBtn.onclick = handleConfirm;

                // 绑定Enter键事件
                promptInput.onkeydown = function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleConfirm();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        closeCustomPrompt();
                    }
                };
            }
        }

        /**
         * 关闭自定义输入弹窗
         */
        function closeCustomPrompt() {
            const promptModal = DOMUtils.getElementById('customPromptModal');
            const promptInput = DOMUtils.getElementById('promptInput');

            if (promptModal) {
                DOMUtils.safeRemoveClass(promptModal, 'active');
            }

            if (promptInput) {
                promptInput.value = '';
                promptInput.onkeydown = null;
            }

            const promptOkBtn = DOMUtils.getElementById('promptOkBtn');
            if (promptOkBtn) {
                promptOkBtn.onclick = null;
            }
        }

        // Handle ESC key for custom modals
        EventManager.addEventListener(document, 'keydown', function(e) {
            if (e.key === 'Escape') {
                // Close custom alert if open
                const alertModal = DOMUtils.getElementById('customAlertModal');
                const confirmModal = DOMUtils.getElementById('customConfirmModal');
                const promptModal = DOMUtils.getElementById('customPromptModal');
                const diffModal = DOMUtils.getElementById('diffModal');

                if (alertModal && alertModal.classList.contains('active')) {
                    closeCustomAlert();
                    e.stopPropagation();
                } else if (confirmModal && confirmModal.classList.contains('active')) {
                    closeCustomConfirm();
                    e.stopPropagation();
                } else if (promptModal && promptModal.classList.contains('active')) {
                    closeCustomPrompt();
                    e.stopPropagation();
                } else if (diffModal && diffModal.classList.contains('active')) {
                    closeDiffModal();
                    e.stopPropagation();
                }
            }
        });

        // 改进的初始化系统
        function initializeApplication() {
            console.log('DOM Content Loaded, initializing...');

            // 步骤1: 初始化核心系统
            initializeNavigation();
            initializeKeyboardShortcuts();

            // 步骤2: 初始化增强功能模块
            try {
                console.log('Initializing enhanced modules...');

                // 初始化搜索管理器
                SearchManager.init();
                console.log('✅ SearchManager initialized');

                // 初始化语法高亮器
                SyntaxHighlighter.init();
                console.log('✅ SyntaxHighlighter initialized');

                // 初始化行内编辑器
                InlineEditor.init();
                console.log('✅ InlineEditor initialized');

                // 初始化差异分析器
                DiffAnalyzer.init();
                console.log('✅ DiffAnalyzer initialized');

                // 初始化Git工作流模块
                GitWorkflow.init();
                console.log('✅ GitWorkflow initialized');

                // 初始化团队协作模块
                TeamCollaboration.init();
                console.log('✅ TeamCollaboration initialized');

                // 初始化冲突解决器
                ConflictResolver.init();
                console.log('✅ ConflictResolver initialized');

                // 初始化性能管理器
                PerformanceManager.init();
                console.log('✅ PerformanceManager initialized');

                // 初始化可访问性管理器
                AccessibilityManager.init();
                console.log('✅ AccessibilityManager initialized');

            } catch (error) {
                console.error('Error initializing enhanced modules:', error);
                // 即使增强模块失败，也要继续基础功能
            }

            // 步骤3: 设置初始状态
            AppState.updateView('branches');

            // 步骤4: 验证初始化完成
            validateInitialization();

            console.log('🚀 AI-Commit TUI initialization completed with enhanced features!');
        }

        function validateInitialization() {
            const dynamicList = DOMUtils.getElementById('dynamicList');
            const currentViewElement = DOMUtils.getElementById('currentView');

            if (!dynamicList || !currentViewElement) {
                console.error('Critical DOM elements not found, retrying...');
                // 如果关键元素不存在，短暂延迟后重试
                setTimeout(validateInitialization, 50);
                return;
            }

            // 确保视图正确显示
            if (currentView === 'branches') {
                const branchNames = AppData.getBranches();
                selectBranch(0, branchNames[0]);
                updateMainGitLogForBranch(0, branchNames[0]);
                selectMainCommit('18c4a3a');
                updateBranchesVisuialFocus();
            }

            console.log('Application initialization completed successfully');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', initializeApplication);

        // Navigation
        function initializeNavigation() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                EventManager.addEventListener(tab, 'click', () => {
                    const view = tab.dataset.view;
                    switchView(view);
                });
            });

            // Commit items
            const commits = document.querySelectorAll('.commit-item');
            commits.forEach(commit => {
                EventManager.addEventListener(commit, 'click', () => {
                    selectCommitElement(commit);
                });
            });

            // 初始化静态按钮事件
            initializeStaticButtons();
        }

        function initializeStaticButtons() {
            // 分支操作按钮
            const checkoutBtn = DOMUtils.querySelector('button[onclick="checkoutBranch()"]');
            if (checkoutBtn) {
                checkoutBtn.removeAttribute('onclick');
                EventManager.addEventListener(checkoutBtn, 'click', checkoutBranch);
            }

            const createBtn = DOMUtils.querySelector('button[onclick="createBranch()"]');
            if (createBtn) {
                createBtn.removeAttribute('onclick');
                EventManager.addEventListener(createBtn, 'click', createBranch);
            }

            const deleteBtn = DOMUtils.querySelector('button[onclick="deleteBranch()"]');
            if (deleteBtn) {
                deleteBtn.removeAttribute('onclick');
                EventManager.addEventListener(deleteBtn, 'click', deleteBranch);
            }

            const refreshBtn = DOMUtils.querySelector('button[onclick="refreshView()"]');
            if (refreshBtn) {
                refreshBtn.removeAttribute('onclick');
                EventManager.addEventListener(refreshBtn, 'click', refreshView);
            }

            // 处理自定义模态框按钮
            handleCustomModalButtons();

            // 处理冲突解决相关按钮
            handleConflictResolutionButtons();

            // 处理 Meld 差异查看器按钮
            handleMeldDiffViewerButtons();

            // 处理 Git 工作流按钮
            handleGitWorkflowButtons();

            // 设置事件委托来处理动态生成的按钮
            setupEventDelegation();

            // 清理剩余的 onclick 属性（但不显示警告，因为有些是动态生成的）
            document.querySelectorAll('[onclick]').forEach(element => {
                const onclick = element.getAttribute('onclick');
                if (onclick && !onclick.includes('showWorkflowTab')) {
                    // 只对非动态生成的按钮显示调试信息
                    console.debug('Remaining onclick attribute:', onclick);
                }
            });
        }

        // 设置事件委托
        function setupEventDelegation() {
            console.log('Setting up event delegation for dynamic buttons...');

            // 为整个文档设置事件委托
            document.addEventListener('click', function(event) {
                const target = event.target;

                // 检查是否是 resolveConflict 按钮
                if (target.matches('button[onclick^="resolveConflict("]')) {
                    console.log('Event delegation: resolveConflict button clicked');
                    event.preventDefault();

                    const onclick = target.getAttribute('onclick');
                    const match = onclick.match(/resolveConflict\(['"]([^'"]+)['"]\)/);
                    if (match) {
                        const filePath = match[1];
                        console.log(`Event delegation: calling resolveConflict('${filePath}')`);
                        resolveConflict(filePath);
                    }
                    return;
                }

                // 检查是否是其他冲突解决按钮
                if (target.matches('button[onclick="continueOperation()"]')) {
                    event.preventDefault();
                    continueOperation();
                    return;
                }

                if (target.matches('button[onclick="abortOperation()"]')) {
                    event.preventDefault();
                    abortOperation();
                    return;
                }

                // 检查是否是 Meld 差异查看器按钮
                if (target.matches('button[onclick^="MeldDiffViewer."]')) {
                    event.preventDefault();
                    const onclick = target.getAttribute('onclick');

                    if (onclick.includes('previousDiff')) {
                        MeldDiffViewer.previousDiff();
                    } else if (onclick.includes('nextDiff')) {
                        MeldDiffViewer.nextDiff();
                    } else if (onclick.includes('syncScroll')) {
                        MeldDiffViewer.syncScroll();
                    }
                    return;
                }

                // 其他动态按钮处理
                const dynamicHandlers = {
                    'closeConflictResolution()': closeConflictResolution,
                    'resetConflictResolution()': resetConflictResolution,
                    'previewConflictResult()': previewConflictResult,
                    'saveConflictResolution()': saveConflictResolution,
                    'closeCustomAlert()': closeCustomAlert,
                    'closeCustomConfirm()': closeCustomConfirm,
                    'closeCustomPrompt()': closeCustomPrompt,
                };

                const onclick = target.getAttribute('onclick');
                if (onclick && dynamicHandlers[onclick]) {
                    event.preventDefault();
                    dynamicHandlers[onclick]();
                    return;
                }
            });
        }

        // 处理自定义模态框按钮
        function handleCustomModalButtons() {
            // closeCustomAlert buttons
            document.querySelectorAll('[onclick="closeCustomAlert()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', closeCustomAlert);
            });

            // closeCustomConfirm buttons
            document.querySelectorAll('[onclick="closeCustomConfirm()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', closeCustomConfirm);
            });

            // closeCustomPrompt buttons
            document.querySelectorAll('[onclick="closeCustomPrompt()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', closeCustomPrompt);
            });
        }

        // 处理冲突解决相关按钮
        function handleConflictResolutionButtons() {
            // resolveConflict buttons with parameters
            const resolveButtons = document.querySelectorAll('[onclick^="resolveConflict("]');
            console.log(`Found ${resolveButtons.length} resolve conflict buttons`);

            resolveButtons.forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                console.log(`Processing button with onclick: ${onclick}`);
                const match = onclick.match(/resolveConflict\(['"]([^'"]+)['"]\)/);
                if (match) {
                    const filePath = match[1];
                    console.log(`Binding event for file: ${filePath}`);
                    btn.removeAttribute('onclick');
                    EventManager.addEventListener(btn, 'click', () => {
                        console.log(`Resolve conflict button clicked for: ${filePath}`);
                        resolveConflict(filePath);
                    });
                } else {
                    console.warn(`Failed to parse onclick: ${onclick}`);
                }
            });

            // closeConflictResolution buttons
            document.querySelectorAll('[onclick="closeConflictResolution()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', closeConflictResolution);
            });

            // resetConflictResolution buttons
            document.querySelectorAll('[onclick="resetConflictResolution()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', resetConflictResolution);
            });

            // previewConflictResult buttons
            document.querySelectorAll('[onclick="previewConflictResult()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', previewConflictResult);
            });

            // saveConflictResolution buttons
            document.querySelectorAll('[onclick="saveConflictResolution()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', saveConflictResolution);
            });

            // continueOperation buttons
            document.querySelectorAll('[onclick="continueOperation()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', continueOperation);
            });

            // abortOperation buttons
            document.querySelectorAll('[onclick="abortOperation()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', abortOperation);
            });
        }

        // 处理 Meld 差异查看器按钮
        function handleMeldDiffViewerButtons() {
            // MeldDiffViewer.previousDiff buttons
            document.querySelectorAll('[onclick="MeldDiffViewer.previousDiff()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', () => MeldDiffViewer.previousDiff());
            });

            // MeldDiffViewer.nextDiff buttons
            document.querySelectorAll('[onclick="MeldDiffViewer.nextDiff()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', () => MeldDiffViewer.nextDiff());
            });

            // MeldDiffViewer.syncScroll buttons
            document.querySelectorAll('[onclick="MeldDiffViewer.syncScroll()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', () => MeldDiffViewer.syncScroll());
            });
        }

        // 处理 Git 工作流按钮
        function handleGitWorkflowButtons() {
            // startInteractiveRebase buttons
            document.querySelectorAll('[onclick="startInteractiveRebase()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', startInteractiveRebase);
            });

            // executeRebase buttons
            document.querySelectorAll('[onclick="executeRebase()"]').forEach(btn => {
                btn.removeAttribute('onclick');
                EventManager.addEventListener(btn, 'click', executeRebase);
            });

            // GitWorkflow method calls
            document.querySelectorAll('[onclick^="GitWorkflow."]').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                const match = onclick.match(/GitWorkflow\.(\w+)\(\)/);
                if (match) {
                    const methodName = match[1];
                    btn.removeAttribute('onclick');
                    EventManager.addEventListener(btn, 'click', () => {
                        if (GitWorkflow && typeof GitWorkflow[methodName] === 'function') {
                            GitWorkflow[methodName]();
                        }
                    });
                }
            });

            // Other Git workflow related buttons
            const workflowButtons = [
                'createBranch', 'deleteBranch', 'mergeBranch',
                'createTag', 'deleteTag', 'pushTag',
                'stashSave', 'stashPop', 'stashApply', 'stashDrop',
                'startFeature', 'finishFeature', 'startRelease',
                'finishRelease', 'startHotfix', 'finishHotfix'
            ];

            workflowButtons.forEach(funcName => {
                document.querySelectorAll(`[onclick="${funcName}()"]`).forEach(btn => {
                    btn.removeAttribute('onclick');
                    EventManager.addEventListener(btn, 'click', () => {
                        if (window[funcName] && typeof window[funcName] === 'function') {
                            window[funcName]();
                        }
                    });
                });
            });
        }

        function switchView(view) {
            // Update tabs with safety check
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            const targetTab = document.querySelector(`.nav-tab[data-view="${view}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }

            // Update views with safety check
            document.querySelectorAll('.view-container').forEach(container => {
                container.classList.remove('active');
            });
            const targetView = document.getElementById(`${view}View`);
            if (targetView) {
                targetView.classList.add('active');
            }

            // 使用统一状态管理系统
            AppState.updateView(view);
            // 自动同步状态，不需要手动同步

            // 处理特殊视图的额外逻辑
            if (view === 'status') {
                // Auto-select first file in status view
                setTimeout(() => {
                    const firstFile = document.querySelector('#statusView .file-item');
                    if (firstFile) {
                        selectedFileIndex = 0;
                        AppState.selectedFileIndex = 0;
                        firstFile.classList.add('selected');
                    }
                }, 100);
            } else if (view === 'stash') {
                selectedStashIndex = 0;
                AppState.selectedStashIndex = 0;
                updateStashDetails(0, 'stash@{0}');
            } else if (view === 'branches') {
                updateBranchesVisuialFocus();
            } else if (view === 'workflow') {
                // Initialize Git workflow view
                if (typeof GitWorkflow !== 'undefined') {
                    // Make sure the active tab is shown
                    showWorkflowTab('rebase');
                }
                updateDynamicList(view);
            } else if (view === 'collaboration') {
                // Initialize team collaboration view
                if (typeof TeamCollaboration !== 'undefined') {
                    // Make sure the active tab is shown
                    showCollaborationTab('pullrequests');
                }
                updateDynamicList(view);
            }
        }

        // Tab management functions for new views
        function showWorkflowTab(tabName) {
            // Remove active class from all workflow tabs
            document.querySelectorAll('.workflow-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.workflow-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Activate selected tab
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            const activeContent = document.getElementById(`${tabName}Tab`);

            if (activeBtn) activeBtn.classList.add('active');
            if (activeContent) activeContent.classList.add('active');

            // 调用 GitWorkflow 的方法来加载内容
            if (typeof GitWorkflow !== 'undefined' && GitWorkflow.switchWorkflowTab) {
                console.log(`Calling GitWorkflow.switchWorkflowTab('${tabName}')`);
                GitWorkflow.switchWorkflowTab(tabName);
            }

            // 在切换到冲突解决标签页时重新绑定事件（作为备用）
            if (tabName === 'conflicts') {
                console.log('Switching to conflicts tab, rebinding events...');
                setTimeout(() => {
                    handleConflictResolutionButtons();
                }, 200);
            }
        }

        function showCollaborationTab(tabName) {
            // Remove active class from all collaboration tabs
            document.querySelectorAll('.collaboration-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.collaboration-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Activate selected tab
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            const activeContent = document.getElementById(`${tabName}Tab`);

            if (activeBtn) activeBtn.classList.add('active');
            if (activeContent) activeContent.classList.add('active');
        }

        // Workflow action functions
        function startInteractiveRebase() {
            showCustomAlert('🔄 开始交互式变基操作<br><br>正在分析提交历史...', '交互式变基', '🔄');
        }

        function executeRebase() {
            showCustomAlert('✅ 执行变基操作完成<br><br>提交历史已重新整理', '变基完成', '✅');
        }

        function previewRebase() {
            showCustomAlert('👁️ 变基预览<br><br>将合并2个提交，删除1个提交', '变基预览', '👁️');
        }

        function resetRebase() {
            showCustomAlert('🔄 已重置变基操作<br><br>恢复到初始状态', '重置变基', '🔄');
        }

        function executeMerge() {
            showCustomAlert('🔀 执行合并操作<br><br>feature/auth → main 合并成功', '合并完成', '🔀');
        }

        function startFeature() {
            showCustomPrompt('输入 Feature 分支名称:', (name) => {
                if (name) {
                    showCustomAlert(`🌱 已创建 Feature 分支: feature/${name}`, 'Git Flow', '🌱');
                }
            }, 'Git Flow Feature', '🌱', '', '例如: user-authentication');
        }

        function finishFeature() {
            showCustomAlert('✅ Feature 分支已完成<br><br>已合并到 develop 分支', 'Git Flow', '✅');
        }

        function listFeatures() {
            showCustomAlert('📋 当前 Feature 分支:<br><br>• feature/auth<br>• feature/dashboard<br>• feature/api-refactor', 'Git Flow', '📋');
        }

        function startRelease() {
            showCustomPrompt('输入 Release 版本号:', (version) => {
                if (version) {
                    showCustomAlert(`🚀 已创建 Release 分支: release/${version}`, 'Git Flow', '🚀');
                }
            }, 'Git Flow Release', '🚀', '', '例如: 1.2.0');
        }

        function finishRelease() {
            showCustomAlert('✅ Release 分支已完成<br><br>已合并到 main 和 develop', 'Git Flow', '✅');
        }

        function startHotfix() {
            showCustomPrompt('输入 Hotfix 版本号:', (version) => {
                if (version) {
                    showCustomAlert(`🚨 已创建 Hotfix 分支: hotfix/${version}`, 'Git Flow', '🚨');
                }
            }, 'Git Flow Hotfix', '🚨', '', '例如: 1.1.1');
        }

        function finishHotfix() {
            showCustomAlert('✅ Hotfix 分支已完成<br><br>已合并到 main 和 develop', 'Git Flow', '✅');
        }

        // ========================================
        // 🔥 Meld-Style Diff Viewer System
        // ========================================

        const MeldDiffViewer = {
            syncScrollEnabled: true,
            currentDiffIndex: 0,
            diffBlocks: [],

            init() {
                console.log('MeldDiffViewer.init() called');

                // 检查必要的 DOM 元素
                const container = document.getElementById('meldDiffContainer');
                if (!container) {
                    console.warn('meldDiffContainer not found, will check again when needed');
                } else {
                    console.log('✅ meldDiffContainer found');
                }

                this.setupSyncScroll();
                this.bindEvents();
                console.log('MeldDiffViewer initialization complete');
            },

            // 生成 Meld 风格的逐行差异视图
            generateDiffView(currentContent, incomingContent, resultContent = '') {
                console.log('generateDiffView called');
                console.log('Current content length:', currentContent.length);
                console.log('Incoming content length:', incomingContent.length);

                const currentLines = currentContent.split('\n');
                const incomingLines = incomingContent.split('\n');
                const resultLines = resultContent ? resultContent.split('\n') : [];

                console.log('Lines split - current:', currentLines.length, 'incoming:', incomingLines.length);

                const diffData = this.computeDiff(currentLines, incomingLines);
                const container = document.getElementById('meldDiffContainer');

                if (!container) {
                    console.error('meldDiffContainer not found!');
                    // 尝试查找并创建容器
                    const modalBody = document.querySelector('.conflict-modal-body');
                    if (modalBody) {
                        const newContainer = document.createElement('div');
                        newContainer.id = 'meldDiffContainer';
                        newContainer.className = 'meld-diff-container';
                        modalBody.appendChild(newContainer);
                        console.log('Created new meldDiffContainer');
                    } else {
                        console.error('Cannot create container - modal body not found');
                        return;
                    }
                }

                const finalContainer = document.getElementById('meldDiffContainer');
                if (!finalContainer) {
                    console.error('Still no container after creation attempt');
                    return;
                }

                console.log('Clearing container and generating diff view');
                finalContainer.innerHTML = '';
                this.diffBlocks = [];

                let currentLineNum = 1;
                let incomingLineNum = 1;
                let resultLineNum = 1;

                console.log('Processing', diffData.length, 'diff blocks');

                diffData.forEach((block, blockIndex) => {
                    if (block.type === 'conflict') {
                        this.diffBlocks.push({
                            index: blockIndex,
                            element: null,
                            type: 'conflict'
                        });

                        // 添加冲突块标记
                        this.addConflictBlockHeader(finalContainer, blockIndex);
                    }

                    block.lines.forEach((line, lineIndex) => {
                        this.addDiffLine(
                            finalContainer,
                            line,
                            currentLineNum,
                            incomingLineNum,
                            resultLineNum,
                            blockIndex,
                            lineIndex
                        );

                        if (line.type !== 'deleted') currentLineNum++;
                        if (line.type !== 'added') incomingLineNum++;
                        if (line.type !== 'empty') resultLineNum++;
                    });
                });

                console.log('Diff view generation completed');

                // 安全调用更新方法
                if (typeof this.updateStats === 'function') {
                    this.updateStats();
                } else {
                    console.warn('updateStats method not found');
                }

                if (typeof this.updateNavigation === 'function') {
                    this.updateNavigation();
                } else {
                    console.warn('updateNavigation method not found');
                }

                console.log('generateDiffView completed successfully');
            },

            // 计算差异数据
            computeDiff(currentLines, incomingLines) {
                console.log('computeDiff called with', currentLines.length, 'current lines and', incomingLines.length, 'incoming lines');
                const diffBlocks = [];
                let currentIndex = 0;
                let incomingIndex = 0;
                let maxIterations = (currentLines.length + incomingLines.length) * 2; // 防止无限循环
                let iterations = 0;

                while (currentIndex < currentLines.length || incomingIndex < incomingLines.length) {
                    iterations++;
                    if (iterations > maxIterations) {
                        console.error('computeDiff: Maximum iterations exceeded, breaking loop');
                        break;
                    }

                    const currentLine = currentLines[currentIndex] || '';
                    const incomingLine = incomingLines[incomingIndex] || '';

                    if (currentLine === incomingLine) {
                        // 相同行
                        diffBlocks.push({
                            type: 'unchanged',
                            lines: [{
                                type: 'unchanged',
                                current: currentLine,
                                incoming: incomingLine,
                                result: currentLine
                            }]
                        });
                        currentIndex++;
                        incomingIndex++;
                    } else {
                        // 发现差异，创建冲突块
                        const conflictBlock = {
                            type: 'conflict',
                            lines: []
                        };

                        // 简化的差异处理 - 收集连续的不同行
                        const startCurrentIndex = currentIndex;
                        const startIncomingIndex = incomingIndex;

                        // 找到下一个相同的行
                        let nextMatchCurrent = -1;
                        let nextMatchIncoming = -1;

                        // 查找下一个匹配点
                        for (let i = currentIndex; i < Math.min(currentIndex + 10, currentLines.length); i++) {
                            for (let j = incomingIndex; j < Math.min(incomingIndex + 10, incomingLines.length); j++) {
                                if (currentLines[i] === incomingLines[j]) {
                                    nextMatchCurrent = i;
                                    nextMatchIncoming = j;
                                    break;
                                }
                            }
                            if (nextMatchCurrent !== -1) break;
                        }

                        // 如果没有找到匹配，处理剩余的所有行
                        if (nextMatchCurrent === -1) {
                            nextMatchCurrent = currentLines.length;
                            nextMatchIncoming = incomingLines.length;
                        }

                        // 添加删除的行
                        for (let i = currentIndex; i < nextMatchCurrent; i++) {
                            conflictBlock.lines.push({
                                type: 'deleted',
                                current: currentLines[i],
                                incoming: '',
                                result: ''
                            });
                        }

                        // 添加新增的行
                        for (let j = incomingIndex; j < nextMatchIncoming; j++) {
                            conflictBlock.lines.push({
                                type: 'added',
                                current: '',
                                incoming: incomingLines[j],
                                result: incomingLines[j]
                            });
                        }

                        if (conflictBlock.lines.length > 0) {
                            diffBlocks.push(conflictBlock);
                        }

                        currentIndex = nextMatchCurrent;
                        incomingIndex = nextMatchIncoming;
                    }
                }

                console.log('computeDiff completed with', diffBlocks.length, 'blocks');
                return diffBlocks;
            },

            // 添加冲突块头部
            addConflictBlockHeader(container, blockIndex) {
                const header = document.createElement('div');
                header.className = 'conflict-block-header';
                header.style.gridColumn = '1 / -1';
                header.innerHTML = `⚡ 冲突块 ${blockIndex + 1}`;
                container.appendChild(header);
            },

            // 添加差异行
            addDiffLine(container, line, currentLineNum, incomingLineNum, resultLineNum, blockIndex, lineIndex) {
                // 当前版本行号
                const currentNumDiv = document.createElement('div');
                currentNumDiv.className = 'line-numbers';
                currentNumDiv.textContent = line.type === 'added' ? '' : currentLineNum;

                // 当前版本内容
                const currentDiv = document.createElement('div');
                currentDiv.className = `diff-content diff-line diff-line-${line.type}`;
                currentDiv.textContent = line.current;
                currentDiv.onclick = () => this.selectLine(currentDiv, 'current');

                // 合并操作按钮
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'conflict-merge-actions';
                if (line.type === 'deleted' || line.type === 'added') {
                    actionsDiv.innerHTML = `
                        <button class="merge-action-btn left-to-result"
                                onclick="MeldDiffViewer.copyToResult('current', ${blockIndex}, ${lineIndex})"
                                title="复制到结果">
                            ← 📍
                        </button>
                        <button class="merge-action-btn right-to-result"
                                onclick="MeldDiffViewer.copyToResult('incoming', ${blockIndex}, ${lineIndex})"
                                title="复制到结果">
                            📥 →
                        </button>
                    `;
                }

                // 传入版本内容
                const incomingDiv = document.createElement('div');
                incomingDiv.className = `diff-content diff-line diff-line-${line.type}`;
                incomingDiv.textContent = line.incoming;
                incomingDiv.onclick = () => this.selectLine(incomingDiv, 'incoming');

                // 传入版本行号
                const incomingNumDiv = document.createElement('div');
                incomingNumDiv.className = 'line-numbers';
                incomingNumDiv.textContent = line.type === 'deleted' ? '' : incomingLineNum;

                // 结果内容
                const resultDiv = document.createElement('div');
                resultDiv.className = `diff-content diff-line diff-line-${line.type}`;
                resultDiv.contentEditable = true;
                resultDiv.textContent = line.result;
                resultDiv.oninput = () => this.onResultEdit(resultDiv, blockIndex, lineIndex);

                // 添加到容器
                container.appendChild(currentNumDiv);
                container.appendChild(currentDiv);
                container.appendChild(actionsDiv);
                container.appendChild(incomingDiv);
                container.appendChild(incomingNumDiv);
                container.appendChild(resultDiv);
            },

            // 复制到结果列
            copyToResult(source, blockIndex, lineIndex) {
                const container = document.getElementById('meldDiffContainer');
                const resultElements = container.querySelectorAll('.diff-content[contenteditable="true"]');
                const targetIndex = this.calculateResultIndex(blockIndex, lineIndex);

                if (resultElements[targetIndex]) {
                    const sourceElements = container.querySelectorAll(
                        source === 'current' ? '.diff-content:nth-child(6n+2)' : '.diff-content:nth-child(6n+4)'
                    );
                    if (sourceElements[targetIndex]) {
                        resultElements[targetIndex].textContent = sourceElements[targetIndex].textContent;
                        resultElements[targetIndex].classList.add('line-selected');
                        setTimeout(() => {
                            resultElements[targetIndex].classList.remove('line-selected');
                        }, 1000);
                    }
                }
            },

            // 计算结果列索引
            calculateResultIndex(blockIndex, lineIndex) {
                // 简化计算，实际应该更精确
                return blockIndex * 10 + lineIndex;
            },

            // 选择行
            selectLine(element, source) {
                // 移除之前的选择
                document.querySelectorAll('.line-selected').forEach(el => {
                    el.classList.remove('line-selected');
                });

                element.classList.add('line-selected');
            },

            // 结果编辑事件
            onResultEdit(element, blockIndex, lineIndex) {
                element.classList.add('diff-line-modified');
                ConflictResolver.updateConflictData();
            },

            // 设置同步滚动
            setupSyncScroll() {
                const container = document.getElementById('meldDiffContainer');
                if (!container) return;

                let isScrolling = false;

                container.addEventListener('scroll', (e) => {
                    if (!this.syncScrollEnabled || isScrolling) return;

                    isScrolling = true;
                    // 同步滚动逻辑
                    setTimeout(() => { isScrolling = false; }, 100);
                });
            },

            // 绑定事件
            bindEvents() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'ArrowUp':
                                e.preventDefault();
                                this.previousDiff();
                                break;
                            case 'ArrowDown':
                                e.preventDefault();
                                this.nextDiff();
                                break;
                        }
                    }
                });
            },

            // 导航到上一个差异
            previousDiff() {
                if (this.currentDiffIndex > 0) {
                    this.currentDiffIndex--;
                    this.scrollToDiff(this.currentDiffIndex);
                }
                this.updateNavigation();
            },

            // 导航到下一个差异
            nextDiff() {
                if (this.currentDiffIndex < this.diffBlocks.length - 1) {
                    this.currentDiffIndex++;
                    this.scrollToDiff(this.currentDiffIndex);
                }
                this.updateNavigation();
            },

            // 滚动到指定差异
            scrollToDiff(index) {
                const headers = document.querySelectorAll('.conflict-block-header');
                if (headers[index]) {
                    headers[index].scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });

                    // 高亮当前冲突块
                    document.querySelectorAll('.conflict-block').forEach(el => {
                        el.classList.remove('conflict-block');
                    });

                    headers[index].classList.add('conflict-block');
                }
            },

            // 切换同步滚动
            syncScroll() {
                this.syncScrollEnabled = !this.syncScrollEnabled;
                const btn = document.getElementById('syncScrollBtn');
                if (btn) {
                    btn.textContent = this.syncScrollEnabled ? '🔄 同步滚动' : '🔄 独立滚动';
                    btn.style.background = this.syncScrollEnabled ? '#28a745' : '#6c757d';
                }
            },

            // 更新统计信息
            updateStats() {
                const container = document.getElementById('meldDiffContainer');
                if (!container) return;

                const addedLines = container.querySelectorAll('.diff-line-added').length;
                const deletedLines = container.querySelectorAll('.diff-line-deleted').length;
                const modifiedLines = container.querySelectorAll('.diff-line-modified').length;

                document.getElementById('addedLines').textContent = addedLines;
                document.getElementById('deletedLines').textContent = deletedLines;
                document.getElementById('modifiedLines').textContent = modifiedLines;
            },

            // 更新导航按钮状态
            updateNavigation() {
                const prevBtn = document.getElementById('prevDiffBtn');
                const nextBtn = document.getElementById('nextDiffBtn');

                if (prevBtn) prevBtn.disabled = this.currentDiffIndex === 0;
                if (nextBtn) nextBtn.disabled = this.currentDiffIndex >= this.diffBlocks.length - 1;
            }
        };

        // ========================================
        // ⚡ Enhanced Conflict Resolution System
        // ========================================

        const ConflictResolver = {
            conflictFiles: [],
            currentFileIndex: 0,
            conflictData: {},
            resolvedConflicts: new Set(),

            // 模拟的冲突文件数据
            mockConflictFiles: [
                {
                    path: 'src/main.rs',
                    current: `fn main() {
    println!("Hello, World!");
    let version = "1.0.0";
    println!("Version: {}", version);
}`,
                    incoming: `fn main() {
    println!("Hello, Git World!");
    let version = "1.1.0";
    let author = "Developer";
    println!("Version: {} by {}", version, author);
}`,
                    conflicts: [
                        { startLine: 2, endLine: 2, type: 'content' },
                        { startLine: 3, endLine: 4, type: 'addition' }
                    ]
                },
                {
                    path: 'docs/README.md',
                    current: `# My Project

## Version 1.0

This is a simple project.

## Features
- Basic functionality`,
                    incoming: `# My Project

## Version 1.1

This is an awesome project with new features!

## Features
- Basic functionality
- Advanced features
- Bug fixes`,
                    conflicts: [
                        { startLine: 3, endLine: 3, type: 'content' },
                        { startLine: 5, endLine: 5, type: 'content' },
                        { startLine: 8, endLine: 9, type: 'addition' }
                    ]
                }
            ],

            init() {
                console.log('ConflictResolver.init() called');
                this.conflictFiles = this.mockConflictFiles;
                console.log('Mock conflict files loaded:', this.conflictFiles.length, 'files');

                // 确保模态框存在
                const modal = document.getElementById('conflictResolutionModal');
                if (!modal) {
                    console.error('❌ conflictResolutionModal not found in DOM!');
                    // 尝试在 DOMContentLoaded 后重新查找
                    setTimeout(() => {
                        const retryModal = document.getElementById('conflictResolutionModal');
                        console.log('Retry finding modal:', !!retryModal);
                    }, 500);
                } else {
                    console.log('✅ conflictResolutionModal found in DOM');
                    // 确保模态框默认隐藏
                    modal.style.display = 'none';
                }

                this.setupEventListeners();

                // 初始化 Meld 差异查看器
                if (typeof MeldDiffViewer !== 'undefined') {
                    MeldDiffViewer.init();
                    console.log('✅ MeldDiffViewer initialized');
                } else {
                    console.error('❌ MeldDiffViewer not found');
                }
            },

            setupEventListeners() {
                // 监听结果编辑区域的变化
                const resultContent = document.getElementById('resultContent');
                if (resultContent) {
                    resultContent.addEventListener('input', () => {
                        this.updateSaveButton();
                    });
                }
            },

            openConflictResolution(filePath) {
                console.log(`========================================`);
                console.log(`openConflictResolution called with: ${filePath}`);
                console.log(`Available conflict files:`, this.conflictFiles.map(f => f.path));

                // 如果 conflictFiles 是空的，重新初始化
                if (!this.conflictFiles || this.conflictFiles.length === 0) {
                    console.warn('No conflict files loaded, re-initializing...');
                    this.conflictFiles = this.mockConflictFiles;
                    console.log('Mock files reloaded:', this.conflictFiles.length, 'files');
                }

                // 查找指定文件的冲突数据
                const file = this.conflictFiles.find(f => f.path === filePath);
                if (!file) {
                    console.error(`File not found: ${filePath}`);
                    console.log('Available files:', this.conflictFiles.map(f => f.path).join(', '));
                    showCustomAlert(`❌ 找不到文件: ${filePath}`, '错误', '❌');
                    return;
                }

                console.log(`Found conflict file:`, file);
                this.currentFileIndex = this.conflictFiles.indexOf(file);

                // 查找并显示模态框
                const modal = document.getElementById('conflictResolutionModal');
                console.log(`Modal element found:`, !!modal);
                console.log(`Modal current display:`, modal ? modal.style.display : 'N/A');

                if (!modal) {
                    console.error('❌ Modal element not found! Checking if DOM is ready...');

                    // 尝试创建一个简单的测试模态框
                    const testModal = document.createElement('div');
                    testModal.innerHTML = `
                        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                                    background: #2d2d30; border: 2px solid #007acc; border-radius: 8px;
                                    padding: 20px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.5);">
                            <h3 style="color: #d4d4d4; margin: 0 0 10px 0;">⚡ 冲突解决器</h3>
                            <p style="color: #d4d4d4;">文件: ${filePath}</p>
                            <p style="color: #9cdcfe;">模态框测试成功！原始模态框未找到。</p>
                            <button onclick="this.parentElement.parentElement.remove()"
                                    style="background: #007acc; color: white; border: none;
                                           padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                                关闭
                            </button>
                        </div>
                    `;
                    document.body.appendChild(testModal);
                    console.log('Created test modal as fallback');
                    return;
                }

                if (modal) {
                    // 确保模态框是可见的
                    modal.style.display = 'flex';
                    modal.style.position = 'fixed';
                    modal.style.zIndex = '10000';
                    console.log(`Modal display set to flex`);

                    // 更新文件名显示
                    const fileName = document.getElementById('conflictFileName');
                    if (fileName) {
                        fileName.textContent = file.path;
                        console.log(`File name updated to: ${file.path}`);
                    } else {
                        console.warn('conflictFileName element not found');
                    }

                    // 加载文件标签页
                    if (typeof this.loadFileTabs === 'function') {
                        this.loadFileTabs();
                        console.log('File tabs loaded');
                    } else {
                        console.warn('loadFileTabs method not found');
                    }

                    // 使用 Meld 风格显示差异
                    if (typeof MeldDiffViewer !== 'undefined' && typeof MeldDiffViewer.generateDiffView === 'function') {
                        console.log(`Calling MeldDiffViewer.generateDiffView`);
                        MeldDiffViewer.generateDiffView(file.current, file.incoming, file.result || '');
                    } else {
                        console.error('MeldDiffViewer or generateDiffView not found');
                        // 创建一个基本的差异显示作为后备
                        const diffContainer = document.querySelector('.meld-diff-container');
                        if (diffContainer) {
                            diffContainer.innerHTML = `
                                <div style="padding: 20px; color: #d4d4d4;">
                                    <h4>当前版本:</h4>
                                    <pre style="background: #1e1e1e; padding: 10px; border-radius: 4px;">${file.current}</pre>
                                    <h4>传入版本:</h4>
                                    <pre style="background: #1e1e1e; padding: 10px; border-radius: 4px;">${file.incoming}</pre>
                                </div>
                            `;
                        }
                    }

                    // 更新进度和状态
                    if (typeof this.updateProgress === 'function') {
                        this.updateProgress();
                    }
                    if (typeof this.updateSaveButton === 'function') {
                        this.updateSaveButton();
                    }

                    console.log(`Conflict resolution modal setup completed`);
                    console.log(`========================================`);
                } else {
                    console.error(`Modal element not found: conflictResolutionModal`);
                }
            },

            // 更新 ConflictResolver 以增加新的方法
            updateConflictData() {
                // 从 Meld 界面收集合并结果
                const container = document.getElementById('meldDiffContainer');
                if (container) {
                    const resultElements = container.querySelectorAll('.diff-content[contenteditable="true"]');
                    const currentFile = this.conflictFiles[this.currentFileIndex];

                    if (currentFile && resultElements.length > 0) {
                        const resultLines = Array.from(resultElements).map(el => el.textContent);
                        currentFile.result = resultLines.join('\n');
                        this.conflictData[currentFile.path] = currentFile.result;
                    }
                }
            },

            // 接受全部当前版本
            acceptAllCurrent() {
                const currentFile = this.conflictFiles[this.currentFileIndex];
                if (currentFile) {
                    MeldDiffViewer.generateDiffView(currentFile.current, currentFile.incoming, currentFile.current);
                    this.updateConflictData();
                    showCustomAlert('✅ 已接受全部当前版本更改', '合并操作', '✅');
                }
            },

            // 接受全部传入版本
            acceptAllIncoming() {
                const currentFile = this.conflictFiles[this.currentFileIndex];
                if (currentFile) {
                    MeldDiffViewer.generateDiffView(currentFile.current, currentFile.incoming, currentFile.incoming);
                    this.updateConflictData();
                    showCustomAlert('✅ 已接受全部传入版本更改', '合并操作', '✅');
                }
            },

            // 重置结果
            resetResult() {
                const currentFile = this.conflictFiles[this.currentFileIndex];
                if (currentFile) {
                    MeldDiffViewer.generateDiffView(currentFile.current, currentFile.incoming, '');
                    showCustomAlert('🔄 结果已重置', '重置操作', '🔄');
                }
            },

            // 关闭模态框
            closeModal() {
                const modal = document.getElementById('conflictResolutionModal');
                if (modal) {
                    modal.style.display = 'none';
                    modal.classList.remove('active');
                }
            },

            loadFileTabs() {
                const tabsContainer = document.getElementById('conflictFileTabs');
                if (!tabsContainer) return;

                tabsContainer.innerHTML = this.conflictFiles.map((file, index) => `
                    <button class="conflict-file-tab ${index === this.currentFileIndex ? 'active' : ''}"
                            onclick="ConflictResolver.switchToFile(${index})">
                        <span>⚠️</span>
                        <span>${file.path}</span>
                        ${this.resolvedConflicts.has(file.path) ? '<span style="color: #28a745;">✅</span>' : ''}
                    </button>
                `).join('');
            },

            switchToFile(index) {
                this.currentFileIndex = index;
                this.loadFileTabs();
                this.loadConflictContent(index);
                this.updateProgress();
            },

            loadConflictContent(index) {
                const file = this.conflictFiles[index];
                if (!file) return;

                // 更新文件名显示
                const fileNameElement = document.getElementById('conflictFileName');
                if (fileNameElement) {
                    fileNameElement.textContent = file.path;
                }

                // 解析和显示三方内容
                this.displayThreeWayContent(file);
            },

            displayThreeWayContent(file) {
                const currentLines = file.current.split('\n');
                const incomingLines = file.incoming.split('\n');

                // 显示当前版本
                this.renderContentPane('currentContent', currentLines, 'current');

                // 显示incoming版本
                this.renderContentPane('incomingContent', incomingLines, 'incoming');

                // 初始化结果版本为当前版本
                const savedResult = this.conflictData[file.path];
                const resultLines = savedResult ? savedResult.split('\n') : currentLines;
                this.renderContentPane('resultContent', resultLines, 'result', true);
            },

            renderContentPane(containerId, lines, type, editable = false) {
                const container = document.getElementById(containerId);
                if (!container) return;

                const file = this.conflictFiles[this.currentFileIndex];
                container.innerHTML = lines.map((line, index) => {
                    const lineNumber = index + 1;
                    const isConflictLine = this.isConflictLine(file, lineNumber);
                    const conflictClass = isConflictLine ? this.getConflictClass(file, lineNumber, type) : '';

                    return `
                        <div class="conflict-line ${conflictClass}" data-line="${lineNumber}">
                            <div class="line-number">${lineNumber}</div>
                            <div class="line-content">${this.escapeHtml(line)}</div>
                            ${editable ? '' : this.getLineActions(lineNumber, type)}
                        </div>
                    `;
                }).join('');

                // 为非可编辑区域添加点击事件
                if (!editable) {
                    container.querySelectorAll('.conflict-line').forEach(lineEl => {
                        lineEl.addEventListener('click', () => {
                            const lineNumber = parseInt(lineEl.dataset.line);
                            this.copyLineToResult(lineNumber, type);
                        });
                    });
                }
            },

            isConflictLine(file, lineNumber) {
                return file.conflicts.some(conflict =>
                    lineNumber >= conflict.startLine && lineNumber <= conflict.endLine
                );
            },

            getConflictClass(file, lineNumber, type) {
                const conflict = file.conflicts.find(c =>
                    lineNumber >= c.startLine && lineNumber <= c.endLine
                );

                if (!conflict) return '';

                if (conflict.startLine === conflict.endLine) {
                    return `conflict-start ${type}`;
                } else if (lineNumber === conflict.startLine) {
                    return `conflict-start ${type}`;
                } else if (lineNumber === conflict.endLine) {
                    return `conflict-end ${type}`;
                } else {
                    return `conflict-middle ${type}`;
                }
            },

            getLineActions(lineNumber, type) {
                return `
                    <div class="line-actions">
                        <button class="line-action-btn" onclick="ConflictResolver.copyLineToResult(${lineNumber}, '${type}')">
                            复制
                        </button>
                    </div>
                `;
            },

            copyLineToResult(lineNumber, sourceType) {
                const file = this.conflictFiles[this.currentFileIndex];
                const sourceLines = sourceType === 'current' ?
                    file.current.split('\n') : file.incoming.split('\n');

                const resultContainer = document.getElementById('resultContent');
                if (!resultContainer) return;

                const resultLines = resultContainer.textContent.split('\n');

                // 替换对应行
                if (lineNumber <= resultLines.length) {
                    resultLines[lineNumber - 1] = sourceLines[lineNumber - 1];

                    // 更新结果显示
                    this.renderContentPane('resultContent', resultLines, 'result', true);
                    resultContainer.textContent = resultLines.join('\n');

                    // 保存更改
                    this.conflictData[file.path] = resultLines.join('\n');
                    this.updateSaveButton();
                }
            },

            acceptAllCurrent() {
                const file = this.conflictFiles[this.currentFileIndex];
                this.conflictData[file.path] = file.current;
                this.loadConflictContent(this.currentFileIndex);
                this.updateSaveButton();
            },

            acceptAllIncoming() {
                const file = this.conflictFiles[this.currentFileIndex];
                this.conflictData[file.path] = file.incoming;
                this.loadConflictContent(this.currentFileIndex);
                this.updateSaveButton();
            },

            resetResult() {
                const file = this.conflictFiles[this.currentFileIndex];
                delete this.conflictData[file.path];
                this.loadConflictContent(this.currentFileIndex);
                this.updateSaveButton();
            },

            updateSaveButton() {
                const saveBtn = document.getElementById('saveConflictBtn');
                const hasChanges = Object.keys(this.conflictData).length > 0;

                if (saveBtn) {
                    saveBtn.disabled = !hasChanges;
                }
            },

            updateProgress() {
                const total = this.conflictFiles.length;
                const resolved = this.resolvedConflicts.size;
                const percentage = total > 0 ? (resolved / total) * 100 : 0;

                const progressFill = document.getElementById('conflictProgressFill');
                const progressText = document.getElementById('conflictProgressText');

                if (progressFill) {
                    progressFill.style.width = `${percentage}%`;
                }

                if (progressText) {
                    progressText.textContent = `${resolved}/${total} 已解决`;
                }
            },

            saveConflictResolution() {
                const file = this.conflictFiles[this.currentFileIndex];
                const resultContent = document.getElementById('resultContent');

                if (resultContent) {
                    this.conflictData[file.path] = resultContent.textContent;
                    this.resolvedConflicts.add(file.path);

                    showCustomAlert(
                        `✅ 冲突解决完成<br><br>文件: ${file.path}<br>已保存解决方案`,
                        '冲突解决',
                        '✅'
                    );

                    this.loadFileTabs();
                    this.updateProgress();
                    this.updateSaveButton();
                }
            },

            resetConflictResolution() {
                showCustomConfirm(
                    '⚠️ 确定要重置所有冲突解决方案吗？<br><br>所有未保存的更改将丢失',
                    () => {
                        this.conflictData = {};
                        this.resolvedConflicts.clear();
                        this.loadConflictContent(this.currentFileIndex);
                        this.updateProgress();
                        this.updateSaveButton();
                        showCustomAlert('🔄 冲突解决方案已重置', '重置完成', '🔄');
                    },
                    '重置确认',
                    '⚠️'
                );
            },

            previewConflictResult() {
                const file = this.conflictFiles[this.currentFileIndex];
                const resultContent = document.getElementById('resultContent');

                if (resultContent) {
                    const preview = resultContent.textContent || file.current;
                    showCustomAlert(
                        `<pre style="text-align: left; max-height: 300px; overflow-y: auto; background: #1e1e1e; padding: 12px; border-radius: 4px;">${this.escapeHtml(preview)}</pre>`,
                        `预览: ${file.path}`,
                        '👁️'
                    );
                }
            },

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        };

        // 更新原有的 resolveConflict 函数
        function resolveConflict(filePath) {
            console.log(`resolveConflict called with filePath: ${filePath}`);
            console.log(`ConflictResolver exists:`, typeof ConflictResolver);
            console.log(`openConflictResolution method exists:`, typeof ConflictResolver.openConflictResolution);

            try {
                ConflictResolver.openConflictResolution(filePath);
            } catch (error) {
                console.error(`Error in resolveConflict:`, error);
            }
        }

        // 新的冲突解决相关函数
        function closeConflictResolution() {
            ConflictResolver.closeModal();
        }

        function acceptAllCurrent() {
            ConflictResolver.acceptAllCurrent();
        }

        function acceptAllIncoming() {
            ConflictResolver.acceptAllIncoming();
        }

        function resetResult() {
            ConflictResolver.resetResult();
        }

        function resetConflictResolution() {
            ConflictResolver.resetConflictResolution();
        }

        function previewConflictResult() {
            ConflictResolver.previewConflictResult();
        }

        function saveConflictResolution() {
            ConflictResolver.saveConflictResolution();
        }

        function continueOperation() {
            showCustomAlert('✅ 继续操作成功<br><br>所有冲突已解决', '操作继续', '✅');
        }

        function abortOperation() {
            showCustomConfirm('❌ 确定要中止当前操作吗？<br><br>所有未保存的更改将丢失', () => {
                showCustomAlert('❌ 操作已中止<br><br>恢复到操作前状态', '操作中止', '❌');
            }, '中止操作', '❌');
        }

        // Collaboration action functions
        function createPullRequest() {
            showCustomAlert('➕ 创建 Pull Request<br><br>正在打开 PR 创建界面...', 'Pull Request', '➕');
        }

        function filterPRs(status) {
            showCustomAlert(`📋 过滤 Pull Requests: ${status}<br><br>显示${status === 'all' ? '全部' : status} PR`, '过滤器', '📋');
        }

        function approveReview(prId) {
            showCustomAlert(`✅ 已批准 PR #${prId}<br><br>代码审查通过`, '代码审查', '✅');
        }

        function requestChanges(prId) {
            showCustomAlert(`🔄 已请求修改 PR #${prId}<br><br>需要进一步调整`, '代码审查', '🔄');
        }

        function addComment(prId) {
            showCustomPrompt('添加评论:', (comment) => {
                if (comment) {
                    showCustomAlert(`💬 已添加评论到 PR #${prId}<br><br>"${comment}"`, '代码审查', '💬');
                }
            }, '添加评论', '💬', '', '请输入您的评论...');
        }

        function markAllRead() {
            showCustomAlert('✅ 所有通知已标记为已读', '通知', '✅');
        }

        function configureNotifications() {
            showCustomAlert('⚙️ 通知设置<br><br>正在打开通知配置界面...', '通知设置', '⚙️');
        }

        function refreshCollaborationData() {
            showCustomAlert('🔄 刷新协作数据<br><br>正在同步最新信息...', '数据刷新', '🔄');
        }

        // 其他状态变量（非AppState管理）
        let selectedCommitIndex = 0;
        let selectedRemoteIndex = 0;
        let selectedHistoryIndex = 0;
        let selectedTagIndex = 0;  // 添加缺失的变量
        let selectedTagCommitIndex = 0;  // Track selected commit in tags view
        let selectedBranchCommitIndex = 0;  // Track selected commit in branches view
        let selectedRemoteCommitIndex = 0;  // Track selected commit in remotes view
        let selectedStashFileIndex = 0;  // 添加缺失的变量
        let currentBranchIndex = 0; // 追踪当前实际所在的分支（带星标）

        function updateDynamicList(view) {
            const dynamicList = document.getElementById('dynamicList');
            if (!dynamicList) return;

            // 清理旧的事件监听器
            EventManager.cleanupContainer(dynamicList);

            let content = '';


            switch(view) {
                case 'git-log':
                    // Git Log 视图中显示当前选中分支信息和分支列表
                    const branchNames = ['main', 'feature/auth', 'develop', 'hotfix/v1.2'];
                    const selectedBranchName = branchNames[selectedBranchIndex] || 'main';
                    content = `
                        <div class="list-title">Git Log - ${selectedBranchName}</div>
                        <div style="margin-bottom: 12px; padding: 8px; background: #2d2d30; border-radius: 4px;">
                            <div style="color: #4ec9b0; font-weight: bold;">🔍 Viewing Branch:</div>
                            <div style="color: #cccccc; margin-top: 4px;">${selectedBranchName}</div>
                        </div>
                        <div class="list-title" style="margin-top: 16px;">Switch Branch:</div>
                        <div class="list-item ${selectedBranchIndex === 0 ? 'selected' : ''}" onclick="selectBranch(0, 'main')"><span class="icon">${currentBranchIndex === 0 ? '★' : ' '}</span> main</div>
                        <div class="list-item ${selectedBranchIndex === 1 ? 'selected' : ''}" onclick="selectBranch(1, 'feature/auth')"><span class="icon">${currentBranchIndex === 1 ? '★' : ' '}</span> feature/auth</div>
                        <div class="list-item ${selectedBranchIndex === 2 ? 'selected' : ''}" onclick="selectBranch(2, 'develop')"><span class="icon">${currentBranchIndex === 2 ? '★' : ' '}</span> develop</div>
                        <div class="list-item ${selectedBranchIndex === 3 ? 'selected' : ''}" onclick="selectBranch(3, 'hotfix/v1.2')"><span class="icon">${currentBranchIndex === 3 ? '★' : ' '}</span> hotfix/v1.2</div>
                    `;
                    break;
                case 'branches':
                    content = `
                        <div class="list-title">Branches List</div>
                        <div class="list-item ${selectedBranchIndex === 0 ? 'selected' : ''}" onclick="selectBranch(0, 'main')"><span class="icon">${currentBranchIndex === 0 ? '★' : ' '}</span> main</div>
                        <div class="list-item ${selectedBranchIndex === 1 ? 'selected' : ''}" onclick="selectBranch(1, 'feature/auth')"><span class="icon">${currentBranchIndex === 1 ? '★' : ' '}</span> feature/auth</div>
                        <div class="list-item ${selectedBranchIndex === 2 ? 'selected' : ''}" onclick="selectBranch(2, 'develop')"><span class="icon">${currentBranchIndex === 2 ? '★' : ' '}</span> develop</div>
                        <div class="list-item ${selectedBranchIndex === 3 ? 'selected' : ''}" onclick="selectBranch(3, 'hotfix/v1.2')"><span class="icon">${currentBranchIndex === 3 ? '★' : ' '}</span> hotfix/v1.2</div>
                    `;
                    break;
                case 'tags':
                    content = `
                        <div class="list-title">Tags List</div>
                        <div class="list-item ${selectedTagIndex === 0 ? 'selected' : ''}" onclick="selectTag(0, 'v2.1.0')">v2.1.0 [09-11]</div>
                        <div class="list-item ${selectedTagIndex === 1 ? 'selected' : ''}" onclick="selectTag(1, 'v2.0.5')">v2.0.5 [09-08]</div>
                        <div class="list-item ${selectedTagIndex === 2 ? 'selected' : ''}" onclick="selectTag(2, 'v2.0.0')">v2.0.0 [08-15]</div>
                    `;
                    break;
                case 'stash':
                    if (isStashMode) {
                        content = `
                            <div class="list-title">Stash Entries</div>
                            <div class="list-item ${selectedStashIndex === 0 ? 'selected' : ''}" onclick="selectStash(0, 'stash@{0}')"><span class="stash-icon">💾</span>stash@{0}: WIP on feature/auth: feat auth system</div>
                            <div class="list-item ${selectedStashIndex === 1 ? 'selected' : ''}" onclick="selectStash(1, 'stash@{1}')"><span class="stash-icon">💾</span>stash@{1}: WIP on develop: temp changes before merge</div>
                            <div class="list-item ${selectedStashIndex === 2 ? 'selected' : ''}" onclick="selectStash(2, 'stash@{2}')"><span class="stash-icon">💾</span>stash@{2}: WIP on main: fix UI layout issues</div>
                        `;
                    } else {
                        content = `
                            <div class="list-title">Recent Commits</div>
                            <div class="list-item ${selectedCommitIndex === 0 ? 'selected' : ''}" onclick="selectCommitByIndex(0, '18c4a3a')"><span class="commit-status">📝</span>18c4a3a fix(ui)</div>
                            <div class="list-item ${selectedCommitIndex === 1 ? 'selected' : ''}" onclick="selectCommitByIndex(1, '8502563')"><span class="commit-status">📝</span>8502563 fix(src)</div>
                            <div class="list-item ${selectedCommitIndex === 2 ? 'selected' : ''}" onclick="selectCommitByIndex(2, '5f49518')"><span class="commit-status">📝</span>5f49518 feat</div>
                        `;
                    }
                    break;
                case 'status':
                    content = `
                        <div class="list-title">Quick Actions</div>
                        <div class="list-item">[c] Commit</div>
                        <div class="list-item">[a] Add All</div>
                        <div class="list-item">[r] Reset</div>
                        <div class="list-item">[d] Discard</div>
                    `;
                    break;
                case 'remotes':
                    content = `
                        <div class="list-title">Remotes</div>
                        <div class="list-item ${selectedRemoteIndex === 0 ? 'selected' : ''}" onclick="selectRemote(0, 'origin')"><span class="remote-icon">📡</span>origin</div>
                        <div class="list-item ${selectedRemoteIndex === 1 ? 'selected' : ''}" onclick="selectRemote(1, 'upstream')"><span class="remote-icon">📡</span>upstream</div>
                    `;
                    break;
                case 'history':
                    content = `
                        <div class="list-title">Recent Searches</div>
                        <div class="list-item ${selectedHistoryIndex === 0 ? 'selected' : ''}" onclick="selectHistory(0, 'fix.*ui')"><span class="search-icon">🔍</span>fix.*ui</div>
                        <div class="list-item ${selectedHistoryIndex === 1 ? 'selected' : ''}" onclick="selectHistory(1, 'author:costa')"><span class="search-icon">🔍</span>author:costa</div>
                        <div class="list-item ${selectedHistoryIndex === 2 ? 'selected' : ''}" onclick="selectHistory(2, 'since:2024-09-01')"><span class="search-icon">🔍</span>since:2024-09-01</div>
                    `;
                    break;
            }

            console.log('Setting dynamicList content for view:', view, 'content length:', content.length);
            dynamicList.innerHTML = content;
            console.log('dynamicList innerHTML set, current content:', dynamicList.innerHTML.substring(0, 100));
        }

        function selectCommitElement(commitElement) {
            document.querySelectorAll('.commit-item').forEach(item => {
                item.classList.remove('selected');
            });
            commitElement.classList.add('selected');
            selectedCommit = commitElement.dataset.hash;
        }

        // Keyboard shortcuts
        function initializeKeyboardShortcuts() {
            EventManager.addEventListener(document, 'keydown', (e) => {
                // Check if any modal is open
                const isModalOpen = document.querySelector('.modal.active');
                const diffModal = document.getElementById('diffModal');
                const isDiffModalOpen = diffModal && diffModal.classList.contains('active');

                // Handle diff modal specific keys
                if (isDiffModalOpen) {
                    if (e.key === '1') {
                        e.preventDefault();
                        e.stopPropagation();
                        switchDiffMode('unified');
                        return;
                    }
                    if (e.key === '2') {
                        e.preventDefault();
                        e.stopPropagation();
                        switchDiffMode('side-by-side');
                        return;
                    }
                    if (e.key === '3') {
                        e.preventDefault();
                        e.stopPropagation();
                        switchDiffMode('split');
                        return;
                    }
                }

                // Number keys for navigation - only if no modal is open (扩展到支持8个视图)
                if (e.key >= '1' && e.key <= '8' && !isModalOpen) {
                    const views = ['branches', 'tags', 'stash', 'status', 'remotes', 'history', 'workflow', 'collaboration'];
                    const index = parseInt(e.key) - 1;
                    if (views[index]) {
                        switchView(views[index]);
                    }
                }

                // Ctrl+A for AI Commit - only if no modal is open
                if (e.ctrlKey && e.key === 'a' && !isModalOpen) {
                    e.preventDefault();
                    showAICommit();
                }

                // F5 for refresh - only if no modal is open
                if (e.key === 'F5' && !isModalOpen) {
                    e.preventDefault();
                    refreshView();
                }

                // Tab for focus switching in branches and stash views - only if no modal is open
                if (e.key === 'Tab' && !isModalOpen) {
                    e.preventDefault();
                    if (currentView === 'branches') {
                        toggleBranchesFocus();
                    } else if (currentView === 'stash' && isStashMode) {
                        toggleStashFocus();
                    }
                }

                // Enter for different actions based on current view and focus
                if (e.key === 'Enter' && !isModalOpen) {
                    if (currentView === 'stash' && isStashMode) {
                        // Check if focusing on file list
                        const stashFilesElement = DOMUtils.getElementById('stashFiles');
                        const stashFilesVisible = stashFilesElement && stashFilesElement.style.display !== 'none';
                        const focusOnFileList = (document.activeElement && document.activeElement.closest('#stashFiles')) ||
                                               (!(document.activeElement && document.activeElement.closest('#dynamicList')) && stashFilesVisible);

                        if (focusOnFileList) {
                            // Show file diff for selected file in stash
                            const selectedFile = DOMUtils.querySelector('#stashFilesList .file-item.selected');
                            if (selectedFile) {
                                const filePath = selectedFile.dataset.file;
                                showStashFileDiff(e, filePath);
                            }
                        } else {
                            // Show stash diff in sidebar
                            showDiff();
                        }
                    } else if (currentView === 'stash' && !isStashMode) {
                        showDiff();
                    }
                }

                // Enter for checkout in branches view
                if (e.key === 'Enter' && currentView === 'branches') {
                    // Use focus tracking variable instead of DOM detection
                    if (branchesFocusOnGitLog) {
                        // Show diff for selected commit in branches git log
                        showDiff();
                    } else {
                        // Checkout branch if in sidebar
                        checkoutBranch();
                    }
                }

                // Enter for diff/checkout in tags view
                if (e.key === 'Enter' && currentView === 'tags') {
                    // Check if we're in Git Log area or sidebar
                    if (document.activeElement.closest('#tagsGitLog') || (!document.activeElement.closest('#dynamicList'))) {
                        // Show diff for selected commit
                        showDiff();
                    } else {
                        // Checkout selected tag
                        checkoutTag();
                    }
                }

                // Enter for diff in remotes view
                if (e.key === 'Enter' && currentView === 'remotes') {
                    // Check if we're in Git Log area or sidebar
                    if (document.activeElement.closest('#remotesGitLog') || (!document.activeElement.closest('#dynamicList'))) {
                        // Show diff for selected commit
                        showDiff();
                    }
                }

                // c for create in branches/tags/stash view or commit in status view
                if (e.key === 'c') {
                    if (currentView === 'branches') {
                        createBranch();
                    } else if (currentView === 'tags') {
                        createTag();
                    } else if (currentView === 'stash' && isStashMode) {
                        createStash();
                    } else if (currentView === 'status') {
                        commitChanges();
                    }
                }

                // Space for stage/unstage in status view or select file in stash view
                if (e.key === ' ') {
                    e.preventDefault();
                    if (currentView === 'status') {
                        const selectedFile = document.querySelector('#statusView .file-item.selected');
                        if (selectedFile) {
                            const filePath = selectedFile.querySelector('.file-path').textContent;
                            if (selectedFile.classList.contains('staged')) {
                                unstageFile(e, filePath);
                            } else {
                                stageFile(e, filePath);
                            }
                        }
                    } else if (currentView === 'stash' && isStashMode) {
                        // Space to select/highlight file in stash view
                        const selectedFile = document.querySelector('#stashFilesList .file-item.selected');
                        if (selectedFile) {
                            // Toggle visual selection highlight
                            selectedFile.style.background = selectedFile.style.background === 'rgb(9, 71, 113)' ? '' : '#094771';
                        }
                    }
                }

                // === 重新设计的快捷键系统 ===

                // 'd' 键：只用于显示差异 (diff)
                if (e.key === 'd' && currentView === 'status' && !isModalOpen) {
                    e.preventDefault();
                    const selectedFile = document.querySelector('#statusView .file-item.selected');
                    if (selectedFile) {
                        const filePath = selectedFile.querySelector('.file-path').textContent;
                        showFileDiff(e, filePath);
                    }
                }

                // 'x' 键：删除操作 (delete)
                if (e.key === 'x' && !isModalOpen) {
                    e.preventDefault();
                    if (currentView === 'branches') {
                        deleteBranch();
                    } else if (currentView === 'tags') {
                        deleteTag();
                    }
                }

                // 更新 stash 操作快捷键
                if (currentView === 'stash' && isStashMode && !isModalOpen) {
                    if (e.key === 'a') {
                        // Apply stash
                        e.preventDefault();
                        applyStash();
                    } else if (e.key === 'p') {
                        // Pop stash
                        e.preventDefault();
                        popStash();
                    } else if (e.key === 'x') {
                        // Drop stash (改为 'x' 键)
                        e.preventDefault();
                        dropStash();
                    }
                }

                // r for reword in stash view
                if (e.key === 'r' && currentView === 'stash') {
                    rewordCommit();
                }

                // Ctrl+R for interactive rebase (改为 Ctrl+R 避免与diff编辑模式冲突)
                if (e.ctrlKey && e.key === 'r' && currentView === 'stash' && !isModalOpen) {
                    e.preventDefault();
                    showInteractiveRebase();
                }

                // 为新的Git工作流和团队协作视图添加快捷键
                if ((currentView === 'workflow' || currentView === 'collaboration') && !isModalOpen) {
                    // Tab 键：在子标签页之间切换
                    if (e.key === 'Tab' && !e.ctrlKey) {
                        e.preventDefault();
                        if (currentView === 'workflow') {
                            const tabs = ['rebase', 'merge', 'gitflow', 'conflicts'];
                            const currentTab = document.querySelector('.workflow-tab-btn.active')?.dataset.tab || 'rebase';
                            const currentIndex = tabs.indexOf(currentTab);
                            const nextIndex = (currentIndex + 1) % tabs.length;
                            showWorkflowTab(tabs[nextIndex]);
                        } else if (currentView === 'collaboration') {
                            const tabs = ['pullrequests', 'reviews', 'stats', 'notifications'];
                            const currentTab = document.querySelector('.collaboration-tab-btn.active')?.dataset.tab || 'pullrequests';
                            const currentIndex = tabs.indexOf(currentTab);
                            const nextIndex = (currentIndex + 1) % tabs.length;
                            showCollaborationTab(tabs[nextIndex]);
                        }
                    }
                }

                // Arrow keys for navigation in lists
                if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (currentView === 'branches') {
                        // Use focus tracking variable instead of DOM detection
                        if (branchesFocusOnGitLog) {
                            // Navigate in Branches Git Log
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const currentCommits = AppData.getBranchCommits(selectedBranchIndex);
                            const maxIndex = currentCommits.length - 1;
                            const newIndex = Math.max(0, Math.min(maxIndex, selectedBranchCommitIndex + direction));
                            if (newIndex !== selectedBranchCommitIndex) {
                                selectBranchCommit(currentCommits[newIndex].hash);
                            }
                        } else {
                            // Navigate in sidebar branches list
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const branchNames = AppData.getBranches();
                            const newIndex = Math.max(0, Math.min(branchNames.length - 1, selectedBranchIndex + direction));
                            if (newIndex !== selectedBranchIndex) {
                                selectBranch(newIndex, branchNames[newIndex]);
                            }
                        }
                    } else if (currentView === 'tags') {
                        // Check if we're focusing on the Git Log or the sidebar
                        if (document.activeElement.closest('#tagsGitLog') || (!document.activeElement.closest('#dynamicList'))) {
                            // Navigate in Git Log - 需要获取当前tag的commits
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const tags = AppData.getTags();
                            const currentTag = tags[selectedTagIndex];
                            if (currentTag) {
                                // 暂时使用固定数据，实际应该从tag获取commits
                                const commitHashes = ['18c4a3a', '8502563', '5f49518', '9bd566f'];
                                const newIndex = Math.max(0, Math.min(commitHashes.length - 1, selectedTagCommitIndex + direction));
                                if (newIndex !== selectedTagCommitIndex) {
                                    selectTagCommit(commitHashes[newIndex]);
                                }
                            }
                        } else {
                            // Navigate in sidebar tags list
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const tags = AppData.getTags();
                            const newIndex = Math.max(0, Math.min(tags.length - 1, selectedTagIndex + direction));
                            if (newIndex !== selectedTagIndex) {
                                const tag = tags[newIndex];
                                if (tag) {
                                    selectTag(newIndex, tag.name);
                                }
                            }
                        }
                    } else if (currentView === 'stash' && isStashMode) {
                        // In stash mode, check if we're focusing on sidebar or file list
                        const stashFilesVisible = document.getElementById('stashFiles').style.display !== 'none';
                        const focusOnFileList = document.activeElement.closest('#stashFiles') ||
                                               (!document.activeElement.closest('#dynamicList') && stashFilesVisible);

                        if (focusOnFileList) {
                            // Navigate in stash file list
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const allFiles = document.querySelectorAll('#stashFilesList .file-item');
                            const maxIndex = allFiles.length - 1;
                            const newIndex = Math.max(0, Math.min(maxIndex, selectedStashFileIndex + direction));

                            if (newIndex !== selectedStashFileIndex && allFiles.length > 0) {
                                selectedStashFileIndex = newIndex;
                                // Clear previous selection
                                allFiles.forEach(item => item.classList.remove('selected'));
                                // Select new file
                                allFiles[newIndex].classList.add('selected');
                            }
                        } else {
                            // Navigate in sidebar stash list
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const stashes = AppData.getStashes();
                            const newIndex = Math.max(0, Math.min(stashes.length - 1, selectedStashIndex + direction));
                            if (newIndex !== selectedStashIndex) {
                                selectStash(newIndex, stashes[newIndex].name);
                            }
                        }
                    } else if (currentView === 'stash' && !isStashMode) {
                        const direction = e.key === 'ArrowUp' ? -1 : 1;
                        const recentCommits = AppData.getRecentCommits();
                        const newIndex = Math.max(0, Math.min(recentCommits.length - 1, selectedCommitIndex + direction));
                        if (newIndex !== selectedCommitIndex) {
                            selectCommitByIndex(newIndex, recentCommits[newIndex]);
                        }
                    } else if (currentView === 'remotes') {
                        // Check if we're focusing on the Git Log or the sidebar
                        if (document.activeElement.closest('#remotesGitLog') || (!document.activeElement.closest('#dynamicList'))) {
                            // Navigate in Git Log
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const newIndex = Math.max(0, Math.min(3, selectedRemoteCommitIndex + direction));
                            if (newIndex !== selectedRemoteCommitIndex) {
                                const commitHashes = ['18c4a3a', '8502563', '5f49518', '9bd566f'];
                                selectRemoteCommit(commitHashes[newIndex]);
                            }
                        } else {
                            // Navigate in sidebar remotes list
                            const direction = e.key === 'ArrowUp' ? -1 : 1;
                            const newIndex = Math.max(0, Math.min(1, selectedRemoteIndex + direction));
                            if (newIndex !== selectedRemoteIndex) {
                                const remoteNames = ['origin', 'upstream'];
                                selectRemote(newIndex, remoteNames[newIndex]);
                            }
                        }
                    } else if (currentView === 'history') {
                        const direction = e.key === 'ArrowUp' ? -1 : 1;
                        const newIndex = Math.max(0, Math.min(2, selectedHistoryIndex + direction));
                        if (newIndex !== selectedHistoryIndex) {
                            const searchTerms = ['fix.*ui', 'author:costa', 'since:2024-09-01'];
                            selectHistory(newIndex, searchTerms[newIndex]);
                        }
                    } else if (currentView === 'status') {
                        // Navigate through files in status view
                        const direction = e.key === 'ArrowUp' ? -1 : 1;
                        const allFiles = document.querySelectorAll('#statusView .file-item');
                        const maxIndex = allFiles.length - 1;
                        const newIndex = Math.max(0, Math.min(maxIndex, selectedFileIndex + direction));

                        if (newIndex !== selectedFileIndex && allFiles.length > 0) {
                            selectedFileIndex = newIndex;
                            // Clear previous selection
                            allFiles.forEach(item => item.classList.remove('selected'));
                            // Select new file
                            allFiles[newIndex].classList.add('selected');
                        }
                    }
                }

                // Escape to close modals
                if (e.key === 'Escape') {
                    closeAllModals();
                }

                // AI Commit editing shortcuts
                if (document.getElementById('aiCommitModal').classList.contains('active')) {
                    // Ctrl+Enter to apply edited message
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        if (document.getElementById('aiEditActions').style.display !== 'none') {
                            applyEditedMessage();
                        }
                    }

                    // Escape to cancel edit
                    if (e.key === 'Escape' && document.getElementById('editAICommit').style.display !== 'none') {
                        e.preventDefault();
                        cancelEdit();
                        return; // Prevent modal close
                    }
                }

            });
        }

        // Modal functions
        function showDiff() {
            document.getElementById('diffCommitHash').textContent = selectedCommit;
            document.getElementById('diffModal').classList.add('active');
            // Reset to unified mode and first file
            currentFileIndex = 0;
            updateFileDisplay();
            switchDiffMode('unified');
            // Hide file list by default
            document.getElementById('fileListPanel').style.display = 'none';
        }

        function closeDiffModal() {
            document.getElementById('diffModal').classList.remove('active');
        }

        // File management for diff viewer
        let currentFileIndex = 0;
        const files = [
            { path: 'src/tui/layout/manager.rs', status: 'Modified', added: 15, removed: 5 },
            { path: 'src/components/sidebar.rs', status: 'Modified', added: 8, removed: 12 },
            { path: 'docs/design.md', status: 'Added', added: 45, removed: 0 }
        ];

        function toggleFileList() {
            const panel = document.getElementById('fileListPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function selectFile(index) {
            currentFileIndex = index;
            updateFileDisplay();
            toggleFileList();
        }

        function nextFile() {
            if (currentFileIndex < files.length - 1) {
                currentFileIndex++;
                updateFileDisplay();
            }
        }

        function previousFile() {
            if (currentFileIndex > 0) {
                currentFileIndex--;
                updateFileDisplay();
            }
        }

        function updateFileDisplay() {
            const file = files[currentFileIndex];
            document.getElementById('currentFilePath').textContent = file.path;
            document.getElementById('fileChanges').textContent = `+${file.added} lines, -${file.removed} lines`;
            document.getElementById('fileStatus').textContent = file.status;
            document.getElementById('currentFileIndex').textContent = currentFileIndex + 1;

            // Update file list selection
            document.querySelectorAll('.file-item').forEach((item, index) => {
                item.style.background = index === currentFileIndex ? '#094771' : '#1e1e1e';
            });
        }

        // Diff Mode Switching
        let currentDiffMode = 'unified';

        function switchDiffMode(mode) {
            currentDiffMode = mode;

            // Hide all views
            document.getElementById('unifiedView').style.display = 'none';
            document.getElementById('sideBySideView').style.display = 'none';
            document.getElementById('splitView').style.display = 'none';

            // Show selected view
            switch(mode) {
                case 'unified':
                    document.getElementById('unifiedView').style.display = 'block';
                    document.getElementById('diffMode').textContent = 'Unified';
                    document.getElementById('diffModeStatus').textContent = 'Unified';
                    break;
                case 'side-by-side':
                    document.getElementById('sideBySideView').style.display = 'block';
                    document.getElementById('diffMode').textContent = 'Side-by-Side';
                    document.getElementById('diffModeStatus').textContent = 'Side-by-Side';
                    break;
                case 'split':
                    document.getElementById('splitView').style.display = 'block';
                    document.getElementById('diffMode').textContent = 'Split';
                    document.getElementById('diffModeStatus').textContent = 'Split';
                    break;
            }

            // Update button styles
            document.querySelectorAll('#diffModal button').forEach(btn => {
                if (btn.textContent.includes('Unified') && mode === 'unified' ||
                    btn.textContent.includes('Side-by-Side') && mode === 'side-by-side' ||
                    btn.textContent.includes('Split') && mode === 'split') {
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn');
                } else if (btn.textContent.includes('Unified') ||
                          btn.textContent.includes('Side-by-Side') ||
                          btn.textContent.includes('Split')) {
                    btn.classList.remove('btn');
                    btn.classList.add('btn-secondary');
                }
            });
        }

        function rewordCommit() {
            // Clear any previous state and ensure clean modal opening
            closeAllModals();

            // Set up the reword modal
            document.getElementById('rewordCommitHash').textContent = selectedCommit;

            // Get commit message based on selected commit
            const commitMessages = {
                '18c4a3a': 'fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单',
                '8502563': 'fix(src): 修复TUI界面焦点管理和视图切换问题',
                '5f49518': 'feat(diff_viewer): 添加 Diff 修改块列表和解析函数',
                '9bd566f': 'fix(tui_enhanced): 修复左侧面板显示问题和 AI commit 相关代码不完整问题'
            };

            document.getElementById('newMessage').value = commitMessages[selectedCommit] || 'fix: 修复问题';
            document.getElementById('commitBody').value = '';

            document.getElementById('rewordModal').classList.add('active');
        }

        function closeRewordModal() {
            document.getElementById('rewordModal').classList.remove('active');
        }

        function editCommit() {
            showCustomAlert(`正在编辑提交: <strong>${selectedCommit}</strong>`, '提交编辑', '✏️');
        }

        function squashCommit() {
            showCustomAlert(`正在合并提交: <strong>${selectedCommit}</strong>`, '提交合并', '🔨');
        }

        function showInteractiveRebase() {
            document.getElementById('rebaseModal').classList.add('active');
        }

        function closeRebaseModal() {
            document.getElementById('rebaseModal').classList.remove('active');
        }

        function startRebase() {
            showCustomAlert('正在启动交互式变基操作...', '交互式变基', '🔄');
            closeRebaseModal();
        }

        function saveReword() {
            const newMessage = document.getElementById('newMessage').value;
            const body = document.getElementById('commitBody').value;
            showCustomAlert(`正在保存新的提交消息：<br><strong>"${newMessage}"</strong>${body ? '<br><br>' + body : ''}`, '保存消息', '💾');
            closeRewordModal();
        }

        function aiEnhance() {
            const messageTextarea = document.querySelector('#rewordModal textarea');
            const originalMessage = messageTextarea.value.trim();

            if (!originalMessage) {
                showCustomAlert('请先输入提交消息后再进行 AI 增强', 'AI 增强', '⚠️');
                return;
            }

            // Show loading state
            const aiButton = document.querySelector('#rewordModal button[onclick="aiEnhance()"]');
            const originalText = aiButton.textContent;
            aiButton.textContent = 'AI 增强中...';
            aiButton.disabled = true;

            // Simulate AI enhancement process
            setTimeout(() => {
                // Generate enhanced commit message suggestions based on original message
                const enhancements = generateEnhancedCommitSuggestions(originalMessage);

                // Create enhancement modal
                showEnhancementSuggestions(originalMessage, enhancements);

                // Restore button state
                aiButton.textContent = originalText;
                aiButton.disabled = false;
            }, 1500);
        }

        function generateEnhancedCommitSuggestions(originalMessage) {
            const suggestions = [];

            // Analyze the original message type and provide enhanced versions
            const lowerMessage = originalMessage.toLowerCase();

            if (lowerMessage.includes('fix') || lowerMessage.includes('修复')) {
                suggestions.push({
                    type: 'fix',
                    message: `fix(core): ${originalMessage.replace(/^(fix|修复):?\s*/i, '')}`,
                    description: '标准化修复类型格式'
                });
                suggestions.push({
                    type: 'fix',
                    message: `fix(ui): ${originalMessage.replace(/^(fix|修复):?\s*/i, '')}`,
                    description: 'UI 修复类型格式'
                });
            } else if (lowerMessage.includes('feat') || lowerMessage.includes('功能') || lowerMessage.includes('新增')) {
                suggestions.push({
                    type: 'feat',
                    message: `feat(api): ${originalMessage.replace(/^(feat|功能|新增):?\s*/i, '')}`,
                    description: 'API 功能增强格式'
                });
                suggestions.push({
                    type: 'feat',
                    message: `feat(ui): ${originalMessage.replace(/^(feat|功能|新增):?\s*/i, '')}`,
                    description: 'UI 功能增强格式'
                });
            } else if (lowerMessage.includes('refactor') || lowerMessage.includes('重构')) {
                suggestions.push({
                    type: 'refactor',
                    message: `refactor(core): ${originalMessage.replace(/^(refactor|重构):?\s*/i, '')}`,
                    description: '核心重构格式'
                });
            } else {
                // Generic enhancements
                suggestions.push({
                    type: 'feat',
                    message: `feat(core): ${originalMessage}`,
                    description: '功能增强格式'
                });
                suggestions.push({
                    type: 'fix',
                    message: `fix(ui): ${originalMessage}`,
                    description: 'Bug 修复格式'
                });
                suggestions.push({
                    type: 'refactor',
                    message: `refactor(code): ${originalMessage}`,
                    description: '代码重构格式'
                });
            }

            return suggestions;
        }

        function showEnhancementSuggestions(originalMessage, suggestions) {
            // Create enhancement modal HTML
            const enhancementModal = document.createElement('div');
            enhancementModal.className = 'modal active';
            enhancementModal.id = 'enhancementModal';
            enhancementModal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <span>🚀 AI 提交消息增强</span>
                        <button class="close-btn" onclick="closeEnhancementModal()">&times;</button>
                    </div>
                    <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: bold; color: #64b5f6;">原始消息:</label>
                            <div style="background: #2d2d2d; padding: 10px; border-radius: 4px; margin-top: 5px; font-family: monospace;">
                                ${originalMessage}
                            </div>
                        </div>

                        <label style="font-weight: bold; color: #64b5f6;">AI 增强建议:</label>
                        <div class="enhancement-suggestions" style="margin-top: 10px;">
                            ${suggestions.map((suggestion, index) => `
                                <div class="enhancement-item" onclick="selectEnhancement(${index})" style="
                                    background: #2d2d2d;
                                    border: 1px solid #404040;
                                    border-radius: 6px;
                                    padding: 12px;
                                    margin-bottom: 10px;
                                    cursor: pointer;
                                    transition: all 0.2s;
                                " onmouseover="this.style.background='#363636'" onmouseout="this.style.background='#2d2d2d'">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <span class="commit-type" style="
                                            background: ${suggestion.type === 'feat' ? '#4caf50' : suggestion.type === 'fix' ? '#f44336' : '#ff9800'};
                                            color: white;
                                            padding: 2px 8px;
                                            border-radius: 12px;
                                            font-size: 12px;
                                            margin-right: 10px;
                                        ">${suggestion.type}</span>
                                        <span style="color: #aaa; font-size: 12px;">${suggestion.description}</span>
                                    </div>
                                    <div style="font-family: monospace; color: #e0e0e0;">
                                        ${suggestion.message}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeEnhancementModal()">取消</button>
                        <button class="btn btn-info" onclick="useOriginalMessage()">保持原样</button>
                        <button class="btn btn-primary" id="useSelectedBtn" onclick="useSelectedEnhancement()" style="display: none;">使用选中</button>
                    </div>
                </div>
            `;

            document.body.appendChild(enhancementModal);

            // Store suggestions for later use
            window.enhancementData = {
                originalMessage,
                suggestions,
                selectedIndex: -1
            };
        }

        function selectEnhancement(index) {
            // Remove previous selection
            document.querySelectorAll('.enhancement-item').forEach(item => {
                item.style.border = '1px solid #404040';
            });

            // Highlight selected
            const selectedItem = document.querySelectorAll('.enhancement-item')[index];
            selectedItem.style.border = '2px solid #64b5f6';

            // Show use selected button
            document.getElementById('useSelectedBtn').style.display = 'inline-block';

            // Store selected index
            window.enhancementData.selectedIndex = index;
        }

        function useSelectedEnhancement() {
            if (window.enhancementData && window.enhancementData.selectedIndex >= 0) {
                const selectedSuggestion = window.enhancementData.suggestions[window.enhancementData.selectedIndex];
                const messageTextarea = document.querySelector('#rewordModal textarea');
                messageTextarea.value = selectedSuggestion.message;

                closeEnhancementModal();
                showCustomAlert(`已应用 AI 增强建议<br><strong>${selectedSuggestion.type}</strong> 类型格式`, 'AI 增强', '✅');
            }
        }

        function useOriginalMessage() {
            closeEnhancementModal();
            showCustomAlert('已保持原始提交消息', 'AI 增强', '💬');
        }

        function closeEnhancementModal() {
            const modal = document.getElementById('enhancementModal');
            if (modal) {
                modal.remove();
            }
            window.enhancementData = null;
        }

        function showAICommit() {
            document.getElementById('aiCommitModal').classList.add('active');
        }

        function closeAIModal() {
            document.getElementById('aiCommitModal').classList.remove('active');
            // Reset state
            document.getElementById('aiProgress').style.display = 'none';
            document.getElementById('aiSuggestions').style.display = 'none';
            document.getElementById('editAICommit').style.display = 'none';
            document.getElementById('aiCommitActions').style.display = 'none';
            document.getElementById('aiEditActions').style.display = 'none';
            document.getElementById('aiCommitMessage').value = '';
            selectedAISuggestion = null;

            // Clear selections
            document.querySelectorAll('.ai-suggestion-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        function generateAICommit() {
            const progress = document.getElementById('aiProgress');
            const suggestions = document.getElementById('aiSuggestions');
            const progressFill = document.getElementById('progressFill');

            progress.style.display = 'block';
            suggestions.style.display = 'none';

            // Simulate progress
            let width = 0;
            const interval = setInterval(() => {
                width += 10;
                progressFill.style.width = width + '%';

                if (width >= 100) {
                    clearInterval(interval);
                    progress.style.display = 'none';
                    suggestions.style.display = 'block';
                }
            }, 200);
        }

        function selectSuggestion(element, index) {
            // Clear previous selection
            document.querySelectorAll('.ai-suggestion-item').forEach(item => {
                item.classList.remove('selected');
            });

            element.classList.add('selected');
            selectedAISuggestion = index;

            // Show action buttons
            document.getElementById('aiCommitActions').style.display = 'flex';
            document.getElementById('aiCommitActions').style.gap = '8px';
        }

        function editAIMessage() {
            if (selectedAISuggestion) {
                const selectedElement = document.querySelector('.ai-suggestion-item.selected');
                const title = selectedElement.querySelector('.ai-suggestion-title').textContent;

                // Extract just the commit message part (remove number and star)
                const commitMessage = title.replace(/^\d+\.\s*/, '').replace(/\s*⭐$/, '');

                // Show edit area and populate message
                document.getElementById('editAICommit').style.display = 'block';
                document.getElementById('aiCommitMessage').value = commitMessage;
                document.getElementById('aiCommitMessage').focus();

                // Switch button groups
                document.getElementById('aiCommitActions').style.display = 'none';
                document.getElementById('aiEditActions').style.display = 'flex';
                document.getElementById('aiEditActions').style.gap = '8px';
            }
        }

        function applyEditedMessage() {
            const editedMessage = document.getElementById('aiCommitMessage').value.trim();
            if (editedMessage) {
                showCustomAlert(`已使用编辑的提交消息：<br><strong>"${editedMessage}"</strong>`, 'AI 提交', '✏️');
                closeAIModal();
            } else {
                showCustomAlert('提交消息不能为空！', '提交错误', '⚠️');
            }
        }

        function cancelEdit() {
            // Hide edit area
            document.getElementById('editAICommit').style.display = 'none';
            document.getElementById('aiCommitMessage').value = '';

            // Switch back to suggestion actions
            document.getElementById('aiEditActions').style.display = 'none';
            document.getElementById('aiCommitActions').style.display = 'flex';
            document.getElementById('aiCommitActions').style.gap = '8px';
        }

        function regenerateAI() {
            // Reset selections and regenerate
            selectedAISuggestion = null;
            document.querySelectorAll('.ai-suggestion-item').forEach(item => {
                item.classList.remove('selected');
            });

            // Hide actions and restart generation
            document.getElementById('aiCommitActions').style.display = 'none';
            document.getElementById('editAICommit').style.display = 'none';

            // Restart generation process
            generateAICommit();
        }

        function useAICommit() {
            if (selectedAISuggestion) {
                const selectedElement = document.querySelector('.ai-suggestion-item.selected');
                const title = selectedElement.querySelector('.ai-suggestion-title').textContent;
                const commitMessage = title.replace(/^\d+\.\s*/, '').replace(/\s*⭐$/, '');

                showCustomAlert(`已使用 AI 建议：<br><strong>"${commitMessage}"</strong>`, 'AI 提交', '🤖');
                closeAIModal();
            }
        }

        function commitChanges() {
            // Check if there are staged files
            const stagedFiles = document.querySelectorAll('#stagedFiles .file-item');
            if (stagedFiles.length === 0) {
                showCustomAlert('没有已暂存的文件可以提交！<br>请先暂存一些文件。', '提交错误', '⚠️');
                return;
            }

            updateCommitFilesList();
            document.getElementById('commitModal').classList.add('active');
            document.getElementById('commitMessage').focus();
        }

        // File Status Functions

        function toggleFileStatus(element, filePath) {
            // Clear previous selection
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function stageFile(event, filePath) {
            event.stopPropagation();
            showCustomAlert(`已暂存文件: <strong>${filePath}</strong>`, '文件操作', '📁');
            // Move file from unstaged to staged
            // In real implementation, this would make git add call
            refreshFileStatus();
        }

        function unstageFile(event, filePath) {
            event.stopPropagation();
            showCustomAlert(`已取消暂存文件: <strong>${filePath}</strong>`, '文件操作', '↩️');
            // Move file from staged to unstaged
            // In real implementation, this would make git reset call
            refreshFileStatus();
        }

        function discardFile(event, filePath) {
            event.stopPropagation();
            showCustomConfirm(
                `确定要放弃文件 "${filePath}" 的更改吗？<br><br><strong>⚠️ 此操作无法撤销！</strong>`,
                () => {
                    showCustomAlert(`已放弃文件更改: ${filePath}`, '文件操作', '✅');
                    // In real implementation, this would make git checkout call
                    refreshFileStatus();
                },
                '放弃文件更改',
                '⚠️'
            );
        }

        function deleteFile(event, filePath) {
            event.stopPropagation();
            showCustomConfirm(
                `确定要删除文件 "${filePath}" 吗？<br><br><strong>⚠️ 此操作无法撤销！</strong>`,
                () => {
                    showCustomAlert(`已删除文件: ${filePath}`, '文件操作', '🗑️');
                    // In real implementation, this would delete the file
                    refreshFileStatus();
                },
                '删除文件',
                '🗑️'
            );
        }

        function showFileDiff(event, filePath) {
            event.stopPropagation();
            showCustomAlert(`正在显示文件差异视图: <br><strong>${filePath}</strong>`, '差异视图', '📋');
            // In real implementation, this would show file-specific diff
            showDiff();
        }

        function stageAllFiles() {
            showCustomAlert('正在暂存所有未暂存的文件...', '文件操作', '📁');
            // In real implementation, this would make git add . call
            refreshFileStatus();
        }

        function unstageAllFiles() {
            showCustomAlert('正在取消暂存所有已暂存的文件...', '文件操作', '↩️');
            // In real implementation, this would make git reset call
            refreshFileStatus();
        }

        function discardAllFiles() {
            showCustomConfirm(
                '确定要放弃所有未暂存的更改吗？<br><br><strong>⚠️ 此操作无法撤销！</strong>',
                () => {
                    showCustomAlert('已放弃所有未暂存的更改', '文件操作', '🗑️');
                    // In real implementation, this would make git checkout . call
                    refreshFileStatus();
                },
                '放弃所有更改',
                '⚠️'
            );
        }

        function refreshFileStatus() {
            // In real implementation, this would refresh git status
            console.log('Refreshing file status...');
        }

        function closeCommitModal() {
            document.getElementById('commitModal').classList.remove('active');
            document.getElementById('commitMessage').value = '';
            document.getElementById('pushAfterCommit').checked = false;
        }

        function executeCommit() {
            const message = document.getElementById('commitMessage').value.trim();
            if (!message) {
                showCustomAlert('提交消息不能为空！<br>请输入有效的提交消息。', '提交错误', '⚠️');
                return;
            }

            const pushAfter = document.getElementById('pushAfterCommit').checked;

            if (pushAfter) {
                showCustomAlert(`提交已创建！<br><strong>"${message}"</strong><br><br>正在推送到远程仓库...`, '提交成功', '🚀');
            } else {
                showCustomAlert(`提交已创建！<br><strong>"${message}"</strong>`, '提交成功', '✅');
            }

            closeCommitModal();
            // In real implementation, this would execute git commit
            refreshFileStatus();
        }

        function updateCommitFilesList() {
            const stagedFiles = document.querySelectorAll('#stagedFiles .file-item');
            const commitFilesList = document.getElementById('commitFilesList');

            commitFilesList.innerHTML = '';
            stagedFiles.forEach(file => {
                const filePath = file.querySelector('.file-path').textContent;
                const fileStatus = file.querySelector('.file-status').textContent;

                const fileItem = document.createElement('div');
                fileItem.className = 'commit-file-item';
                fileItem.innerHTML = `
                    <span class="file-status-icon">✓</span>
                    <span class="file-path">${filePath}</span>
                    <span class="file-status">${fileStatus}</span>
                `;
                commitFilesList.appendChild(fileItem);
            });
        }

        function toggleStashMode() {
            isStashMode = !isStashMode;
            const button = event.target;
            button.textContent = isStashMode ? 'Switch to Git Log' : 'Switch to Stash';

            const title = document.querySelector('#stashView h3');
            title.textContent = isStashMode ? 'Stash Management' : 'Git Log';

            // Toggle display between stash files and git log
            const stashFiles = document.getElementById('stashFiles');
            const gitLog = document.getElementById('gitLog');
            const selectedCommitDetails = document.getElementById('selectedCommitDetails');

            if (isStashMode) {
                // Show stash files, hide git log
                stashFiles.style.display = 'block';
                gitLog.style.display = 'none';
                selectedCommitDetails.style.display = 'none';

                // Initialize first stash selection
                selectedStashIndex = 0;
                if (currentView === 'stash') {
                    updateDynamicList('stash');
                }
                updateStashDetails(0, 'stash@{0}');
            } else {
                // Show git log, hide stash files
                stashFiles.style.display = 'none';
                gitLog.style.display = 'block';

                // Initialize first commit selection when switching to git log mode
                selectedCommitIndex = 0;
                if (currentView === 'stash') {
                    updateDynamicList('stash');
                }
                updateCommitDetails(0, '18c4a3a');

                // Remove stash details when switching back to git log
                const stashDetails = document.querySelector('.stash-details');
                if (stashDetails) {
                    stashDetails.remove();
                }
            }
        }

        function refreshView() {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.classList.add('refreshing');
            syncStatus.querySelector('.status-text').textContent = 'Refreshing...';

            setTimeout(() => {
                syncStatus.classList.remove('refreshing');
                syncStatus.querySelector('.status-text').textContent = 'Ready';
                showCustomAlert(`已刷新 ${currentView} 视图`, '刷新', '🔄');
            }, 1500);
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }

        // Branch and Tag Management
        function selectBranch(index, branchName) {
            selectedBranchIndex = index;
            document.getElementById('selectedBranch').textContent = (index === 0 ? '★ ' : '') + branchName;

            // 更新当前视图的侧边栏
            updateDynamicList(currentView);

            // 如果在 branches 视图，更新分支详情和右侧Git Log
            if (currentView === 'branches') {
                updateBranchDetails(index, branchName);
                // 确保焦点指示器正确更新
                updateBranchesVisuialFocus();
            }

            // 如果在 git-log 视图，更新主Git Log内容以显示选中分支的提交
            if (currentView === 'git-log') {
                updateMainGitLogForBranch(index, branchName);
            }
        }

        function selectTag(index, tagName) {
            selectedTagIndex = index;
            document.getElementById('selectedTag').textContent = tagName;
            updateDynamicList('tags');
            updateTagDetails(index, tagName);
        }

        function selectStash(index, stashName) {
            selectedStashIndex = index;
            updateDynamicList('stash'); // Only update when we're actually in stash view
            updateStashDetails(index, stashName);
        }

        function selectCommitByIndex(index, commitHash) {
            selectedCommitIndex = index;
            selectedCommit = commitHash;
            AppState.selectedCommit = commitHash;
            if (currentView === 'stash') {
                updateDynamicList('stash'); // Only update when we're in stash view
            }
            updateStashCommitDetails(index, commitHash);
        }

        function selectTagCommit(commitHash) {
            // Update selection in tags git log
            document.querySelectorAll('#tagsGitLog .commit-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#tagsGitLog .commit-item[data-hash="${commitHash}"]`).classList.add('selected');
            selectedCommit = commitHash;

            // Update the selectedTagCommitIndex
            const commits = ['18c4a3a', '8502563', '5f49518', '9bd566f'];
            selectedTagCommitIndex = commits.indexOf(commitHash);

            // Update global selected commit for diff viewer
            updateGlobalSelectedCommit(commitHash);
        }

        function selectRemoteCommit(commitHash) {
            // Update selection in remotes git log
            document.querySelectorAll('#remotesGitLog .commit-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#remotesGitLog .commit-item[data-hash="${commitHash}"]`).classList.add('selected');
            selectedCommit = commitHash;

            // Update the selectedRemoteCommitIndex
            const commits = ['18c4a3a', '8502563', '5f49518', '9bd566f'];
            selectedRemoteCommitIndex = commits.indexOf(commitHash);

            // Update global selected commit for diff viewer
            updateGlobalSelectedCommit(commitHash);
        }

        function updateGlobalSelectedCommit(commitHash) {
            // Update the main git log selection as well to keep consistency
            document.querySelectorAll('#gitLog .commit-item').forEach(item => {
                item.classList.remove('selected');
            });
            const mainCommit = document.querySelector(`#gitLog .commit-item[data-hash="${commitHash}"]`);
            if (mainCommit) {
                mainCommit.classList.add('selected');
            }
        }

        // Branch Git Log Functions
        function selectBranchCommit(commitHash) {
            // Update selection in branches git log
            document.querySelectorAll('#branchesGitLog .commit-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#branchesGitLog .commit-item[data-hash="${commitHash}"]`).classList.add('selected');
            selectedCommit = commitHash;

            // Update the selectedBranchCommitIndex
            const currentCommits = AppData.getBranchCommits(selectedBranchIndex);
            selectedBranchCommitIndex = currentCommits.findIndex(commit => commit.hash === commitHash);

            // Update global selected commit for diff viewer
            updateGlobalSelectedCommit(commitHash);
        }

        function editBranchCommit(commitHash) {
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;
            rewordCommit();
        }

        function resetBranchCommit(commitHash) {
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;
            resetCommit();
        }

        function cherryPickBranchCommit(commitHash) {
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;
            cherryPickCommit();
        }

        function showBranchCommitDiff(commitHash) {
            // 设置选中的提交并显示diff
            selectBranchCommit(commitHash);
            showDiff();
        }

        function toggleBranchesFocus() {
            // 在分支列表和Git Log之间切换焦点
            branchesFocusOnGitLog = !branchesFocusOnGitLog;
            updateBranchesVisuialFocus();
        }

        // Stash view focus management
        let stashFocusOnFileList = true; // Default focus on file list in stash mode

        function toggleStashFocus() {
            // 在 stash 列表和文件列表之间切换焦点
            stashFocusOnFileList = !stashFocusOnFileList;
            updateStashVisualFocus();
        }

        function updateStashVisualFocus() {
            // 更新可视的焦点指示器
            const sidebar = document.getElementById('dynamicList');
            const fileListArea = document.getElementById('stashFiles');

            if (stashFocusOnFileList) {
                // 焦点在文件列表区域
                sidebar.style.opacity = '0.5';
                sidebar.style.filter = 'brightness(0.7)';
                fileListArea.style.border = '2px solid #007acc';
                fileListArea.style.borderRadius = '4px';
                fileListArea.style.boxShadow = '0 0 8px rgba(0, 122, 204, 0.3)';
            } else {
                // 焦点在侧边栏
                sidebar.style.opacity = '1';
                sidebar.style.filter = 'none';
                fileListArea.style.border = '1px solid #3e3e42';
                fileListArea.style.borderRadius = '4px';
                fileListArea.style.boxShadow = 'none';
            }
        }

        function updateBranchesVisuialFocus() {
            // 更新可视的焦点指示器
            const sidebar = document.getElementById('dynamicList');
            const gitLogArea = document.getElementById('branchesGitLog');
            const focusHint = document.getElementById('branchesFocusHint');

            if (branchesFocusOnGitLog) {
                // 焦点在Git Log区域
                sidebar.style.opacity = '0.5';
                sidebar.style.filter = 'brightness(0.7)';
                gitLogArea.style.border = '2px solid #007acc';
                gitLogArea.style.borderRadius = '4px';
                gitLogArea.style.boxShadow = '0 0 8px rgba(0, 122, 204, 0.3)';
                focusHint.innerHTML = '<span style="color: #007acc;">📍 Git Log Active</span> | <span class="kbd">Tab</span> Switch to Branches | <span class="kbd">↑↓</span> Navigate | <span class="kbd">Enter</span> Show Diff';
            } else {
                // 焦点在侧边栏
                sidebar.style.opacity = '1';
                sidebar.style.filter = 'none';
                gitLogArea.style.border = '1px solid #3e3e42';
                gitLogArea.style.borderRadius = '4px';
                gitLogArea.style.boxShadow = 'none';
                focusHint.innerHTML = '<span style="color: #4ec9b0;">📍 Branches Active</span> | <span class="kbd">Tab</span> Switch to Git Log | <span class="kbd">↑↓</span> Navigate | <span class="kbd">Enter</span> Checkout';
            }
        }

        // Tag Git Log Functions
        function editTagCommit(commitHash) {
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;
            rewordCommit();
        }

        function resetTagCommit(commitHash) {
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;
            resetCommit();
        }

        function cherryPickTagCommit(commitHash) {
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;
            cherryPickCommit();
        }

        // Main Git Log Functions (for Stash view)
        function selectMainCommit(commitHash) {
            // Update selection in main git log
            document.querySelectorAll('#gitLog .commit-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#gitLog .commit-item[data-hash="${commitHash}"]`).classList.add('selected');

            // Update global selected commit
            selectedCommit = commitHash;
            document.getElementById('selectedCommitHash').textContent = commitHash;

            // Update commit details in the sidebar
            updateMainCommitDetails(commitHash);

            // Also update the sidebar selection to keep it in sync
            const commitHashes = ['18c4a3a', '8502563', '5f49518'];
            const index = commitHashes.indexOf(commitHash);
            if (index !== -1) {
                selectedCommitIndex = index;
                if (currentView === 'stash') {
                    updateDynamicList('stash');
                }
            }
        }

        function updateMainCommitDetails(commitHash) {
            const commitDetails = {
                '18c4a3a': {
                    hash: '18c4a3a',
                    date: '2024-09-11 01:44:32',
                    message: 'fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单',
                    author: 'costa',
                    changes: '3 files changed, 12 insertions(+), 5 deletions(-)',
                    branch: 'main'
                },
                '8502563': {
                    hash: '8502563',
                    date: '2024-09-11 01:44:32',
                    message: 'fix(src): 修复TUI界面焦点管理和视图切换问题',
                    author: 'costa',
                    changes: '2 files changed, 8 insertions(+), 3 deletions(-)',
                    branch: 'main'
                },
                '5f49518': {
                    hash: '5f49518',
                    date: '2024-09-11 01:44:32',
                    message: 'feat(diff_viewer): 添加 Diff 修改块列表和解析函数',
                    author: 'costa',
                    changes: '4 files changed, 15 insertions(+), 2 deletions(-)',
                    branch: 'main'
                }
            };

            const details = commitDetails[commitHash] || commitDetails['18c4a3a'];

            // Update the commit details section in stash view (below Git Log)
            const detailsDiv = document.getElementById('selectedCommitDetails');
            if (detailsDiv) {
                // Update the existing details div
                detailsDiv.style.display = 'block';
            }

            // Update all detail fields
            document.getElementById('selectedCommitHash').textContent = details.hash;
            document.getElementById('detailCommitHash').textContent = details.hash;
            document.getElementById('detailCommitDate').textContent = details.date;
            document.getElementById('detailCommitMessage').textContent = details.message;
            document.getElementById('detailCommitAuthor').textContent = details.author;
            document.getElementById('detailCommitStats').textContent = details.changes;
        }

        function editCommitMessage() {
            // Edit the selected commit message
            if (selectedCommit) {
                document.getElementById('selectedCommitHash').textContent = selectedCommit;
                rewordCommit();
            }
        }

        function resetToThis() {
            // Reset to the selected commit
            if (selectedCommit) {
                showCustomConfirm(
                    `Are you sure you want to reset to commit ${selectedCommit}?\\n\\nThis will undo all commits after this one.`,
                    () => {
                        showCustomAlert(`Reset to ${selectedCommit} completed!`, '✅ Reset Complete');
                    },
                    '🔄 Reset to Commit'
                );
            }
        }

        function cherryPickThis() {
            // Cherry pick the selected commit
            if (selectedCommit) {
                showCustomAlert(`Cherry-picked commit ${selectedCommit}!`, '🍒 Cherry Pick Complete');
            }
        }

        function selectRemote(index, remoteName) {
            selectedRemoteIndex = index;
            updateDynamicList('remotes');
            updateRemoteDetails(index, remoteName);
        }

        function selectHistory(index, searchTerm) {
            selectedHistoryIndex = index;
            updateDynamicList('history');
            updateHistoryDetails(index, searchTerm);
        }

        function updateBranchDetails(index, branchName) {
            // 模拟不同分支的详细信息
            const branchDetails = {
                0: { // main
                    upstream: 'origin/main',
                    ahead: 2,
                    behind: 0,
                    lastCommit: 'fix(ui): 修复侧边栏布局问题',
                    author: 'costa',
                    date: '2024-09-11'
                },
                1: { // feature/auth
                    upstream: 'origin/feature/auth',
                    ahead: 5,
                    behind: 1,
                    lastCommit: 'feat(auth): 添加用户认证系统',
                    author: 'alice',
                    date: '2024-09-10'
                },
                2: { // develop
                    upstream: 'origin/develop',
                    ahead: 0,
                    behind: 3,
                    lastCommit: 'merge: 合并多个功能分支',
                    author: 'bob',
                    date: '2024-09-09'
                },
                3: { // hotfix/v1.2
                    upstream: 'origin/hotfix/v1.2',
                    ahead: 1,
                    behind: 0,
                    lastCommit: 'hotfix: 修复关键安全漏洞',
                    author: 'charlie',
                    date: '2024-09-08'
                }
            };

            const details = branchDetails[index] || branchDetails[0];

            // 更新分支详情显示
            const branchView = document.getElementById('branchesView');
            const detailsSection = branchView.querySelector('div[style*="background: #252526"]');
            detailsSection.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #4ec9b0;">Selected: <span id="selectedBranch">${(index === currentBranchIndex ? '★ ' : '') + branchName}</span></div>
                    <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                        <div>📊 Branch Details:</div>
                        <div>• Upstream: ${details.upstream}</div>
                        <div>• Ahead: ${details.ahead} commits | Behind: ${details.behind} commits</div>
                        <div>• Last commit: ${details.lastCommit}</div>
                        <div>• Author: ${details.author} | Date: ${details.date}</div>
                        <div style="color: ${index === currentBranchIndex ? '#4ec9b0' : '#969696'};">• Status: ${index === currentBranchIndex ? 'Current Branch' : 'Available'}</div>
                    </div>
                </div>
            `;

            // 更新分支对应的 Git Log
            updateBranchGitLog(index, branchName);
        }

        function getBranchCommits(index) {
            // 使用统一数据管理获取指定分支的提交列表
            return AppData.getBranchCommits(index);
        }

        function updateBranchGitLog(index, branchName) {
            // 使用统一数据管理获取分支提交历史
            const commits = AppData.getBranchCommits(index);
            const gitLogContainer = document.getElementById('branchesGitLog');

            // 更新Git Log内容 - 使用安全的DOM操作替代HTML拼接
            gitLogContainer.innerHTML = '';
            commits.forEach((commit, commitIndex) => {
                const commitElement = document.createElement('div');
                commitElement.className = `commit-item ${commitIndex === 0 ? 'selected' : ''}`;
                commitElement.setAttribute('data-hash', commit.hash);

                // 使用事件管理器替代原生addEventListener
                EventManager.addEventListener(commitElement, 'click', () => selectBranchCommit(commit.hash));
                EventManager.addEventListener(commitElement, 'dblclick', () => showBranchCommitDiff(commit.hash));

                // 安全地设置内容
                commitElement.innerHTML = `
                    <span class="commit-status">${escapeHtml(commit.status)}</span>
                    <span class="commit-hash">${escapeHtml(commit.hash)}</span>
                    <span class="commit-date">${escapeHtml(commit.date)}</span>
                    <span class="commit-message">${escapeHtml(commit.message)}</span>
                `;

                // 创建按钮容器
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'commit-actions';

                // 创建按钮并使用事件监听器
                const buttons = [
                    { text: '👁️', title: 'Show Diff', handler: () => showBranchCommitDiff(commit.hash) },
                    { text: '✏️', title: 'Edit', handler: () => editBranchCommit(commit.hash) },
                    { text: '🔄', title: 'Reset', handler: () => resetBranchCommit(commit.hash) },
                    { text: '🍒', title: 'Cherry Pick', handler: () => cherryPickBranchCommit(commit.hash) }
                ];

                buttons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = 'btn btn-secondary';
                    button.textContent = btn.text;
                    button.title = btn.title;
                    EventManager.addEventListener(button, 'click', (e) => {
                        e.stopPropagation();
                        btn.handler();
                    });
                    actionsDiv.appendChild(button);
                });

                commitElement.appendChild(actionsDiv);
                gitLogContainer.appendChild(commitElement);
            });

            // 更新全局选中的commit为第一个
            if (commits.length > 0) {
                selectedCommit = commits[0].hash;
                selectedBranchCommitIndex = 0;  // 重置选中索引为第一个
                updateGlobalSelectedCommit(selectedCommit);
            }
        }

        function updateMainGitLogForBranch(index, branchName) {
            // 更新主Git Log区域以显示选中分支的提交历史
            // 这个函数在用户在git-log视图中从侧边栏选择不同分支时调用
            const branchCommits = {
                0: [ // main
                    { hash: '18c4a3a', status: '📝', date: '[09-11 01:44]', message: 'fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单', author: 'costa' },
                    { hash: '8502563', status: '🔧', date: '[09-11 01:44]', message: 'fix(src): 修复TUI界面焦点管理和视图切换问题', author: 'costa' },
                    { hash: '5f49518', status: '✨', date: '[09-11 01:44]', message: 'feat(diff_viewer): 添加 Diff 修改块列表和解析函数', author: 'costa' },
                    { hash: '9bd566f', status: '🎨', date: '[09-10 18:33]', message: 'style(ui): 优化界面布局和颜色主题', author: 'costa' }
                ],
                1: [ // feature/auth
                    { hash: '2a1b3c4', status: '🔐', date: '[09-10 16:22]', message: 'feat(auth): 添加用户认证系统基础框架', author: 'alice' },
                    { hash: '3b2c4d5', status: '🧪', date: '[09-10 14:15]', message: 'test(auth): 添加认证模块单元测试', author: 'alice' },
                    { hash: '4c3d5e6', status: '📝', date: '[09-10 12:30]', message: 'docs(auth): 更新认证系统文档', author: 'alice' },
                    { hash: '5d4e6f7', status: '🔒', date: '[09-09 18:45]', message: 'security(auth): 强化密码加密算法', author: 'alice' }
                ],
                2: [ // develop
                    { hash: '6e5f7g8', status: '🔀', date: '[09-09 15:30]', message: 'merge: 合并多个功能分支到开发分支', author: 'bob' },
                    { hash: '7f6g8h9', status: '🚀', date: '[09-09 13:20]', message: 'perf(core): 优化核心模块性能', author: 'bob' },
                    { hash: '8g7h9i0', status: '🐛', date: '[09-09 11:15]', message: 'fix(api): 修复API接口响应问题', author: 'bob' },
                    { hash: '9h8i0j1', status: '📦', date: '[09-08 16:45]', message: 'build(deps): 更新项目依赖包', author: 'bob' }
                ],
                3: [ // hotfix/v1.2
                    { hash: '0i9j1k2', status: '🚨', date: '[09-08 14:20]', message: 'hotfix: 修复关键安全漏洞', author: 'charlie' },
                    { hash: '1j0k2l3', status: '🔒', date: '[09-08 13:15]', message: 'security: 加强输入验证防止注入攻击', author: 'charlie' },
                    { hash: '2k1l3m4', status: '🧹', date: '[09-08 12:30]', message: 'clean: 清理无用代码和注释', author: 'charlie' },
                    { hash: '3l2m4n5', status: '📋', date: '[09-08 11:45]', message: 'log: 添加详细的安全审计日志', author: 'charlie' }
                ]
            };

            const commits = branchCommits[index] || branchCommits[0];
            const mainGitLogContainer = document.getElementById('gitLog');

            // 更新主Git Log内容以显示选中分支的提交 - 使用安全的DOM操作
            mainGitLogContainer.innerHTML = '';
            commits.forEach((commit, commitIndex) => {
                const commitElement = document.createElement('div');
                commitElement.className = `commit-item ${commitIndex === 0 ? 'selected' : ''}`;
                commitElement.setAttribute('data-hash', commit.hash);

                // 使用事件管理器而不是onclick属性
                EventManager.addEventListener(commitElement, 'click', () => selectMainCommit(commit.hash));

                // 安全地设置内容
                commitElement.innerHTML = `
                    <span class="commit-status">${escapeHtml(commit.status)}</span>
                    <span class="commit-hash">${escapeHtml(commit.hash)}</span>
                    <span class="commit-date">${escapeHtml(commit.date)}</span>
                    <span class="commit-message">${escapeHtml(commit.message)}</span>
                `;

                mainGitLogContainer.appendChild(commitElement);
            });

            // 更新全局选中的commit为第一个
            if (commits.length > 0) {
                selectedCommit = commits[0].hash;
                updateGlobalSelectedCommit(selectedCommit);
            }
        }

        function updateTagDetails(index, tagName) {
            // 模拟不同标签的详细信息
            const tagDetails = {
                0: { // v2.1.0
                    date: '2024-09-11 15:45:32',
                    commit: '18c4a3a',
                    message: 'Latest release with UI improvements',
                    tagger: 'costa <costa@helltalk.com>'
                },
                1: { // v2.0.5
                    date: '2024-09-08 12:30:15',
                    commit: '8502563',
                    message: 'Bug fixes and performance improvements',
                    tagger: 'alice <alice@helltalk.com>'
                },
                2: { // v2.0.0
                    date: '2024-08-15 09:15:45',
                    commit: '5f49518',
                    message: 'Major version release',
                    tagger: 'bob <bob@helltalk.com>'
                }
            };

            const details = tagDetails[index] || tagDetails[0];

            // 更新标签详情显示
            const tagView = document.getElementById('tagsView');
            const detailsSection = tagView.querySelector('div[style*="background: #252526"]');
            detailsSection.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #4ec9b0;">Selected: <span id="selectedTag">${tagName}</span></div>
                    <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                        <div>🏷️ Tag Details:</div>
                        <div>• Date: ${details.date}</div>
                        <div>• Commit: ${details.commit}</div>
                        <div>• Message: ${details.message}</div>
                        <div>• Tagger: ${details.tagger}</div>
                    </div>
                </div>
            `;
        }

        function updateStashDetails(index, stashName) {
            // 模拟不同 stash 的详细信息
            const stashDetails = {
                0: { // stash@{0}
                    branch: 'feature/auth',
                    date: '2024-09-11 14:23:15',
                    message: 'WIP on feature/auth: feat auth system',
                    files: '3 files changed, 15 insertions(+), 8 deletions(-)',
                    author: 'costa <costa@helltalk.com>'
                },
                1: { // stash@{1}
                    branch: 'develop',
                    date: '2024-09-10 16:45:32',
                    message: 'WIP on develop: temp changes before merge',
                    files: '2 files changed, 7 insertions(+), 3 deletions(-)',
                    author: 'alice <alice@helltalk.com>'
                },
                2: { // stash@{2}
                    branch: 'main',
                    date: '2024-09-09 11:20:45',
                    message: 'WIP on main: fix UI layout issues',
                    files: '4 files changed, 12 insertions(+), 5 deletions(-)',
                    author: 'bob <bob@helltalk.com>'
                }
            };

            const details = stashDetails[index] || stashDetails[0];

            // 更新 stash 详情显示
            const stashView = document.getElementById('stashView');
            // 查找当前的详情区域，如果不存在则创建
            let detailsSection = stashView.querySelector('.stash-details');
            if (!detailsSection) {
                // 在 h3 之后添加详情区域
                const header = stashView.querySelector('h3');
                detailsSection = document.createElement('div');
                detailsSection.className = 'stash-details';
                detailsSection.style.cssText = 'background: #252526; padding: 16px; border-radius: 4px; margin: 16px 0;';
                header.parentNode.insertBefore(detailsSection, header.nextSibling);
            }

            detailsSection.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #4ec9b0;">Selected Stash: <span id="selectedStash">${stashName}</span></div>
                    <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                        <div>💾 Stash Details:</div>
                        <div>• Branch: ${details.branch}</div>
                        <div>• Date: ${details.date}</div>
                        <div>• Message: ${details.message}</div>
                        <div>• Changes: ${details.files}</div>
                        <div>• Author: ${details.author}</div>
                    </div>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="applyStash()">Apply Stash</button>
                    <button class="btn btn-secondary" onclick="popStash()">Pop Stash</button>
                    <button class="btn btn-danger" onclick="dropStash()">Drop Stash</button>
                    <button class="btn btn-secondary" onclick="showStashDiff()">Show Diff</button>
                </div>
            `;
        }

        function updateStashCommitDetails(index, commitHash) {
            // 模拟不同 commit 的详细信息
            const commitDetails = {
                0: { // 18c4a3a
                    hash: '18c4a3a',
                    date: '2024-09-11 01:44:32',
                    message: 'fix(ui): 修复侧边栏布局问题，显示分支列表和导航菜单',
                    author: 'costa',
                    changes: '3 files changed, 12 insertions(+), 5 deletions(-)',
                    branch: 'main'
                },
                1: { // 8502563
                    hash: '8502563',
                    date: '2024-09-11 01:44:15',
                    message: 'fix(src): 修复TUI界面焦点管理和视图切换问题',
                    author: 'costa',
                    changes: '2 files changed, 8 insertions(+), 3 deletions(-)',
                    branch: 'main'
                },
                2: { // 5f49518
                    hash: '5f49518',
                    date: '2024-09-10 15:30:45',
                    message: 'feat(diff_viewer): 添加 Diff 修改块列表和解析函数',
                    author: 'alice',
                    changes: '1 file changed, 15 insertions(+), 0 deletions(-)',
                    branch: 'develop'
                }
            };

            const details = commitDetails[index] || commitDetails[0];

            // 使用统一的 updateMainCommitDetails 函数来更新详情显示
            // 而不是创建重复的显示区域
            updateMainCommitDetails(details.hash);
        }

        function updateRemoteDetails(index, remoteName) {
            // 模拟不同 remote 的详细信息
            const remoteDetails = {
                0: { // origin
                    name: 'origin',
                    url: 'https://github.com/costalong/ai-commit.git',
                    type: 'push/fetch',
                    status: 'up to date',
                    lastFetch: '2024-09-11 15:30:25',
                    branches: ['main', 'develop', 'feature/auth']
                },
                1: { // upstream
                    name: 'upstream',
                    url: 'https://github.com/upstream/ai-commit.git',
                    type: 'fetch only',
                    status: '2 commits ahead',
                    lastFetch: '2024-09-11 12:15:10',
                    branches: ['main', 'develop']
                }
            };

            const details = remoteDetails[index] || remoteDetails[0];

            // 更新 remote 详情显示
            const remotesView = document.getElementById('remotesView');
            // 查找当前的详情区域，如果不存在则创建
            let detailsSection = remotesView.querySelector('.remote-details');
            if (!detailsSection) {
                // 在 h3 之后添加详情区域
                const header = remotesView.querySelector('h3');
                detailsSection = document.createElement('div');
                detailsSection.className = 'remote-details';
                detailsSection.style.cssText = 'background: #252526; padding: 16px; border-radius: 4px; margin: 16px 0;';
                header.parentNode.insertBefore(detailsSection, header.nextSibling);
            }

            detailsSection.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #4ec9b0;">Selected Remote: <span id="selectedRemote">${remoteName}</span></div>
                    <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                        <div>📡 Remote Details:</div>
                        <div>• Name: ${details.name}</div>
                        <div>• URL: ${details.url}</div>
                        <div>• Type: ${details.type}</div>
                        <div>• Status: ${details.status}</div>
                        <div>• Last Fetch: ${details.lastFetch}</div>
                        <div>• Branches: ${details.branches.join(', ')}</div>
                    </div>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="fetchRemote()">Fetch</button>
                    <button class="btn btn-secondary" onclick="pullRemote()">Pull</button>
                    <button class="btn btn-secondary" onclick="pushRemote()">Push</button>
                    <button class="btn btn-danger" onclick="removeRemote()">Remove</button>
                </div>
            `;
        }

        function updateHistoryDetails(index, searchTerm) {
            // 模拟不同搜索历史的详细信息
            const historyDetails = {
                0: { // fix.*ui
                    term: 'fix.*ui',
                    type: 'Regex Pattern',
                    lastUsed: '2024-09-11 14:45:30',
                    results: '5 commits found',
                    description: 'Search for UI fix commits using regex pattern',
                    scope: 'commit messages'
                },
                1: { // author:costa
                    term: 'author:costa',
                    type: 'Author Filter',
                    lastUsed: '2024-09-11 12:20:15',
                    results: '23 commits found',
                    description: 'Filter commits by author costa',
                    scope: 'commit author'
                },
                2: { // since:2024-09-01
                    term: 'since:2024-09-01',
                    type: 'Date Filter',
                    lastUsed: '2024-09-10 16:30:45',
                    results: '15 commits found',
                    description: 'Show commits since September 1st, 2024',
                    scope: 'commit date'
                }
            };

            const details = historyDetails[index] || historyDetails[0];

            // 更新搜索历史详情显示
            const historyView = document.getElementById('historyView');
            // 查找当前的详情区域，如果不存在则创建
            let detailsSection = historyView.querySelector('.history-details');
            if (!detailsSection) {
                // 在 h3 之后添加详情区域
                const header = historyView.querySelector('h3');
                detailsSection = document.createElement('div');
                detailsSection.className = 'history-details';
                detailsSection.style.cssText = 'background: #252526; padding: 16px; border-radius: 4px; margin: 16px 0;';
                header.parentNode.insertBefore(detailsSection, header.nextSibling);
            }

            detailsSection.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #4ec9b0;">Selected Search: <span id="selectedSearch">${searchTerm}</span></div>
                    <div style="font-size: 12px; color: #969696; margin-top: 8px;">
                        <div>🔍 Search Details:</div>
                        <div>• Term: ${details.term}</div>
                        <div>• Type: ${details.type}</div>
                        <div>• Last Used: ${details.lastUsed}</div>
                        <div>• Results: ${details.results}</div>
                        <div>• Description: ${details.description}</div>
                        <div>• Scope: ${details.scope}</div>
                    </div>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="executeSearch()">Execute Search</button>
                    <button class="btn btn-secondary" onclick="editSearch()">Edit Search</button>
                    <button class="btn btn-secondary" onclick="saveSearch()">Save Search</button>
                    <button class="btn btn-danger" onclick="deleteSearch()">Delete</button>
                </div>
            `;
        }

        function checkoutBranch() {
            const branch = document.getElementById('selectedBranch').textContent.replace('★ ', '');
            showCustomConfirm(
                `确定要切换到分支 <strong>"${branch}"</strong> 吗？`,
                () => {
                    showCustomAlert(`已切换到分支: <strong>${branch}</strong>`, '分支切换', '🌿');
                    // Update UI to show current branch
                    document.querySelector('.repo-info-item:nth-child(2) span:last-child').textContent = branch;
                    // Move the star to the new current branch
                    moveStarToCurrentBranch(branch);
                },
                '切换分支',
                '🌿'
            );
        }

        function moveStarToCurrentBranch(currentBranch) {
            // 更新左侧分支列表，移动星标
            const branchNames = ['main', 'feature/auth', 'develop', 'hotfix/v1.2'];
            const currentIndex = branchNames.indexOf(currentBranch);

            if (currentIndex !== -1) {
                // 更新全局的当前分支索引
                currentBranchIndex = currentIndex;
                // 重新渲染分支列表以显示新的星标位置
                updateDynamicListSafeV2('branches');
                // 更新分支详情显示
                updateBranchDetails(currentIndex, currentBranch);
            }
        }

        function checkoutTag() {
            const tag = document.getElementById('selectedTag').textContent;
            showCustomConfirm(
                `确定要切换到标签 <strong>"${tag}"</strong> 吗？<br><br>⚠️ 注意：这将使您处于 "detached HEAD" 状态`,
                () => {
                    showCustomAlert(`已切换到标签: <strong>${tag}</strong><br><br>⚠️ 您现在处于 "detached HEAD" 状态`, '标签切换', '🏷️');
                    // Update UI to show detached HEAD state
                    document.querySelector('.repo-info-item:nth-child(2) span:last-child').textContent = `${tag} (detached)`;
                    // Clear star from all branches since we're not on any branch
                    currentBranchIndex = -1;
                    if (currentView === 'branches') {
                        updateDynamicListSafeV2('branches');
                    }
                },
                '切换标签',
                '🏷️'
            );
        }

        function createBranch() {
            showCustomPrompt('请输入新分支名称:', (branchName) => {
                if (branchName) {
                    showCustomAlert(`已创建新分支: <strong>${branchName}</strong>`, '创建分支', '🌱');
                    // Add to list
                    selectedBranchIndex = 1; // Select the new branch
                    updateDynamicListSafeV2('branches');
                }
            }, '创建分支', '🌱', '', '例如: feature/new-feature');
        }

        function createTag() {
            showCustomPrompt('请输入新标签名称:', (tagName) => {
                if (tagName) {
                    showCustomPrompt('请输入标签消息 (可选):', (message) => {
                        showCustomAlert(`已创建新标签: <strong>${tagName}</strong>${message ? '<br>消息: ' + message : ''}`, '标签创建', '🏷️');
                        updateDynamicList('tags');
                    }, '标签消息', '💬', '', '例如: 修复重要bug');
                }
            }, '创建标签', '🏷️', '', '例如: v1.0.0');
        }

        function createStash() {
            showCustomPrompt('请输入储藏消息 (可选):', (message) => {
                const stashMessage = message || 'WIP on current branch';
                showCustomAlert(`已创建新储藏: <strong>"stash@{0}: ${stashMessage}"</strong><br><br>当前更改已保存到储藏中。`, '储藏创建', '💾');
                // 在实际实现中，这里会执行 git stash save
            }, '创建储藏', '💾', '', '描述当前工作进度...');
            // 重新加载 stash 列表
            if (currentView === 'stash') {
                updateDynamicList('stash');
            }
        }

        // Stash file selection and operations

        function selectStashFile(element) {
            // Remove previous selection
            document.querySelectorAll('#stashFilesList .file-item').forEach(item => {
                item.classList.remove('selected');
            });

            // Add selection to clicked element
            element.classList.add('selected');

            // Update selected file index
            const allFiles = document.querySelectorAll('#stashFilesList .file-item');
            selectedStashFileIndex = Array.from(allFiles).indexOf(element);

            // Update selected file info if needed
            const fileName = element.dataset.file;
            console.log('Selected stash file:', fileName);
        }

        function showStashFileDiff(event, filePath) {
            event.stopPropagation();
            showCustomAlert(`正在显示文件差异: <strong>${filePath}</strong><br><br>这里会显示在 stash 中该文件的具体更改内容。`, 'Stash 文件差异', '📋');
            // 在实际实现中，这里会打开 diff modal 显示文件的 stash diff
            showDiff();
        }

        function restoreStashFile(event, filePath) {
            event.stopPropagation();
            showCustomConfirm(
                `确定要从 stash 中恢复文件 <strong>"${filePath}"</strong> 吗？<br><br>这将会将该文件的 stash 状态应用到当前工作目录。`,
                () => {
                    showCustomAlert(`已恢复文件: <strong>${filePath}</strong><br>文件更改已从 stash 应用到工作目录。`, 'Stash 文件恢复', '✅');
                    // 在实际实现中，这里会执行 git checkout stash@{0} -- file_path
                },
                '恢复 Stash 文件',
                '💾'
            );
        }

        function applyStash() {
            const stashName = document.getElementById('selectedStash').textContent;
            showCustomConfirm(
                `确定要应用储藏 <strong>"${stashName}"</strong> 吗？<br><br>这将把储藏的更改应用到当前工作目录。`,
                () => {
                    showCustomAlert(`已应用储藏: "${stashName}"<br>更改已应用到工作目录。`, '储藏操作', '✅');
                    // 在实际实现中，这里会执行 git stash apply
                },
                '应用储藏',
                '📋'
            );
        }

        // Enhanced Status View Functions
        function selectFile(element) {
            // Remove previous selection
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('selected');
            });

            // Add selection to clicked element
            element.classList.add('selected');

            // Update selected file info if needed
            const fileName = element.dataset.file;
            console.log('Selected file:', fileName);
        }

        function updateStatusCounts() {
            // Update the count displays in the status view
            const modifiedFiles = document.querySelectorAll('#unstagedFiles .file-item').length;
            const untrackedFiles = document.querySelectorAll('#untrackedFiles .file-item').length;
            const stagedFiles = document.querySelectorAll('#stagedFiles .file-item:not([style*="italic"])').length;

            document.getElementById('modifiedCount').textContent = modifiedFiles;
            document.getElementById('untrackedCount').textContent = untrackedFiles;
            document.getElementById('stagedCount').textContent = stagedFiles;

            // Update section headers
            document.querySelector('#stagedSection h4 span:last-child').textContent = `(${stagedFiles})`;
            document.querySelector('[data-section="unstaged"] span:last-child').textContent = `(${modifiedFiles})`;
            document.querySelector('[data-section="untracked"] span:last-child').textContent = `(${untrackedFiles})`;
        }

        function addAllUntracked() {
            showCustomConfirm(
                '确定要将所有未跟踪的文件添加到暂存区吗？',
                () => {
                    // Move all untracked files to staged
                    const untrackedFiles = document.querySelectorAll('#untrackedFiles .file-item');
                    const stagedContainer = document.getElementById('stagedFiles');

                    // Clear "No changes staged" message if it exists
                    const noChangesMsg = stagedContainer.querySelector('[style*="italic"]');
                    if (noChangesMsg) {
                        noChangesMsg.remove();
                    }

                    untrackedFiles.forEach(fileItem => {
                        // Clone and modify for staged area
                        const stagedItem = fileItem.cloneNode(true);
                        stagedItem.className = 'file-item staged';
                        stagedItem.querySelector('.file-status-icon').textContent = 'A';
                        stagedItem.querySelector('.file-status-icon').style.color = '#4ec9b0';
                        stagedItem.querySelector('.file-stats').textContent = 'added';
                        stagedItem.querySelector('.file-stats').style.color = '#4ec9b0';

                        // Update actions for staged file
                        stagedItem.querySelector('.file-actions').innerHTML = `
                            <button class="btn-small" onclick="unstageFile(event, '${fileItem.dataset.file}')">Unstage</button>
                            <button class="btn-small" onclick="showFileDiff(event, '${fileItem.dataset.file}')">Diff</button>
                        `;

                        stagedContainer.appendChild(stagedItem);
                        fileItem.remove();
                    });

                    updateStatusCounts();
                    showCustomAlert('已将所有未跟踪文件添加到暂存区', '✅ Files Staged');
                },
                'Add All Untracked',
                '📋'
            );
        }

        function refreshStatusView() {
            // Simulate refreshing git status
            showCustomAlert('Git status refreshed', '🔄 Refresh Complete');

            // In a real implementation, this would fetch actual git status
            // For demo purposes, we'll just show a refresh message
            updateStatusCounts();
        }

        // Enhanced file operations with better feedback
        function stageFile(event, fileName) {
            event.stopPropagation();

            showCustomConfirm(
                `Stage changes in <strong>${fileName}</strong>?`,
                () => {
                    // Move file from unstaged to staged section
                    const fileItem = document.querySelector(`[data-file="${fileName}"]`);
                    const stagedContainer = document.getElementById('stagedFiles');

                    // Clear "No changes staged" message if it exists
                    const noChangesMsg = stagedContainer.querySelector('[style*="italic"]');
                    if (noChangesMsg) {
                        noChangesMsg.remove();
                    }

                    // Clone and modify for staged area
                    const stagedItem = fileItem.cloneNode(true);
                    stagedItem.className = 'file-item staged';
                    stagedItem.querySelector('.file-status-icon').style.color = '#4ec9b0';
                    stagedItem.querySelector('.file-stats').style.color = '#4ec9b0';

                    // Update actions for staged file
                    stagedItem.querySelector('.file-actions').innerHTML = `
                        <button class="btn-small" onclick="unstageFile(event, '${fileName}')">Unstage</button>
                        <button class="btn-small" onclick="showFileDiff(event, '${fileName}')">Diff</button>
                    `;

                    stagedContainer.appendChild(stagedItem);
                    fileItem.remove();

                    updateStatusCounts();
                    showCustomAlert(`Staged <strong>${fileName}</strong>`, '✅ File Staged');
                },
                'Stage File',
                '📋'
            );
        }

        function unstageFile(event, fileName) {
            event.stopPropagation();

            showCustomConfirm(
                `Unstage changes in <strong>${fileName}</strong>?`,
                () => {
                    // Move file from staged back to unstaged section
                    const fileItem = document.querySelector(`#stagedFiles [data-file="${fileName}"]`);
                    const unstagedContainer = document.getElementById('unstagedFiles');

                    // Clone and modify for unstaged area
                    const unstagedItem = fileItem.cloneNode(true);
                    unstagedItem.className = 'file-item unstaged';
                    unstagedItem.querySelector('.file-status-icon').style.color = '#f14c4c';
                    unstagedItem.querySelector('.file-stats').style.color = '#569cd6';

                    // Update actions for unstaged file
                    unstagedItem.querySelector('.file-actions').innerHTML = `
                        <button class="btn-small" onclick="stageFile(event, '${fileName}')">Stage</button>
                        <button class="btn-small" onclick="showFileDiff(event, '${fileName}')">Diff</button>
                        <button class="btn-small btn-danger" onclick="discardFile(event, '${fileName}')">Restore</button>
                    `;

                    unstagedContainer.appendChild(unstagedItem);
                    fileItem.remove();

                    // Show "no changes staged" if staged area is empty
                    const stagedContainer = document.getElementById('stagedFiles');
                    if (stagedContainer.children.length === 0) {
                        stagedContainer.innerHTML = `
                            <div style="padding: 12px; background: #2d2d30; border-radius: 4px; text-align: center; color: #969696; font-style: italic;">
                                No changes staged for commit
                            </div>
                        `;
                    }

                    updateStatusCounts();
                    showCustomAlert(`Unstaged <strong>${fileName}</strong>`, '🔄 File Unstaged');
                },
                'Unstage File',
                '🔄'
            );
        }

        function popStash() {
            const stashName = document.getElementById('selectedStash').textContent;
            showCustomConfirm(
                `确定要弹出储藏 <strong>"${stashName}"</strong> 吗？<br><br>这将应用储藏并从储藏列表中删除它。`,
                () => {
                    showCustomAlert(`已弹出储藏: "${stashName}"<br>更改已应用，储藏已删除。`, '储藏操作', '📤');
                    // 模拟从列表中移除储藏
                    selectedStashIndex = Math.max(0, selectedStashIndex - 1);
                    if (currentView === 'stash') {
                        updateDynamicList('stash');
                    }
                    if (selectedStashIndex === 0) {
                        updateStashDetails(0, 'stash@{0}');
                    }
                },
                '弹出储藏',
                '📤'
            );
        }

        function dropStash() {
            const stashName = document.getElementById('selectedStash').textContent;
            showCustomConfirm(
                `确定要删除储藏 <strong>"${stashName}"</strong> 吗？<br><br><strong>⚠️ 这将永久删除该储藏！</strong>`,
                () => {
                    showCustomAlert(`已删除储藏: "${stashName}"<br>储藏已永久删除。`, '储藏操作', '🗑️');
                    // Simulate removing stash from list
                    selectedStashIndex = Math.max(0, selectedStashIndex - 1);
                    if (currentView === 'stash') {
                        updateDynamicList('stash');
                    }
                },
                '删除储藏',
                '🗑️'
            );
        }

        function showStashDiff() {
            const stashName = document.getElementById('selectedStash').textContent;
            showCustomAlert(`正在显示储藏差异: <strong>${stashName}</strong><br><br>这里会显示储藏的详细更改内容。`, '储藏差异', '📋');
            // 在实际实现中，这里会打开 diff modal
            showDiff();
        }

        function resetCommit() {
            const commitHash = document.getElementById('selectedCommitHash').textContent;
            showCustomConfirm(
                `确定要重置到提交 <strong>${commitHash}</strong> 吗？<br><br><strong>⚠️ 此操作将放弃该提交之后的所有更改！</strong><br><br>此操作无法撤销，请谨慎操作。`,
                () => {
                    showCustomAlert(`已重置到提交: ${commitHash}<br>该提交之后的所有更改已被放弃。`, '重置操作', '🔄');
                },
                '重置提交',
                '⚠️'
            );
        }

        function cherryPickCommit() {
            const commitHash = document.getElementById('selectedCommitHash').textContent;
            showCustomConfirm(
                `确定要挑选提交 <strong>${commitHash}</strong> 吗？<br><br>这将把该提交的更改应用到当前分支。`,
                () => {
                    showCustomAlert(`已挑选提交: ${commitHash}<br>更改已应用到当前分支。`, 'Cherry Pick', '🍒');
                },
                '挑选提交',
                '🍒'
            );
        }

        // Remote operations
        function fetchRemote() {
            const remoteName = document.getElementById('selectedRemote').textContent;
            showCustomAlert(`正在从远程获取更新: <strong>${remoteName}</strong><br><br>📡 正在获取最新变更...`, '远程同步', '📡');
        }

        function pullRemote() {
            const remoteName = document.getElementById('selectedRemote').textContent;
            showCustomConfirm(`确认从远程拉取: <strong>${remoteName}</strong>?<br><br>这将合并远程变更到当前分支。`, () => {
                showCustomAlert(`已从远程拉取: <strong>${remoteName}</strong><br><br>✅ 最新变更已合并到当前分支。`, '拉取完成', '📥');
            }, '远程拉取', '📥');
        }

        function pushRemote() {
            const remoteName = document.getElementById('selectedRemote').textContent;
            showCustomConfirm(`确认推送到远程: <strong>${remoteName}</strong>?<br><br>这将上传本地变更到远程仓库。`, () => {
                showCustomAlert(`已推送到远程: <strong>${remoteName}</strong><br><br>📤 本地变更已上传完成。`, '推送完成', '📤');
            }, '远程推送', '📤');
        }

        function removeRemote() {
            const remoteName = document.getElementById('selectedRemote').textContent;
            showCustomConfirm(`删除远程: <strong>${remoteName}</strong>?<br><br>⚠️ 这将删除远程引用！`, () => {
                showCustomAlert(`已删除远程: <strong>${remoteName}</strong><br><br>🗑️ 远程引用已删除。`, '删除完成', '🗑️');
            }, '删除远程', '⚠️');
        }

        // Search history operations
        function executeSearch() {
            const searchTerm = document.getElementById('selectedSearch').textContent;
            showCustomAlert(`正在执行搜索: <strong>${searchTerm}</strong><br><br>🔍 正在搜索仓库...`, '搜索执行', '🔍');
        }

        function editSearch() {
            const searchTerm = document.getElementById('selectedSearch').textContent;
            showCustomPrompt(`编辑搜索条件:`, (newTerm) => {
                if (newTerm && newTerm !== searchTerm) {
                    showCustomAlert(`搜索条件已更新：<br>从 <strong>"${searchTerm}"</strong><br>到 <strong>"${newTerm}"</strong>`, '搜索更新', '✏️');
                }
            }, '编辑搜索', '✏️', searchTerm, '请输入搜索条件...');
        }

        function saveSearch() {
            const searchTerm = document.getElementById('selectedSearch').textContent;
            showCustomPrompt(`保存搜索为:`, (name) => {
                if (name) {
                    showCustomAlert(`已保存搜索: <strong>"${searchTerm}"</strong><br>名称: <strong>"${name}"</strong>`, '搜索保存', '💾');
                }
            }, '保存搜索', '💾', '', '请输入搜索名称...');
        }

        function deleteSearch() {
            const searchTerm = document.getElementById('selectedSearch').textContent;
            showCustomConfirm(`删除搜索: <strong>${searchTerm}</strong>?<br><br>⚠️ 此操作不可撤销！`, () => {
                showCustomAlert(`已删除搜索: <strong>${searchTerm}</strong>`, '删除完成', '🗑️');
            }, '删除搜索', '⚠️');
        }

        /**
         * 测试统一弹窗系统功能
         * 依次演示所有弹窗类型：Alert, Confirm, Prompt
         */
        function testModalSystem() {
            let step = 1;

            // Step 1: 测试Alert弹窗
            showCustomAlert(
                `🎉 欢迎使用统一弹窗系统！<br><br>` +
                `✅ <strong>Alert弹窗</strong> - 用于显示信息和通知<br>` +
                `❓ <strong>Confirm弹窗</strong> - 用于确认操作<br>` +
                `📝 <strong>Prompt弹窗</strong> - 用于输入信息<br><br>` +
                `点击确定继续测试Confirm弹窗...`,
                '弹窗系统测试 (1/3)',
                '🧪'
            );

            // 劫持Alert的确定按钮来继续测试
            setTimeout(() => {
                const alertOkBtn = document.querySelector('#customAlertModal .btn-primary');
                if (alertOkBtn) {
                    const originalOnClick = alertOkBtn.onclick;
                    alertOkBtn.onclick = function() {
                        originalOnClick && originalOnClick();

                        // Step 2: 测试Confirm弹窗
                        setTimeout(() => {
                            showCustomConfirm(
                                `这是 <strong>Confirm确认弹窗</strong> 测试！<br><br>` +
                                `💡 确认弹窗用于需要用户做出选择的场景<br>` +
                                `✅ 点击"确认"继续测试Prompt弹窗<br>` +
                                `❌ 点击"取消"结束测试`,
                                () => {
                                    // Step 3: 测试Prompt弹窗
                                    showCustomPrompt(
                                        `这是 <strong>Prompt输入弹窗</strong> 测试！<br><br>` +
                                        `📝 输入弹窗用于收集用户输入<br>` +
                                        `请输入任意内容来完成测试:`,
                                        (inputValue) => {
                                            if (inputValue) {
                                                showCustomAlert(
                                                    `🎊 弹窗系统测试完成！<br><br>` +
                                                    `您输入的内容: <strong>"${inputValue}"</strong><br><br>` +
                                                    `✨ 所有弹窗类型都已成功测试：<br>` +
                                                    `✅ Alert弹窗 - 信息展示<br>` +
                                                    `❓ Confirm弹窗 - 确认操作<br>` +
                                                    `📝 Prompt弹窗 - 信息输入<br><br>` +
                                                    `统一弹窗系统运行正常！`,
                                                    '测试完成 ✅',
                                                    '🎉'
                                                );
                                            } else {
                                                showCustomAlert(
                                                    `⚠️ 测试已取消<br><br>您没有输入任何内容。`,
                                                    '测试取消',
                                                    '⚠️'
                                                );
                                            }
                                        },
                                        '输入测试 (3/3)',
                                        '📝',
                                        '这是默认输入值',
                                        '请输入测试内容...'
                                    );
                                },
                                '确认测试 (2/3)',
                                '❓'
                            );
                        }, 200);
                    };
                }
            }, 100);
        }

        function deleteBranch() {
            const branch = document.getElementById('selectedBranch').textContent.replace('★ ', '');
            if (branch === 'main') {
                showCustomAlert('无法删除主分支！<br>主分支不能被删除。', '删除分支', '⚠️');
                return;
            }
            showCustomConfirm(
                `确定要删除分支 <strong>"${branch}"</strong> 吗？<br><br>⚠️ 此操作无法撤销！`,
                () => {
                    showCustomAlert(`已删除分支: <strong>${branch}</strong>`, '删除分支', '🗑️');
                    selectedBranchIndex = 0;
                    updateDynamicListSafeV2('branches');
                },
                '删除分支',
                '🗑️'
            );
        }

        function deleteTag() {
            const tag = document.getElementById('selectedTag').textContent;
            showCustomConfirm(
                `确定要删除标签 <strong>"${tag}"</strong> 吗？<br><br>⚠️ 此操作无法撤销！`,
                () => {
                    showCustomAlert(`已删除标签: <strong>${tag}</strong>`, '删除标签', '🗑️');
                    selectedTagIndex = 0;
                    updateDynamicList('tags');
                },
                '删除标签',
                '🗑️'
            );
        }

        // ========================================
        // 🔧 Enhanced Function Implementations
        // ========================================

        /**
         * 清除文件搜索
         */
        function clearFileSearch() {
            SearchManager.clearSearch();
        }

        /**
         * 快速过滤器处理
         */
        function quickFilter(filterType) {
            SearchManager.quickFilter(filterType);
        }

        /**
         * 增强的差异模式切换
         */
        function switchDiffMode(mode) {
            // 移除所有活动状态
            document.querySelectorAll('.diff-mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // 激活当前模式按钮
            const activeBtn = document.querySelector(`[data-mode="${mode}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // 隐藏所有视图
            document.querySelectorAll('#unifiedView, #sideBySideView, #splitView').forEach(view => {
                view.style.display = 'none';
            });

            // 显示选择的视图
            let targetView;
            switch(mode) {
                case 'unified':
                    targetView = document.getElementById('unifiedView');
                    break;
                case 'side-by-side':
                    targetView = document.getElementById('sideBySideView');
                    break;
                case 'split':
                    targetView = document.getElementById('splitView');
                    break;
            }

            if (targetView) {
                targetView.style.display = 'block';
            }

            // 更新状态显示
            const diffModeStatus = document.getElementById('diffModeStatus');
            if (diffModeStatus) {
                diffModeStatus.textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            }

            // 可访问性公告
            if (window.AccessibilityManager) {
                AccessibilityManager.announce(`Switched to ${mode} diff view`);
            }
        }

        /**
         * 差异文件导航
         */
        function navigateDiffFile(direction) {
            // 模拟文件导航逻辑
            const currentFileSpan = document.getElementById('diffCurrentFile');
            if (currentFileSpan) {
                const currentText = currentFileSpan.textContent;
                const match = currentText.match(/(\d+) of (\d+)/);

                if (match) {
                    let current = parseInt(match[1]);
                    const total = parseInt(match[2]);

                    current += direction;
                    if (current < 1) current = total;
                    if (current > total) current = 1;

                    currentFileSpan.textContent = `${current} of ${total}`;

                    // 可访问性公告
                    if (window.AccessibilityManager) {
                        AccessibilityManager.announce(`File ${current} of ${total}`);
                    }
                }
            }
        }

        /**
         * 显示文件列表
         */
        function showFileList() {
            // 创建文件列表模态框或侧边栏
            showCustomAlert(
                `文件导航功能已激活\n\n📁 当前文件: src/core/ai/agents/commit_agent.rs\n📁 下一个: src/tui/layout/manager.rs\n📁 上一个: docs/design.md`,
                '📁 文件列表',
                '📂'
            );
        }

        /**
         * 关闭差异模态框
         */
        function closeDiffModal() {
            const diffModal = DOMUtils.getElementById('diffModal');
            if (diffModal) {
                DOMUtils.safeRemoveClass(diffModal, 'active');

                // 可访问性公告
                if (window.AccessibilityManager) {
                    AccessibilityManager.announce('Diff viewer closed');
                }
            }
        }

        /**
         * 全局错误处理
         */
        window.addEventListener('error', (event) => {
            console.error('Global error caught:', event.error);

            // 可访问性错误公告
            if (window.AccessibilityManager) {
                AccessibilityManager.announce('An error occurred', 'alerts');
            }
        });

        /**
         * 全局未捕获的Promise拒绝处理
         */
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();

            // 可访问性错误公告
            if (window.AccessibilityManager) {
                AccessibilityManager.announce('A system error occurred', 'alerts');
            }
        });

        // ========================================
        // 🎉 Enhanced TUI System Completion
        // ========================================
        console.log(`
        🎉 AI-Commit Enhanced TUI System Loaded Successfully!

        ✅ Features Implemented:
        📊 Advanced Search & Filter System
        ⚡ Performance Optimization (Virtual Scrolling, Lazy Loading)
        ♿ Accessibility Enhancements (ARIA, Screen Reader, Keyboard Nav)
        🎨 Modern Enhanced Diff Viewer
        🔧 Modular Architecture with Event Management
        🛡️ Security & Memory Management
        🔥 Meld-Style Conflict Resolution System
        ↔️ Interactive Three-Way Merge Interface
        🎯 Line-by-Line Diff Visualization
        🔄 Git Workflow Management (Interactive Rebase, Merge)
        👥 Team Collaboration Features (PR, Reviews, Stats)

        🚀 Ready for enhanced Git repository management!
        `);
    </script>

    <!-- Enhanced Conflict Resolution Modal -->
    <div class="modal" id="conflictResolutionModal">
        <div class="modal-content conflict-resolution-modal">
            <div class="conflict-modal-header">
                <div class="modal-title">
                    <span>⚡ 冲突解决器</span>
                    <span id="conflictFileName" style="margin-left: 12px; font-weight: normal;"></span>
                </div>
                <button class="close-btn" onclick="closeConflictResolution()">&times;</button>
            </div>

            <!-- File Tabs for Multiple Conflicts -->
            <div class="conflict-file-tabs" id="conflictFileTabs">
                <!-- Tabs will be populated by JavaScript -->
            </div>

            <!-- Meld-Style Diff Navigation -->
            <div class="diff-navigation">
                <div class="diff-nav-buttons">
                    <button class="diff-nav-btn" onclick="MeldDiffViewer.previousDiff()" id="prevDiffBtn">
                        ⬆️ 上一个差异
                    </button>
                    <button class="diff-nav-btn" onclick="MeldDiffViewer.nextDiff()" id="nextDiffBtn">
                        ⬇️ 下一个差异
                    </button>
                    <button class="diff-nav-btn" onclick="MeldDiffViewer.syncScroll()" id="syncScrollBtn">
                        🔄 同步滚动
                    </button>
                </div>
                <div class="diff-stats" id="diffStats">
                    <div class="diff-stat diff-stat-added">
                        <span>+</span>
                        <span id="addedLines">0</span>
                    </div>
                    <div class="diff-stat diff-stat-deleted">
                        <span>-</span>
                        <span id="deletedLines">0</span>
                    </div>
                    <div class="diff-stat diff-stat-modified">
                        <span>~</span>
                        <span id="modifiedLines">0</span>
                    </div>
                </div>
            </div>

            <!-- Meld-Style Three-Way Diff View -->
            <div class="meld-diff-container" id="meldDiffContainer">
                <!-- Content will be populated by JavaScript -->
            </div>

            <!-- Conflict Resolution Controls -->
            <div class="conflict-controls">
                <div class="conflict-progress">
                    <span>解决进度:</span>
                    <div class="conflict-progress-bar">
                        <div class="conflict-progress-fill" id="conflictProgressFill" style="width: 0%"></div>
                    </div>
                    <span id="conflictProgressText">0/0 已解决</span>
                </div>

                <div class="conflict-actions">
                    <button class="btn btn-secondary" onclick="resetConflictResolution()">🔄 重置</button>
                    <button class="btn btn-warning" onclick="previewConflictResult()">👁️ 预览</button>
                    <button class="btn btn-success" onclick="saveConflictResolution()" id="saveConflictBtn" disabled>💾 保存解决方案</button>
                    <button class="btn btn-danger" onclick="closeConflictResolution()">❌ 取消</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>